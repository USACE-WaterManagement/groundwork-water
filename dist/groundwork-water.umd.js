(function(ci,Zt){typeof exports=="object"&&typeof module<"u"?Zt(exports,require("react"),require("plotly.js-basic-dist"),require("@tanstack/react-query")):typeof define=="function"&&define.amd?define(["exports","react","plotly.js-basic-dist","@tanstack/react-query"],Zt):(ci=typeof globalThis<"u"?globalThis:ci||self,Zt(ci.GroundworkWater={},ci.React,ci.Plotly,ci.ReactQuery))})(this,function(ci,Zt,qn,$n){"use strict";var Qn=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function ta(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Gn={exports:{}},Hr={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ea;function Sa(){if(ea)return Hr;ea=1;var t=Zt,e=Symbol.for("react.element"),i=Symbol.for("react.fragment"),r=Object.prototype.hasOwnProperty,n=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,a={key:!0,ref:!0,__self:!0,__source:!0};function o(s,l,h){var u,f={},c=null,d=null;h!==void 0&&(c=""+h),l.key!==void 0&&(c=""+l.key),l.ref!==void 0&&(d=l.ref);for(u in l)r.call(l,u)&&!a.hasOwnProperty(u)&&(f[u]=l[u]);if(s&&s.defaultProps)for(u in l=s.defaultProps,l)f[u]===void 0&&(f[u]=l[u]);return{$$typeof:e,type:s,key:c,ref:d,props:f,_owner:n.current}}return Hr.Fragment=i,Hr.jsx=o,Hr.jsxs=o,Hr}var Kr={};/**
 * @license React
 * react-jsx-runtime.development.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ia;function La(){return ia||(ia=1,process.env.NODE_ENV!=="production"&&function(){var t=Zt,e=Symbol.for("react.element"),i=Symbol.for("react.portal"),r=Symbol.for("react.fragment"),n=Symbol.for("react.strict_mode"),a=Symbol.for("react.profiler"),o=Symbol.for("react.provider"),s=Symbol.for("react.context"),l=Symbol.for("react.forward_ref"),h=Symbol.for("react.suspense"),u=Symbol.for("react.suspense_list"),f=Symbol.for("react.memo"),c=Symbol.for("react.lazy"),d=Symbol.for("react.offscreen"),v=Symbol.iterator,E="@@iterator";function p(T){if(T===null||typeof T!="object")return null;var G=v&&T[v]||T[E];return typeof G=="function"?G:null}var m=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;function y(T){{for(var G=arguments.length,Y=new Array(G>1?G-1:0),at=1;at<G;at++)Y[at-1]=arguments[at];R("error",T,Y)}}function R(T,G,Y){{var at=m.ReactDebugCurrentFrame,bt=at.getStackAddendum();bt!==""&&(G+="%s",Y=Y.concat([bt]));var kt=Y.map(function(pt){return String(pt)});kt.unshift("Warning: "+G),Function.prototype.apply.call(console[T],console,kt)}}var C=!1,x=!1,I=!1,D=!1,O=!1,B;B=Symbol.for("react.module.reference");function W(T){return!!(typeof T=="string"||typeof T=="function"||T===r||T===a||O||T===n||T===h||T===u||D||T===d||C||x||I||typeof T=="object"&&T!==null&&(T.$$typeof===c||T.$$typeof===f||T.$$typeof===o||T.$$typeof===s||T.$$typeof===l||T.$$typeof===B||T.getModuleId!==void 0))}function N(T,G,Y){var at=T.displayName;if(at)return at;var bt=G.displayName||G.name||"";return bt!==""?Y+"("+bt+")":Y}function P(T){return T.displayName||"Context"}function $(T){if(T==null)return null;if(typeof T.tag=="number"&&y("Received an unexpected object in getComponentNameFromType(). This is likely a bug in React. Please file an issue."),typeof T=="function")return T.displayName||T.name||null;if(typeof T=="string")return T;switch(T){case r:return"Fragment";case i:return"Portal";case a:return"Profiler";case n:return"StrictMode";case h:return"Suspense";case u:return"SuspenseList"}if(typeof T=="object")switch(T.$$typeof){case s:var G=T;return P(G)+".Consumer";case o:var Y=T;return P(Y._context)+".Provider";case l:return N(T,T.render,"ForwardRef");case f:var at=T.displayName||null;return at!==null?at:$(T.type)||"Memo";case c:{var bt=T,kt=bt._payload,pt=bt._init;try{return $(pt(kt))}catch{return null}}}return null}var b=Object.assign,M=0,F,X,U,Z,z,Q,rt;function ft(){}ft.__reactDisabledLog=!0;function Ct(){{if(M===0){F=console.log,X=console.info,U=console.warn,Z=console.error,z=console.group,Q=console.groupCollapsed,rt=console.groupEnd;var T={configurable:!0,enumerable:!0,value:ft,writable:!0};Object.defineProperties(console,{info:T,log:T,warn:T,error:T,group:T,groupCollapsed:T,groupEnd:T})}M++}}function yt(){{if(M--,M===0){var T={configurable:!0,enumerable:!0,writable:!0};Object.defineProperties(console,{log:b({},T,{value:F}),info:b({},T,{value:X}),warn:b({},T,{value:U}),error:b({},T,{value:Z}),group:b({},T,{value:z}),groupCollapsed:b({},T,{value:Q}),groupEnd:b({},T,{value:rt})})}M<0&&y("disabledDepth fell below zero. This is a bug in React. Please file an issue.")}}var jt=m.ReactCurrentDispatcher,It;function ie(T,G,Y){{if(It===void 0)try{throw Error()}catch(bt){var at=bt.stack.trim().match(/\n( *(at )?)/);It=at&&at[1]||""}return`
`+It+T}}var xe=!1,Bt;{var Ce=typeof WeakMap=="function"?WeakMap:Map;Bt=new Ce}function ke(T,G){if(!T||xe)return"";{var Y=Bt.get(T);if(Y!==void 0)return Y}var at;xe=!0;var bt=Error.prepareStackTrace;Error.prepareStackTrace=void 0;var kt;kt=jt.current,jt.current=null,Ct();try{if(G){var pt=function(){throw Error()};if(Object.defineProperty(pt.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(pt,[])}catch(oi){at=oi}Reflect.construct(T,[],pt)}else{try{pt.call()}catch(oi){at=oi}T.call(pt.prototype)}}else{try{throw Error()}catch(oi){at=oi}T()}}catch(oi){if(oi&&at&&typeof oi.stack=="string"){for(var ct=oi.stack.split(`
`),ei=at.stack.split(`
`),he=ct.length-1,ye=ei.length-1;he>=1&&ye>=0&&ct[he]!==ei[ye];)ye--;for(;he>=1&&ye>=0;he--,ye--)if(ct[he]!==ei[ye]){if(he!==1||ye!==1)do if(he--,ye--,ye<0||ct[he]!==ei[ye]){var Ti=`
`+ct[he].replace(" at new "," at ");return T.displayName&&Ti.includes("<anonymous>")&&(Ti=Ti.replace("<anonymous>",T.displayName)),typeof T=="function"&&Bt.set(T,Ti),Ti}while(he>=1&&ye>=0);break}}}finally{xe=!1,jt.current=kt,yt(),Error.prepareStackTrace=bt}var Vr=T?T.displayName||T.name:"",wr=Vr?ie(Vr):"";return typeof T=="function"&&Bt.set(T,wr),wr}function Fe(T,G,Y){return ke(T,!1)}function fi(T){var G=T.prototype;return!!(G&&G.isReactComponent)}function cr(T,G,Y){if(T==null)return"";if(typeof T=="function")return ke(T,fi(T));if(typeof T=="string")return ie(T);switch(T){case h:return ie("Suspense");case u:return ie("SuspenseList")}if(typeof T=="object")switch(T.$$typeof){case l:return Fe(T.render);case f:return cr(T.type,G,Y);case c:{var at=T,bt=at._payload,kt=at._init;try{return cr(kt(bt),G,Y)}catch{}}}return""}var ki=Object.prototype.hasOwnProperty,ir={},Xi=m.ReactDebugCurrentFrame;function Ei(T){if(T){var G=T._owner,Y=cr(T.type,T._source,G?G.type:null);Xi.setExtraStackFrame(Y)}else Xi.setExtraStackFrame(null)}function wn(T,G,Y,at,bt){{var kt=Function.call.bind(ki);for(var pt in T)if(kt(T,pt)){var ct=void 0;try{if(typeof T[pt]!="function"){var ei=Error((at||"React class")+": "+Y+" type `"+pt+"` is invalid; it must be a function, usually from the `prop-types` package, but received `"+typeof T[pt]+"`.This often happens because of typos such as `PropTypes.function` instead of `PropTypes.func`.");throw ei.name="Invariant Violation",ei}ct=T[pt](G,pt,at,Y,null,"SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED")}catch(he){ct=he}ct&&!(ct instanceof Error)&&(Ei(bt),y("%s: type specification of %s `%s` is invalid; the type checker function must return `null` or an `Error` but returned a %s. You may have forgotten to pass an argument to the type checker creator (arrayOf, instanceOf, objectOf, oneOf, oneOfType, and shape all require an argument).",at||"React class",Y,pt,typeof ct),Ei(null)),ct instanceof Error&&!(ct.message in ir)&&(ir[ct.message]=!0,Ei(bt),y("Failed %s type: %s",Y,ct.message),Ei(null))}}}var On=Array.isArray;function Ir(T){return On(T)}function zn(T){{var G=typeof Symbol=="function"&&Symbol.toStringTag,Y=G&&T[Symbol.toStringTag]||T.constructor.name||"Object";return Y}}function Pn(T){try{return Mn(T),!1}catch{return!0}}function Mn(T){return""+T}function en(T){if(Pn(T))return y("The provided key is an unsupported type %s. This value must be coerced to a string before before using it here.",zn(T)),Mn(T)}var dr=m.ReactCurrentOwner,Dn={key:!0,ref:!0,__self:!0,__source:!0},rn,nn,Sr;Sr={};function bn(T){if(ki.call(T,"ref")){var G=Object.getOwnPropertyDescriptor(T,"ref").get;if(G&&G.isReactWarning)return!1}return T.ref!==void 0}function Fn(T){if(ki.call(T,"key")){var G=Object.getOwnPropertyDescriptor(T,"key").get;if(G&&G.isReactWarning)return!1}return T.key!==void 0}function Nn(T,G){if(typeof T.ref=="string"&&dr.current&&G&&dr.current.stateNode!==G){var Y=$(dr.current.type);Sr[Y]||(y('Component "%s" contains the string ref "%s". Support for string refs will be removed in a future major release. This case cannot be automatically converted to an arrow function. We ask you to manually fix this case by using useRef() or createRef() instead. Learn more about using refs safely here: https://reactjs.org/link/strict-mode-string-ref',$(dr.current.type),T.ref),Sr[Y]=!0)}}function jn(T,G){{var Y=function(){rn||(rn=!0,y("%s: `key` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://reactjs.org/link/special-props)",G))};Y.isReactWarning=!0,Object.defineProperty(T,"key",{get:Y,configurable:!0})}}function Zn(T,G){{var Y=function(){nn||(nn=!0,y("%s: `ref` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://reactjs.org/link/special-props)",G))};Y.isReactWarning=!0,Object.defineProperty(T,"ref",{get:Y,configurable:!0})}}var Lr=function(T,G,Y,at,bt,kt,pt){var ct={$$typeof:e,type:T,key:G,ref:Y,props:pt,_owner:kt};return ct._store={},Object.defineProperty(ct._store,"validated",{configurable:!1,enumerable:!1,writable:!0,value:!1}),Object.defineProperty(ct,"_self",{configurable:!1,enumerable:!1,writable:!1,value:at}),Object.defineProperty(ct,"_source",{configurable:!1,enumerable:!1,writable:!1,value:bt}),Object.freeze&&(Object.freeze(ct.props),Object.freeze(ct)),ct};function Yi(T,G,Y,at,bt){{var kt,pt={},ct=null,ei=null;Y!==void 0&&(en(Y),ct=""+Y),Fn(G)&&(en(G.key),ct=""+G.key),bn(G)&&(ei=G.ref,Nn(G,bt));for(kt in G)ki.call(G,kt)&&!Dn.hasOwnProperty(kt)&&(pt[kt]=G[kt]);if(T&&T.defaultProps){var he=T.defaultProps;for(kt in he)pt[kt]===void 0&&(pt[kt]=he[kt])}if(ct||ei){var ye=typeof T=="function"?T.displayName||T.name||"Unknown":T;ct&&jn(pt,ye),ei&&Zn(pt,ye)}return Lr(T,ct,ei,bt,at,dr.current,pt)}}var _r=m.ReactCurrentOwner,Ar=m.ReactDebugCurrentFrame;function Xe(T){if(T){var G=T._owner,Y=cr(T.type,T._source,G?G.type:null);Ar.setExtraStackFrame(Y)}else Ar.setExtraStackFrame(null)}var $e;$e=!1;function Yr(T){return typeof T=="object"&&T!==null&&T.$$typeof===e}function Ea(){{if(_r.current){var T=$(_r.current.type);if(T)return`

Check the render method of \``+T+"`."}return""}}function Oo(T){return""}var Ta={};function Po(T){{var G=Ea();if(!G){var Y=typeof T=="string"?T:T.displayName||T.name;Y&&(G=`

Check the top-level render call using <`+Y+">.")}return G}}function Ra(T,G){{if(!T._store||T._store.validated||T.key!=null)return;T._store.validated=!0;var Y=Po(G);if(Ta[Y])return;Ta[Y]=!0;var at="";T&&T._owner&&T._owner!==_r.current&&(at=" It was passed a child from "+$(T._owner.type)+"."),Xe(T),y('Each child in a list should have a unique "key" prop.%s%s See https://reactjs.org/link/warning-keys for more information.',Y,at),Xe(null)}}function xa(T,G){{if(typeof T!="object")return;if(Ir(T))for(var Y=0;Y<T.length;Y++){var at=T[Y];Yr(at)&&Ra(at,G)}else if(Yr(T))T._store&&(T._store.validated=!0);else if(T){var bt=p(T);if(typeof bt=="function"&&bt!==T.entries)for(var kt=bt.call(T),pt;!(pt=kt.next()).done;)Yr(pt.value)&&Ra(pt.value,G)}}}function Mo(T){{var G=T.type;if(G==null||typeof G=="string")return;var Y;if(typeof G=="function")Y=G.propTypes;else if(typeof G=="object"&&(G.$$typeof===l||G.$$typeof===f))Y=G.propTypes;else return;if(Y){var at=$(G);wn(Y,T.props,"prop",at,T)}else if(G.PropTypes!==void 0&&!$e){$e=!0;var bt=$(G);y("Component %s declared `PropTypes` instead of `propTypes`. Did you misspell the property assignment?",bt||"Unknown")}typeof G.getDefaultProps=="function"&&!G.getDefaultProps.isReactClassApproved&&y("getDefaultProps is only used on classic React.createClass definitions. Use a static property named `defaultProps` instead.")}}function Do(T){{for(var G=Object.keys(T.props),Y=0;Y<G.length;Y++){var at=G[Y];if(at!=="children"&&at!=="key"){Xe(T),y("Invalid prop `%s` supplied to `React.Fragment`. React.Fragment can only have `key` and `children` props.",at),Xe(null);break}}T.ref!==null&&(Xe(T),y("Invalid attribute `ref` supplied to `React.Fragment`."),Xe(null))}}var Ca={};function Ia(T,G,Y,at,bt,kt){{var pt=W(T);if(!pt){var ct="";(T===void 0||typeof T=="object"&&T!==null&&Object.keys(T).length===0)&&(ct+=" You likely forgot to export your component from the file it's defined in, or you might have mixed up default and named imports.");var ei=Oo();ei?ct+=ei:ct+=Ea();var he;T===null?he="null":Ir(T)?he="array":T!==void 0&&T.$$typeof===e?(he="<"+($(T.type)||"Unknown")+" />",ct=" Did you accidentally export a JSX literal instead of a component?"):he=typeof T,y("React.jsx: type is invalid -- expected a string (for built-in components) or a class/function (for composite components) but got: %s.%s",he,ct)}var ye=Yi(T,G,Y,bt,kt);if(ye==null)return ye;if(pt){var Ti=G.children;if(Ti!==void 0)if(at)if(Ir(Ti)){for(var Vr=0;Vr<Ti.length;Vr++)xa(Ti[Vr],T);Object.freeze&&Object.freeze(Ti)}else y("React.jsx: Static children should always be an array. You are likely explicitly calling React.jsxs or React.jsxDEV. Use the Babel transform instead.");else xa(Ti,T)}if(ki.call(G,"key")){var wr=$(T),oi=Object.keys(G).filter(function(Bo){return Bo!=="key"}),Jn=oi.length>0?"{key: someKey, "+oi.join(": ..., ")+": ...}":"{key: someKey}";if(!Ca[wr+Jn]){var Uo=oi.length>0?"{"+oi.join(": ..., ")+": ...}":"{}";y(`A props object containing a "key" prop is being spread into JSX:
  let props = %s;
  <%s {...props} />
React keys must be passed directly to JSX without using spread:
  let props = %s;
  <%s key={someKey} {...props} />`,Jn,wr,Uo,wr),Ca[wr+Jn]=!0}}return T===r?Do(ye):Mo(ye),ye}}function bo(T,G,Y){return Ia(T,G,Y,!0)}function Fo(T,G,Y){return Ia(T,G,Y,!1)}var No=Fo,Go=bo;Kr.Fragment=r,Kr.jsx=No,Kr.jsxs=Go}()),Kr}process.env.NODE_ENV==="production"?Gn.exports=Sa():Gn.exports=La();var mt=Gn.exports,vr=function(t,e,i,r){function n(a){return a instanceof i?a:new i(function(o){o(a)})}return new(i||(i=Promise))(function(a,o){function s(u){try{h(r.next(u))}catch(f){o(f)}}function l(u){try{h(r.throw(u))}catch(f){o(f)}}function h(u){u.done?a(u.value):n(u.value).then(s,l)}h((r=r.apply(t,e||[])).next())})};const Aa="https://cwms-data.usace.army.mil/cwms-data".replace(/\/+$/,"");class an{constructor(e={}){this.configuration=e}set config(e){this.configuration=e}get basePath(){return this.configuration.basePath!=null?this.configuration.basePath:Aa}get fetchApi(){return this.configuration.fetchApi}get middleware(){return this.configuration.middleware||[]}get queryParamsStringify(){return this.configuration.queryParamsStringify||ra}get username(){return this.configuration.username}get password(){return this.configuration.password}get apiKey(){const e=this.configuration.apiKey;if(e)return typeof e=="function"?e:()=>e}get accessToken(){const e=this.configuration.accessToken;if(e)return typeof e=="function"?e:()=>vr(this,void 0,void 0,function*(){return e})}get headers(){return this.configuration.headers}get credentials(){return this.configuration.credentials}}const wa=new an;class on{constructor(e=wa){this.configuration=e,this.fetchApi=(i,r)=>vr(this,void 0,void 0,function*(){let n={url:i,init:r};for(const o of this.middleware)o.pre&&(n=(yield o.pre(Object.assign({fetch:this.fetchApi},n)))||n);let a;try{a=yield(this.configuration.fetchApi||fetch)(n.url,n.init)}catch(o){for(const s of this.middleware)s.onError&&(a=(yield s.onError({fetch:this.fetchApi,url:n.url,init:n.init,error:o,response:a?a.clone():void 0}))||a);if(a===void 0)throw o instanceof Error?new Da(o,"The request failed and the interceptors did not return an alternative response"):o}for(const o of this.middleware)o.post&&(a=(yield o.post({fetch:this.fetchApi,url:n.url,init:n.init,response:a.clone()}))||a);return a}),this.middleware=e.middleware}withMiddleware(...e){const i=this.clone();return i.middleware=i.middleware.concat(...e),i}withPreMiddleware(...e){const i=e.map(r=>({pre:r}));return this.withMiddleware(...i)}withPostMiddleware(...e){const i=e.map(r=>({post:r}));return this.withMiddleware(...i)}isJsonMime(e){return e?on.jsonRegex.test(e):!1}request(e,i){return vr(this,void 0,void 0,function*(){const{url:r,init:n}=yield this.createFetchParams(e,i),a=yield this.fetchApi(r,n);if(a&&a.status>=200&&a.status<300)return a;throw new Ma(a,"Response returned an error code")})}createFetchParams(e,i){return vr(this,void 0,void 0,function*(){let r=this.configuration.basePath+e.path;e.query!==void 0&&Object.keys(e.query).length!==0&&(r+="?"+this.configuration.queryParamsStringify(e.query));const n=Object.assign({},this.configuration.headers,e.headers);Object.keys(n).forEach(u=>n[u]===void 0?delete n[u]:{});const a=typeof i=="function"?i:()=>vr(this,void 0,void 0,function*(){return i}),o={method:e.method,headers:n,body:e.body,credentials:this.configuration.credentials},s=Object.assign(Object.assign({},o),yield a({init:o,context:e}));let l;Pa(s.body)||s.body instanceof URLSearchParams||Oa(s.body)?l=s.body:this.isJsonMime(n["Content-Type"])?l=JSON.stringify(s.body):l=s.body;const h=Object.assign(Object.assign({},s),{body:l});return{url:r,init:h}})}clone(){const e=this.constructor,i=new e(this.configuration);return i.middleware=this.middleware.slice(),i}}on.jsonRegex=new RegExp("^(:?application/json|[^;/ 	]+/[^;/ 	]+[+]json)[ 	]*(:?;.*)?$","i");function Oa(t){return typeof Blob<"u"&&t instanceof Blob}function Pa(t){return typeof FormData<"u"&&t instanceof FormData}class Ma extends Error{constructor(e,i){super(i),this.response=e,this.name="ResponseError"}}class Da extends Error{constructor(e,i){super(i),this.cause=e,this.name="FetchError"}}class rr extends Error{constructor(e,i){super(i),this.field=e,this.name="RequiredError"}}function ra(t,e=""){return Object.keys(t).map(i=>na(i,t[i],e)).filter(i=>i.length>0).join("&")}function na(t,e,i=""){const r=i+(i.length?`[${t}]`:t);if(e instanceof Array){const n=e.map(a=>encodeURIComponent(String(a))).join(`&${encodeURIComponent(r)}=`);return`${encodeURIComponent(r)}=${n}`}if(e instanceof Set){const n=Array.from(e);return na(t,n,i)}return e instanceof Date?`${encodeURIComponent(r)}=${encodeURIComponent(e.toISOString())}`:e instanceof Object?ra(e,r):`${encodeURIComponent(r)}=${encodeURIComponent(String(e))}`}class ba{constructor(e,i=r=>r){this.raw=e,this.transformer=i}value(){return vr(this,void 0,void 0,function*(){return this.transformer(yield this.raw.json())})}}class Un{constructor(e){this.raw=e}value(){return vr(this,void 0,void 0,function*(){})}}function Fa(t){return Na(t)}function Na(t,e){return t==null?t:{estimate:t.estimate==null?void 0:t.estimate,toDatum:t.toDatum==null?void 0:t.toDatum,value:t.value==null?void 0:t.value}}function Ga(t){return t==null?t:{estimate:t.estimate,toDatum:t.toDatum,value:t.value}}function Ua(t){return Ba(t)}function Ba(t,e){return t==null?t:{name:t.name==null?void 0:t.name,ordinal:t.ordinal==null?void 0:t.ordinal,datatype:t.datatype==null?void 0:t.datatype}}function Wa(t){return ka(t)}function ka(t,e){return t==null?t:{seconds:t.seconds==null?void 0:t.seconds,nano:t.nano==null?void 0:t.nano,zero:t.zero==null?void 0:t.zero,negative:t.negative==null?void 0:t.negative}}function Xa(t){return t==null?t:{seconds:t.seconds,nano:t.nano,zero:t.zero,negative:t.negative}}function Ya(t){return Va(t)}function Va(t,e){return t==null?t:{duration:t.duration==null?void 0:Wa(t.duration),durationEstimated:t.durationEstimated==null?void 0:t.durationEstimated,dateBased:t.dateBased==null?void 0:t.dateBased,timeBased:t.timeBased==null?void 0:t.timeBased}}function Ha(t){return t==null?t:{duration:Xa(t.duration),durationEstimated:t.durationEstimated,dateBased:t.dateBased,timeBased:t.timeBased}}function Ka(t){return za(t)}function za(t,e){return t==null?t:{seconds:t.seconds==null?void 0:t.seconds,nano:t.nano==null?void 0:t.nano,zero:t.zero==null?void 0:t.zero,units:t.units==null?void 0:t.units.map(Ya),negative:t.negative==null?void 0:t.negative}}function ja(t){return t==null?t:{seconds:t.seconds,nano:t.nano,zero:t.zero,units:t.units==null?void 0:t.units.map(Ha),negative:t.negative}}function Za(t){return Ja(t)}function Ja(t,e){return t==null?t:{office:t.office==null?void 0:t.office,unit:t.unit==null?void 0:t.unit,location:t.location==null?void 0:t.location,nativeDatum:t["native-datum"]==null?void 0:t["native-datum"],elevation:t.elevation==null?void 0:t.elevation,offsets:t.offsets==null?void 0:t.offsets.map(Fa)}}function qa(t){return t==null?t:{office:t.office,unit:t.unit,location:t.location,"native-datum":t.nativeDatum,elevation:t.elevation,offsets:t.offsets==null?void 0:t.offsets.map(Ga)}}function $a(t){return Qa(t)}function Qa(t,e){return t==null?t:{begin:t.begin==null?void 0:new Date(t.begin),end:t.end==null?void 0:new Date(t.end),interval:t.interval==null?void 0:Ka(t.interval),intervalOffset:t["interval-offset"]==null?void 0:t["interval-offset"],name:t.name==null?void 0:t.name,nextPage:t["next-page"]==null?void 0:t["next-page"],officeId:t["office-id"]==null?void 0:t["office-id"],page:t.page==null?void 0:t.page,pageSize:t["page-size"]==null?void 0:t["page-size"],timeZone:t["time-zone"]==null?void 0:t["time-zone"],total:t.total==null?void 0:t.total,units:t.units,valueColumns:t["value-columns"]==null?void 0:t["value-columns"].map(Ua),values:t.values==null?void 0:t.values,verticalDatumInfo:t["vertical-datum-info"]==null?void 0:Za(t["vertical-datum-info"])}}function aa(t){return t==null?t:{interval:ja(t.interval),name:t.name,"office-id":t.officeId,units:t.units,values:t.values,"vertical-datum-info":qa(t.verticalDatumInfo)}}var nr=function(t,e,i,r){function n(a){return a instanceof i?a:new i(function(o){o(a)})}return new(i||(i=Promise))(function(a,o){function s(u){try{h(r.next(u))}catch(f){o(f)}}function l(u){try{h(r.throw(u))}catch(f){o(f)}}function h(u){u.done?a(u.value):n(u.value).then(s,l)}h((r=r.apply(t,e||[])).next())})};class Bn extends on{deleteCwmsDataTimeseriesWithTimeseriesRaw(e,i){return nr(this,void 0,void 0,function*(){if(e.timeseries==null)throw new rr("timeseries",'Required parameter "timeseries" was null or undefined when calling deleteCwmsDataTimeseriesWithTimeseries().');if(e.office==null)throw new rr("office",'Required parameter "office" was null or undefined when calling deleteCwmsDataTimeseriesWithTimeseries().');if(e.begin==null)throw new rr("begin",'Required parameter "begin" was null or undefined when calling deleteCwmsDataTimeseriesWithTimeseries().');if(e.end==null)throw new rr("end",'Required parameter "end" was null or undefined when calling deleteCwmsDataTimeseriesWithTimeseries().');const r={};e.office!=null&&(r.office=e.office),e.begin!=null&&(r.begin=e.begin),e.end!=null&&(r.end=e.end),e.timezone!=null&&(r.timezone=e.timezone),e.versionDate!=null&&(r["version-date"]=e.versionDate),e.startTimeInclusive!=null&&(r["start-time-inclusive"]=e.startTimeInclusive),e.endTimeInclusive!=null&&(r["end-time-inclusive"]=e.endTimeInclusive),e.maxVersion!=null&&(r["max-version"]=e.maxVersion),e.overrideProtection!=null&&(r["override-protection"]=e.overrideProtection);const n={};this.configuration&&this.configuration.apiKey&&(n.Authorization=yield this.configuration.apiKey("Authorization"));const a=yield this.request({path:"/timeseries/{timeseries}".replace("{timeseries}",encodeURIComponent(String(e.timeseries))),method:"DELETE",headers:n,query:r},i);return new Un(a)})}deleteCwmsDataTimeseriesWithTimeseries(e,i){return nr(this,void 0,void 0,function*(){yield this.deleteCwmsDataTimeseriesWithTimeseriesRaw(e,i)})}getCwmsDataTimeseriesRaw(e,i){return nr(this,void 0,void 0,function*(){if(e.name==null)throw new rr("name",'Required parameter "name" was null or undefined when calling getCwmsDataTimeseries().');const r={};e.name!=null&&(r.name=e.name),e.office!=null&&(r.office=e.office),e.unit!=null&&(r.unit=e.unit),e.datum!=null&&(r.datum=e.datum),e.begin!=null&&(r.begin=e.begin),e.end!=null&&(r.end=e.end),e.timezone!=null&&(r.timezone=e.timezone),e.format!=null&&(r.format=e.format),e.page!=null&&(r.page=e.page),e.pageSize!=null&&(r["page-size"]=e.pageSize);const n={},a=yield this.request({path:"/timeseries",method:"GET",headers:n,query:r},i);return new ba(a,o=>$a(o))})}getCwmsDataTimeseries(e,i){return nr(this,void 0,void 0,function*(){return yield(yield this.getCwmsDataTimeseriesRaw(e,i)).value()})}patchCwmsDataTimeseriesWithTimeseriesRaw(e,i){return nr(this,void 0,void 0,function*(){if(e.timeseries==null)throw new rr("timeseries",'Required parameter "timeseries" was null or undefined when calling patchCwmsDataTimeseriesWithTimeseries().');if(e.timeSeries==null)throw new rr("timeSeries",'Required parameter "timeSeries" was null or undefined when calling patchCwmsDataTimeseriesWithTimeseries().');const r={};e.versionDate!=null&&(r["version-date"]=e.versionDate),e.timezone!=null&&(r.timezone=e.timezone),e.createAsLrts!=null&&(r["create-as-lrts"]=e.createAsLrts),e.storeRule!=null&&(r["store-rule"]=e.storeRule),e.overrideProtection!=null&&(r["override-protection"]=e.overrideProtection);const n={};n["Content-Type"]="application/json;version=2",this.configuration&&this.configuration.apiKey&&(n.Authorization=yield this.configuration.apiKey("Authorization"));const a=yield this.request({path:"/timeseries/{timeseries}".replace("{timeseries}",encodeURIComponent(String(e.timeseries))),method:"PATCH",headers:n,query:r,body:aa(e.timeSeries)},i);return new Un(a)})}patchCwmsDataTimeseriesWithTimeseries(e,i){return nr(this,void 0,void 0,function*(){yield this.patchCwmsDataTimeseriesWithTimeseriesRaw(e,i)})}postCwmsDataTimeseriesRaw(e,i){return nr(this,void 0,void 0,function*(){if(e.timeSeries==null)throw new rr("timeSeries",'Required parameter "timeSeries" was null or undefined when calling postCwmsDataTimeseries().');const r={};e.versionDate!=null&&(r["version-date"]=e.versionDate),e.timezone!=null&&(r.timezone=e.timezone),e.createAsLrts!=null&&(r["create-as-lrts"]=e.createAsLrts),e.storeRule!=null&&(r["store-rule"]=e.storeRule),e.overrideProtection!=null&&(r["override-protection"]=e.overrideProtection);const n={};n["Content-Type"]="application/json;version=2",this.configuration&&this.configuration.apiKey&&(n.Authorization=yield this.configuration.apiKey("Authorization"));const a=yield this.request({path:"/timeseries",method:"POST",headers:n,query:r,body:aa(e.timeSeries)},i);return new Un(a)})}postCwmsDataTimeseries(e,i){return nr(this,void 0,void 0,function*(){yield this.postCwmsDataTimeseriesRaw(e,i)})}}const to=new an({headers:{accept:"application/json;version=2"}}),eo=new Bn(to),io=({queryParams:t,...e})=>{const[i,r]=Zt.useState(null),[n,a]=Zt.useState(null),o=Zt.useRef(null);if(Zt.useEffect(()=>{(async()=>{const l=window.performance.now();try{eo.getCwmsDataTimeseriesRaw(t).then(async h=>{let u=await h.raw.json();return u.url=h.raw.url,u}).then(h=>{h.query_str=h.url,r(h),a(((window.performance.now()-l)/1e3).toFixed(2))}).catch(h=>{console.error(h),r({error:h.message})})}catch(h){console.error("Failed to fetch: ",h),r({error:h.message})}})()},[t,a]),Zt.useEffect(()=>{if(i&&i.values){const s=[{x:i.values.map(h=>new Date(h[0])),y:i.values.map(h=>h[1]),type:"scatter",mode:"lines",marker:{color:"blue"}}],l={title:(t==null?void 0:t.name)||"Timeseries Plot",xaxis:{title:"Date"},yaxis:{title:t==null?void 0:t.name.split(".")[1]}};qn.newPlot(o.current,s,l)}},[i,t]),i){if(i.error)return mt.jsxs("div",{children:["Error: ",i.error]});if(i.values&&i.values.length===0)return mt.jsxs("div",{children:["No data found for the query ",i.url]})}else return mt.jsx("div",{children:"Loading..."});return mt.jsx("div",{ref:o,title:`Loaded in ${n} seconds`,style:{width:"100%",height:"500px"},...e})};var oa={exports:{}};(function(t,e){(function(i,r){t.exports=r()})(Qn,function(){var i=1e3,r=6e4,n=36e5,a="millisecond",o="second",s="minute",l="hour",h="day",u="week",f="month",c="quarter",d="year",v="date",E="Invalid Date",p=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,m=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,y={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(b){var M=["th","st","nd","rd"],F=b%100;return"["+b+(M[(F-20)%10]||M[F]||M[0])+"]"}},R=function(b,M,F){var X=String(b);return!X||X.length>=M?b:""+Array(M+1-X.length).join(F)+b},C={s:R,z:function(b){var M=-b.utcOffset(),F=Math.abs(M),X=Math.floor(F/60),U=F%60;return(M<=0?"+":"-")+R(X,2,"0")+":"+R(U,2,"0")},m:function b(M,F){if(M.date()<F.date())return-b(F,M);var X=12*(F.year()-M.year())+(F.month()-M.month()),U=M.clone().add(X,f),Z=F-U<0,z=M.clone().add(X+(Z?-1:1),f);return+(-(X+(F-U)/(Z?U-z:z-U))||0)},a:function(b){return b<0?Math.ceil(b)||0:Math.floor(b)},p:function(b){return{M:f,y:d,w:u,d:h,D:v,h:l,m:s,s:o,ms:a,Q:c}[b]||String(b||"").toLowerCase().replace(/s$/,"")},u:function(b){return b===void 0}},x="en",I={};I[x]=y;var D="$isDayjsObject",O=function(b){return b instanceof P||!(!b||!b[D])},B=function b(M,F,X){var U;if(!M)return x;if(typeof M=="string"){var Z=M.toLowerCase();I[Z]&&(U=Z),F&&(I[Z]=F,U=Z);var z=M.split("-");if(!U&&z.length>1)return b(z[0])}else{var Q=M.name;I[Q]=M,U=Q}return!X&&U&&(x=U),U||!X&&x},W=function(b,M){if(O(b))return b.clone();var F=typeof M=="object"?M:{};return F.date=b,F.args=arguments,new P(F)},N=C;N.l=B,N.i=O,N.w=function(b,M){return W(b,{locale:M.$L,utc:M.$u,x:M.$x,$offset:M.$offset})};var P=function(){function b(F){this.$L=B(F.locale,null,!0),this.parse(F),this.$x=this.$x||F.x||{},this[D]=!0}var M=b.prototype;return M.parse=function(F){this.$d=function(X){var U=X.date,Z=X.utc;if(U===null)return new Date(NaN);if(N.u(U))return new Date;if(U instanceof Date)return new Date(U);if(typeof U=="string"&&!/Z$/i.test(U)){var z=U.match(p);if(z){var Q=z[2]-1||0,rt=(z[7]||"0").substring(0,3);return Z?new Date(Date.UTC(z[1],Q,z[3]||1,z[4]||0,z[5]||0,z[6]||0,rt)):new Date(z[1],Q,z[3]||1,z[4]||0,z[5]||0,z[6]||0,rt)}}return new Date(U)}(F),this.init()},M.init=function(){var F=this.$d;this.$y=F.getFullYear(),this.$M=F.getMonth(),this.$D=F.getDate(),this.$W=F.getDay(),this.$H=F.getHours(),this.$m=F.getMinutes(),this.$s=F.getSeconds(),this.$ms=F.getMilliseconds()},M.$utils=function(){return N},M.isValid=function(){return this.$d.toString()!==E},M.isSame=function(F,X){var U=W(F);return this.startOf(X)<=U&&U<=this.endOf(X)},M.isAfter=function(F,X){return W(F)<this.startOf(X)},M.isBefore=function(F,X){return this.endOf(X)<W(F)},M.$g=function(F,X,U){return N.u(F)?this[X]:this.set(U,F)},M.unix=function(){return Math.floor(this.valueOf()/1e3)},M.valueOf=function(){return this.$d.getTime()},M.startOf=function(F,X){var U=this,Z=!!N.u(X)||X,z=N.p(F),Q=function(xe,Bt){var Ce=N.w(U.$u?Date.UTC(U.$y,Bt,xe):new Date(U.$y,Bt,xe),U);return Z?Ce:Ce.endOf(h)},rt=function(xe,Bt){return N.w(U.toDate()[xe].apply(U.toDate("s"),(Z?[0,0,0,0]:[23,59,59,999]).slice(Bt)),U)},ft=this.$W,Ct=this.$M,yt=this.$D,jt="set"+(this.$u?"UTC":"");switch(z){case d:return Z?Q(1,0):Q(31,11);case f:return Z?Q(1,Ct):Q(0,Ct+1);case u:var It=this.$locale().weekStart||0,ie=(ft<It?ft+7:ft)-It;return Q(Z?yt-ie:yt+(6-ie),Ct);case h:case v:return rt(jt+"Hours",0);case l:return rt(jt+"Minutes",1);case s:return rt(jt+"Seconds",2);case o:return rt(jt+"Milliseconds",3);default:return this.clone()}},M.endOf=function(F){return this.startOf(F,!1)},M.$set=function(F,X){var U,Z=N.p(F),z="set"+(this.$u?"UTC":""),Q=(U={},U[h]=z+"Date",U[v]=z+"Date",U[f]=z+"Month",U[d]=z+"FullYear",U[l]=z+"Hours",U[s]=z+"Minutes",U[o]=z+"Seconds",U[a]=z+"Milliseconds",U)[Z],rt=Z===h?this.$D+(X-this.$W):X;if(Z===f||Z===d){var ft=this.clone().set(v,1);ft.$d[Q](rt),ft.init(),this.$d=ft.set(v,Math.min(this.$D,ft.daysInMonth())).$d}else Q&&this.$d[Q](rt);return this.init(),this},M.set=function(F,X){return this.clone().$set(F,X)},M.get=function(F){return this[N.p(F)]()},M.add=function(F,X){var U,Z=this;F=Number(F);var z=N.p(X),Q=function(Ct){var yt=W(Z);return N.w(yt.date(yt.date()+Math.round(Ct*F)),Z)};if(z===f)return this.set(f,this.$M+F);if(z===d)return this.set(d,this.$y+F);if(z===h)return Q(1);if(z===u)return Q(7);var rt=(U={},U[s]=r,U[l]=n,U[o]=i,U)[z]||1,ft=this.$d.getTime()+F*rt;return N.w(ft,this)},M.subtract=function(F,X){return this.add(-1*F,X)},M.format=function(F){var X=this,U=this.$locale();if(!this.isValid())return U.invalidDate||E;var Z=F||"YYYY-MM-DDTHH:mm:ssZ",z=N.z(this),Q=this.$H,rt=this.$m,ft=this.$M,Ct=U.weekdays,yt=U.months,jt=U.meridiem,It=function(Bt,Ce,ke,Fe){return Bt&&(Bt[Ce]||Bt(X,Z))||ke[Ce].slice(0,Fe)},ie=function(Bt){return N.s(Q%12||12,Bt,"0")},xe=jt||function(Bt,Ce,ke){var Fe=Bt<12?"AM":"PM";return ke?Fe.toLowerCase():Fe};return Z.replace(m,function(Bt,Ce){return Ce||function(ke){switch(ke){case"YY":return String(X.$y).slice(-2);case"YYYY":return N.s(X.$y,4,"0");case"M":return ft+1;case"MM":return N.s(ft+1,2,"0");case"MMM":return It(U.monthsShort,ft,yt,3);case"MMMM":return It(yt,ft);case"D":return X.$D;case"DD":return N.s(X.$D,2,"0");case"d":return String(X.$W);case"dd":return It(U.weekdaysMin,X.$W,Ct,2);case"ddd":return It(U.weekdaysShort,X.$W,Ct,3);case"dddd":return Ct[X.$W];case"H":return String(Q);case"HH":return N.s(Q,2,"0");case"h":return ie(1);case"hh":return ie(2);case"a":return xe(Q,rt,!0);case"A":return xe(Q,rt,!1);case"m":return String(rt);case"mm":return N.s(rt,2,"0");case"s":return String(X.$s);case"ss":return N.s(X.$s,2,"0");case"SSS":return N.s(X.$ms,3,"0");case"Z":return z}return null}(Bt)||z.replace(":","")})},M.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},M.diff=function(F,X,U){var Z,z=this,Q=N.p(X),rt=W(F),ft=(rt.utcOffset()-this.utcOffset())*r,Ct=this-rt,yt=function(){return N.m(z,rt)};switch(Q){case d:Z=yt()/12;break;case f:Z=yt();break;case c:Z=yt()/3;break;case u:Z=(Ct-ft)/6048e5;break;case h:Z=(Ct-ft)/864e5;break;case l:Z=Ct/n;break;case s:Z=Ct/r;break;case o:Z=Ct/i;break;default:Z=Ct}return U?Z:N.a(Z)},M.daysInMonth=function(){return this.endOf(f).$D},M.$locale=function(){return I[this.$L]},M.locale=function(F,X){if(!F)return this.$L;var U=this.clone(),Z=B(F,X,!0);return Z&&(U.$L=Z),U},M.clone=function(){return N.w(this.$d,this)},M.toDate=function(){return new Date(this.valueOf())},M.toJSON=function(){return this.isValid()?this.toISOString():null},M.toISOString=function(){return this.$d.toISOString()},M.toString=function(){return this.$d.toUTCString()},b}(),$=P.prototype;return W.prototype=$,[["$ms",a],["$s",o],["$m",s],["$H",l],["$W",h],["$M",f],["$y",d],["$D",v]].forEach(function(b){$[b[1]]=function(M){return this.$g(M,b[0],b[1])}}),W.extend=function(b,M){return b.$i||(b(M,P,W),b.$i=!0),W},W.locale=B,W.isDayjs=O,W.unix=function(b){return W(1e3*b)},W.en=I[x],W.Ls=I,W.p={},W})})(oa);var ro=oa.exports;const no=ta(ro);function ao(t,e){return Number(t).toFixed(e)}function oo({h1:t,subTitle:e,heading:i,content:r,order:n="desc",precision:a=4,dateFormat:o="MM-DD-YYYY HH:mm",...s}){const l=Zt.useMemo(()=>[...r].sort((h,u)=>h[1]<u[1]?n==="asc"?-1:1:h[1]>u[1]?n==="asc"?1:-1:0),[r,n]);return mt.jsxs("div",{className:"gw-px-4 gw-sm:px-6 gw-lg:px-8",children:[mt.jsx("div",{className:"gw-sm:flex gw-sm:items-center",children:mt.jsxs("div",{className:"gw-sm:flex-auto",children:[t&&mt.jsx("h1",{className:"gw-text-base gw-font-semibold gw-leading-6 gw-text-gray-900",children:t}),e&&mt.jsx("p",{className:"gw-mt-2 gw-text-sm gw-text-gray-700",children:e})]})}),mt.jsx("div",{className:"gw-mt-8 gw-flow-root",children:mt.jsx("div",{className:"gw--mx-4 gw--my-2 gw-overflow-x-auto gw-sm:-mx-6 gw-lg:-mx-8",children:mt.jsx("div",{className:"gw-inline-block gw-min-w-full gw-py-2 gw-align-middle gw-sm:px-6 gw-lg:px-8",children:mt.jsxs("table",{className:"gw-min-w-full gw-divide-y gw-divide-gray-300",children:[mt.jsx("thead",{children:mt.jsx("tr",{children:i.map(h=>mt.jsx("th",{scope:"col",className:"gw-py-3.5 gw-pl-4 gw-pr-3 gw-text-left gw-text-sm gw-font-semibold gw-text-gray-900 gw-sm:pl-3",children:h},h))})}),mt.jsx("tbody",{className:"gw-bg-white",children:l.map(h=>mt.jsxs("tr",{className:"gw-even:bg-gray-50",children:[mt.jsx("td",{className:"gw-whitespace-nowrap gw-py-4 gw-pl-4 gw-pr-3 gw-text-sm gw-font-medium gw-text-gray-900 gw-sm:pl-3",children:no(h[0]).format(o)}),mt.jsx("td",{className:"gw-whitespace-nowrap gw-px-3 gw-py-4 gw-text-sm gw-text-gray-500",children:ao(h[1],a)}),mt.jsx("td",{className:"gw-whitespace-nowrap gw-px-3 gw-py-4 gw-text-sm gw-text-gray-500",children:h[2]})]},h[0]))})]})})})})]})}const so=new an({headers:{accept:"application/json;version=2"}}),lo=new Bn(so),ho=async({queryKey:t})=>{const[,e]=t,i=await lo.getCwmsDataTimeseriesRaw(e),r=await i.raw.json();return r.url=i.raw.url,r},uo=({queryParams:t,precision:e,...i})=>{const[r,n]=Zt.useState(null),{data:a,error:o,isLoading:s,isError:l}=$n.useQuery({queryKey:["timeseriesData",t],queryFn:ho,onSuccess:()=>{n(((window.performance.now()-startTime)/1e3).toFixed(2))}});return Zt.useEffect(()=>{window.performance.now(),n(null)},[t]),s?mt.jsx("div",{children:"Loading..."}):l?mt.jsxs("div",{children:["Error: ",o.message]}):(a==null?void 0:a.values.length)===0?mt.jsxs("div",{children:["No data found for the query ",a==null?void 0:a.url]}):mt.jsx(mt.Fragment,{children:mt.jsx(oo,{h1:"Time Series Data",subTitle:`Loaded in ${r} seconds`,heading:["Date-Time","Value","Quality Code"],precision:e,content:a==null?void 0:a.values})})};var _={};_.ASSUME_TOUCH=!1,_.DEFAULT_MAX_ZOOM=42,_.DEFAULT_MIN_ZOOM=0,_.DEFAULT_RASTER_REPROJECTION_ERROR_THRESHOLD=.5,_.DEFAULT_TILE_SIZE=256,_.DEFAULT_WMS_VERSION="1.3.0",_.ENABLE_CANVAS=!0,_.ENABLE_PROJ4JS=!0,_.ENABLE_RASTER_REPROJECTION=!0,_.ENABLE_WEBGL=!0,_.DEBUG_WEBGL=!0,_.INITIAL_ATLAS_SIZE=256,_.MAX_ATLAS_SIZE=-1,_.MOUSEWHEELZOOM_MAXDELTA=1,_.OVERVIEWMAP_MAX_RATIO=.75,_.OVERVIEWMAP_MIN_RATIO=.1,_.RASTER_REPROJECTION_MAX_SOURCE_TILES=100,_.RASTER_REPROJECTION_MAX_SUBDIVISION=10,_.RASTER_REPROJECTION_MAX_TRIANGLE_WIDTH=.25,_.SIMPLIFY_TOLERANCE=.5,_.WEBGL_TEXTURE_CACHE_HIGH_WATER_MARK=1024,_.VERSION="v4.6.5",_.WEBGL_MAX_TEXTURE_SIZE,_.WEBGL_EXTENSIONS,_.inherits=function(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t},_.nullFunction=function(){},_.getUid=function(t){return t.ol_uid||(t.ol_uid=++_.uidCounter_)},_.uidCounter_=0;var Pi={IMAGE:"IMAGE",TILE:"TILE",VECTOR_TILE:"VECTOR_TILE",VECTOR:"VECTOR"},ht={};ht.assign=typeof Object.assign=="function"?Object.assign:function(t,e){if(t==null)throw new TypeError("Cannot convert undefined or null to object");for(var i=Object(t),r=1,n=arguments.length;r<n;++r){var a=arguments[r];if(a!=null)for(var o in a)a.hasOwnProperty(o)&&(i[o]=a[o])}return i},ht.clear=function(t){for(var e in t)delete t[e]},ht.getValues=function(t){var e=[];for(var i in t)e.push(t[i]);return e},ht.isEmpty=function(t){var e;for(e in t)return!1;return!e};var L={};L.bindListener_=function(t){var e=function(i){var r=t.listener,n=t.bindTo||t.target;return t.callOnce&&L.unlistenByKey(t),r.call(n,i)};return t.boundListener=e,e},L.findListener_=function(t,e,i,r){for(var n,a=0,o=t.length;a<o;++a)if(n=t[a],n.listener===e&&n.bindTo===i)return r&&(n.deleteIndex=a),n},L.getListeners=function(t,e){var i=t.ol_lm;return i?i[e]:void 0},L.getListenerMap_=function(t){var e=t.ol_lm;return e||(e=t.ol_lm={}),e},L.removeListeners_=function(t,e){var i=L.getListeners(t,e);if(i){for(var r=0,n=i.length;r<n;++r)t.removeEventListener(e,i[r].boundListener),ht.clear(i[r]);i.length=0;var a=t.ol_lm;a&&(delete a[e],Object.keys(a).length===0&&delete t.ol_lm)}},L.listen=function(t,e,i,r,n){var a=L.getListenerMap_(t),o=a[e];o||(o=a[e]=[]);var s=L.findListener_(o,i,r,!1);return s?n||(s.callOnce=!1):(s={bindTo:r,callOnce:!!n,listener:i,target:t,type:e},t.addEventListener(e,L.bindListener_(s)),o.push(s)),s},L.listenOnce=function(t,e,i,r){return L.listen(t,e,i,r,!0)},L.unlisten=function(t,e,i,r){var n=L.getListeners(t,e);if(n){var a=L.findListener_(n,i,r,!0);a&&L.unlistenByKey(a)}},L.unlistenByKey=function(t){if(t&&t.target){t.target.removeEventListener(t.type,t.boundListener);var e=L.getListeners(t.target,t.type);if(e){var i="deleteIndex"in t?t.deleteIndex:e.indexOf(t);i!==-1&&e.splice(i,1),e.length===0&&L.removeListeners_(t.target,t.type)}ht.clear(t)}},L.unlistenAll=function(t){var e=L.getListenerMap_(t);for(var i in e)L.removeListeners_(t,i)};var tt={CHANGE:"change",CLEAR:"clear",CLICK:"click",DBLCLICK:"dblclick",DRAGENTER:"dragenter",DRAGOVER:"dragover",DROP:"drop",ERROR:"error",KEYDOWN:"keydown",KEYPRESS:"keypress",LOAD:"load",MOUSEDOWN:"mousedown",MOUSEMOVE:"mousemove",MOUSEOUT:"mouseout",MOUSEUP:"mouseup",MOUSEWHEEL:"mousewheel",MSPOINTERDOWN:"MSPointerDown",RESIZE:"resize",TOUCHSTART:"touchstart",TOUCHMOVE:"touchmove",TOUCHEND:"touchend",WHEEL:"wheel"},zr={PROPERTYCHANGE:"propertychange"},Vi=function(){};Vi.prototype.disposed_=!1,Vi.prototype.dispose=function(){this.disposed_||(this.disposed_=!0,this.disposeInternal())},Vi.prototype.disposeInternal=_.nullFunction;var ue=function(t){this.propagationStopped,this.type=t,this.target=null};ue.prototype.preventDefault=ue.prototype.stopPropagation=function(){this.propagationStopped=!0},ue.stopPropagation=function(t){t.stopPropagation()},ue.preventDefault=function(t){t.preventDefault()};var re=function(){Vi.call(this),this.pendingRemovals_={},this.dispatching_={},this.listeners_={}};_.inherits(re,Vi),re.prototype.addEventListener=function(t,e){var i=this.listeners_[t];i||(i=this.listeners_[t]=[]),i.indexOf(e)===-1&&i.push(e)},re.prototype.dispatchEvent=function(t){var e=typeof t=="string"?new ue(t):t,i=e.type;e.target=this;var r=this.listeners_[i],n;if(r){i in this.dispatching_||(this.dispatching_[i]=0,this.pendingRemovals_[i]=0),++this.dispatching_[i];for(var a=0,o=r.length;a<o;++a)if(r[a].call(this,e)===!1||e.propagationStopped){n=!1;break}if(--this.dispatching_[i],this.dispatching_[i]===0){var s=this.pendingRemovals_[i];for(delete this.pendingRemovals_[i];s--;)this.removeEventListener(i,_.nullFunction);delete this.dispatching_[i]}return n}},re.prototype.disposeInternal=function(){L.unlistenAll(this)},re.prototype.getListeners=function(t){return this.listeners_[t]},re.prototype.hasListener=function(t){return t?t in this.listeners_:Object.keys(this.listeners_).length>0},re.prototype.removeEventListener=function(t,e){var i=this.listeners_[t];if(i){var r=i.indexOf(e);t in this.pendingRemovals_?(i[r]=_.nullFunction,++this.pendingRemovals_[t]):(i.splice(r,1),i.length===0&&delete this.listeners_[t])}};var di=function(){re.call(this),this.revision_=0};_.inherits(di,re),di.unByKey=function(t){if(Array.isArray(t))for(var e=0,i=t.length;e<i;++e)L.unlistenByKey(t[e]);else L.unlistenByKey(t)},di.prototype.changed=function(){++this.revision_,this.dispatchEvent(tt.CHANGE)},di.prototype.dispatchEvent,di.prototype.getRevision=function(){return this.revision_},di.prototype.on=function(t,e,i){if(Array.isArray(t)){for(var r=t.length,n=new Array(r),a=0;a<r;++a)n[a]=L.listen(this,t[a],e,i);return n}else return L.listen(this,t,e,i)},di.prototype.once=function(t,e,i){if(Array.isArray(t)){for(var r=t.length,n=new Array(r),a=0;a<r;++a)n[a]=L.listenOnce(this,t[a],e,i);return n}else return L.listenOnce(this,t,e,i)},di.prototype.un=function(t,e,i){if(Array.isArray(t)){for(var r=0,n=t.length;r<n;++r)L.unlisten(this,t[r],e,i);return}else L.unlisten(this,t,e,i)};var it=function(t){di.call(this),_.getUid(this),this.values_={},t!==void 0&&this.setProperties(t)};_.inherits(it,di),it.changeEventTypeCache_={},it.getChangeEventType=function(t){return it.changeEventTypeCache_.hasOwnProperty(t)?it.changeEventTypeCache_[t]:it.changeEventTypeCache_[t]="change:"+t},it.prototype.get=function(t){var e;return this.values_.hasOwnProperty(t)&&(e=this.values_[t]),e},it.prototype.getKeys=function(){return Object.keys(this.values_)},it.prototype.getProperties=function(){return ht.assign({},this.values_)},it.prototype.notify=function(t,e){var i;i=it.getChangeEventType(t),this.dispatchEvent(new it.Event(i,t,e)),i=zr.PROPERTYCHANGE,this.dispatchEvent(new it.Event(i,t,e))},it.prototype.set=function(t,e,i){if(i)this.values_[t]=e;else{var r=this.values_[t];this.values_[t]=e,r!==e&&this.notify(t,r)}},it.prototype.setProperties=function(t,e){var i;for(i in t)this.set(i,t[i],e)},it.prototype.unset=function(t,e){if(t in this.values_){var i=this.values_[t];delete this.values_[t],e||this.notify(t,i)}},it.Event=function(t,e,i){ue.call(this,t),this.key=e,this.oldValue=i},_.inherits(it.Event,ue);var fe={OPACITY:"opacity",VISIBLE:"visible",EXTENT:"extent",Z_INDEX:"zIndex",MAX_RESOLUTION:"maxResolution",MIN_RESOLUTION:"minResolution",SOURCE:"source"},Wn=function(t){var e=_.VERSION?_.VERSION.split("-")[0]:"latest";this.message="Assertion failed. See https://openlayers.org/en/"+e+"/doc/errors/#"+t+" for details.",this.code=t,this.name="AssertionError"};_.inherits(Wn,Error);var Ot={};Ot.assert=function(t,e){if(!t)throw new Wn(e)};var j={};j.clamp=function(t,e,i){return Math.min(Math.max(t,e),i)},j.cosh=function(){var t;return"cosh"in Math?t=Math.cosh:t=function(e){var i=Math.exp(e);return(i+1/i)/2},t}(),j.roundUpToPowerOfTwo=function(t){return Ot.assert(0<t,29),Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},j.squaredSegmentDistance=function(t,e,i,r,n,a){var o=n-i,s=a-r;if(o!==0||s!==0){var l=((t-i)*o+(e-r)*s)/(o*o+s*s);l>1?(i=n,r=a):l>0&&(i+=o*l,r+=s*l)}return j.squaredDistance(t,e,i,r)},j.squaredDistance=function(t,e,i,r){var n=i-t,a=r-e;return n*n+a*a},j.solveLinearSystem=function(t){for(var e=t.length,i=0;i<e;i++){for(var r=i,n=Math.abs(t[i][i]),a=i+1;a<e;a++){var o=Math.abs(t[a][i]);o>n&&(n=o,r=a)}if(n===0)return null;var s=t[r];t[r]=t[i],t[i]=s;for(var l=i+1;l<e;l++)for(var h=-t[l][i]/t[i][i],u=i;u<e+1;u++)i==u?t[l][u]=0:t[l][u]+=h*t[i][u]}for(var f=new Array(e),c=e-1;c>=0;c--){f[c]=t[c][e]/t[c][c];for(var d=c-1;d>=0;d--)t[d][e]-=t[d][c]*f[c]}return f},j.toDegrees=function(t){return t*180/Math.PI},j.toRadians=function(t){return t*Math.PI/180},j.modulo=function(t,e){var i=t%e;return i*e<0?i+e:i},j.lerp=function(t,e,i){return t+i*(e-t)};var te=function(t){it.call(this);var e=ht.assign({},t);e[fe.OPACITY]=t.opacity!==void 0?t.opacity:1,e[fe.VISIBLE]=t.visible!==void 0?t.visible:!0,e[fe.Z_INDEX]=t.zIndex!==void 0?t.zIndex:0,e[fe.MAX_RESOLUTION]=t.maxResolution!==void 0?t.maxResolution:1/0,e[fe.MIN_RESOLUTION]=t.minResolution!==void 0?t.minResolution:0,this.setProperties(e),this.state_={layer:this,managed:!0},this.type};_.inherits(te,it),te.prototype.getType=function(){return this.type},te.prototype.getLayerState=function(){return this.state_.opacity=j.clamp(this.getOpacity(),0,1),this.state_.sourceState=this.getSourceState(),this.state_.visible=this.getVisible(),this.state_.extent=this.getExtent(),this.state_.zIndex=this.getZIndex(),this.state_.maxResolution=this.getMaxResolution(),this.state_.minResolution=Math.max(this.getMinResolution(),0),this.state_},te.prototype.getLayersArray=function(t){},te.prototype.getLayerStatesArray=function(t){},te.prototype.getExtent=function(){return this.get(fe.EXTENT)},te.prototype.getMaxResolution=function(){return this.get(fe.MAX_RESOLUTION)},te.prototype.getMinResolution=function(){return this.get(fe.MIN_RESOLUTION)},te.prototype.getOpacity=function(){return this.get(fe.OPACITY)},te.prototype.getSourceState=function(){},te.prototype.getVisible=function(){return this.get(fe.VISIBLE)},te.prototype.getZIndex=function(){return this.get(fe.Z_INDEX)},te.prototype.setExtent=function(t){this.set(fe.EXTENT,t)},te.prototype.setMaxResolution=function(t){this.set(fe.MAX_RESOLUTION,t)},te.prototype.setMinResolution=function(t){this.set(fe.MIN_RESOLUTION,t)},te.prototype.setOpacity=function(t){this.set(fe.OPACITY,t)},te.prototype.setVisible=function(t){this.set(fe.VISIBLE,t)},te.prototype.setZIndex=function(t){this.set(fe.Z_INDEX,t)};var Ri={POSTCOMPOSE:"postcompose",PRECOMPOSE:"precompose",RENDER:"render"},Or={UNDEFINED:"undefined",LOADING:"loading",READY:"ready",ERROR:"error"},ce=function(t){var e=ht.assign({},t);delete e.source,te.call(this,e),this.mapPrecomposeKey_=null,this.mapRenderKey_=null,this.sourceChangeKey_=null,t.map&&this.setMap(t.map),L.listen(this,it.getChangeEventType(fe.SOURCE),this.handleSourcePropertyChange_,this);var i=t.source?t.source:null;this.setSource(i)};_.inherits(ce,te),ce.visibleAtResolution=function(t,e){return t.visible&&e>=t.minResolution&&e<t.maxResolution},ce.prototype.getLayersArray=function(t){var e=t||[];return e.push(this),e},ce.prototype.getLayerStatesArray=function(t){var e=t||[];return e.push(this.getLayerState()),e},ce.prototype.getSource=function(){var t=this.get(fe.SOURCE);return t||null},ce.prototype.getSourceState=function(){var t=this.getSource();return t?t.getState():Or.UNDEFINED},ce.prototype.handleSourceChange_=function(){this.changed()},ce.prototype.handleSourcePropertyChange_=function(){this.sourceChangeKey_&&(L.unlistenByKey(this.sourceChangeKey_),this.sourceChangeKey_=null);var t=this.getSource();t&&(this.sourceChangeKey_=L.listen(t,tt.CHANGE,this.handleSourceChange_,this)),this.changed()},ce.prototype.setMap=function(t){this.mapPrecomposeKey_&&(L.unlistenByKey(this.mapPrecomposeKey_),this.mapPrecomposeKey_=null),t||this.changed(),this.mapRenderKey_&&(L.unlistenByKey(this.mapRenderKey_),this.mapRenderKey_=null),t&&(this.mapPrecomposeKey_=L.listen(t,Ri.PRECOMPOSE,function(e){var i=this.getLayerState();i.managed=!1,i.zIndex=1/0,e.frameState.layerStatesArray.push(i),e.frameState.layerStates[_.getUid(this)]=i},this),this.mapRenderKey_=L.listen(this,tt.CHANGE,t.render,t),this.changed())},ce.prototype.setSource=function(t){this.set(fe.SOURCE,t)};var sn={PRELOAD:"preload",USE_INTERIM_TILES_ON_ERROR:"useInterimTilesOnError"},pr=function(t){var e=t||{},i=ht.assign({},e);delete i.preload,delete i.useInterimTilesOnError,ce.call(this,i),this.setPreload(e.preload!==void 0?e.preload:0),this.setUseInterimTilesOnError(e.useInterimTilesOnError!==void 0?e.useInterimTilesOnError:!0),this.type=Pi.TILE};_.inherits(pr,ce),pr.prototype.getPreload=function(){return this.get(sn.PRELOAD)},pr.prototype.getSource,pr.prototype.setPreload=function(t){this.set(sn.PRELOAD,t)},pr.prototype.getUseInterimTilesOnError=function(){return this.get(sn.USE_INTERIM_TILES_ON_ERROR)},pr.prototype.setUseInterimTilesOnError=function(t){this.set(sn.USE_INTERIM_TILES_ON_ERROR,t)};var _i={ADD:"add",REMOVE:"remove"},ut=function(t,e){it.call(this);var i=e||{};if(this.unique_=!!i.unique,this.array_=t||[],this.unique_)for(var r=0,n=this.array_.length;r<n;++r)this.assertUnique_(this.array_[r],r);this.updateLength_()};_.inherits(ut,it),ut.prototype.clear=function(){for(;this.getLength()>0;)this.pop()},ut.prototype.extend=function(t){var e,i;for(e=0,i=t.length;e<i;++e)this.push(t[e]);return this},ut.prototype.forEach=function(t,e){for(var i=e?t.bind(e):t,r=this.array_,n=0,a=r.length;n<a;++n)i(r[n],n,r)},ut.prototype.getArray=function(){return this.array_},ut.prototype.item=function(t){return this.array_[t]},ut.prototype.getLength=function(){return this.get(ut.Property_.LENGTH)},ut.prototype.insertAt=function(t,e){this.unique_&&this.assertUnique_(e),this.array_.splice(t,0,e),this.updateLength_(),this.dispatchEvent(new ut.Event(_i.ADD,e))},ut.prototype.pop=function(){return this.removeAt(this.getLength()-1)},ut.prototype.push=function(t){this.unique_&&this.assertUnique_(t);var e=this.getLength();return this.insertAt(e,t),this.getLength()},ut.prototype.remove=function(t){var e=this.array_,i,r;for(i=0,r=e.length;i<r;++i)if(e[i]===t)return this.removeAt(i)},ut.prototype.removeAt=function(t){var e=this.array_[t];return this.array_.splice(t,1),this.updateLength_(),this.dispatchEvent(new ut.Event(_i.REMOVE,e)),e},ut.prototype.setAt=function(t,e){var i=this.getLength();if(t<i){this.unique_&&this.assertUnique_(e,t);var r=this.array_[t];this.array_[t]=e,this.dispatchEvent(new ut.Event(_i.REMOVE,r)),this.dispatchEvent(new ut.Event(_i.ADD,e))}else{var n;for(n=i;n<t;++n)this.insertAt(n,void 0);this.insertAt(t,e)}},ut.prototype.updateLength_=function(){this.set(ut.Property_.LENGTH,this.array_.length)},ut.prototype.assertUnique_=function(t,e){for(var i=0,r=this.array_.length;i<r;++i)if(this.array_[i]===t&&i!==e)throw new Wn(58)},ut.Property_={LENGTH:"length"},ut.Event=function(t,e){ue.call(this,t),this.element=e},_.inherits(ut.Event,ue);var ar=function(t,e,i){ue.call(this,t),this.map=e,this.frameState=i!==void 0?i:null};_.inherits(ar,ue);var Pr=function(t,e,i,r,n){ar.call(this,t,e,n),this.originalEvent=i,this.pixel=e.getEventPixel(i),this.coordinate=e.getCoordinateFromPixel(this.pixel),this.dragging=r!==void 0?r:!1};_.inherits(Pr,ar),Pr.prototype.preventDefault=function(){ar.prototype.preventDefault.call(this),this.originalEvent.preventDefault()},Pr.prototype.stopPropagation=function(){ar.prototype.stopPropagation.call(this),this.originalEvent.stopPropagation()};var S={};S.ONE=1,S.SRC_ALPHA=770,S.COLOR_ATTACHMENT0=36064,S.COLOR_BUFFER_BIT=16384,S.TRIANGLES=4,S.TRIANGLE_STRIP=5,S.ONE_MINUS_SRC_ALPHA=771,S.ARRAY_BUFFER=34962,S.ELEMENT_ARRAY_BUFFER=34963,S.STREAM_DRAW=35040,S.STATIC_DRAW=35044,S.DYNAMIC_DRAW=35048,S.CULL_FACE=2884,S.BLEND=3042,S.STENCIL_TEST=2960,S.DEPTH_TEST=2929,S.SCISSOR_TEST=3089,S.UNSIGNED_BYTE=5121,S.UNSIGNED_SHORT=5123,S.UNSIGNED_INT=5125,S.FLOAT=5126,S.RGBA=6408,S.FRAGMENT_SHADER=35632,S.VERTEX_SHADER=35633,S.LINK_STATUS=35714,S.LINEAR=9729,S.TEXTURE_MAG_FILTER=10240,S.TEXTURE_MIN_FILTER=10241,S.TEXTURE_WRAP_S=10242,S.TEXTURE_WRAP_T=10243,S.TEXTURE_2D=3553,S.TEXTURE0=33984,S.CLAMP_TO_EDGE=33071,S.COMPILE_STATUS=35713,S.FRAMEBUFFER=36160,S.CONTEXT_IDS_=["experimental-webgl","webgl","webkit-3d","moz-webgl"],S.getContext=function(t,e){var i,r,n=S.CONTEXT_IDS_.length;for(r=0;r<n;++r)try{if(i=t.getContext(S.CONTEXT_IDS_[r],e),i)return i}catch{}return null};var _t={},Mr=typeof navigator<"u"?navigator.userAgent.toLowerCase():"";_t.FIREFOX=Mr.indexOf("firefox")!==-1,_t.SAFARI=Mr.indexOf("safari")!==-1&&Mr.indexOf("chrom")==-1,_t.WEBKIT=Mr.indexOf("webkit")!==-1&&Mr.indexOf("edge")==-1,_t.MAC=Mr.indexOf("macintosh")!==-1,_t.DEVICE_PIXEL_RATIO=window.devicePixelRatio||1,_t.CANVAS_LINE_DASH=!1,_t.CANVAS=_.ENABLE_CANVAS&&function(){if(!("HTMLCanvasElement"in window))return!1;try{var t=document.createElement("CANVAS").getContext("2d");return t?(t.setLineDash!==void 0&&(_t.CANVAS_LINE_DASH=!0),!0):!1}catch{return!1}}(),_t.DEVICE_ORIENTATION="DeviceOrientationEvent"in window,_t.GEOLOCATION="geolocation"in navigator,_t.TOUCH=_.ASSUME_TOUCH||"ontouchstart"in window,_t.POINTER="PointerEvent"in window,_t.MSPOINTER=!!navigator.msPointerEnabled,function(){if(_.ENABLE_WEBGL){var t=!1,e,i=[];if("WebGLRenderingContext"in window)try{var r=document.createElement("CANVAS"),n=S.getContext(r,{failIfMajorPerformanceCaveat:!0});n&&(t=!0,e=n.getParameter(n.MAX_TEXTURE_SIZE),i=n.getSupportedExtensions())}catch{}_t.WEBGL=t,_.WEBGL_EXTENSIONS=i,_.WEBGL_MAX_TEXTURE_SIZE=e}}();var Ft={SINGLECLICK:"singleclick",CLICK:tt.CLICK,DBLCLICK:tt.DBLCLICK,POINTERDRAG:"pointerdrag",POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"},Hi=function(t,e,i,r,n){Pr.call(this,t,e,i.originalEvent,r,n),this.pointerEvent=i};_.inherits(Hi,Pr);var Mi={POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"},Di=function(t,e){this.dispatcher=t,this.mapping_=e};Di.prototype.getEvents=function(){return Object.keys(this.mapping_)},Di.prototype.getHandlerForEvent=function(t){return this.mapping_[t]};var St=function(t){var e={mousedown:this.mousedown,mousemove:this.mousemove,mouseup:this.mouseup,mouseover:this.mouseover,mouseout:this.mouseout};Di.call(this,t,e),this.pointerMap=t.pointerMap,this.lastTouches=[]};_.inherits(St,Di),St.POINTER_ID=1,St.POINTER_TYPE="mouse",St.DEDUP_DIST=25,St.prototype.isEventSimulatedFromTouch_=function(t){for(var e=this.lastTouches,i=t.clientX,r=t.clientY,n=0,a=e.length,o;n<a&&(o=e[n]);n++){var s=Math.abs(i-o[0]),l=Math.abs(r-o[1]);if(s<=St.DEDUP_DIST&&l<=St.DEDUP_DIST)return!0}return!1},St.prepareEvent=function(t,e){var i=e.cloneEvent(t,t),r=i.preventDefault;return i.preventDefault=function(){t.preventDefault(),r()},i.pointerId=St.POINTER_ID,i.isPrimary=!0,i.pointerType=St.POINTER_TYPE,i},St.prototype.mousedown=function(t){if(!this.isEventSimulatedFromTouch_(t)){St.POINTER_ID.toString()in this.pointerMap&&this.cancel(t);var e=St.prepareEvent(t,this.dispatcher);this.pointerMap[St.POINTER_ID.toString()]=t,this.dispatcher.down(e,t)}},St.prototype.mousemove=function(t){if(!this.isEventSimulatedFromTouch_(t)){var e=St.prepareEvent(t,this.dispatcher);this.dispatcher.move(e,t)}},St.prototype.mouseup=function(t){if(!this.isEventSimulatedFromTouch_(t)){var e=this.pointerMap[St.POINTER_ID.toString()];if(e&&e.button===t.button){var i=St.prepareEvent(t,this.dispatcher);this.dispatcher.up(i,t),this.cleanupMouse()}}},St.prototype.mouseover=function(t){if(!this.isEventSimulatedFromTouch_(t)){var e=St.prepareEvent(t,this.dispatcher);this.dispatcher.enterOver(e,t)}},St.prototype.mouseout=function(t){if(!this.isEventSimulatedFromTouch_(t)){var e=St.prepareEvent(t,this.dispatcher);this.dispatcher.leaveOut(e,t)}},St.prototype.cancel=function(t){var e=St.prepareEvent(t,this.dispatcher);this.dispatcher.cancel(e,t),this.cleanupMouse()},St.prototype.cleanupMouse=function(){delete this.pointerMap[St.POINTER_ID.toString()]};var vi=function(t){var e={MSPointerDown:this.msPointerDown,MSPointerMove:this.msPointerMove,MSPointerUp:this.msPointerUp,MSPointerOut:this.msPointerOut,MSPointerOver:this.msPointerOver,MSPointerCancel:this.msPointerCancel,MSGotPointerCapture:this.msGotPointerCapture,MSLostPointerCapture:this.msLostPointerCapture};Di.call(this,t,e),this.pointerMap=t.pointerMap,this.POINTER_TYPES=["","unavailable","touch","pen","mouse"]};_.inherits(vi,Di),vi.prototype.prepareEvent_=function(t){var e=t;return typeof t.pointerType=="number"&&(e=this.dispatcher.cloneEvent(t,t),e.pointerType=this.POINTER_TYPES[t.pointerType]),e},vi.prototype.cleanup=function(t){delete this.pointerMap[t.toString()]},vi.prototype.msPointerDown=function(t){this.pointerMap[t.pointerId.toString()]=t;var e=this.prepareEvent_(t);this.dispatcher.down(e,t)},vi.prototype.msPointerMove=function(t){var e=this.prepareEvent_(t);this.dispatcher.move(e,t)},vi.prototype.msPointerUp=function(t){var e=this.prepareEvent_(t);this.dispatcher.up(e,t),this.cleanup(t.pointerId)},vi.prototype.msPointerOut=function(t){var e=this.prepareEvent_(t);this.dispatcher.leaveOut(e,t)},vi.prototype.msPointerOver=function(t){var e=this.prepareEvent_(t);this.dispatcher.enterOver(e,t)},vi.prototype.msPointerCancel=function(t){var e=this.prepareEvent_(t);this.dispatcher.cancel(e,t),this.cleanup(t.pointerId)},vi.prototype.msLostPointerCapture=function(t){var e=this.dispatcher.makeEvent("lostpointercapture",t,t);this.dispatcher.dispatchEvent(e)},vi.prototype.msGotPointerCapture=function(t){var e=this.dispatcher.makeEvent("gotpointercapture",t,t);this.dispatcher.dispatchEvent(e)};var bi=function(t){var e={pointerdown:this.pointerDown,pointermove:this.pointerMove,pointerup:this.pointerUp,pointerout:this.pointerOut,pointerover:this.pointerOver,pointercancel:this.pointerCancel,gotpointercapture:this.gotPointerCapture,lostpointercapture:this.lostPointerCapture};Di.call(this,t,e)};_.inherits(bi,Di),bi.prototype.pointerDown=function(t){this.dispatcher.fireNativeEvent(t)},bi.prototype.pointerMove=function(t){this.dispatcher.fireNativeEvent(t)},bi.prototype.pointerUp=function(t){this.dispatcher.fireNativeEvent(t)},bi.prototype.pointerOut=function(t){this.dispatcher.fireNativeEvent(t)},bi.prototype.pointerOver=function(t){this.dispatcher.fireNativeEvent(t)},bi.prototype.pointerCancel=function(t){this.dispatcher.fireNativeEvent(t)},bi.prototype.lostPointerCapture=function(t){this.dispatcher.fireNativeEvent(t)},bi.prototype.gotPointerCapture=function(t){this.dispatcher.fireNativeEvent(t)};var gr=function(t,e,i){ue.call(this,t),this.originalEvent=e;var r=i||{};this.buttons=this.getButtons_(r),this.pressure=this.getPressure_(r,this.buttons),this.bubbles="bubbles"in r?r.bubbles:!1,this.cancelable="cancelable"in r?r.cancelable:!1,this.view="view"in r?r.view:null,this.detail="detail"in r?r.detail:null,this.screenX="screenX"in r?r.screenX:0,this.screenY="screenY"in r?r.screenY:0,this.clientX="clientX"in r?r.clientX:0,this.clientY="clientY"in r?r.clientY:0,this.ctrlKey="ctrlKey"in r?r.ctrlKey:!1,this.altKey="altKey"in r?r.altKey:!1,this.shiftKey="shiftKey"in r?r.shiftKey:!1,this.metaKey="metaKey"in r?r.metaKey:!1,this.button="button"in r?r.button:0,this.relatedTarget="relatedTarget"in r?r.relatedTarget:null,this.pointerId="pointerId"in r?r.pointerId:0,this.width="width"in r?r.width:0,this.height="height"in r?r.height:0,this.tiltX="tiltX"in r?r.tiltX:0,this.tiltY="tiltY"in r?r.tiltY:0,this.pointerType="pointerType"in r?r.pointerType:"",this.hwTimestamp="hwTimestamp"in r?r.hwTimestamp:0,this.isPrimary="isPrimary"in r?r.isPrimary:!1,e.preventDefault&&(this.preventDefault=function(){e.preventDefault()})};_.inherits(gr,ue),gr.prototype.getButtons_=function(t){var e;if(t.buttons||gr.HAS_BUTTONS)e=t.buttons;else switch(t.which){case 1:e=1;break;case 2:e=4;break;case 3:e=2;break;default:e=0}return e},gr.prototype.getPressure_=function(t,e){var i=0;return t.pressure?i=t.pressure:i=e?.5:0,i},gr.HAS_BUTTONS=!1,function(){try{var t=new MouseEvent("click",{buttons:1});gr.HAS_BUTTONS=t.buttons===1}catch{}}();var st={};st.binarySearch=function(t,e,i){for(var r,n,a=i||st.numberSafeCompareFunction,o=0,s=t.length,l=!1;o<s;)r=o+(s-o>>1),n=+a(t[r],e),n<0?o=r+1:(s=r,l=!n);return l?o:~o},st.numberSafeCompareFunction=function(t,e){return t>e?1:t<e?-1:0},st.includes=function(t,e){return t.indexOf(e)>=0},st.linearFindNearest=function(t,e,i){var r=t.length;if(t[0]<=e)return 0;if(e<=t[r-1])return r-1;var n;if(i>0){for(n=1;n<r;++n)if(t[n]<e)return n-1}else if(i<0){for(n=1;n<r;++n)if(t[n]<=e)return n}else for(n=1;n<r;++n){if(t[n]==e)return n;if(t[n]<e)return t[n-1]-e<e-t[n]?n-1:n}return r-1},st.reverseSubArray=function(t,e,i){for(;e<i;){var r=t[e];t[e]=t[i],t[i]=r,++e,--i}},st.extend=function(t,e){var i,r=Array.isArray(e)?e:[e],n=r.length;for(i=0;i<n;i++)t[t.length]=r[i]},st.remove=function(t,e){var i=t.indexOf(e),r=i>-1;return r&&t.splice(i,1),r},st.find=function(t,e){for(var i=t.length>>>0,r,n=0;n<i;n++)if(r=t[n],e(r,n,t))return r;return null},st.equals=function(t,e){var i=t.length;if(i!==e.length)return!1;for(var r=0;r<i;r++)if(t[r]!==e[r])return!1;return!0},st.stableSort=function(t,e){var i=t.length,r=Array(t.length),n;for(n=0;n<i;n++)r[n]={index:n,value:t[n]};for(r.sort(function(a,o){return e(a.value,o.value)||a.index-o.index}),n=0;n<t.length;n++)t[n]=r[n].value},st.findIndex=function(t,e){var i,r=!t.every(function(n,a){return i=a,!e(n,a,t)});return r?i:-1},st.isSorted=function(t,e,i){var r=e||st.numberSafeCompareFunction;return t.every(function(n,a){if(a===0)return!0;var o=r(t[a-1],n);return!(o>0||i&&o===0)})};var Nt=function(t,e){var i={touchstart:this.touchstart,touchmove:this.touchmove,touchend:this.touchend,touchcancel:this.touchcancel};Di.call(this,t,i),this.pointerMap=t.pointerMap,this.mouseSource=e,this.firstTouchId_=void 0,this.clickCount_=0,this.resetId_=void 0};_.inherits(Nt,Di),Nt.DEDUP_TIMEOUT=2500,Nt.CLICK_COUNT_TIMEOUT=200,Nt.POINTER_TYPE="touch",Nt.prototype.isPrimaryTouch_=function(t){return this.firstTouchId_===t.identifier},Nt.prototype.setPrimaryTouch_=function(t){var e=Object.keys(this.pointerMap).length;(e===0||e===1&&St.POINTER_ID.toString()in this.pointerMap)&&(this.firstTouchId_=t.identifier,this.cancelResetClickCount_())},Nt.prototype.removePrimaryPointer_=function(t){t.isPrimary&&(this.firstTouchId_=void 0,this.resetClickCount_())},Nt.prototype.resetClickCount_=function(){this.resetId_=setTimeout(this.resetClickCountHandler_.bind(this),Nt.CLICK_COUNT_TIMEOUT)},Nt.prototype.resetClickCountHandler_=function(){this.clickCount_=0,this.resetId_=void 0},Nt.prototype.cancelResetClickCount_=function(){this.resetId_!==void 0&&clearTimeout(this.resetId_)},Nt.prototype.touchToPointer_=function(t,e){var i=this.dispatcher.cloneEvent(t,e);return i.pointerId=e.identifier+2,i.bubbles=!0,i.cancelable=!0,i.detail=this.clickCount_,i.button=0,i.buttons=1,i.width=e.webkitRadiusX||e.radiusX||0,i.height=e.webkitRadiusY||e.radiusY||0,i.pressure=e.webkitForce||e.force||.5,i.isPrimary=this.isPrimaryTouch_(e),i.pointerType=Nt.POINTER_TYPE,i.clientX=e.clientX,i.clientY=e.clientY,i.screenX=e.screenX,i.screenY=e.screenY,i},Nt.prototype.processTouches_=function(t,e){var i=Array.prototype.slice.call(t.changedTouches),r=i.length;function n(){t.preventDefault()}var a,o;for(a=0;a<r;++a)o=this.touchToPointer_(t,i[a]),o.preventDefault=n,e.call(this,t,o)},Nt.prototype.findTouch_=function(t,e){for(var i=t.length,r,n=0;n<i;n++)if(r=t[n],r.identifier===e)return!0;return!1},Nt.prototype.vacuumTouches_=function(t){var e=t.touches,i=Object.keys(this.pointerMap),r=i.length;if(r>=e.length){var n=[],a,o,s;for(a=0;a<r;++a)o=i[a],s=this.pointerMap[o],o!=St.POINTER_ID&&!this.findTouch_(e,o-2)&&n.push(s.out);for(a=0;a<n.length;++a)this.cancelOut_(t,n[a])}},Nt.prototype.touchstart=function(t){this.vacuumTouches_(t),this.setPrimaryTouch_(t.changedTouches[0]),this.dedupSynthMouse_(t),this.clickCount_++,this.processTouches_(t,this.overDown_)},Nt.prototype.overDown_=function(t,e){this.pointerMap[e.pointerId]={target:e.target,out:e,outTarget:e.target},this.dispatcher.over(e,t),this.dispatcher.enter(e,t),this.dispatcher.down(e,t)},Nt.prototype.touchmove=function(t){t.preventDefault(),this.processTouches_(t,this.moveOverOut_)},Nt.prototype.moveOverOut_=function(t,e){var i=e,r=this.pointerMap[i.pointerId];if(r){var n=r.out,a=r.outTarget;this.dispatcher.move(i,t),n&&a!==i.target&&(n.relatedTarget=i.target,i.relatedTarget=a,n.target=a,i.target?(this.dispatcher.leaveOut(n,t),this.dispatcher.enterOver(i,t)):(i.target=a,i.relatedTarget=null,this.cancelOut_(t,i))),r.out=i,r.outTarget=i.target}},Nt.prototype.touchend=function(t){this.dedupSynthMouse_(t),this.processTouches_(t,this.upOut_)},Nt.prototype.upOut_=function(t,e){this.dispatcher.up(e,t),this.dispatcher.out(e,t),this.dispatcher.leave(e,t),this.cleanUpPointer_(e)},Nt.prototype.touchcancel=function(t){this.processTouches_(t,this.cancelOut_)},Nt.prototype.cancelOut_=function(t,e){this.dispatcher.cancel(e,t),this.dispatcher.out(e,t),this.dispatcher.leave(e,t),this.cleanUpPointer_(e)},Nt.prototype.cleanUpPointer_=function(t){delete this.pointerMap[t.pointerId],this.removePrimaryPointer_(t)},Nt.prototype.dedupSynthMouse_=function(t){var e=this.mouseSource.lastTouches,i=t.changedTouches[0];if(this.isPrimaryTouch_(i)){var r=[i.clientX,i.clientY];e.push(r),setTimeout(function(){st.remove(e,r)},Nt.DEDUP_TIMEOUT)}};var Lt=function(t){re.call(this),this.element_=t,this.pointerMap={},this.eventMap_={},this.eventSourceList_=[],this.registerSources()};_.inherits(Lt,re),Lt.prototype.registerSources=function(){if(_t.POINTER)this.registerSource("native",new bi(this));else if(_t.MSPOINTER)this.registerSource("ms",new vi(this));else{var t=new St(this);this.registerSource("mouse",t),_t.TOUCH&&this.registerSource("touch",new Nt(this,t))}this.register_()},Lt.prototype.registerSource=function(t,e){var i=e,r=i.getEvents();r&&(r.forEach(function(n){var a=i.getHandlerForEvent(n);a&&(this.eventMap_[n]=a.bind(i))},this),this.eventSourceList_.push(i))},Lt.prototype.register_=function(){for(var t=this.eventSourceList_.length,e,i=0;i<t;i++)e=this.eventSourceList_[i],this.addEvents_(e.getEvents())},Lt.prototype.unregister_=function(){for(var t=this.eventSourceList_.length,e,i=0;i<t;i++)e=this.eventSourceList_[i],this.removeEvents_(e.getEvents())},Lt.prototype.eventHandler_=function(t){var e=t.type,i=this.eventMap_[e];i&&i(t)},Lt.prototype.addEvents_=function(t){t.forEach(function(e){L.listen(this.element_,e,this.eventHandler_,this)},this)},Lt.prototype.removeEvents_=function(t){t.forEach(function(e){L.unlisten(this.element_,e,this.eventHandler_,this)},this)},Lt.prototype.cloneEvent=function(t,e){for(var i={},r,n=0,a=Lt.CLONE_PROPS.length;n<a;n++)r=Lt.CLONE_PROPS[n][0],i[r]=t[r]||e[r]||Lt.CLONE_PROPS[n][1];return i},Lt.prototype.down=function(t,e){this.fireEvent(Mi.POINTERDOWN,t,e)},Lt.prototype.move=function(t,e){this.fireEvent(Mi.POINTERMOVE,t,e)},Lt.prototype.up=function(t,e){this.fireEvent(Mi.POINTERUP,t,e)},Lt.prototype.enter=function(t,e){t.bubbles=!1,this.fireEvent(Mi.POINTERENTER,t,e)},Lt.prototype.leave=function(t,e){t.bubbles=!1,this.fireEvent(Mi.POINTERLEAVE,t,e)},Lt.prototype.over=function(t,e){t.bubbles=!0,this.fireEvent(Mi.POINTEROVER,t,e)},Lt.prototype.out=function(t,e){t.bubbles=!0,this.fireEvent(Mi.POINTEROUT,t,e)},Lt.prototype.cancel=function(t,e){this.fireEvent(Mi.POINTERCANCEL,t,e)},Lt.prototype.leaveOut=function(t,e){this.out(t,e),this.contains_(t.target,t.relatedTarget)||this.leave(t,e)},Lt.prototype.enterOver=function(t,e){this.over(t,e),this.contains_(t.target,t.relatedTarget)||this.enter(t,e)},Lt.prototype.contains_=function(t,e){return!t||!e?!1:t.contains(e)},Lt.prototype.makeEvent=function(t,e,i){return new gr(t,i,e)},Lt.prototype.fireEvent=function(t,e,i){var r=this.makeEvent(t,e,i);this.dispatchEvent(r)},Lt.prototype.fireNativeEvent=function(t){var e=this.makeEvent(t.type,t,t);this.dispatchEvent(e)},Lt.prototype.wrapMouseEvent=function(t,e){var i=this.makeEvent(t,St.prepareEvent(e,this),e);return i},Lt.prototype.disposeInternal=function(){this.unregister_(),re.prototype.disposeInternal.call(this)},Lt.CLONE_PROPS=[["bubbles",!1],["cancelable",!1],["view",null],["detail",null],["screenX",0],["screenY",0],["clientX",0],["clientY",0],["ctrlKey",!1],["altKey",!1],["shiftKey",!1],["metaKey",!1],["button",0],["relatedTarget",null],["buttons",0],["pointerId",0],["width",0],["height",0],["pressure",0],["tiltX",0],["tiltY",0],["pointerType",""],["hwTimestamp",0],["isPrimary",!1],["type",""],["target",null],["currentTarget",null],["which",0]];var xi=function(t,e){re.call(this),this.map_=t,this.clickTimeoutId_=0,this.dragging_=!1,this.dragListenerKeys_=[],this.moveTolerance_=e?e*_t.DEVICE_PIXEL_RATIO:_t.DEVICE_PIXEL_RATIO,this.down_=null;var i=this.map_.getViewport();this.activePointers_=0,this.trackedTouches_={},this.pointerEventHandler_=new Lt(i),this.documentPointerEventHandler_=null,this.pointerdownListenerKey_=L.listen(this.pointerEventHandler_,Mi.POINTERDOWN,this.handlePointerDown_,this),this.relayedListenerKey_=L.listen(this.pointerEventHandler_,Mi.POINTERMOVE,this.relayEvent_,this)};_.inherits(xi,re),xi.prototype.emulateClick_=function(t){var e=new Hi(Ft.CLICK,this.map_,t);this.dispatchEvent(e),this.clickTimeoutId_!==0?(clearTimeout(this.clickTimeoutId_),this.clickTimeoutId_=0,e=new Hi(Ft.DBLCLICK,this.map_,t),this.dispatchEvent(e)):this.clickTimeoutId_=setTimeout((function(){this.clickTimeoutId_=0;var i=new Hi(Ft.SINGLECLICK,this.map_,t);this.dispatchEvent(i)}).bind(this),250)},xi.prototype.updateActivePointers_=function(t){var e=t;e.type==Ft.POINTERUP||e.type==Ft.POINTERCANCEL?delete this.trackedTouches_[e.pointerId]:e.type==Ft.POINTERDOWN&&(this.trackedTouches_[e.pointerId]=!0),this.activePointers_=Object.keys(this.trackedTouches_).length},xi.prototype.handlePointerUp_=function(t){this.updateActivePointers_(t);var e=new Hi(Ft.POINTERUP,this.map_,t);this.dispatchEvent(e),!e.propagationStopped&&!this.dragging_&&this.isMouseActionButton_(t)&&this.emulateClick_(this.down_),this.activePointers_===0&&(this.dragListenerKeys_.forEach(L.unlistenByKey),this.dragListenerKeys_.length=0,this.dragging_=!1,this.down_=null,this.documentPointerEventHandler_.dispose(),this.documentPointerEventHandler_=null)},xi.prototype.isMouseActionButton_=function(t){return t.button===0},xi.prototype.handlePointerDown_=function(t){this.updateActivePointers_(t);var e=new Hi(Ft.POINTERDOWN,this.map_,t);this.dispatchEvent(e),this.down_=t,this.dragListenerKeys_.length===0&&(this.documentPointerEventHandler_=new Lt(document),this.dragListenerKeys_.push(L.listen(this.documentPointerEventHandler_,Ft.POINTERMOVE,this.handlePointerMove_,this),L.listen(this.documentPointerEventHandler_,Ft.POINTERUP,this.handlePointerUp_,this),L.listen(this.pointerEventHandler_,Ft.POINTERCANCEL,this.handlePointerUp_,this)))},xi.prototype.handlePointerMove_=function(t){if(this.isMoving_(t)){this.dragging_=!0;var e=new Hi(Ft.POINTERDRAG,this.map_,t,this.dragging_);this.dispatchEvent(e)}t.preventDefault()},xi.prototype.relayEvent_=function(t){var e=!!(this.down_&&this.isMoving_(t));this.dispatchEvent(new Hi(t.type,this.map_,t,e))},xi.prototype.isMoving_=function(t){return Math.abs(t.clientX-this.down_.clientX)>this.moveTolerance_||Math.abs(t.clientY-this.down_.clientY)>this.moveTolerance_},xi.prototype.disposeInternal=function(){this.relayedListenerKey_&&(L.unlistenByKey(this.relayedListenerKey_),this.relayedListenerKey_=null),this.pointerdownListenerKey_&&(L.unlistenByKey(this.pointerdownListenerKey_),this.pointerdownListenerKey_=null),this.dragListenerKeys_.forEach(L.unlistenByKey),this.dragListenerKeys_.length=0,this.documentPointerEventHandler_&&(this.documentPointerEventHandler_.dispose(),this.documentPointerEventHandler_=null),this.pointerEventHandler_&&(this.pointerEventHandler_.dispose(),this.pointerEventHandler_=null),re.prototype.disposeInternal.call(this)};var jr={POSTRENDER:"postrender",MOVESTART:"movestart",MOVEEND:"moveend"},Qe={LAYERGROUP:"layergroup",SIZE:"size",TARGET:"target",VIEW:"view"},V={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4,ABORT:5},Jt=function(t,e){this.priorityFunction_=t,this.keyFunction_=e,this.elements_=[],this.priorities_=[],this.queuedElements_={}};Jt.DROP=1/0,Jt.prototype.clear=function(){this.elements_.length=0,this.priorities_.length=0,ht.clear(this.queuedElements_)},Jt.prototype.dequeue=function(){var t=this.elements_,e=this.priorities_,i=t[0];t.length==1?(t.length=0,e.length=0):(t[0]=t.pop(),e[0]=e.pop(),this.siftUp_(0));var r=this.keyFunction_(i);return delete this.queuedElements_[r],i},Jt.prototype.enqueue=function(t){Ot.assert(!(this.keyFunction_(t)in this.queuedElements_),31);var e=this.priorityFunction_(t);return e!=Jt.DROP?(this.elements_.push(t),this.priorities_.push(e),this.queuedElements_[this.keyFunction_(t)]=!0,this.siftDown_(0,this.elements_.length-1),!0):!1},Jt.prototype.getCount=function(){return this.elements_.length},Jt.prototype.getLeftChildIndex_=function(t){return t*2+1},Jt.prototype.getRightChildIndex_=function(t){return t*2+2},Jt.prototype.getParentIndex_=function(t){return t-1>>1},Jt.prototype.heapify_=function(){var t;for(t=(this.elements_.length>>1)-1;t>=0;t--)this.siftUp_(t)},Jt.prototype.isEmpty=function(){return this.elements_.length===0},Jt.prototype.isKeyQueued=function(t){return t in this.queuedElements_},Jt.prototype.isQueued=function(t){return this.isKeyQueued(this.keyFunction_(t))},Jt.prototype.siftUp_=function(t){for(var e=this.elements_,i=this.priorities_,r=e.length,n=e[t],a=i[t],o=t;t<r>>1;){var s=this.getLeftChildIndex_(t),l=this.getRightChildIndex_(t),h=l<r&&i[l]<i[s]?l:s;e[t]=e[h],i[t]=i[h],t=h}e[t]=n,i[t]=a,this.siftDown_(o,t)},Jt.prototype.siftDown_=function(t,e){for(var i=this.elements_,r=this.priorities_,n=i[e],a=r[e];e>t;){var o=this.getParentIndex_(e);if(r[o]>a)i[e]=i[o],r[e]=r[o],e=o;else break}i[e]=n,r[e]=a},Jt.prototype.reprioritize=function(){var t=this.priorityFunction_,e=this.elements_,i=this.priorities_,r=0,n=e.length,a,o,s;for(o=0;o<n;++o)a=e[o],s=t(a),s==Jt.DROP?delete this.queuedElements_[this.keyFunction_(a)]:(i[r]=s,e[r++]=a);e.length=r,i.length=r,this.heapify_()};var Dr=function(t,e){Jt.call(this,function(i){return t.apply(null,i)},function(i){return i[0].getKey()}),this.tileChangeCallback_=e,this.tilesLoading_=0,this.tilesLoadingKeys_={}};_.inherits(Dr,Jt),Dr.prototype.enqueue=function(t){var e=Jt.prototype.enqueue.call(this,t);if(e){var i=t[0];L.listen(i,tt.CHANGE,this.handleTileChange,this)}return e},Dr.prototype.getTilesLoading=function(){return this.tilesLoading_},Dr.prototype.handleTileChange=function(t){var e=t.target,i=e.getState();if(i===V.LOADED||i===V.ERROR||i===V.EMPTY||i===V.ABORT){L.unlisten(e,tt.CHANGE,this.handleTileChange,this);var r=e.getKey();r in this.tilesLoadingKeys_&&(delete this.tilesLoadingKeys_[r],--this.tilesLoading_),this.tileChangeCallback_()}},Dr.prototype.loadMoreTiles=function(t,e){for(var i=0,r=!1,n,a,o;this.tilesLoading_<t&&i<e&&this.getCount()>0;)a=this.dequeue()[0],o=a.getKey(),n=a.getState(),n===V.ABORT?r=!0:n===V.IDLE&&!(o in this.tilesLoadingKeys_)&&(this.tilesLoadingKeys_[o]=!0,++this.tilesLoading_,++i,a.load());i===0&&r&&this.tileChangeCallback_()};var ln={};ln.createExtent=function(t){return function(e){if(e)return[j.clamp(e[0],t[0],t[2]),j.clamp(e[1],t[1],t[3])]}},ln.none=function(t){return t};var hn={};hn.createSnapToResolutions=function(t){return function(e,i,r){if(e!==void 0){var n=st.linearFindNearest(t,e,r);n=j.clamp(n+i,0,t.length-1);var a=Math.floor(n);if(n!=a&&a<t.length-1){var o=t[a]/t[a+1];return t[a]/Math.pow(o,n-a)}else return t[a]}else return}},hn.createSnapToPower=function(t,e,i){return function(r,n,a){if(r!==void 0){var o=-a/2+.5,s=Math.floor(Math.log(e/r)/Math.log(t)+o),l=Math.max(s+n,0);return i!==void 0&&(l=Math.min(l,i)),e/Math.pow(t,l)}else return}};var Ci={};Ci.disable=function(t,e){if(t!==void 0)return 0},Ci.none=function(t,e){if(t!==void 0)return t+e},Ci.createSnapToN=function(t){var e=2*Math.PI/t;return function(i,r){if(i!==void 0)return i=Math.floor((i+r)/e+.5)*e,i}},Ci.createSnapToZero=function(t){var e=t||j.toRadians(5);return function(i,r){if(i!==void 0)return Math.abs(i+r)<=e?0:i+r}};var Pt={ANIMATING:0,INTERACTING:1},Ne={CENTER:"center",RESOLUTION:"resolution",ROTATION:"rotation"},un={};un.padNumber=function(t,e,i){var r=i!==void 0?t.toFixed(i):""+t,n=r.indexOf(".");return n=n===-1?r.length:n,n>e?r:new Array(1+e-n).join("0")+r},un.compareVersions=function(t,e){for(var i=(""+t).split("."),r=(""+e).split("."),n=0;n<Math.max(i.length,r.length);n++){var a=parseInt(i[n]||"0",10),o=parseInt(r[n]||"0",10);if(a>o)return 1;if(o>a)return-1}return 0};var Mt={};Mt.add=function(t,e){return t[0]+=e[0],t[1]+=e[1],t},Mt.closestOnCircle=function(t,e){var i=e.getRadius(),r=e.getCenter(),n=r[0],a=r[1],o=t[0],s=t[1],l=o-n,h=s-a;l===0&&h===0&&(l=1);var u=Math.sqrt(l*l+h*h),f,c;return f=n+i*l/u,c=a+i*h/u,[f,c]},Mt.closestOnSegment=function(t,e){var i=t[0],r=t[1],n=e[0],a=e[1],o=n[0],s=n[1],l=a[0],h=a[1],u=l-o,f=h-s,c=u===0&&f===0?0:(u*(i-o)+f*(r-s))/(u*u+f*f||0),d,v;return c<=0?(d=o,v=s):c>=1?(d=l,v=h):(d=o+c*u,v=s+c*f),[d,v]},Mt.createStringXY=function(t){return function(e){return Mt.toStringXY(e,t)}},Mt.degreesToStringHDMS=function(t,e,i){var r=j.modulo(e+180,360)-180,n=Math.abs(3600*r),a=i||0,o=Math.pow(10,a),s=Math.floor(n/3600),l=Math.floor((n-s*3600)/60),h=n-s*3600-l*60;return h=Math.ceil(h*o)/o,h>=60&&(h=0,l+=1),l>=60&&(l=0,s+=1),s+" "+un.padNumber(l,2)+" "+un.padNumber(h,2,a)+""+(r==0?"":" "+t.charAt(r<0?1:0))},Mt.format=function(t,e,i){return t?e.replace("{x}",t[0].toFixed(i)).replace("{y}",t[1].toFixed(i)):""},Mt.equals=function(t,e){for(var i=!0,r=t.length-1;r>=0;--r)if(t[r]!=e[r]){i=!1;break}return i},Mt.rotate=function(t,e){var i=Math.cos(e),r=Math.sin(e),n=t[0]*i-t[1]*r,a=t[1]*i+t[0]*r;return t[0]=n,t[1]=a,t},Mt.scale=function(t,e){return t[0]*=e,t[1]*=e,t},Mt.sub=function(t,e){return t[0]-=e[0],t[1]-=e[1],t},Mt.squaredDistance=function(t,e){var i=t[0]-e[0],r=t[1]-e[1];return i*i+r*r},Mt.distance=function(t,e){return Math.sqrt(Mt.squaredDistance(t,e))},Mt.squaredDistanceToSegment=function(t,e){return Mt.squaredDistance(t,Mt.closestOnSegment(t,e))},Mt.toStringHDMS=function(t,e){return t?Mt.degreesToStringHDMS("NS",t[1],e)+" "+Mt.degreesToStringHDMS("EW",t[0],e):""},Mt.toStringXY=function(t,e){return Mt.format(t,"{x}, {y}",e)};var de={};de.easeIn=function(t){return Math.pow(t,3)},de.easeOut=function(t){return 1-de.easeIn(1-t)},de.inAndOut=function(t){return 3*t*t-2*t*t*t},de.linear=function(t){return t},de.upAndDown=function(t){return t<.5?de.inAndOut(2*t):1-de.inAndOut(2*(t-.5))};var Zr={BOTTOM_LEFT:"bottom-left",BOTTOM_RIGHT:"bottom-right",TOP_LEFT:"top-left",TOP_RIGHT:"top-right"},Ie={UNKNOWN:0,INTERSECTING:1,ABOVE:2,RIGHT:4,BELOW:8,LEFT:16},g={};g.boundingExtent=function(t){for(var e=g.createEmpty(),i=0,r=t.length;i<r;++i)g.extendCoordinate(e,t[i]);return e},g.boundingExtentXYs_=function(t,e,i){var r=Math.min.apply(null,t),n=Math.min.apply(null,e),a=Math.max.apply(null,t),o=Math.max.apply(null,e);return g.createOrUpdate(r,n,a,o,i)},g.buffer=function(t,e,i){return i?(i[0]=t[0]-e,i[1]=t[1]-e,i[2]=t[2]+e,i[3]=t[3]+e,i):[t[0]-e,t[1]-e,t[2]+e,t[3]+e]},g.clone=function(t,e){return e?(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e):t.slice()},g.closestSquaredDistanceXY=function(t,e,i){var r,n;return e<t[0]?r=t[0]-e:t[2]<e?r=e-t[2]:r=0,i<t[1]?n=t[1]-i:t[3]<i?n=i-t[3]:n=0,r*r+n*n},g.containsCoordinate=function(t,e){return g.containsXY(t,e[0],e[1])},g.containsExtent=function(t,e){return t[0]<=e[0]&&e[2]<=t[2]&&t[1]<=e[1]&&e[3]<=t[3]},g.containsXY=function(t,e,i){return t[0]<=e&&e<=t[2]&&t[1]<=i&&i<=t[3]},g.coordinateRelationship=function(t,e){var i=t[0],r=t[1],n=t[2],a=t[3],o=e[0],s=e[1],l=Ie.UNKNOWN;return o<i?l=l|Ie.LEFT:o>n&&(l=l|Ie.RIGHT),s<r?l=l|Ie.BELOW:s>a&&(l=l|Ie.ABOVE),l===Ie.UNKNOWN&&(l=Ie.INTERSECTING),l},g.createEmpty=function(){return[1/0,1/0,-1/0,-1/0]},g.createOrUpdate=function(t,e,i,r,n){return n?(n[0]=t,n[1]=e,n[2]=i,n[3]=r,n):[t,e,i,r]},g.createOrUpdateEmpty=function(t){return g.createOrUpdate(1/0,1/0,-1/0,-1/0,t)},g.createOrUpdateFromCoordinate=function(t,e){var i=t[0],r=t[1];return g.createOrUpdate(i,r,i,r,e)},g.createOrUpdateFromCoordinates=function(t,e){var i=g.createOrUpdateEmpty(e);return g.extendCoordinates(i,t)},g.createOrUpdateFromFlatCoordinates=function(t,e,i,r,n){var a=g.createOrUpdateEmpty(n);return g.extendFlatCoordinates(a,t,e,i,r)},g.createOrUpdateFromRings=function(t,e){var i=g.createOrUpdateEmpty(e);return g.extendRings(i,t)},g.equals=function(t,e){return t[0]==e[0]&&t[2]==e[2]&&t[1]==e[1]&&t[3]==e[3]},g.extend=function(t,e){return e[0]<t[0]&&(t[0]=e[0]),e[2]>t[2]&&(t[2]=e[2]),e[1]<t[1]&&(t[1]=e[1]),e[3]>t[3]&&(t[3]=e[3]),t},g.extendCoordinate=function(t,e){e[0]<t[0]&&(t[0]=e[0]),e[0]>t[2]&&(t[2]=e[0]),e[1]<t[1]&&(t[1]=e[1]),e[1]>t[3]&&(t[3]=e[1])},g.extendCoordinates=function(t,e){var i,r;for(i=0,r=e.length;i<r;++i)g.extendCoordinate(t,e[i]);return t},g.extendFlatCoordinates=function(t,e,i,r,n){for(;i<r;i+=n)g.extendXY(t,e[i],e[i+1]);return t},g.extendRings=function(t,e){var i,r;for(i=0,r=e.length;i<r;++i)g.extendCoordinates(t,e[i]);return t},g.extendXY=function(t,e,i){t[0]=Math.min(t[0],e),t[1]=Math.min(t[1],i),t[2]=Math.max(t[2],e),t[3]=Math.max(t[3],i)},g.forEachCorner=function(t,e,i){var r;return r=e.call(i,g.getBottomLeft(t)),r||(r=e.call(i,g.getBottomRight(t)),r)||(r=e.call(i,g.getTopRight(t)),r)||(r=e.call(i,g.getTopLeft(t)),r)?r:!1},g.getArea=function(t){var e=0;return g.isEmpty(t)||(e=g.getWidth(t)*g.getHeight(t)),e},g.getBottomLeft=function(t){return[t[0],t[1]]},g.getBottomRight=function(t){return[t[2],t[1]]},g.getCenter=function(t){return[(t[0]+t[2])/2,(t[1]+t[3])/2]},g.getCorner=function(t,e){var i;return e===Zr.BOTTOM_LEFT?i=g.getBottomLeft(t):e===Zr.BOTTOM_RIGHT?i=g.getBottomRight(t):e===Zr.TOP_LEFT?i=g.getTopLeft(t):e===Zr.TOP_RIGHT?i=g.getTopRight(t):Ot.assert(!1,13),i},g.getEnlargedArea=function(t,e){var i=Math.min(t[0],e[0]),r=Math.min(t[1],e[1]),n=Math.max(t[2],e[2]),a=Math.max(t[3],e[3]);return(n-i)*(a-r)},g.getForViewAndSize=function(t,e,i,r,n){var a=e*r[0]/2,o=e*r[1]/2,s=Math.cos(i),l=Math.sin(i),h=a*s,u=a*l,f=o*s,c=o*l,d=t[0],v=t[1],E=d-h+c,p=d-h-c,m=d+h-c,y=d+h+c,R=v-u-f,C=v-u+f,x=v+u+f,I=v+u-f;return g.createOrUpdate(Math.min(E,p,m,y),Math.min(R,C,x,I),Math.max(E,p,m,y),Math.max(R,C,x,I),n)},g.getHeight=function(t){return t[3]-t[1]},g.getIntersectionArea=function(t,e){var i=g.getIntersection(t,e);return g.getArea(i)},g.getIntersection=function(t,e,i){var r=i||g.createEmpty();return g.intersects(t,e)&&(t[0]>e[0]?r[0]=t[0]:r[0]=e[0],t[1]>e[1]?r[1]=t[1]:r[1]=e[1],t[2]<e[2]?r[2]=t[2]:r[2]=e[2],t[3]<e[3]?r[3]=t[3]:r[3]=e[3]),r},g.getMargin=function(t){return g.getWidth(t)+g.getHeight(t)},g.getSize=function(t){return[t[2]-t[0],t[3]-t[1]]},g.getTopLeft=function(t){return[t[0],t[3]]},g.getTopRight=function(t){return[t[2],t[3]]},g.getWidth=function(t){return t[2]-t[0]},g.intersects=function(t,e){return t[0]<=e[2]&&t[2]>=e[0]&&t[1]<=e[3]&&t[3]>=e[1]},g.isEmpty=function(t){return t[2]<t[0]||t[3]<t[1]},g.returnOrUpdate=function(t,e){return e?(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e):t},g.scaleFromCenter=function(t,e){var i=(t[2]-t[0])/2*(e-1),r=(t[3]-t[1])/2*(e-1);t[0]-=i,t[2]+=i,t[1]-=r,t[3]+=r},g.intersectsSegment=function(t,e,i){var r=!1,n=g.coordinateRelationship(t,e),a=g.coordinateRelationship(t,i);if(n===Ie.INTERSECTING||a===Ie.INTERSECTING)r=!0;else{var o=t[0],s=t[1],l=t[2],h=t[3],u=e[0],f=e[1],c=i[0],d=i[1],v=(d-f)/(c-u),E,p;a&Ie.ABOVE&&!(n&Ie.ABOVE)&&(E=c-(d-h)/v,r=E>=o&&E<=l),!r&&a&Ie.RIGHT&&!(n&Ie.RIGHT)&&(p=d-(c-l)*v,r=p>=s&&p<=h),!r&&a&Ie.BELOW&&!(n&Ie.BELOW)&&(E=c-(d-s)/v,r=E>=o&&E<=l),!r&&a&Ie.LEFT&&!(n&Ie.LEFT)&&(p=d-(c-o)*v,r=p>=s&&p<=h)}return r},g.applyTransform=function(t,e,i){var r=[t[0],t[1],t[0],t[3],t[2],t[1],t[2],t[3]];e(r,r,2);var n=[r[0],r[2],r[4],r[6]],a=[r[1],r[3],r[5],r[7]];return g.boundingExtentXYs_(n,a,i)};var K={POINT:"Point",LINE_STRING:"LineString",LINEAR_RING:"LinearRing",POLYGON:"Polygon",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon",GEOMETRY_COLLECTION:"GeometryCollection",CIRCLE:"Circle"},Ge={XY:"XY",XYZ:"XYZ",XYM:"XYM",XYZM:"XYZM"},ne={};ne.TRUE=function(){return!0},ne.FALSE=function(){return!1};var ae={};ae.transform2D=function(t,e,i,r,n,a){var o=a||[],s=0,l;for(l=e;l<i;l+=r){var h=t[l],u=t[l+1];o[s++]=n[0]*h+n[2]*u+n[4],o[s++]=n[1]*h+n[3]*u+n[5]}return a&&o.length!=s&&(o.length=s),o},ae.rotate=function(t,e,i,r,n,a,o){for(var s=o||[],l=Math.cos(n),h=Math.sin(n),u=a[0],f=a[1],c=0,d=e;d<i;d+=r){var v=t[d]-u,E=t[d+1]-f;s[c++]=u+v*l-E*h,s[c++]=f+v*h+E*l;for(var p=d+2;p<d+r;++p)s[c++]=t[p]}return o&&s.length!=c&&(s.length=c),s},ae.scale=function(t,e,i,r,n,a,o,s){for(var l=s||[],h=o[0],u=o[1],f=0,c=e;c<i;c+=r){var d=t[c]-h,v=t[c+1]-u;l[f++]=h+n*d,l[f++]=u+a*v;for(var E=c+2;E<c+r;++E)l[f++]=t[E]}return s&&l.length!=f&&(l.length=f),l},ae.translate=function(t,e,i,r,n,a,o){var s=o||[],l=0,h,u;for(h=e;h<i;h+=r)for(s[l++]=t[h]+n,s[l++]=t[h+1]+a,u=h+2;u<h+r;++u)s[l++]=t[u];return o&&s.length!=l&&(s.length=l),s};/**
 * @license
 * Latitude/longitude spherical geodesy formulae taken from
 * http://www.movable-type.co.uk/scripts/latlong.html
 * Licensed under CC-BY-3.0.
 */var Vt=function(t){this.radius=t};Vt.prototype.geodesicArea=function(t){return Vt.getArea_(t,this.radius)},Vt.prototype.haversineDistance=function(t,e){return Vt.getDistance_(t,e,this.radius)},Vt.prototype.offset=function(t,e,i){var r=j.toRadians(t[1]),n=j.toRadians(t[0]),a=e/this.radius,o=Math.asin(Math.sin(r)*Math.cos(a)+Math.cos(r)*Math.sin(a)*Math.cos(i)),s=n+Math.atan2(Math.sin(i)*Math.sin(a)*Math.cos(r),Math.cos(a)-Math.sin(r)*Math.sin(o));return[j.toDegrees(s),j.toDegrees(o)]},Vt.DEFAULT_RADIUS=63710088e-1,Vt.getLength=function(t,e){var i=e||{},r=i.radius||Vt.DEFAULT_RADIUS,n=i.projection||"EPSG:3857";t=t.clone().transform(n,"EPSG:4326");var a=t.getType(),o=0,s,l,h,u,f,c;switch(a){case K.POINT:case K.MULTI_POINT:break;case K.LINE_STRING:case K.LINEAR_RING:{s=t.getCoordinates(),o=Vt.getLength_(s,r);break}case K.MULTI_LINE_STRING:case K.POLYGON:{for(s=t.getCoordinates(),h=0,u=s.length;h<u;++h)o+=Vt.getLength_(s[h],r);break}case K.MULTI_POLYGON:{for(s=t.getCoordinates(),h=0,u=s.length;h<u;++h)for(l=s[h],f=0,c=l.length;f<c;++f)o+=Vt.getLength_(l[f],r);break}case K.GEOMETRY_COLLECTION:{var d=t.getGeometries();for(h=0,u=d.length;h<u;++h)o+=Vt.getLength(d[h],e);break}default:throw new Error("Unsupported geometry type: "+a)}return o},Vt.getLength_=function(t,e){for(var i=0,r=0,n=t.length;r<n-1;++r)i+=Vt.getDistance_(t[r],t[r+1],e);return i},Vt.getDistance_=function(t,e,i){var r=j.toRadians(t[1]),n=j.toRadians(e[1]),a=(n-r)/2,o=j.toRadians(e[0]-t[0])/2,s=Math.sin(a)*Math.sin(a)+Math.sin(o)*Math.sin(o)*Math.cos(r)*Math.cos(n);return 2*i*Math.atan2(Math.sqrt(s),Math.sqrt(1-s))},Vt.getArea=function(t,e){var i=e||{},r=i.radius||Vt.DEFAULT_RADIUS,n=i.projection||"EPSG:3857";t=t.clone().transform(n,"EPSG:4326");var a=t.getType(),o=0,s,l,h,u,f,c;switch(a){case K.POINT:case K.MULTI_POINT:case K.LINE_STRING:case K.MULTI_LINE_STRING:case K.LINEAR_RING:break;case K.POLYGON:{for(s=t.getCoordinates(),o=Math.abs(Vt.getArea_(s[0],r)),h=1,u=s.length;h<u;++h)o-=Math.abs(Vt.getArea_(s[h],r));break}case K.MULTI_POLYGON:{for(s=t.getCoordinates(),h=0,u=s.length;h<u;++h)for(l=s[h],o+=Math.abs(Vt.getArea_(l[0],r)),f=1,c=l.length;f<c;++f)o-=Math.abs(Vt.getArea_(l[f],r));break}case K.GEOMETRY_COLLECTION:{var d=t.getGeometries();for(h=0,u=d.length;h<u;++h)o+=Vt.getArea(d[h],e);break}default:throw new Error("Unsupported geometry type: "+a)}return o},Vt.getArea_=function(t,e){for(var i=0,r=t.length,n=t[r-1][0],a=t[r-1][1],o=0;o<r;o++){var s=t[o][0],l=t[o][1];i+=j.toRadians(s-n)*(2+Math.sin(j.toRadians(a))+Math.sin(j.toRadians(l))),n=s,a=l}return i*e*e/2};var _e={DEGREES:"degrees",FEET:"ft",METERS:"m",PIXELS:"pixels",TILE_PIXELS:"tile-pixels",USFEET:"us-ft"};_e.METERS_PER_UNIT={},_e.METERS_PER_UNIT[_e.DEGREES]=2*Math.PI*6370997/360,_e.METERS_PER_UNIT[_e.FEET]=.3048,_e.METERS_PER_UNIT[_e.METERS]=1,_e.METERS_PER_UNIT[_e.USFEET]=1200/3937;var Ki={};Ki.cache_=null,Ki.set=function(t){Ki.cache_=t},Ki.get=function(){return Ki.cache_||window.proj4};var oe=function(t){this.code_=t.code,this.units_=t.units,this.extent_=t.extent!==void 0?t.extent:null,this.worldExtent_=t.worldExtent!==void 0?t.worldExtent:null,this.axisOrientation_=t.axisOrientation!==void 0?t.axisOrientation:"enu",this.global_=t.global!==void 0?t.global:!1,this.canWrapX_=!!(this.global_&&this.extent_),this.getPointResolutionFunc_=t.getPointResolution,this.defaultTileGrid_=null,this.metersPerUnit_=t.metersPerUnit;var e=t.code;if(_.ENABLE_PROJ4JS){var i=Ki.get();if(typeof i=="function"){var r=i.defs(e);r!==void 0&&(r.axis!==void 0&&t.axisOrientation===void 0&&(this.axisOrientation_=r.axis),t.metersPerUnit===void 0&&(this.metersPerUnit_=r.to_meter),t.units===void 0&&(this.units_=r.units))}}};oe.prototype.canWrapX=function(){return this.canWrapX_},oe.prototype.getCode=function(){return this.code_},oe.prototype.getExtent=function(){return this.extent_},oe.prototype.getUnits=function(){return this.units_},oe.prototype.getMetersPerUnit=function(){return this.metersPerUnit_||_e.METERS_PER_UNIT[this.units_]},oe.prototype.getWorldExtent=function(){return this.worldExtent_},oe.prototype.getAxisOrientation=function(){return this.axisOrientation_},oe.prototype.isGlobal=function(){return this.global_},oe.prototype.setGlobal=function(t){this.global_=t,this.canWrapX_=!!(t&&this.extent_)},oe.prototype.getDefaultTileGrid=function(){return this.defaultTileGrid_},oe.prototype.setDefaultTileGrid=function(t){this.defaultTileGrid_=t},oe.prototype.setExtent=function(t){this.extent_=t,this.canWrapX_=!!(this.global_&&t)},oe.prototype.setWorldExtent=function(t){this.worldExtent_=t},oe.prototype.setGetPointResolution=function(t){this.getPointResolutionFunc_=t},oe.prototype.getPointResolutionFunc=function(){return this.getPointResolutionFunc_};var Et={};Et.Projection_=function(t){oe.call(this,{code:t,units:_e.METERS,extent:Et.EXTENT,global:!0,worldExtent:Et.WORLD_EXTENT,getPointResolution:function(e,i){return e/j.cosh(i[1]/Et.RADIUS)}})},_.inherits(Et.Projection_,oe),Et.RADIUS=6378137,Et.HALF_SIZE=Math.PI*Et.RADIUS,Et.EXTENT=[-Et.HALF_SIZE,-Et.HALF_SIZE,Et.HALF_SIZE,Et.HALF_SIZE],Et.WORLD_EXTENT=[-180,-85,180,85],Et.PROJECTIONS=[new Et.Projection_("EPSG:3857"),new Et.Projection_("EPSG:102100"),new Et.Projection_("EPSG:102113"),new Et.Projection_("EPSG:900913"),new Et.Projection_("urn:ogc:def:crs:EPSG:6.18:3:3857"),new Et.Projection_("urn:ogc:def:crs:EPSG::3857"),new Et.Projection_("http://www.opengis.net/gml/srs/epsg.xml#3857")],Et.fromEPSG4326=function(t,e,i){var r=t.length,n=i>1?i:2,a=e;a===void 0&&(n>2?a=t.slice():a=new Array(r));for(var o=Et.HALF_SIZE,s=0;s<r;s+=n){a[s]=o*t[s]/180;var l=Et.RADIUS*Math.log(Math.tan(Math.PI*(t[s+1]+90)/360));l>o?l=o:l<-o&&(l=-o),a[s+1]=l}return a},Et.toEPSG4326=function(t,e,i){var r=t.length,n=i>1?i:2,a=e;a===void 0&&(n>2?a=t.slice():a=new Array(r));for(var o=0;o<r;o+=n)a[o]=180*t[o]/Et.HALF_SIZE,a[o+1]=360*Math.atan(Math.exp(t[o+1]/Et.RADIUS))/Math.PI-90;return a};var ve={};ve.Projection_=function(t,e){oe.call(this,{code:t,units:_e.DEGREES,extent:ve.EXTENT,axisOrientation:e,global:!0,metersPerUnit:ve.METERS_PER_UNIT,worldExtent:ve.EXTENT})},_.inherits(ve.Projection_,oe),ve.RADIUS=6378137,ve.EXTENT=[-180,-90,180,90],ve.METERS_PER_UNIT=Math.PI*ve.RADIUS/180,ve.PROJECTIONS=[new ve.Projection_("CRS:84"),new ve.Projection_("EPSG:4326","neu"),new ve.Projection_("urn:ogc:def:crs:EPSG::4326","neu"),new ve.Projection_("urn:ogc:def:crs:EPSG:6.6:4326","neu"),new ve.Projection_("urn:ogc:def:crs:OGC:1.3:CRS84"),new ve.Projection_("urn:ogc:def:crs:OGC:2:84"),new ve.Projection_("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new ve.Projection_("urn:x-ogc:def:crs:EPSG:4326","neu")];var Fi={};Fi.cache_={},Fi.clear=function(){Fi.cache_={}},Fi.get=function(t){var e=Fi.cache_;return e[t]||null},Fi.add=function(t,e){var i=Fi.cache_;i[t]=e};var Se={};Se.cache_={},Se.clear=function(){Se.cache_={}},Se.add=function(t,e,i){var r=t.getCode(),n=e.getCode(),a=Se.cache_;r in a||(a[r]={}),a[r][n]=i},Se.remove=function(t,e){var i=t.getCode(),r=e.getCode(),n=Se.cache_,a=n[i][r];return delete n[i][r],ht.isEmpty(n[i])&&delete n[i],a},Se.get=function(t,e){var i,r=Se.cache_;return t in r&&e in r[t]&&(i=r[t][e]),i};var k={};k.METERS_PER_UNIT=_e.METERS_PER_UNIT,k.SPHERE_=new Vt(Vt.DEFAULT_RADIUS),_.ENABLE_PROJ4JS&&(k.setProj4=function(t){Ki.set(t)}),k.getPointResolution=function(t,e,i,r){t=k.get(t);var n,a=t.getPointResolutionFunc();if(a)n=a(e,i);else{var o=t.getUnits();if(o==_e.DEGREES&&!r||r==_e.DEGREES)n=e;else{var s=k.getTransformFromProjections(t,k.get("EPSG:4326")),l=[i[0]-e/2,i[1],i[0]+e/2,i[1],i[0],i[1]-e/2,i[0],i[1]+e/2];l=s(l,l,2);var h=k.SPHERE_.haversineDistance(l.slice(0,2),l.slice(2,4)),u=k.SPHERE_.haversineDistance(l.slice(4,6),l.slice(6,8));n=(h+u)/2;var f=r?_e.METERS_PER_UNIT[r]:t.getMetersPerUnit();f!==void 0&&(n/=f)}}return n},k.addEquivalentProjections=function(t){k.addProjections(t),t.forEach(function(e){t.forEach(function(i){e!==i&&Se.add(e,i,k.cloneTransform)})})},k.addEquivalentTransforms=function(t,e,i,r){t.forEach(function(n){e.forEach(function(a){Se.add(n,a,i),Se.add(a,n,r)})})},k.addProjection=function(t){Fi.add(t.getCode(),t),Se.add(t,t,k.cloneTransform)},k.addProjections=function(t){t.forEach(k.addProjection)},k.clearAllProjections=function(){Fi.clear(),Se.clear()},k.createProjection=function(t,e){return t?typeof t=="string"?k.get(t):t:k.get(e)},k.addCoordinateTransforms=function(t,e,i,r){var n=k.get(t),a=k.get(e);Se.add(n,a,k.createTransformFromCoordinateTransform(i)),Se.add(a,n,k.createTransformFromCoordinateTransform(r))},k.createTransformFromCoordinateTransform=function(t){return function(e,i,r){var n=e.length,a=r!==void 0?r:2,o=i!==void 0?i:new Array(n),s,l,h;for(l=0;l<n;l+=a)for(s=t([e[l],e[l+1]]),o[l]=s[0],o[l+1]=s[1],h=a-1;h>=2;--h)o[l+h]=e[l+h];return o}},k.fromLonLat=function(t,e){return k.transform(t,"EPSG:4326",e!==void 0?e:"EPSG:3857")},k.toLonLat=function(t,e){var i=k.transform(t,e!==void 0?e:"EPSG:3857","EPSG:4326"),r=i[0];return(r<-180||r>180)&&(i[0]=j.modulo(r+180,360)-180),i},k.get=function(t){var e=null;if(t instanceof oe)e=t;else if(typeof t=="string"){var i=t;if(e=Fi.get(i),_.ENABLE_PROJ4JS&&!e){var r=Ki.get();typeof r=="function"&&r.defs(i)!==void 0&&(e=new oe({code:i}),k.addProjection(e))}}return e},k.equivalent=function(t,e){if(t===e)return!0;var i=t.getUnits()===e.getUnits();if(t.getCode()===e.getCode())return i;var r=k.getTransformFromProjections(t,e);return r===k.cloneTransform&&i},k.getTransform=function(t,e){var i=k.get(t),r=k.get(e);return k.getTransformFromProjections(i,r)},k.getTransformFromProjections=function(t,e){var i=t.getCode(),r=e.getCode(),n=Se.get(i,r);if(_.ENABLE_PROJ4JS&&!n){var a=Ki.get();if(typeof a=="function"){var o=a.defs(i),s=a.defs(r);if(o!==void 0&&s!==void 0){if(o===s)k.addEquivalentProjections([e,t]);else{var l=a(r,i);k.addCoordinateTransforms(e,t,l.forward,l.inverse)}n=Se.get(i,r)}}}return n||(n=k.identityTransform),n},k.identityTransform=function(t,e,i){if(e!==void 0&&t!==e){for(var r=0,n=t.length;r<n;++r)e[r]=t[r];t=e}return t},k.cloneTransform=function(t,e,i){var r;if(e!==void 0){for(var n=0,a=t.length;n<a;++n)e[n]=t[n];r=e}else r=t.slice();return r},k.transform=function(t,e,i){var r=k.getTransform(e,i);return r(t,void 0,t.length)},k.transformExtent=function(t,e,i){var r=k.getTransform(e,i);return g.applyTransform(t,r)},k.transformWithProjections=function(t,e,i){var r=k.getTransformFromProjections(e,i);return r(t)},k.addCommon=function(){k.addEquivalentProjections(Et.PROJECTIONS),k.addEquivalentProjections(ve.PROJECTIONS),k.addEquivalentTransforms(ve.PROJECTIONS,Et.PROJECTIONS,Et.fromEPSG4326,Et.toEPSG4326)},k.addCommon();var A={};A.tmp_=new Array(6),A.create=function(){return[1,0,0,1,0,0]},A.reset=function(t){return A.set(t,1,0,0,1,0,0)},A.multiply=function(t,e){var i=t[0],r=t[1],n=t[2],a=t[3],o=t[4],s=t[5],l=e[0],h=e[1],u=e[2],f=e[3],c=e[4],d=e[5];return t[0]=i*l+n*h,t[1]=r*l+a*h,t[2]=i*u+n*f,t[3]=r*u+a*f,t[4]=i*c+n*d+o,t[5]=r*c+a*d+s,t},A.set=function(t,e,i,r,n,a,o){return t[0]=e,t[1]=i,t[2]=r,t[3]=n,t[4]=a,t[5]=o,t},A.setFromArray=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},A.apply=function(t,e){var i=e[0],r=e[1];return e[0]=t[0]*i+t[2]*r+t[4],e[1]=t[1]*i+t[3]*r+t[5],e},A.rotate=function(t,e){var i=Math.cos(e),r=Math.sin(e);return A.multiply(t,A.set(A.tmp_,i,r,-r,i,0,0))},A.scale=function(t,e,i){return A.multiply(t,A.set(A.tmp_,e,0,0,i,0,0))},A.translate=function(t,e,i){return A.multiply(t,A.set(A.tmp_,1,0,0,1,e,i))},A.compose=function(t,e,i,r,n,a,o,s){var l=Math.sin(a),h=Math.cos(a);return t[0]=r*h,t[1]=n*l,t[2]=-r*l,t[3]=n*h,t[4]=o*r*h-s*r*l+e,t[5]=o*n*l+s*n*h+i,t},A.invert=function(t){var e=A.determinant(t);Ot.assert(e!==0,32);var i=t[0],r=t[1],n=t[2],a=t[3],o=t[4],s=t[5];return t[0]=a/e,t[1]=-r/e,t[2]=-n/e,t[3]=i/e,t[4]=(n*s-a*o)/e,t[5]=-(i*s-r*o)/e,t},A.determinant=function(t){return t[0]*t[3]-t[1]*t[2]};var me=function(){it.call(this),this.extent_=g.createEmpty(),this.extentRevision_=-1,this.simplifiedGeometryCache={},this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=0,this.tmpTransform_=A.create()};_.inherits(me,it),me.prototype.clone=function(){},me.prototype.closestPointXY=function(t,e,i,r){},me.prototype.getClosestPoint=function(t,e){var i=e||[NaN,NaN];return this.closestPointXY(t[0],t[1],i,1/0),i},me.prototype.intersectsCoordinate=function(t){return this.containsXY(t[0],t[1])},me.prototype.computeExtent=function(t){},me.prototype.containsXY=ne.FALSE,me.prototype.getExtent=function(t){return this.extentRevision_!=this.getRevision()&&(this.extent_=this.computeExtent(this.extent_),this.extentRevision_=this.getRevision()),g.returnOrUpdate(this.extent_,t)},me.prototype.rotate=function(t,e){},me.prototype.scale=function(t,e,i){},me.prototype.simplify=function(t){return this.getSimplifiedGeometry(t*t)},me.prototype.getSimplifiedGeometry=function(t){},me.prototype.getType=function(){},me.prototype.applyTransform=function(t){},me.prototype.intersectsExtent=function(t){},me.prototype.translate=function(t,e){},me.prototype.transform=function(t,e){var i=this.tmpTransform_;t=k.get(t);var r=t.getUnits()==_e.TILE_PIXELS?function(n,a,o){var s=t.getExtent(),l=t.getWorldExtent(),h=g.getHeight(l)/g.getHeight(s);return A.compose(i,l[0],l[3],h,-h,0,0,0),ae.transform2D(n,0,n.length,o,i,a),k.getTransform(t,e)(n,a,o)}:k.getTransform(t,e);return this.applyTransform(r),this};var Tt=function(){me.call(this),this.layout=Ge.XY,this.stride=2,this.flatCoordinates=null};_.inherits(Tt,me),Tt.getLayoutForStride_=function(t){var e;return t==2?e=Ge.XY:t==3?e=Ge.XYZ:t==4&&(e=Ge.XYZM),e},Tt.getStrideForLayout=function(t){var e;return t==Ge.XY?e=2:t==Ge.XYZ||t==Ge.XYM?e=3:t==Ge.XYZM&&(e=4),e},Tt.prototype.containsXY=ne.FALSE,Tt.prototype.computeExtent=function(t){return g.createOrUpdateFromFlatCoordinates(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)},Tt.prototype.getCoordinates=function(){},Tt.prototype.getFirstCoordinate=function(){return this.flatCoordinates.slice(0,this.stride)},Tt.prototype.getFlatCoordinates=function(){return this.flatCoordinates},Tt.prototype.getLastCoordinate=function(){return this.flatCoordinates.slice(this.flatCoordinates.length-this.stride)},Tt.prototype.getLayout=function(){return this.layout},Tt.prototype.getSimplifiedGeometry=function(t){if(this.simplifiedGeometryRevision!=this.getRevision()&&(ht.clear(this.simplifiedGeometryCache),this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),t<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&t<=this.simplifiedGeometryMaxMinSquaredTolerance)return this;var e=t.toString();if(this.simplifiedGeometryCache.hasOwnProperty(e))return this.simplifiedGeometryCache[e];var i=this.getSimplifiedGeometryInternal(t),r=i.getFlatCoordinates();return r.length<this.flatCoordinates.length?(this.simplifiedGeometryCache[e]=i,i):(this.simplifiedGeometryMaxMinSquaredTolerance=t,this)},Tt.prototype.getSimplifiedGeometryInternal=function(t){return this},Tt.prototype.getStride=function(){return this.stride},Tt.prototype.setFlatCoordinatesInternal=function(t,e){this.stride=Tt.getStrideForLayout(t),this.layout=t,this.flatCoordinates=e},Tt.prototype.setCoordinates=function(t,e){},Tt.prototype.setLayout=function(t,e,i){var r;if(t)r=Tt.getStrideForLayout(t);else{var n;for(n=0;n<i;++n)if(e.length===0){this.layout=Ge.XY,this.stride=2;return}else e=e[0];r=e.length,t=Tt.getLayoutForStride_(r)}this.layout=t,this.stride=r},Tt.prototype.applyTransform=function(t){this.flatCoordinates&&(t(this.flatCoordinates,this.flatCoordinates,this.stride),this.changed())},Tt.prototype.rotate=function(t,e){var i=this.getFlatCoordinates();if(i){var r=this.getStride();ae.rotate(i,0,i.length,r,t,e,i),this.changed()}},Tt.prototype.scale=function(t,e,i){var r=e;r===void 0&&(r=t);var n=i;n||(n=g.getCenter(this.getExtent()));var a=this.getFlatCoordinates();if(a){var o=this.getStride();ae.scale(a,0,a.length,o,t,r,n,a),this.changed()}},Tt.prototype.translate=function(t,e){var i=this.getFlatCoordinates();if(i){var r=this.getStride();ae.translate(i,0,i.length,r,t,e,i),this.changed()}},Tt.transform2D=function(t,e,i){var r=t.getFlatCoordinates();if(r){var n=t.getStride();return ae.transform2D(r,0,r.length,n,e,i)}else return null};var or={};or.linearRing=function(t,e,i,r){for(var n=0,a=t[i-r],o=t[i-r+1];e<i;e+=r){var s=t[e],l=t[e+1];n+=o*s-a*l,a=s,o=l}return n/2},or.linearRings=function(t,e,i,r){var n=0,a,o;for(a=0,o=i.length;a<o;++a){var s=i[a];n+=or.linearRing(t,e,s,r),e=s}return n},or.linearRingss=function(t,e,i,r){var n=0,a,o;for(a=0,o=i.length;a<o;++a){var s=i[a];n+=or.linearRings(t,e,s,r),e=s[s.length-1]}return n};var Ue={};Ue.point=function(t,e,i,r,n,a,o){var s=t[e],l=t[e+1],h=t[i]-s,u=t[i+1]-l,f,c;if(h===0&&u===0)c=e;else{var d=((n-s)*h+(a-l)*u)/(h*h+u*u);if(d>1)c=i;else if(d>0){for(f=0;f<r;++f)o[f]=j.lerp(t[e+f],t[i+f],d);o.length=r;return}else c=e}for(f=0;f<r;++f)o[f]=t[c+f];o.length=r},Ue.getMaxSquaredDelta=function(t,e,i,r,n){var a=t[e],o=t[e+1];for(e+=r;e<i;e+=r){var s=t[e],l=t[e+1],h=j.squaredDistance(a,o,s,l);h>n&&(n=h),a=s,o=l}return n},Ue.getsMaxSquaredDelta=function(t,e,i,r,n){var a,o;for(a=0,o=i.length;a<o;++a){var s=i[a];n=Ue.getMaxSquaredDelta(t,e,s,r,n),e=s}return n},Ue.getssMaxSquaredDelta=function(t,e,i,r,n){var a,o;for(a=0,o=i.length;a<o;++a){var s=i[a];n=Ue.getsMaxSquaredDelta(t,e,s,r,n),e=s[s.length-1]}return n},Ue.getClosestPoint=function(t,e,i,r,n,a,o,s,l,h,u){if(e==i)return h;var f,c;if(n===0)if(c=j.squaredDistance(o,s,t[e],t[e+1]),c<h){for(f=0;f<r;++f)l[f]=t[e+f];return l.length=r,c}else return h;for(var d=u||[NaN,NaN],v=e+r;v<i;)if(Ue.point(t,v-r,v,r,o,s,d),c=j.squaredDistance(o,s,d[0],d[1]),c<h){for(h=c,f=0;f<r;++f)l[f]=d[f];l.length=r,v+=r}else v+=r*Math.max((Math.sqrt(c)-Math.sqrt(h))/n|0,1);if(a&&(Ue.point(t,i-r,e,r,o,s,d),c=j.squaredDistance(o,s,d[0],d[1]),c<h)){for(h=c,f=0;f<r;++f)l[f]=d[f];l.length=r}return h},Ue.getsClosestPoint=function(t,e,i,r,n,a,o,s,l,h,u){var f=u||[NaN,NaN],c,d;for(c=0,d=i.length;c<d;++c){var v=i[c];h=Ue.getClosestPoint(t,e,v,r,n,a,o,s,l,h,f),e=v}return h},Ue.getssClosestPoint=function(t,e,i,r,n,a,o,s,l,h,u){var f=u||[NaN,NaN],c,d;for(c=0,d=i.length;c<d;++c){var v=i[c];h=Ue.getsClosestPoint(t,e,v,r,n,a,o,s,l,h,f),e=v[v.length-1]}return h};var zi={};zi.coordinate=function(t,e,i,r){var n,a;for(n=0,a=i.length;n<a;++n)t[e++]=i[n];return e},zi.coordinates=function(t,e,i,r){var n,a;for(n=0,a=i.length;n<a;++n){var o=i[n],s;for(s=0;s<r;++s)t[e++]=o[s]}return e},zi.coordinatess=function(t,e,i,r,n){var a=n||[],o=0,s,l;for(s=0,l=i.length;s<l;++s){var h=zi.coordinates(t,e,i[s],r);a[o++]=h,e=h}return a.length=o,a},zi.coordinatesss=function(t,e,i,r,n){var a=n||[],o=0,s,l;for(s=0,l=i.length;s<l;++s){var h=zi.coordinatess(t,e,i[s],r,a[o]);a[o++]=h,e=h[h.length-1]}return a.length=o,a};var Ni={};Ni.coordinates=function(t,e,i,r,n){var a=n!==void 0?n:[],o=0,s;for(s=e;s<i;s+=r)a[o++]=t.slice(s,s+r);return a.length=o,a},Ni.coordinatess=function(t,e,i,r,n){var a=n!==void 0?n:[],o=0,s,l;for(s=0,l=i.length;s<l;++s){var h=i[s];a[o++]=Ni.coordinates(t,e,h,r,a[o]),e=h}return a.length=o,a},Ni.coordinatesss=function(t,e,i,r,n){var a=n!==void 0?n:[],o=0,s,l;for(s=0,l=i.length;s<l;++s){var h=i[s];a[o++]=Ni.coordinatess(t,e,h,r,a[o]),e=h[h.length-1]}return a.length=o,a};var Ht={};Ht.lineString=function(t,e,i,r,n,a,o){var s=o!==void 0?o:[];return a||(i=Ht.radialDistance(t,e,i,r,n,s,0),t=s,e=0,r=2),s.length=Ht.douglasPeucker(t,e,i,r,n,s,0),s},Ht.douglasPeucker=function(t,e,i,r,n,a,o){var s=(i-e)/r;if(s<3){for(;e<i;e+=r)a[o++]=t[e],a[o++]=t[e+1];return o}var l=new Array(s);l[0]=1,l[s-1]=1;for(var h=[e,i-r],u=0,f;h.length>0;){var c=h.pop(),d=h.pop(),v=0,E=t[d],p=t[d+1],m=t[c],y=t[c+1];for(f=d+r;f<c;f+=r){var R=t[f],C=t[f+1],x=j.squaredSegmentDistance(R,C,E,p,m,y);x>v&&(u=f,v=x)}v>n&&(l[(u-e)/r]=1,d+r<u&&h.push(d,u),u+r<c&&h.push(u,c))}for(f=0;f<s;++f)l[f]&&(a[o++]=t[e+f*r],a[o++]=t[e+f*r+1]);return o},Ht.douglasPeuckers=function(t,e,i,r,n,a,o,s){var l,h;for(l=0,h=i.length;l<h;++l){var u=i[l];o=Ht.douglasPeucker(t,e,u,r,n,a,o),s.push(o),e=u}return o},Ht.douglasPeuckerss=function(t,e,i,r,n,a,o,s){var l,h;for(l=0,h=i.length;l<h;++l){var u=i[l],f=[];o=Ht.douglasPeuckers(t,e,u,r,n,a,o,f),s.push(f),e=u[u.length-1]}return o},Ht.radialDistance=function(t,e,i,r,n,a,o){if(i<=e+r){for(;e<i;e+=r)a[o++]=t[e],a[o++]=t[e+1];return o}var s=t[e],l=t[e+1];a[o++]=s,a[o++]=l;var h=s,u=l;for(e+=r;e<i;e+=r)h=t[e],u=t[e+1],j.squaredDistance(s,l,h,u)>n&&(a[o++]=h,a[o++]=u,s=h,l=u);return(h!=s||u!=l)&&(a[o++]=h,a[o++]=u),o},Ht.snap=function(t,e){return e*Math.round(t/e)},Ht.quantize=function(t,e,i,r,n,a,o){if(e==i)return o;var s=Ht.snap(t[e],n),l=Ht.snap(t[e+1],n);e+=r,a[o++]=s,a[o++]=l;var h,u;do if(h=Ht.snap(t[e],n),u=Ht.snap(t[e+1],n),e+=r,e==i)return a[o++]=h,a[o++]=u,o;while(h==s&&u==l);for(;e<i;){var f,c;if(f=Ht.snap(t[e],n),c=Ht.snap(t[e+1],n),e+=r,!(f==h&&c==u)){var d=h-s,v=u-l,E=f-s,p=c-l;if(d*p==v*E&&(d<0&&E<d||d==E||d>0&&E>d)&&(v<0&&p<v||v==p||v>0&&p>v)){h=f,u=c;continue}a[o++]=h,a[o++]=u,s=h,l=u,h=f,u=c}}return a[o++]=h,a[o++]=u,o},Ht.quantizes=function(t,e,i,r,n,a,o,s){var l,h;for(l=0,h=i.length;l<h;++l){var u=i[l];o=Ht.quantize(t,e,u,r,n,a,o),s.push(o),e=u}return o},Ht.quantizess=function(t,e,i,r,n,a,o,s){var l,h;for(l=0,h=i.length;l<h;++l){var u=i[l],f=[];o=Ht.quantizes(t,e,u,r,n,a,o,f),s.push(f),e=u[u.length-1]}return o};var ii=function(t,e){Tt.call(this),this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.setCoordinates(t,e)};_.inherits(ii,Tt),ii.prototype.clone=function(){var t=new ii(null);return t.setFlatCoordinates(this.layout,this.flatCoordinates.slice()),t},ii.prototype.closestPointXY=function(t,e,i,r){return r<g.closestSquaredDistanceXY(this.getExtent(),t,e)?r:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Ue.getMaxSquaredDelta(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Ue.getClosestPoint(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!0,t,e,i,r))},ii.prototype.getArea=function(){return or.linearRing(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)},ii.prototype.getCoordinates=function(){return Ni.coordinates(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)},ii.prototype.getSimplifiedGeometryInternal=function(t){var e=[];e.length=Ht.douglasPeucker(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,0);var i=new ii(null);return i.setFlatCoordinates(Ge.XY,e),i},ii.prototype.getType=function(){return K.LINEAR_RING},ii.prototype.intersectsExtent=function(t){},ii.prototype.setCoordinates=function(t,e){t?(this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=zi.coordinates(this.flatCoordinates,0,t,this.stride),this.changed()):this.setFlatCoordinates(Ge.XY,null)},ii.prototype.setFlatCoordinates=function(t,e){this.setFlatCoordinatesInternal(t,e),this.changed()};var Ii=function(t,e){Tt.call(this),this.setCoordinates(t,e)};_.inherits(Ii,Tt),Ii.prototype.clone=function(){var t=new Ii(null);return t.setFlatCoordinates(this.layout,this.flatCoordinates.slice()),t},Ii.prototype.closestPointXY=function(t,e,i,r){var n=this.flatCoordinates,a=j.squaredDistance(t,e,n[0],n[1]);if(a<r){var o=this.stride,s;for(s=0;s<o;++s)i[s]=n[s];return i.length=o,a}else return r},Ii.prototype.getCoordinates=function(){return this.flatCoordinates?this.flatCoordinates.slice():[]},Ii.prototype.computeExtent=function(t){return g.createOrUpdateFromCoordinate(this.flatCoordinates,t)},Ii.prototype.getType=function(){return K.POINT},Ii.prototype.intersectsExtent=function(t){return g.containsXY(t,this.flatCoordinates[0],this.flatCoordinates[1])},Ii.prototype.setCoordinates=function(t,e){t?(this.setLayout(e,t,0),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=zi.coordinate(this.flatCoordinates,0,t,this.stride),this.changed()):this.setFlatCoordinates(Ge.XY,null)},Ii.prototype.setFlatCoordinates=function(t,e){this.setFlatCoordinatesInternal(t,e),this.changed()};var Ye={};Ye.linearRingContainsExtent=function(t,e,i,r,n){var a=g.forEachCorner(n,function(o){return!Ye.linearRingContainsXY(t,e,i,r,o[0],o[1])});return!a},Ye.linearRingContainsXY=function(t,e,i,r,n,a){for(var o=0,s=t[i-r],l=t[i-r+1];e<i;e+=r){var h=t[e],u=t[e+1];l<=a?u>a&&(h-s)*(a-l)-(n-s)*(u-l)>0&&o++:u<=a&&(h-s)*(a-l)-(n-s)*(u-l)<0&&o--,s=h,l=u}return o!==0},Ye.linearRingsContainsXY=function(t,e,i,r,n,a){if(i.length===0||!Ye.linearRingContainsXY(t,e,i[0],r,n,a))return!1;var o,s;for(o=1,s=i.length;o<s;++o)if(Ye.linearRingContainsXY(t,i[o-1],i[o],r,n,a))return!1;return!0},Ye.linearRingssContainsXY=function(t,e,i,r,n,a){if(i.length===0)return!1;var o,s;for(o=0,s=i.length;o<s;++o){var l=i[o];if(Ye.linearRingsContainsXY(t,e,l,r,n,a))return!0;e=l[l.length-1]}return!1};var fn={};fn.linearRings=function(t,e,i,r,n,a,o){for(var s,l,h,u,f,c,d,v=n[a+1],E=[],p=0,m=i.length;p<m;++p){var y=i[p];for(u=t[y-r],c=t[y-r+1],s=e;s<y;s+=r)f=t[s],d=t[s+1],(v<=c&&d<=v||c<=v&&v<=d)&&(h=(v-c)/(d-c)*(f-u)+u,E.push(h)),u=f,c=d}var R=NaN,C=-1/0;for(E.sort(st.numberSafeCompareFunction),u=E[0],s=1,l=E.length;s<l;++s){f=E[s];var x=Math.abs(f-u);x>C&&(h=(u+f)/2,Ye.linearRingsContainsXY(t,e,i,r,h,v)&&(R=h,C=x)),u=f}return isNaN(R)&&(R=n[a]),o?(o.push(R,v,C),o):[R,v,C]},fn.linearRingss=function(t,e,i,r,n){var a=[],o,s;for(o=0,s=i.length;o<s;++o){var l=i[o];a=fn.linearRings(t,e,l,r,n,2*o,a),e=l[l.length-1]}return a};var sa={};sa.forEach=function(t,e,i,r,n,a){for(var o=[t[e],t[e+1]],s=[],l;e+r<i;e+=r){if(s[0]=t[e+r],s[1]=t[e+r+1],l=n.call(a,o,s),l)return l;o[0]=s[0],o[1]=s[1]}return!1};var Gi={};Gi.lineString=function(t,e,i,r,n){var a=g.extendFlatCoordinates(g.createEmpty(),t,e,i,r);return g.intersects(n,a)?g.containsExtent(n,a)||a[0]>=n[0]&&a[2]<=n[2]||a[1]>=n[1]&&a[3]<=n[3]?!0:sa.forEach(t,e,i,r,function(o,s){return g.intersectsSegment(n,o,s)}):!1},Gi.lineStrings=function(t,e,i,r,n){var a,o;for(a=0,o=i.length;a<o;++a){if(Gi.lineString(t,e,i[a],r,n))return!0;e=i[a]}return!1},Gi.linearRing=function(t,e,i,r,n){return!!(Gi.lineString(t,e,i,r,n)||Ye.linearRingContainsXY(t,e,i,r,n[0],n[1])||Ye.linearRingContainsXY(t,e,i,r,n[0],n[3])||Ye.linearRingContainsXY(t,e,i,r,n[2],n[1])||Ye.linearRingContainsXY(t,e,i,r,n[2],n[3]))},Gi.linearRings=function(t,e,i,r,n){if(!Gi.linearRing(t,e,i[0],r,n))return!1;if(i.length===1)return!0;var a,o;for(a=1,o=i.length;a<o;++a)if(Ye.linearRingContainsExtent(t,i[a-1],i[a],r,n))return!1;return!0},Gi.linearRingss=function(t,e,i,r,n){var a,o;for(a=0,o=i.length;a<o;++a){var s=i[a];if(Gi.linearRings(t,e,s,r,n))return!0;e=s[s.length-1]}return!1};var la={};la.coordinates=function(t,e,i,r){for(;e<i-r;){var n;for(n=0;n<r;++n){var a=t[e+n];t[e+n]=t[i-r+n],t[i-r+n]=a}e+=r,i-=r}};var Ve={};Ve.linearRingIsClockwise=function(t,e,i,r){for(var n=0,a=t[i-r],o=t[i-r+1];e<i;e+=r){var s=t[e],l=t[e+1];n+=(s-a)*(l+o),a=s,o=l}return n>0},Ve.linearRingsAreOriented=function(t,e,i,r,n){var a=n!==void 0?n:!1,o,s;for(o=0,s=i.length;o<s;++o){var l=i[o],h=Ve.linearRingIsClockwise(t,e,l,r);if(o===0){if(a&&h||!a&&!h)return!1}else if(a&&!h||!a&&h)return!1;e=l}return!0},Ve.linearRingssAreOriented=function(t,e,i,r,n){var a,o;for(a=0,o=i.length;a<o;++a)if(!Ve.linearRingsAreOriented(t,e,i[a],r,n))return!1;return!0},Ve.orientLinearRings=function(t,e,i,r,n){var a=n!==void 0?n:!1,o,s;for(o=0,s=i.length;o<s;++o){var l=i[o],h=Ve.linearRingIsClockwise(t,e,l,r),u=o===0?a&&h||!a&&!h:a&&!h||!a&&h;u&&la.coordinates(t,e,l,r),e=l}return e},Ve.orientLinearRingss=function(t,e,i,r,n){var a,o;for(a=0,o=i.length;a<o;++a)e=Ve.orientLinearRings(t,e,i[a],r,n);return e};var Rt=function(t,e){Tt.call(this),this.ends_=[],this.flatInteriorPointRevision_=-1,this.flatInteriorPoint_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,this.setCoordinates(t,e)};_.inherits(Rt,Tt),Rt.prototype.appendLinearRing=function(t){this.flatCoordinates?st.extend(this.flatCoordinates,t.getFlatCoordinates()):this.flatCoordinates=t.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()},Rt.prototype.clone=function(){var t=new Rt(null);return t.setFlatCoordinates(this.layout,this.flatCoordinates.slice(),this.ends_.slice()),t},Rt.prototype.closestPointXY=function(t,e,i,r){return r<g.closestSquaredDistanceXY(this.getExtent(),t,e)?r:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Ue.getsMaxSquaredDelta(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Ue.getsClosestPoint(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!0,t,e,i,r))},Rt.prototype.containsXY=function(t,e){return Ye.linearRingsContainsXY(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,e)},Rt.prototype.getArea=function(){return or.linearRings(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride)},Rt.prototype.getCoordinates=function(t){var e;return t!==void 0?(e=this.getOrientedFlatCoordinates().slice(),Ve.orientLinearRings(e,0,this.ends_,this.stride,t)):e=this.flatCoordinates,Ni.coordinatess(e,0,this.ends_,this.stride)},Rt.prototype.getEnds=function(){return this.ends_},Rt.prototype.getFlatInteriorPoint=function(){if(this.flatInteriorPointRevision_!=this.getRevision()){var t=g.getCenter(this.getExtent());this.flatInteriorPoint_=fn.linearRings(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,0),this.flatInteriorPointRevision_=this.getRevision()}return this.flatInteriorPoint_},Rt.prototype.getInteriorPoint=function(){return new Ii(this.getFlatInteriorPoint(),Ge.XYM)},Rt.prototype.getLinearRingCount=function(){return this.ends_.length},Rt.prototype.getLinearRing=function(t){if(t<0||this.ends_.length<=t)return null;var e=new ii(null);return e.setFlatCoordinates(this.layout,this.flatCoordinates.slice(t===0?0:this.ends_[t-1],this.ends_[t])),e},Rt.prototype.getLinearRings=function(){var t=this.layout,e=this.flatCoordinates,i=this.ends_,r=[],n=0,a,o;for(a=0,o=i.length;a<o;++a){var s=i[a],l=new ii(null);l.setFlatCoordinates(t,e.slice(n,s)),r.push(l),n=s}return r},Rt.prototype.getOrientedFlatCoordinates=function(){if(this.orientedRevision_!=this.getRevision()){var t=this.flatCoordinates;Ve.linearRingsAreOriented(t,0,this.ends_,this.stride)?this.orientedFlatCoordinates_=t:(this.orientedFlatCoordinates_=t.slice(),this.orientedFlatCoordinates_.length=Ve.orientLinearRings(this.orientedFlatCoordinates_,0,this.ends_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_},Rt.prototype.getSimplifiedGeometryInternal=function(t){var e=[],i=[];e.length=Ht.quantizes(this.flatCoordinates,0,this.ends_,this.stride,Math.sqrt(t),e,0,i);var r=new Rt(null);return r.setFlatCoordinates(Ge.XY,e,i),r},Rt.prototype.getType=function(){return K.POLYGON},Rt.prototype.intersectsExtent=function(t){return Gi.linearRings(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t)},Rt.prototype.setCoordinates=function(t,e){if(!t)this.setFlatCoordinates(Ge.XY,null,this.ends_);else{this.setLayout(e,t,2),this.flatCoordinates||(this.flatCoordinates=[]);var i=zi.coordinatess(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=i.length===0?0:i[i.length-1],this.changed()}},Rt.prototype.setFlatCoordinates=function(t,e,i){this.setFlatCoordinatesInternal(t,e),this.ends_=i,this.changed()},Rt.circular=function(t,e,i,r){var n=r||32,a=[],o;for(o=0;o<n;++o)st.extend(a,t.offset(e,i,2*Math.PI*o/n));a.push(a[0],a[1]);var s=new Rt(null);return s.setFlatCoordinates(Ge.XY,a,[a.length]),s},Rt.fromExtent=function(t){var e=t[0],i=t[1],r=t[2],n=t[3],a=[e,i,e,n,r,n,r,i,e,i],o=new Rt(null);return o.setFlatCoordinates(Ge.XY,a,[a.length]),o},Rt.fromCircle=function(t,e,i){for(var r=e||32,n=t.getStride(),a=t.getLayout(),o=new Rt(null,a),s=n*(r+1),l=new Array(s),h=0;h<s;h++)l[h]=0;var u=[l.length];return o.setFlatCoordinates(a,l,u),Rt.makeRegular(o,t.getCenter(),t.getRadius(),i),o},Rt.makeRegular=function(t,e,i,r){for(var n=t.getFlatCoordinates(),a=t.getLayout(),o=t.getStride(),s=t.getEnds(),l=n.length/o-1,h=r||0,u,f,c=0;c<=l;++c)f=c*o,u=h+j.modulo(c,l)*2*Math.PI/l,n[f]=e[0]+i*Math.cos(u),n[f+1]=e[1]+i*Math.sin(u);t.setFlatCoordinates(a,n,s)};var q=function(t){it.call(this);var e=ht.assign({},t);this.hints_=[0,0],this.animations_=[],this.updateAnimationKey_,this.updateAnimations_=this.updateAnimations_.bind(this),this.projection_=k.createProjection(e.projection,"EPSG:3857"),this.applyOptions_(e)};_.inherits(q,it),q.prototype.applyOptions_=function(t){var e={};e[Ne.CENTER]=t.center!==void 0?t.center:null;var i=q.createResolutionConstraint_(t);this.maxResolution_=i.maxResolution,this.minResolution_=i.minResolution,this.zoomFactor_=i.zoomFactor,this.resolutions_=t.resolutions,this.minZoom_=i.minZoom;var r=q.createCenterConstraint_(t),n=i.constraint,a=q.createRotationConstraint_(t);this.constraints_={center:r,resolution:n,rotation:a},t.resolution!==void 0?e[Ne.RESOLUTION]=t.resolution:t.zoom!==void 0&&(e[Ne.RESOLUTION]=this.constrainResolution(this.maxResolution_,t.zoom-this.minZoom_),this.resolutions_&&(e[Ne.RESOLUTION]=j.clamp(Number(this.getResolution()||e[Ne.RESOLUTION]),this.minResolution_,this.maxResolution_))),e[Ne.ROTATION]=t.rotation!==void 0?t.rotation:0,this.setProperties(e),this.options_=t},q.prototype.getUpdatedOptions_=function(t){var e=ht.assign({},this.options_);return e.resolution!==void 0?e.resolution=this.getResolution():e.zoom=this.getZoom(),e.center=this.getCenter(),e.rotation=this.getRotation(),ht.assign({},e,t)},q.prototype.animate=function(t){var e=arguments.length,i;if(e>1&&typeof arguments[e-1]=="function"&&(i=arguments[e-1],--e),!this.isDef()){var r=arguments[e-1];r.center&&this.setCenter(r.center),r.zoom!==void 0&&this.setZoom(r.zoom),r.rotation!==void 0&&this.setRotation(r.rotation),i&&i(!0);return}for(var n=Date.now(),a=this.getCenter().slice(),o=this.getResolution(),s=this.getRotation(),l=[],h=0;h<e;++h){var u=arguments[h],f={start:n,complete:!1,anchor:u.anchor,duration:u.duration!==void 0?u.duration:1e3,easing:u.easing||de.inAndOut};if(u.center&&(f.sourceCenter=a,f.targetCenter=u.center,a=f.targetCenter),u.zoom!==void 0?(f.sourceResolution=o,f.targetResolution=this.constrainResolution(this.maxResolution_,u.zoom-this.minZoom_,0),o=f.targetResolution):u.resolution&&(f.sourceResolution=o,f.targetResolution=u.resolution,o=f.targetResolution),u.rotation!==void 0){f.sourceRotation=s;var c=j.modulo(u.rotation-s+Math.PI,2*Math.PI)-Math.PI;f.targetRotation=s+c,s=f.targetRotation}f.callback=i,q.isNoopAnimation(f)?f.complete=!0:n+=f.duration,l.push(f)}this.animations_.push(l),this.setHint(Pt.ANIMATING,1),this.updateAnimations_()},q.prototype.getAnimating=function(){return this.hints_[Pt.ANIMATING]>0},q.prototype.getInteracting=function(){return this.hints_[Pt.INTERACTING]>0},q.prototype.cancelAnimations=function(){this.setHint(Pt.ANIMATING,-this.hints_[Pt.ANIMATING]);for(var t=0,e=this.animations_.length;t<e;++t){var i=this.animations_[t];i[0].callback&&i[0].callback(!1)}this.animations_.length=0},q.prototype.updateAnimations_=function(){if(this.updateAnimationKey_!==void 0&&(cancelAnimationFrame(this.updateAnimationKey_),this.updateAnimationKey_=void 0),!!this.getAnimating()){for(var t=Date.now(),e=!1,i=this.animations_.length-1;i>=0;--i){for(var r=this.animations_[i],n=!0,a=0,o=r.length;a<o;++a){var s=r[a];if(!s.complete){var l=t-s.start,h=s.duration>0?l/s.duration:1;h>=1?(s.complete=!0,h=1):n=!1;var u=s.easing(h);if(s.sourceCenter){var f=s.sourceCenter[0],c=s.sourceCenter[1],d=s.targetCenter[0],v=s.targetCenter[1],E=f+u*(d-f),p=c+u*(v-c);this.set(Ne.CENTER,[E,p])}if(s.sourceResolution&&s.targetResolution){var m=u===1?s.targetResolution:s.sourceResolution+u*(s.targetResolution-s.sourceResolution);s.anchor&&this.set(Ne.CENTER,this.calculateCenterZoom(m,s.anchor)),this.set(Ne.RESOLUTION,m)}if(s.sourceRotation!==void 0&&s.targetRotation!==void 0){var y=u===1?j.modulo(s.targetRotation+Math.PI,2*Math.PI)-Math.PI:s.sourceRotation+u*(s.targetRotation-s.sourceRotation);s.anchor&&this.set(Ne.CENTER,this.calculateCenterRotate(y,s.anchor)),this.set(Ne.ROTATION,y)}if(e=!0,!s.complete)break}}if(n){this.animations_[i]=null,this.setHint(Pt.ANIMATING,-1);var R=r[0].callback;R&&R(!0)}}this.animations_=this.animations_.filter(Boolean),e&&this.updateAnimationKey_===void 0&&(this.updateAnimationKey_=requestAnimationFrame(this.updateAnimations_))}},q.prototype.calculateCenterRotate=function(t,e){var i,r=this.getCenter();return r!==void 0&&(i=[r[0]-e[0],r[1]-e[1]],Mt.rotate(i,t-this.getRotation()),Mt.add(i,e)),i},q.prototype.calculateCenterZoom=function(t,e){var i,r=this.getCenter(),n=this.getResolution();if(r!==void 0&&n!==void 0){var a=e[0]-t*(e[0]-r[0])/n,o=e[1]-t*(e[1]-r[1])/n;i=[a,o]}return i},q.prototype.getSizeFromViewport_=function(){var t=[100,100],e='.ol-viewport[data-view="'+_.getUid(this)+'"]',i=document.querySelector(e);if(i){var r=getComputedStyle(i);t[0]=parseInt(r.width,10),t[1]=parseInt(r.height,10)}return t},q.prototype.constrainCenter=function(t){return this.constraints_.center(t)},q.prototype.constrainResolution=function(t,e,i){var r=e||0,n=i||0;return this.constraints_.resolution(t,r,n)},q.prototype.constrainRotation=function(t,e){var i=e||0;return this.constraints_.rotation(t,i)},q.prototype.getCenter=function(){return this.get(Ne.CENTER)},q.prototype.getConstraints=function(){return this.constraints_},q.prototype.getHints=function(t){return t!==void 0?(t[0]=this.hints_[0],t[1]=this.hints_[1],t):this.hints_.slice()},q.prototype.calculateExtent=function(t){var e=t||this.getSizeFromViewport_(),i=this.getCenter();Ot.assert(i,1);var r=this.getResolution();Ot.assert(r!==void 0,2);var n=this.getRotation();return Ot.assert(n!==void 0,3),g.getForViewAndSize(i,r,n,e)},q.prototype.getMaxResolution=function(){return this.maxResolution_},q.prototype.getMinResolution=function(){return this.minResolution_},q.prototype.getMaxZoom=function(){return this.getZoomForResolution(this.minResolution_)},q.prototype.setMaxZoom=function(t){this.applyOptions_(this.getUpdatedOptions_({maxZoom:t}))},q.prototype.getMinZoom=function(){return this.getZoomForResolution(this.maxResolution_)},q.prototype.setMinZoom=function(t){this.applyOptions_(this.getUpdatedOptions_({minZoom:t}))},q.prototype.getProjection=function(){return this.projection_},q.prototype.getResolution=function(){return this.get(Ne.RESOLUTION)},q.prototype.getResolutions=function(){return this.resolutions_},q.prototype.getResolutionForExtent=function(t,e){var i=e||this.getSizeFromViewport_(),r=g.getWidth(t)/i[0],n=g.getHeight(t)/i[1];return Math.max(r,n)},q.prototype.getResolutionForValueFunction=function(t){var e=t||2,i=this.maxResolution_,r=this.minResolution_,n=Math.log(i/r)/Math.log(e);return function(a){var o=i/Math.pow(e,a*n);return o}},q.prototype.getRotation=function(){return this.get(Ne.ROTATION)},q.prototype.getValueForResolutionFunction=function(t){var e=t||2,i=this.maxResolution_,r=this.minResolution_,n=Math.log(i/r)/Math.log(e);return function(a){var o=Math.log(i/a)/Math.log(e)/n;return o}},q.prototype.getState=function(){var t=this.getCenter(),e=this.getProjection(),i=this.getResolution(),r=this.getRotation();return{center:t.slice(),projection:e!==void 0?e:null,resolution:i,rotation:r,zoom:this.getZoom()}},q.prototype.getZoom=function(){var t,e=this.getResolution();return e!==void 0&&(t=this.getZoomForResolution(e)),t},q.prototype.getZoomForResolution=function(t){var e=this.minZoom_||0,i,r;if(this.resolutions_){var n=st.linearFindNearest(this.resolutions_,t,1);e=n,i=this.resolutions_[n],n==this.resolutions_.length-1?r=2:r=i/this.resolutions_[n+1]}else i=this.maxResolution_,r=this.zoomFactor_;return e+Math.log(i/t)/Math.log(r)},q.prototype.getResolutionForZoom=function(t){return this.constrainResolution(this.maxResolution_,t-this.minZoom_,0)},q.prototype.fit=function(t,e){var i=e||{},r=i.size;r||(r=this.getSizeFromViewport_());var n;t instanceof Tt?t.getType()===K.CIRCLE?(t=t.getExtent(),n=Rt.fromExtent(t),n.rotate(this.getRotation(),g.getCenter(t))):n=t:(Ot.assert(Array.isArray(t),24),Ot.assert(!g.isEmpty(t),25),n=Rt.fromExtent(t));var a=i.padding!==void 0?i.padding:[0,0,0,0],o=i.constrainResolution!==void 0?i.constrainResolution:!0,s=i.nearest!==void 0?i.nearest:!1,l;i.minResolution!==void 0?l=i.minResolution:i.maxZoom!==void 0?l=this.constrainResolution(this.maxResolution_,i.maxZoom-this.minZoom_,0):l=0;for(var h=n.getFlatCoordinates(),u=this.getRotation(),f=Math.cos(-u),c=Math.sin(-u),d=1/0,v=1/0,E=-1/0,p=-1/0,m=n.getStride(),y=0,R=h.length;y<R;y+=m){var C=h[y]*f-h[y+1]*c,x=h[y]*c+h[y+1]*f;d=Math.min(d,C),v=Math.min(v,x),E=Math.max(E,C),p=Math.max(p,x)}var I=this.getResolutionForExtent([d,v,E,p],[r[0]-a[1]-a[3],r[1]-a[0]-a[2]]);if(I=isNaN(I)?l:Math.max(I,l),o){var D=this.constrainResolution(I,0,0);!s&&D<I&&(D=this.constrainResolution(D,-1,0)),I=D}c=-c;var O=(d+E)/2,B=(v+p)/2;O+=(a[1]-a[3])/2*I,B+=(a[0]-a[2])/2*I;var W=O*f-B*c,N=B*f+O*c,P=[W,N],$=i.callback?i.callback:_.nullFunction;i.duration!==void 0?this.animate({resolution:I,center:P,duration:i.duration,easing:i.easing},$):(this.setResolution(I),this.setCenter(P),setTimeout($.bind(void 0,!0),0))},q.prototype.centerOn=function(t,e,i){var r=this.getRotation(),n=Math.cos(-r),a=Math.sin(-r),o=t[0]*n-t[1]*a,s=t[1]*n+t[0]*a,l=this.getResolution();o+=(e[0]/2-i[0])*l,s+=(i[1]-e[1]/2)*l,a=-a;var h=o*n-s*a,u=s*n+o*a;this.setCenter([h,u])},q.prototype.isDef=function(){return!!this.getCenter()&&this.getResolution()!==void 0},q.prototype.rotate=function(t,e){if(e!==void 0){var i=this.calculateCenterRotate(t,e);this.setCenter(i)}this.setRotation(t)},q.prototype.setCenter=function(t){this.set(Ne.CENTER,t),this.getAnimating()&&this.cancelAnimations()},q.prototype.setHint=function(t,e){return this.hints_[t]+=e,this.changed(),this.hints_[t]},q.prototype.setResolution=function(t){this.set(Ne.RESOLUTION,t),this.getAnimating()&&this.cancelAnimations()},q.prototype.setRotation=function(t){this.set(Ne.ROTATION,t),this.getAnimating()&&this.cancelAnimations()},q.prototype.setZoom=function(t){this.setResolution(this.getResolutionForZoom(t))},q.createCenterConstraint_=function(t){return t.extent!==void 0?ln.createExtent(t.extent):ln.none},q.createResolutionConstraint_=function(t){var e,i,r,n=28,a=2,o=t.minZoom!==void 0?t.minZoom:_.DEFAULT_MIN_ZOOM,s=t.maxZoom!==void 0?t.maxZoom:n,l=t.zoomFactor!==void 0?t.zoomFactor:a;if(t.resolutions!==void 0){var h=t.resolutions;i=h[o],r=h[s]!==void 0?h[s]:h[h.length-1],e=hn.createSnapToResolutions(h)}else{var u=k.createProjection(t.projection,"EPSG:3857"),f=u.getExtent(),c=f?Math.max(g.getWidth(f),g.getHeight(f)):360*k.METERS_PER_UNIT[_e.DEGREES]/u.getMetersPerUnit(),d=c/_.DEFAULT_TILE_SIZE/Math.pow(a,_.DEFAULT_MIN_ZOOM),v=d/Math.pow(a,n-_.DEFAULT_MIN_ZOOM);i=t.maxResolution,i!==void 0?o=0:i=d/Math.pow(l,o),r=t.minResolution,r===void 0&&(t.maxZoom!==void 0?t.maxResolution!==void 0?r=i/Math.pow(l,s):r=d/Math.pow(l,s):r=v),s=o+Math.floor(Math.log(i/r)/Math.log(l)),r=i/Math.pow(l,s-o),e=hn.createSnapToPower(l,i,s-o)}return{constraint:e,maxResolution:i,minResolution:r,minZoom:o,zoomFactor:l}},q.createRotationConstraint_=function(t){var e=t.enableRotation!==void 0?t.enableRotation:!0;if(e){var i=t.constrainRotation;return i===void 0||i===!0?Ci.createSnapToZero():i===!1?Ci.none:typeof i=="number"?Ci.createSnapToN(i):Ci.none}else return Ci.disable},q.isNoopAnimation=function(t){return!(t.sourceCenter&&t.targetCenter&&!Mt.equals(t.sourceCenter,t.targetCenter)||t.sourceResolution!==t.targetResolution||t.sourceRotation!==t.targetRotation)};var At={};At.createCanvasContext2D=function(t,e){var i=document.createElement("CANVAS");return t&&(i.width=t),e&&(i.height=e),i.getContext("2d")},At.outerWidth=function(t){var e=t.offsetWidth,i=getComputedStyle(t);return e+=parseInt(i.marginLeft,10)+parseInt(i.marginRight,10),e},At.outerHeight=function(t){var e=t.offsetHeight,i=getComputedStyle(t);return e+=parseInt(i.marginTop,10)+parseInt(i.marginBottom,10),e},At.replaceNode=function(t,e){var i=e.parentNode;i&&i.replaceChild(t,e)},At.removeNode=function(t){return t&&t.parentNode?t.parentNode.removeChild(t):null},At.removeChildren=function(t){for(;t.lastChild;)t.removeChild(t.lastChild)};var He=function(t){var e=t||{},i=ht.assign({},e);delete i.layers;var r=e.layers;te.call(this,i),this.layersListenerKeys_=[],this.listenerKeys_={},L.listen(this,it.getChangeEventType(He.Property_.LAYERS),this.handleLayersChanged_,this),r?Array.isArray(r)?r=new ut(r.slice(),{unique:!0}):(Ot.assert(r instanceof ut,43),r=r):r=new ut(void 0,{unique:!0}),this.setLayers(r)};_.inherits(He,te),He.prototype.handleLayerChange_=function(){this.changed()},He.prototype.handleLayersChanged_=function(t){this.layersListenerKeys_.forEach(L.unlistenByKey),this.layersListenerKeys_.length=0;var e=this.getLayers();this.layersListenerKeys_.push(L.listen(e,_i.ADD,this.handleLayersAdd_,this),L.listen(e,_i.REMOVE,this.handleLayersRemove_,this));for(var i in this.listenerKeys_)this.listenerKeys_[i].forEach(L.unlistenByKey);ht.clear(this.listenerKeys_);var r=e.getArray(),n,a,o;for(n=0,a=r.length;n<a;n++)o=r[n],this.listenerKeys_[_.getUid(o).toString()]=[L.listen(o,zr.PROPERTYCHANGE,this.handleLayerChange_,this),L.listen(o,tt.CHANGE,this.handleLayerChange_,this)];this.changed()},He.prototype.handleLayersAdd_=function(t){var e=t.element,i=_.getUid(e).toString();this.listenerKeys_[i]=[L.listen(e,zr.PROPERTYCHANGE,this.handleLayerChange_,this),L.listen(e,tt.CHANGE,this.handleLayerChange_,this)],this.changed()},He.prototype.handleLayersRemove_=function(t){var e=t.element,i=_.getUid(e).toString();this.listenerKeys_[i].forEach(L.unlistenByKey),delete this.listenerKeys_[i],this.changed()},He.prototype.getLayers=function(){return this.get(He.Property_.LAYERS)},He.prototype.setLayers=function(t){this.set(He.Property_.LAYERS,t)},He.prototype.getLayersArray=function(t){var e=t!==void 0?t:[];return this.getLayers().forEach(function(i){i.getLayersArray(e)}),e},He.prototype.getLayerStatesArray=function(t){var e=t!==void 0?t:[],i=e.length;this.getLayers().forEach(function(s){s.getLayerStatesArray(e)});var r=this.getLayerState(),n,a,o;for(n=i,a=e.length;n<a;n++)o=e[n],o.opacity*=r.opacity,o.visible=o.visible&&r.visible,o.maxResolution=Math.min(o.maxResolution,r.maxResolution),o.minResolution=Math.max(o.minResolution,r.minResolution),r.extent!==void 0&&(o.extent!==void 0?o.extent=g.getIntersection(o.extent,r.extent):o.extent=r.extent);return e},He.prototype.getSourceState=function(){return Or.READY},He.Property_={LAYERS:"layers"};var br={MAP_RENDERER:"MAP_RENDERER",LAYER_RENDERER:"LAYER_RENDERER"},Le={};Le.mapRendererPlugins_=[],Le.getMapRendererPlugins=function(){return Le.mapRendererPlugins_},Le.layerRendererPlugins_=[],Le.getLayerRendererPlugins=function(){return Le.layerRendererPlugins_},Le.register=function(t,e){var i;switch(t){case br.MAP_RENDERER:{i=Le.mapRendererPlugins_,i.push(e);break}case br.LAYER_RENDERER:{i=Le.layerRendererPlugins_,i.push(e);break}default:throw new Error("Unsupported plugin type: "+t)}},Le.registerMultiple=function(t,e){for(var i=0,r=e.length;i<r;++i)Le.register(t,e[i])};var ri={CANVAS:"canvas",WEBGL:"webgl"},ni={};ni.buffer=function(t,e,i){return i===void 0&&(i=[0,0]),i[0]=t[0]+2*e,i[1]=t[1]+2*e,i},ni.hasArea=function(t){return t[0]>0&&t[1]>0},ni.scale=function(t,e,i){return i===void 0&&(i=[0,0]),i[0]=t[0]*e+.5|0,i[1]=t[1]*e+.5|0,i},ni.toSize=function(t,e){return Array.isArray(t)?t:(e===void 0?e=[t,t]:e[0]=e[1]=t,e)};var H=function(t){it.call(this);var e=H.createOptionsInternal(t);this.loadTilesWhileAnimating_=t.loadTilesWhileAnimating!==void 0?t.loadTilesWhileAnimating:!1,this.loadTilesWhileInteracting_=t.loadTilesWhileInteracting!==void 0?t.loadTilesWhileInteracting:!1,this.pixelRatio_=t.pixelRatio!==void 0?t.pixelRatio:_t.DEVICE_PIXEL_RATIO,this.logos_=e.logos,this.animationDelayKey_,this.animationDelay_=(function(){this.animationDelayKey_=void 0,this.renderFrame_.call(this,Date.now())}).bind(this),this.coordinateToPixelTransform_=A.create(),this.pixelToCoordinateTransform_=A.create(),this.frameIndex_=0,this.frameState_=null,this.previousExtent_=null,this.viewPropertyListenerKey_=null,this.viewChangeListenerKey_=null,this.layerGroupPropertyListenerKeys_=null,this.viewport_=document.createElement("DIV"),this.viewport_.className="ol-viewport"+(_t.TOUCH?" ol-touch":""),this.viewport_.style.position="relative",this.viewport_.style.overflow="hidden",this.viewport_.style.width="100%",this.viewport_.style.height="100%",this.viewport_.style.msTouchAction="none",this.viewport_.style.touchAction="none",this.overlayContainer_=document.createElement("DIV"),this.overlayContainer_.className="ol-overlaycontainer",this.viewport_.appendChild(this.overlayContainer_),this.overlayContainerStopEvent_=document.createElement("DIV"),this.overlayContainerStopEvent_.className="ol-overlaycontainer-stopevent";for(var i=[tt.CLICK,tt.DBLCLICK,tt.MOUSEDOWN,tt.TOUCHSTART,tt.MSPOINTERDOWN,Ft.POINTERDOWN,tt.MOUSEWHEEL,tt.WHEEL],r=0,n=i.length;r<n;++r)L.listen(this.overlayContainerStopEvent_,i[r],ue.stopPropagation);this.viewport_.appendChild(this.overlayContainerStopEvent_),this.mapBrowserEventHandler_=new xi(this,t.moveTolerance);for(var a in Ft)L.listen(this.mapBrowserEventHandler_,Ft[a],this.handleMapBrowserEvent,this);this.keyboardEventTarget_=e.keyboardEventTarget,this.keyHandlerKeys_=null,L.listen(this.viewport_,tt.WHEEL,this.handleBrowserEvent,this),L.listen(this.viewport_,tt.MOUSEWHEEL,this.handleBrowserEvent,this),this.controls=e.controls||new ut,this.interactions=e.interactions||new ut,this.overlays_=e.overlays,this.overlayIdIndex_={},this.renderer_=e.mapRendererPlugin.create(this.viewport_,this),this.handleResize_,this.focus_=null,this.postRenderFunctions_=[],this.tileQueue_=new Dr(this.getTilePriority.bind(this),this.handleTileChange_.bind(this)),this.skippedFeatureUids_={},L.listen(this,it.getChangeEventType(Qe.LAYERGROUP),this.handleLayerGroupChanged_,this),L.listen(this,it.getChangeEventType(Qe.VIEW),this.handleViewChanged_,this),L.listen(this,it.getChangeEventType(Qe.SIZE),this.handleSizeChanged_,this),L.listen(this,it.getChangeEventType(Qe.TARGET),this.handleTargetChanged_,this),this.setProperties(e.values),this.controls.forEach(function(o){o.setMap(this)},this),L.listen(this.controls,_i.ADD,function(o){o.element.setMap(this)},this),L.listen(this.controls,_i.REMOVE,function(o){o.element.setMap(null)},this),this.interactions.forEach(function(o){o.setMap(this)},this),L.listen(this.interactions,_i.ADD,function(o){o.element.setMap(this)},this),L.listen(this.interactions,_i.REMOVE,function(o){o.element.setMap(null)},this),this.overlays_.forEach(this.addOverlayInternal_,this),L.listen(this.overlays_,_i.ADD,function(o){this.addOverlayInternal_(o.element)},this),L.listen(this.overlays_,_i.REMOVE,function(o){var s=o.element,l=s.getId();l!==void 0&&delete this.overlayIdIndex_[l.toString()],o.element.setMap(null)},this)};_.inherits(H,it),H.prototype.addControl=function(t){this.getControls().push(t)},H.prototype.addInteraction=function(t){this.getInteractions().push(t)},H.prototype.addLayer=function(t){var e=this.getLayerGroup().getLayers();e.push(t)},H.prototype.addOverlay=function(t){this.getOverlays().push(t)},H.prototype.addOverlayInternal_=function(t){var e=t.getId();e!==void 0&&(this.overlayIdIndex_[e.toString()]=t),t.setMap(this)},H.prototype.disposeInternal=function(){this.mapBrowserEventHandler_.dispose(),L.unlisten(this.viewport_,tt.WHEEL,this.handleBrowserEvent,this),L.unlisten(this.viewport_,tt.MOUSEWHEEL,this.handleBrowserEvent,this),this.handleResize_!==void 0&&(window.removeEventListener(tt.RESIZE,this.handleResize_,!1),this.handleResize_=void 0),this.animationDelayKey_&&(cancelAnimationFrame(this.animationDelayKey_),this.animationDelayKey_=void 0),this.setTarget(null),it.prototype.disposeInternal.call(this)},H.prototype.forEachFeatureAtPixel=function(t,e,i){if(this.frameState_){var r=this.getCoordinateFromPixel(t);i=i!==void 0?i:{};var n=i.hitTolerance!==void 0?i.hitTolerance*this.frameState_.pixelRatio:0,a=i.layerFilter!==void 0?i.layerFilter:ne.TRUE;return this.renderer_.forEachFeatureAtCoordinate(r,this.frameState_,n,e,null,a,null)}},H.prototype.getFeaturesAtPixel=function(t,e){var i=null;return this.forEachFeatureAtPixel(t,function(r){i||(i=[]),i.push(r)},e),i},H.prototype.forEachLayerAtPixel=function(t,e,i,r,n){if(this.frameState_){var a=i!==void 0?i:null,o=r!==void 0?r:ne.TRUE,s=n!==void 0?n:null;return this.renderer_.forEachLayerAtPixel(t,this.frameState_,e,a,o,s)}},H.prototype.hasFeatureAtPixel=function(t,e){if(!this.frameState_)return!1;var i=this.getCoordinateFromPixel(t);e=e!==void 0?e:{};var r=e.layerFilter!==void 0?e.layerFilter:ne.TRUE,n=e.hitTolerance!==void 0?e.hitTolerance*this.frameState_.pixelRatio:0;return this.renderer_.hasFeatureAtCoordinate(i,this.frameState_,n,r,null)},H.prototype.getEventCoordinate=function(t){return this.getCoordinateFromPixel(this.getEventPixel(t))},H.prototype.getEventPixel=function(t){var e=this.viewport_.getBoundingClientRect(),i=t.changedTouches?t.changedTouches[0]:t;return[i.clientX-e.left,i.clientY-e.top]},H.prototype.getTarget=function(){return this.get(Qe.TARGET)},H.prototype.getTargetElement=function(){var t=this.getTarget();return t!==void 0?typeof t=="string"?document.getElementById(t):t:null},H.prototype.getCoordinateFromPixel=function(t){var e=this.frameState_;return e?A.apply(e.pixelToCoordinateTransform,t.slice()):null},H.prototype.getControls=function(){return this.controls},H.prototype.getOverlays=function(){return this.overlays_},H.prototype.getOverlayById=function(t){var e=this.overlayIdIndex_[t.toString()];return e!==void 0?e:null},H.prototype.getInteractions=function(){return this.interactions},H.prototype.getLayerGroup=function(){return this.get(Qe.LAYERGROUP)},H.prototype.getLayers=function(){var t=this.getLayerGroup().getLayers();return t},H.prototype.getPixelFromCoordinate=function(t){var e=this.frameState_;return e?A.apply(e.coordinateToPixelTransform,t.slice(0,2)):null},H.prototype.getRenderer=function(){return this.renderer_},H.prototype.getSize=function(){return this.get(Qe.SIZE)},H.prototype.getView=function(){return this.get(Qe.VIEW)},H.prototype.getViewport=function(){return this.viewport_},H.prototype.getOverlayContainer=function(){return this.overlayContainer_},H.prototype.getOverlayContainerStopEvent=function(){return this.overlayContainerStopEvent_},H.prototype.getTilePriority=function(t,e,i,r){var n=this.frameState_;if(!n||!(e in n.wantedTiles)||!n.wantedTiles[e][t.getKey()])return Jt.DROP;var a=i[0]-n.focus[0],o=i[1]-n.focus[1];return 65536*Math.log(r)+Math.sqrt(a*a+o*o)/r},H.prototype.handleBrowserEvent=function(t,e){var i=e||t.type,r=new Pr(i,this,t);this.handleMapBrowserEvent(r)},H.prototype.handleMapBrowserEvent=function(t){if(this.frameState_){this.focus_=t.coordinate,t.frameState=this.frameState_;var e=this.getInteractions().getArray(),i;if(this.dispatchEvent(t)!==!1)for(i=e.length-1;i>=0;i--){var r=e[i];if(r.getActive()){var n=r.handleEvent(t);if(!n)break}}}},H.prototype.handlePostRender=function(){var t=this.frameState_,e=this.tileQueue_;if(!e.isEmpty()){var i=16,r=i;if(t){var n=t.viewHints;n[Pt.ANIMATING]&&(i=this.loadTilesWhileAnimating_?8:0,r=2),n[Pt.INTERACTING]&&(i=this.loadTilesWhileInteracting_?8:0,r=2)}e.getTilesLoading()<i&&(e.reprioritize(),e.loadMoreTiles(i,r))}var a=this.postRenderFunctions_,o,s;for(o=0,s=a.length;o<s;++o)a[o](this,t);a.length=0},H.prototype.handleSizeChanged_=function(){this.render()},H.prototype.handleTargetChanged_=function(){var t;if(this.getTarget()&&(t=this.getTargetElement()),this.keyHandlerKeys_){for(var e=0,i=this.keyHandlerKeys_.length;e<i;++e)L.unlistenByKey(this.keyHandlerKeys_[e]);this.keyHandlerKeys_=null}if(!t)this.renderer_.removeLayerRenderers(),At.removeNode(this.viewport_),this.handleResize_!==void 0&&(window.removeEventListener(tt.RESIZE,this.handleResize_,!1),this.handleResize_=void 0);else{t.appendChild(this.viewport_);var r=this.keyboardEventTarget_?this.keyboardEventTarget_:t;this.keyHandlerKeys_=[L.listen(r,tt.KEYDOWN,this.handleBrowserEvent,this),L.listen(r,tt.KEYPRESS,this.handleBrowserEvent,this)],this.handleResize_||(this.handleResize_=this.updateSize.bind(this),window.addEventListener(tt.RESIZE,this.handleResize_,!1))}this.updateSize()},H.prototype.handleTileChange_=function(){this.render()},H.prototype.handleViewPropertyChanged_=function(){this.render()},H.prototype.handleViewChanged_=function(){this.viewPropertyListenerKey_&&(L.unlistenByKey(this.viewPropertyListenerKey_),this.viewPropertyListenerKey_=null),this.viewChangeListenerKey_&&(L.unlistenByKey(this.viewChangeListenerKey_),this.viewChangeListenerKey_=null);var t=this.getView();t&&(this.viewport_.setAttribute("data-view",_.getUid(t)),this.viewPropertyListenerKey_=L.listen(t,zr.PROPERTYCHANGE,this.handleViewPropertyChanged_,this),this.viewChangeListenerKey_=L.listen(t,tt.CHANGE,this.handleViewPropertyChanged_,this)),this.render()},H.prototype.handleLayerGroupChanged_=function(){this.layerGroupPropertyListenerKeys_&&(this.layerGroupPropertyListenerKeys_.forEach(L.unlistenByKey),this.layerGroupPropertyListenerKeys_=null);var t=this.getLayerGroup();t&&(this.layerGroupPropertyListenerKeys_=[L.listen(t,zr.PROPERTYCHANGE,this.render,this),L.listen(t,tt.CHANGE,this.render,this)]),this.render()},H.prototype.isRendered=function(){return!!this.frameState_},H.prototype.renderSync=function(){this.animationDelayKey_&&cancelAnimationFrame(this.animationDelayKey_),this.animationDelay_()},H.prototype.render=function(){this.animationDelayKey_===void 0&&(this.animationDelayKey_=requestAnimationFrame(this.animationDelay_))},H.prototype.removeControl=function(t){return this.getControls().remove(t)},H.prototype.removeInteraction=function(t){return this.getInteractions().remove(t)},H.prototype.removeLayer=function(t){var e=this.getLayerGroup().getLayers();return e.remove(t)},H.prototype.removeOverlay=function(t){return this.getOverlays().remove(t)},H.prototype.renderFrame_=function(t){var e,i,r,n=this.getSize(),a=this.getView(),o=g.createEmpty(),s=this.frameState_,l=null;if(n!==void 0&&ni.hasArea(n)&&a&&a.isDef()){var h=a.getHints(this.frameState_?this.frameState_.viewHints:void 0),u=this.getLayerGroup().getLayerStatesArray(),f={};for(e=0,i=u.length;e<i;++e)f[_.getUid(u[e].layer)]=u[e];r=a.getState();var c=r.center,d=r.resolution/this.pixelRatio_;c[0]=Math.round(c[0]/d)*d,c[1]=Math.round(c[1]/d)*d,l={animate:!1,coordinateToPixelTransform:this.coordinateToPixelTransform_,extent:o,focus:this.focus_?this.focus_:c,index:this.frameIndex_++,layerStates:f,layerStatesArray:u,logos:ht.assign({},this.logos_),pixelRatio:this.pixelRatio_,pixelToCoordinateTransform:this.pixelToCoordinateTransform_,postRenderFunctions:[],size:n,skippedFeatureUids:this.skippedFeatureUids_,tileQueue:this.tileQueue_,time:t,usedTiles:{},viewState:r,viewHints:h,wantedTiles:{}}}if(l&&(l.extent=g.getForViewAndSize(r.center,r.resolution,r.rotation,l.size,o)),this.frameState_=l,this.renderer_.renderFrame(l),l){if(l.animate&&this.render(),Array.prototype.push.apply(this.postRenderFunctions_,l.postRenderFunctions),s){var v=!this.previousExtent_||!g.isEmpty(this.previousExtent_)&&!g.equals(l.extent,this.previousExtent_);v&&(this.dispatchEvent(new ar(jr.MOVESTART,this,s)),this.previousExtent_=g.createOrUpdateEmpty(this.previousExtent_))}var E=this.previousExtent_&&!l.viewHints[Pt.ANIMATING]&&!l.viewHints[Pt.INTERACTING]&&!g.equals(l.extent,this.previousExtent_);E&&(this.dispatchEvent(new ar(jr.MOVEEND,this,l)),g.clone(l.extent,this.previousExtent_))}this.dispatchEvent(new ar(jr.POSTRENDER,this,l)),setTimeout(this.handlePostRender.bind(this),0)},H.prototype.setLayerGroup=function(t){this.set(Qe.LAYERGROUP,t)},H.prototype.setSize=function(t){this.set(Qe.SIZE,t)},H.prototype.setTarget=function(t){this.set(Qe.TARGET,t)},H.prototype.setView=function(t){this.set(Qe.VIEW,t)},H.prototype.skipFeature=function(t){var e=_.getUid(t).toString();this.skippedFeatureUids_[e]=!0,this.render()},H.prototype.updateSize=function(){var t=this.getTargetElement();if(!t)this.setSize(void 0);else{var e=getComputedStyle(t);this.setSize([t.offsetWidth-parseFloat(e.borderLeftWidth)-parseFloat(e.paddingLeft)-parseFloat(e.paddingRight)-parseFloat(e.borderRightWidth),t.offsetHeight-parseFloat(e.borderTopWidth)-parseFloat(e.paddingTop)-parseFloat(e.paddingBottom)-parseFloat(e.borderBottomWidth)])}},H.prototype.unskipFeature=function(t){var e=_.getUid(t).toString();delete this.skippedFeatureUids_[e],this.render()},H.DEFAULT_RENDERER_TYPES=[ri.CANVAS,ri.WEBGL],H.LOGO_URL="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAAA3NCSVQICAjb4U/gAAAACXBIWXMAAAHGAAABxgEXwfpGAAAAGXRFWHRTb2Z0d2FyZQB3d3cuaW5rc2NhcGUub3Jnm+48GgAAAhNQTFRF////AP//AICAgP//AFVVQECA////K1VVSbbbYL/fJ05idsTYJFtbbcjbJllmZszWWMTOIFhoHlNiZszTa9DdUcHNHlNlV8XRIVdiasrUHlZjIVZjaMnVH1RlIFRkH1RkH1ZlasvYasvXVsPQH1VkacnVa8vWIVZjIFRjVMPQa8rXIVVkXsXRsNveIFVkIFZlIVVj3eDeh6GmbMvXH1ZkIFRka8rWbMvXIFVkIFVjIFVkbMvWH1VjbMvWIFVlbcvWIFVla8vVIFVkbMvWbMvVH1VkbMvWIFVlbcvWIFVkbcvVbMvWjNPbIFVkU8LPwMzNIFVkbczWIFVkbsvWbMvXIFVkRnB8bcvW2+TkW8XRIFVkIlZlJVloJlpoKlxrLl9tMmJwOWd0Omh1RXF8TneCT3iDUHiDU8LPVMLPVcLPVcPQVsPPVsPQV8PQWMTQWsTQW8TQXMXSXsXRX4SNX8bSYMfTYcfTYsfTY8jUZcfSZsnUaIqTacrVasrVa8jTa8rWbI2VbMvWbcvWdJObdcvUdszUd8vVeJaee87Yfc3WgJyjhqGnitDYjaarldPZnrK2oNbborW5o9bbo9fbpLa6q9ndrL3ArtndscDDutzfu8fJwN7gwt7gxc/QyuHhy+HizeHi0NfX0+Pj19zb1+Tj2uXk29/e3uLg3+Lh3+bl4uXj4ufl4+fl5Ofl5ufl5ujm5+jmySDnBAAAAFp0Uk5TAAECAgMEBAYHCA0NDg4UGRogIiMmKSssLzU7PkJJT1JTVFliY2hrdHZ3foSFhYeJjY2QkpugqbG1tre5w8zQ09XY3uXn6+zx8vT09vf4+Pj5+fr6/P39/f3+gz7SsAAAAVVJREFUOMtjYKA7EBDnwCPLrObS1BRiLoJLnte6CQy8FLHLCzs2QUG4FjZ5GbcmBDDjxJBXDWxCBrb8aM4zbkIDzpLYnAcE9VXlJSWlZRU13koIeW57mGx5XjoMZEUqwxWYQaQbSzLSkYGfKFSe0QMsX5WbjgY0YS4MBplemI4BdGBW+DQ11eZiymfqQuXZIjqwyadPNoSZ4L+0FVM6e+oGI6g8a9iKNT3o8kVzNkzRg5lgl7p4wyRUL9Yt2jAxVh6mQCogae6GmflI8p0r13VFWTHBQ0rWPW7ahgWVcPm+9cuLoyy4kCJDzCm6d8PSFoh0zvQNC5OjDJhQopPPJqph1doJBUD5tnkbZiUEqaCnB3bTqLTFG1bPn71kw4b+GFdpLElKIzRxxgYgWNYc5SCENVHKeUaltHdXx0dZ8uBI1hJ2UUDgq82CM2MwKeibqAvSO7MCABq0wXEPiqWEAAAAAElFTkSuQmCC",H.createOptionsInternal=function(t){var e=null;t.keyboardEventTarget!==void 0&&(e=typeof t.keyboardEventTarget=="string"?document.getElementById(t.keyboardEventTarget):t.keyboardEventTarget);var i={},r={};if(t.logo===void 0||typeof t.logo=="boolean"&&t.logo)r[H.LOGO_URL]="https://openlayers.org/";else{var n=t.logo;typeof n=="string"?r[n]="":n instanceof HTMLElement?r[_.getUid(n).toString()]=n:n&&(Ot.assert(typeof n.href=="string",44),Ot.assert(typeof n.src=="string",45),r[n.src]=n.href)}var a=t.layers instanceof He?t.layers:new He({layers:t.layers});i[Qe.LAYERGROUP]=a,i[Qe.TARGET]=t.target,i[Qe.VIEW]=t.view!==void 0?t.view:new q;var o;t.renderer!==void 0?(Array.isArray(t.renderer)?o=t.renderer:typeof t.renderer=="string"?o=[t.renderer]:Ot.assert(!1,46),o.indexOf("dom")>=0&&(o=o.concat(H.DEFAULT_RENDERER_TYPES))):o=H.DEFAULT_RENDERER_TYPES;var s,l=Le.getMapRendererPlugins();t:for(var h=0,u=o.length;h<u;++h)for(var f=o[h],c=0,d=l.length;c<d;++c){var v=l[c];if(v.handles(f)){s=v;break t}}if(!s)throw new Error("Unable to create a map renderer for types: "+o.join(", "));var E;t.controls!==void 0&&(Array.isArray(t.controls)?E=new ut(t.controls.slice()):(Ot.assert(t.controls instanceof ut,47),E=t.controls));var p;t.interactions!==void 0&&(Array.isArray(t.interactions)?p=new ut(t.interactions.slice()):(Ot.assert(t.interactions instanceof ut,48),p=t.interactions));var m;return t.overlays!==void 0?Array.isArray(t.overlays)?m=new ut(t.overlays.slice()):(Ot.assert(t.overlays instanceof ut,49),m=t.overlays):m=new ut,{controls:E,interactions:p,keyboardEventTarget:e,logos:r,overlays:m,mapRendererPlugin:s,values:i}};var Si=function(t){it.call(this),this.element=t.element?t.element:null,this.target_=null,this.map_=null,this.listenerKeys=[],this.render=t.render?t.render:_.nullFunction,t.target&&this.setTarget(t.target)};_.inherits(Si,it),Si.prototype.disposeInternal=function(){At.removeNode(this.element),it.prototype.disposeInternal.call(this)},Si.prototype.getMap=function(){return this.map_},Si.prototype.setMap=function(t){this.map_&&At.removeNode(this.element);for(var e=0,i=this.listenerKeys.length;e<i;++e)L.unlistenByKey(this.listenerKeys[e]);if(this.listenerKeys.length=0,this.map_=t,this.map_){var r=this.target_?this.target_:t.getOverlayContainerStopEvent();r.appendChild(this.element),this.render!==_.nullFunction&&this.listenerKeys.push(L.listen(t,jr.POSTRENDER,this.render,this)),t.render()}},Si.prototype.setTarget=function(t){this.target_=typeof t=="string"?document.getElementById(t):t};var pe={};pe.CLASS_HIDDEN="ol-hidden",pe.CLASS_SELECTABLE="ol-selectable",pe.CLASS_UNSELECTABLE="ol-unselectable",pe.CLASS_UNSUPPORTED="ol-unsupported",pe.CLASS_CONTROL="ol-control",pe.getFontFamilies=function(){var t,e={};return function(i){if(t||(t=document.createElement("div").style),!(i in e)){t.font=i;var r=t.fontFamily;if(t.font="",!r)return null;e[i]=r.split(/,\s?/)}return e[i]}}();var si=function(t){var e=t||{};this.ulElement_=document.createElement("UL"),this.logoLi_=document.createElement("LI"),this.ulElement_.appendChild(this.logoLi_),this.logoLi_.style.display="none",this.collapsed_=e.collapsed!==void 0?e.collapsed:!0,this.collapsible_=e.collapsible!==void 0?e.collapsible:!0,this.collapsible_||(this.collapsed_=!1);var i=e.className!==void 0?e.className:"ol-attribution",r=e.tipLabel!==void 0?e.tipLabel:"Attributions",n=e.collapseLabel!==void 0?e.collapseLabel:"";typeof n=="string"?(this.collapseLabel_=document.createElement("span"),this.collapseLabel_.textContent=n):this.collapseLabel_=n;var a=e.label!==void 0?e.label:"i";typeof a=="string"?(this.label_=document.createElement("span"),this.label_.textContent=a):this.label_=a;var o=this.collapsible_&&!this.collapsed_?this.collapseLabel_:this.label_,s=document.createElement("button");s.setAttribute("type","button"),s.title=r,s.appendChild(o),L.listen(s,tt.CLICK,this.handleClick_,this);var l=i+" "+pe.CLASS_UNSELECTABLE+" "+pe.CLASS_CONTROL+(this.collapsed_&&this.collapsible_?" ol-collapsed":"")+(this.collapsible_?"":" ol-uncollapsible"),h=document.createElement("div");h.className=l,h.appendChild(this.ulElement_),h.appendChild(s);var u=e.render?e.render:si.render;Si.call(this,{element:h,render:u,target:e.target}),this.renderedAttributions_=[],this.renderedVisible_=!0,this.logoElements_={}};_.inherits(si,Si),si.prototype.getSourceAttributions_=function(t){for(var e={},i=[],r=t.layerStatesArray,n=t.viewState.resolution,a=0,o=r.length;a<o;++a){var s=r[a];if(ce.visibleAtResolution(s,n)){var l=s.layer.getSource();if(l){var h=l.getAttributions2();if(h){var u=h(t);if(u)if(Array.isArray(u))for(var f=0,c=u.length;f<c;++f)u[f]in e||(i.push(u[f]),e[u[f]]=!0);else u in e||(i.push(u),e[u]=!0)}}}}return i},si.render=function(t){this.updateElement_(t.frameState)},si.prototype.updateElement_=function(t){if(!t){this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1);return}var e=this.getSourceAttributions_(t);if(!st.equals(e,this.renderedAttributions_)){for(;this.ulElement_.lastChild!==this.logoLi_;)this.ulElement_.removeChild(this.ulElement_.lastChild);for(var i=0,r=e.length;i<r;++i){var n=document.createElement("LI");n.innerHTML=e[i],this.ulElement_.appendChild(n)}e.length===0&&this.renderedAttributions_.length>0?this.element.classList.add("ol-logo-only"):this.renderedAttributions_.length===0&&e.length>0&&this.element.classList.remove("ol-logo-only");var a=e.length>0||!ht.isEmpty(t.logos);this.renderedVisible_!=a&&(this.element.style.display=a?"":"none",this.renderedVisible_=a),this.renderedAttributions_=e,this.insertLogos_(t)}},si.prototype.insertLogos_=function(t){var e,i=t.logos,r=this.logoElements_;for(e in r)e in i||(At.removeNode(r[e]),delete r[e]);var n,a,o;for(o in i){var s=i[o];s instanceof HTMLElement&&(this.logoLi_.appendChild(s),r[o]=s),o in r||(n=new Image,n.src=o,s===""?a=n:(a=document.createElement("a"),a.href=s,a.appendChild(n)),this.logoLi_.appendChild(a),r[o]=a)}this.logoLi_.style.display=ht.isEmpty(i)?"none":""},si.prototype.handleClick_=function(t){t.preventDefault(),this.handleToggle_()},si.prototype.handleToggle_=function(){this.element.classList.toggle("ol-collapsed"),this.collapsed_?At.replaceNode(this.collapseLabel_,this.label_):At.replaceNode(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_},si.prototype.getCollapsible=function(){return this.collapsible_},si.prototype.setCollapsible=function(t){this.collapsible_!==t&&(this.collapsible_=t,this.element.classList.toggle("ol-uncollapsible"),!t&&this.collapsed_&&this.handleToggle_())},si.prototype.setCollapsed=function(t){!this.collapsible_||this.collapsed_===t||this.handleToggle_()},si.prototype.getCollapsed=function(){return this.collapsed_};var yr=function(t){var e=t||{},i=e.className!==void 0?e.className:"ol-rotate",r=e.label!==void 0?e.label:"";this.label_=null,typeof r=="string"?(this.label_=document.createElement("span"),this.label_.className="ol-compass",this.label_.textContent=r):(this.label_=r,this.label_.classList.add("ol-compass"));var n=e.tipLabel?e.tipLabel:"Reset rotation",a=document.createElement("button");a.className=i+"-reset",a.setAttribute("type","button"),a.title=n,a.appendChild(this.label_),L.listen(a,tt.CLICK,yr.prototype.handleClick_,this);var o=i+" "+pe.CLASS_UNSELECTABLE+" "+pe.CLASS_CONTROL,s=document.createElement("div");s.className=o,s.appendChild(a);var l=e.render?e.render:yr.render;this.callResetNorth_=e.resetNorth?e.resetNorth:void 0,Si.call(this,{element:s,render:l,target:e.target}),this.duration_=e.duration!==void 0?e.duration:250,this.autoHide_=e.autoHide!==void 0?e.autoHide:!0,this.rotation_=void 0,this.autoHide_&&this.element.classList.add(pe.CLASS_HIDDEN)};_.inherits(yr,Si),yr.prototype.handleClick_=function(t){t.preventDefault(),this.callResetNorth_!==void 0?this.callResetNorth_():this.resetNorth_()},yr.prototype.resetNorth_=function(){var t=this.getMap(),e=t.getView();e&&e.getRotation()!==void 0&&(this.duration_>0?e.animate({rotation:0,duration:this.duration_,easing:de.easeOut}):e.setRotation(0))},yr.render=function(t){var e=t.frameState;if(e){var i=e.viewState.rotation;if(i!=this.rotation_){var r="rotate("+i+"rad)";if(this.autoHide_){var n=this.element.classList.contains(pe.CLASS_HIDDEN);!n&&i===0?this.element.classList.add(pe.CLASS_HIDDEN):n&&i!==0&&this.element.classList.remove(pe.CLASS_HIDDEN)}this.label_.style.msTransform=r,this.label_.style.webkitTransform=r,this.label_.style.transform=r}this.rotation_=i}};var Fr=function(t){var e=t||{},i=e.className!==void 0?e.className:"ol-zoom",r=e.delta!==void 0?e.delta:1,n=e.zoomInLabel!==void 0?e.zoomInLabel:"+",a=e.zoomOutLabel!==void 0?e.zoomOutLabel:"",o=e.zoomInTipLabel!==void 0?e.zoomInTipLabel:"Zoom in",s=e.zoomOutTipLabel!==void 0?e.zoomOutTipLabel:"Zoom out",l=document.createElement("button");l.className=i+"-in",l.setAttribute("type","button"),l.title=o,l.appendChild(typeof n=="string"?document.createTextNode(n):n),L.listen(l,tt.CLICK,Fr.prototype.handleClick_.bind(this,r));var h=document.createElement("button");h.className=i+"-out",h.setAttribute("type","button"),h.title=s,h.appendChild(typeof a=="string"?document.createTextNode(a):a),L.listen(h,tt.CLICK,Fr.prototype.handleClick_.bind(this,-r));var u=i+" "+pe.CLASS_UNSELECTABLE+" "+pe.CLASS_CONTROL,f=document.createElement("div");f.className=u,f.appendChild(l),f.appendChild(h),Si.call(this,{element:f,target:e.target}),this.duration_=e.duration!==void 0?e.duration:250};_.inherits(Fr,Si),Fr.prototype.handleClick_=function(t,e){e.preventDefault(),this.zoomByDelta_(t)},Fr.prototype.zoomByDelta_=function(t){var e=this.getMap(),i=e.getView();if(i){var r=i.getResolution();if(r){var n=i.constrainResolution(r,t);this.duration_>0?(i.getAnimating()&&i.cancelAnimations(),i.animate({resolution:n,duration:this.duration_,easing:de.easeOut})):i.setResolution(n)}}};var ha={};ha.defaults=function(t){var e=t||{},i=new ut,r=e.zoom!==void 0?e.zoom:!0;r&&i.push(new Fr(e.zoomOptions));var n=e.rotate!==void 0?e.rotate:!0;n&&i.push(new yr(e.rotateOptions));var a=e.attribution!==void 0?e.attribution:!0;return a&&i.push(new si(e.attributionOptions)),i};var Nr=function(t,e,i){this.decay_=t,this.minVelocity_=e,this.delay_=i,this.points_=[],this.angle_=0,this.initialVelocity_=0};Nr.prototype.begin=function(){this.points_.length=0,this.angle_=0,this.initialVelocity_=0},Nr.prototype.update=function(t,e){this.points_.push(t,e,Date.now())},Nr.prototype.end=function(){if(this.points_.length<6)return!1;var t=Date.now()-this.delay_,e=this.points_.length-3;if(this.points_[e+2]<t)return!1;for(var i=e-3;i>0&&this.points_[i+2]>t;)i-=3;var r=this.points_[e+2]-this.points_[i+2];if(r<1e3/60)return!1;var n=this.points_[e]-this.points_[i],a=this.points_[e+1]-this.points_[i+1];return this.angle_=Math.atan2(a,n),this.initialVelocity_=Math.sqrt(n*n+a*a)/r,this.initialVelocity_>this.minVelocity_},Nr.prototype.getDistance=function(){return(this.minVelocity_-this.initialVelocity_)/this.decay_},Nr.prototype.getAngle=function(){return this.angle_};var ua={ACTIVE:"active"},vt=function(t){it.call(this),this.map_=null,this.setActive(!0),this.handleEvent=t.handleEvent};_.inherits(vt,it),vt.prototype.getActive=function(){return this.get(ua.ACTIVE)},vt.prototype.getMap=function(){return this.map_},vt.prototype.setActive=function(t){this.set(ua.ACTIVE,t)},vt.prototype.setMap=function(t){this.map_=t},vt.pan=function(t,e,i){var r=t.getCenter();if(r){var n=t.constrainCenter([r[0]+e[0],r[1]+e[1]]);i?t.animate({duration:i,easing:de.linear,center:n}):t.setCenter(n)}},vt.rotate=function(t,e,i,r){e=t.constrainRotation(e,0),vt.rotateWithoutConstraints(t,e,i,r)},vt.rotateWithoutConstraints=function(t,e,i,r){if(e!==void 0){var n=t.getRotation(),a=t.getCenter();n!==void 0&&a&&r>0?t.animate({rotation:e,anchor:i,duration:r,easing:de.easeOut}):t.rotate(e,i)}},vt.zoom=function(t,e,i,r,n){e=t.constrainResolution(e,0,n),vt.zoomWithoutConstraints(t,e,i,r)},vt.zoomByDelta=function(t,e,i,r){var n=t.getResolution(),a=t.constrainResolution(n,e,0);if(a!==void 0){var o=t.getResolutions();a=j.clamp(a,t.getMinResolution()||o[o.length-1],t.getMaxResolution()||o[0])}if(i&&a!==void 0&&a!==n){var s=t.getCenter(),l=t.calculateCenterZoom(a,i);l=t.constrainCenter(l),i=[(a*s[0]-n*l[0])/(a-n),(a*s[1]-n*l[1])/(a-n)]}vt.zoomWithoutConstraints(t,a,i,r)},vt.zoomWithoutConstraints=function(t,e,i,r){if(e){var n=t.getResolution(),a=t.getCenter();if(n!==void 0&&a&&e!==n&&r)t.animate({resolution:e,anchor:i,duration:r,easing:de.easeOut});else{if(i){var o=t.calculateCenterZoom(e,i);t.setCenter(o)}t.setResolution(e)}}};var cn=function(t){var e=t||{};this.delta_=e.delta?e.delta:1,vt.call(this,{handleEvent:cn.handleEvent}),this.duration_=e.duration!==void 0?e.duration:250};_.inherits(cn,vt),cn.handleEvent=function(t){var e=!1,i=t.originalEvent;if(t.type==Ft.DBLCLICK){var r=t.map,n=t.coordinate,a=i.shiftKey?-this.delta_:this.delta_,o=r.getView();vt.zoomByDelta(o,a,n,this.duration_),t.preventDefault(),e=!0}return!e};var Dt={};Dt.altKeyOnly=function(t){var e=t.originalEvent;return e.altKey&&!(e.metaKey||e.ctrlKey)&&!e.shiftKey},Dt.altShiftKeysOnly=function(t){var e=t.originalEvent;return e.altKey&&!(e.metaKey||e.ctrlKey)&&e.shiftKey},Dt.always=ne.TRUE,Dt.click=function(t){return t.type==Ft.CLICK},Dt.mouseActionButton=function(t){var e=t.originalEvent;return e.button==0&&!(_t.WEBKIT&&_t.MAC&&e.ctrlKey)},Dt.never=ne.FALSE,Dt.pointerMove=function(t){return t.type=="pointermove"},Dt.singleClick=function(t){return t.type==Ft.SINGLECLICK},Dt.doubleClick=function(t){return t.type==Ft.DBLCLICK},Dt.noModifierKeys=function(t){var e=t.originalEvent;return!e.altKey&&!(e.metaKey||e.ctrlKey)&&!e.shiftKey},Dt.platformModifierKeyOnly=function(t){var e=t.originalEvent;return!e.altKey&&(_t.MAC?e.metaKey:e.ctrlKey)&&!e.shiftKey},Dt.shiftKeyOnly=function(t){var e=t.originalEvent;return!e.altKey&&!(e.metaKey||e.ctrlKey)&&e.shiftKey},Dt.targetNotEditable=function(t){var e=t.originalEvent.target,i=e.tagName;return i!=="INPUT"&&i!=="SELECT"&&i!=="TEXTAREA"},Dt.mouseOnly=function(t){return Ot.assert(t.pointerEvent,56),t.pointerEvent.pointerType=="mouse"},Dt.primaryAction=function(t){var e=t.pointerEvent;return e.isPrimary&&e.button===0};var Gt=function(t){var e=t||{},i=e.handleEvent?e.handleEvent:Gt.handleEvent;vt.call(this,{handleEvent:i}),this.handleDownEvent_=e.handleDownEvent?e.handleDownEvent:Gt.handleDownEvent,this.handleDragEvent_=e.handleDragEvent?e.handleDragEvent:Gt.handleDragEvent,this.handleMoveEvent_=e.handleMoveEvent?e.handleMoveEvent:Gt.handleMoveEvent,this.handleUpEvent_=e.handleUpEvent?e.handleUpEvent:Gt.handleUpEvent,this.handlingDownUpSequence=!1,this.trackedPointers_={},this.targetPointers=[]};_.inherits(Gt,vt),Gt.centroid=function(t){for(var e=t.length,i=0,r=0,n=0;n<e;n++)i+=t[n].clientX,r+=t[n].clientY;return[i/e,r/e]},Gt.prototype.isPointerDraggingEvent_=function(t){var e=t.type;return e===Ft.POINTERDOWN||e===Ft.POINTERDRAG||e===Ft.POINTERUP},Gt.prototype.updateTrackedPointers_=function(t){if(this.isPointerDraggingEvent_(t)){var e=t.pointerEvent,i=e.pointerId.toString();t.type==Ft.POINTERUP?delete this.trackedPointers_[i]:t.type==Ft.POINTERDOWN?this.trackedPointers_[i]=e:i in this.trackedPointers_&&(this.trackedPointers_[i]=e),this.targetPointers=ht.getValues(this.trackedPointers_)}},Gt.handleDragEvent=_.nullFunction,Gt.handleUpEvent=ne.FALSE,Gt.handleDownEvent=ne.FALSE,Gt.handleMoveEvent=_.nullFunction,Gt.handleEvent=function(t){if(!(t instanceof Hi))return!0;var e=!1;if(this.updateTrackedPointers_(t),this.handlingDownUpSequence){if(t.type==Ft.POINTERDRAG)this.handleDragEvent_(t);else if(t.type==Ft.POINTERUP){var i=this.handleUpEvent_(t);this.handlingDownUpSequence=i&&this.targetPointers.length>0}}else if(t.type==Ft.POINTERDOWN){var r=this.handleDownEvent_(t);this.handlingDownUpSequence=r,e=this.shouldStopEvent(r)}else t.type==Ft.POINTERMOVE&&this.handleMoveEvent_(t);return!e},Gt.prototype.shouldStopEvent=function(t){return t};var ji=function(t){Gt.call(this,{handleDownEvent:ji.handleDownEvent_,handleDragEvent:ji.handleDragEvent_,handleUpEvent:ji.handleUpEvent_});var e=t||{};this.kinetic_=e.kinetic,this.lastCentroid=null,this.lastPointersCount_,this.condition_=e.condition?e.condition:Dt.noModifierKeys,this.noKinetic_=!1};_.inherits(ji,Gt),ji.handleDragEvent_=function(t){var e=this.targetPointers,i=Gt.centroid(e);if(e.length==this.lastPointersCount_){if(this.kinetic_&&this.kinetic_.update(i[0],i[1]),this.lastCentroid){var r=this.lastCentroid[0]-i[0],n=i[1]-this.lastCentroid[1],a=t.map,o=a.getView(),s=o.getState(),l=[r,n];Mt.scale(l,s.resolution),Mt.rotate(l,s.rotation),Mt.add(l,s.center),l=o.constrainCenter(l),o.setCenter(l)}}else this.kinetic_&&this.kinetic_.begin();this.lastCentroid=i,this.lastPointersCount_=e.length},ji.handleUpEvent_=function(t){var e=t.map,i=e.getView();if(this.targetPointers.length===0){if(!this.noKinetic_&&this.kinetic_&&this.kinetic_.end()){var r=this.kinetic_.getDistance(),n=this.kinetic_.getAngle(),a=i.getCenter(),o=e.getPixelFromCoordinate(a),s=e.getCoordinateFromPixel([o[0]-r*Math.cos(n),o[1]-r*Math.sin(n)]);i.animate({center:i.constrainCenter(s),duration:500,easing:de.easeOut})}return i.setHint(Pt.INTERACTING,-1),!1}else return this.kinetic_&&this.kinetic_.begin(),this.lastCentroid=null,!0},ji.handleDownEvent_=function(t){if(this.targetPointers.length>0&&this.condition_(t)){var e=t.map,i=e.getView();return this.lastCentroid=null,this.handlingDownUpSequence||i.setHint(Pt.INTERACTING,1),i.getAnimating()&&i.setCenter(t.frameState.viewState.center),this.kinetic_&&this.kinetic_.begin(),this.noKinetic_=this.targetPointers.length>1,!0}else return!1},ji.prototype.shouldStopEvent=ne.FALSE;var Zi=function(t){var e=t||{};Gt.call(this,{handleDownEvent:Zi.handleDownEvent_,handleDragEvent:Zi.handleDragEvent_,handleUpEvent:Zi.handleUpEvent_}),this.condition_=e.condition?e.condition:Dt.altShiftKeysOnly,this.lastAngle_=void 0,this.duration_=e.duration!==void 0?e.duration:250};_.inherits(Zi,Gt),Zi.handleDragEvent_=function(t){if(Dt.mouseOnly(t)){var e=t.map,i=e.getView();if(i.getConstraints().rotation!==Ci.disable){var r=e.getSize(),n=t.pixel,a=Math.atan2(r[1]/2-n[1],n[0]-r[0]/2);if(this.lastAngle_!==void 0){var o=a-this.lastAngle_,s=i.getRotation();vt.rotateWithoutConstraints(i,s-o)}this.lastAngle_=a}}},Zi.handleUpEvent_=function(t){if(!Dt.mouseOnly(t))return!0;var e=t.map,i=e.getView();i.setHint(Pt.INTERACTING,-1);var r=i.getRotation();return vt.rotate(i,r,void 0,this.duration_),!1},Zi.handleDownEvent_=function(t){if(!Dt.mouseOnly(t))return!1;if(Dt.mouseActionButton(t)&&this.condition_(t)){var e=t.map;return e.getView().setHint(Pt.INTERACTING,1),this.lastAngle_=void 0,!0}else return!1},Zi.prototype.shouldStopEvent=ne.FALSE;var sr=function(t){this.geometry_=null,this.element_=document.createElement("div"),this.element_.style.position="absolute",this.element_.className="ol-box "+t,this.map_=null,this.startPixel_=null,this.endPixel_=null};_.inherits(sr,Vi),sr.prototype.disposeInternal=function(){this.setMap(null)},sr.prototype.render_=function(){var t=this.startPixel_,e=this.endPixel_,i="px",r=this.element_.style;r.left=Math.min(t[0],e[0])+i,r.top=Math.min(t[1],e[1])+i,r.width=Math.abs(e[0]-t[0])+i,r.height=Math.abs(e[1]-t[1])+i},sr.prototype.setMap=function(t){if(this.map_){this.map_.getOverlayContainer().removeChild(this.element_);var e=this.element_.style;e.left=e.top=e.width=e.height="inherit"}this.map_=t,this.map_&&this.map_.getOverlayContainer().appendChild(this.element_)},sr.prototype.setPixels=function(t,e){this.startPixel_=t,this.endPixel_=e,this.createOrUpdateGeometry(),this.render_()},sr.prototype.createOrUpdateGeometry=function(){var t=this.startPixel_,e=this.endPixel_,i=[t,[t[0],e[1]],e,[e[0],t[1]]],r=i.map(this.map_.getCoordinateFromPixel,this.map_);r[4]=r[0].slice(),this.geometry_?this.geometry_.setCoordinates([r]):this.geometry_=new Rt([r])},sr.prototype.getGeometry=function(){return this.geometry_};var ee=function(t){Gt.call(this,{handleDownEvent:ee.handleDownEvent_,handleDragEvent:ee.handleDragEvent_,handleUpEvent:ee.handleUpEvent_});var e=t||{};this.box_=new sr(e.className||"ol-dragbox"),this.minArea_=e.minArea!==void 0?e.minArea:64,this.startPixel_=null,this.condition_=e.condition?e.condition:Dt.always,this.boxEndCondition_=e.boxEndCondition?e.boxEndCondition:ee.defaultBoxEndCondition};_.inherits(ee,Gt),ee.defaultBoxEndCondition=function(t,e,i){var r=i[0]-e[0],n=i[1]-e[1];return r*r+n*n>=this.minArea_},ee.handleDragEvent_=function(t){Dt.mouseOnly(t)&&(this.box_.setPixels(this.startPixel_,t.pixel),this.dispatchEvent(new ee.Event(ee.EventType_.BOXDRAG,t.coordinate,t)))},ee.prototype.getGeometry=function(){return this.box_.getGeometry()},ee.prototype.onBoxEnd=_.nullFunction,ee.handleUpEvent_=function(t){return Dt.mouseOnly(t)?(this.box_.setMap(null),this.boxEndCondition_(t,this.startPixel_,t.pixel)&&(this.onBoxEnd(t),this.dispatchEvent(new ee.Event(ee.EventType_.BOXEND,t.coordinate,t))),!1):!0},ee.handleDownEvent_=function(t){return Dt.mouseOnly(t)&&Dt.mouseActionButton(t)&&this.condition_(t)?(this.startPixel_=t.pixel,this.box_.setMap(t.map),this.box_.setPixels(this.startPixel_,this.startPixel_),this.dispatchEvent(new ee.Event(ee.EventType_.BOXSTART,t.coordinate,t)),!0):!1},ee.EventType_={BOXSTART:"boxstart",BOXDRAG:"boxdrag",BOXEND:"boxend"},ee.Event=function(t,e,i){ue.call(this,t),this.coordinate=e,this.mapBrowserEvent=i},_.inherits(ee.Event,ue);var kn=function(t){var e=t||{},i=e.condition?e.condition:Dt.shiftKeyOnly;this.duration_=e.duration!==void 0?e.duration:200,this.out_=e.out!==void 0?e.out:!1,ee.call(this,{condition:i,className:e.className||"ol-dragzoom"})};_.inherits(kn,ee),kn.prototype.onBoxEnd=function(){var t=this.getMap(),e=t.getView(),i=t.getSize(),r=this.getGeometry().getExtent();if(this.out_){var n=e.calculateExtent(i),a=g.createOrUpdateFromCoordinates([t.getPixelFromCoordinate(g.getBottomLeft(r)),t.getPixelFromCoordinate(g.getTopRight(r))]),o=e.getResolutionForExtent(a,i);g.scaleFromCenter(n,1/o),r=n}var s=e.constrainResolution(e.getResolutionForExtent(r,i)),l=g.getCenter(r);l=e.constrainCenter(l),e.animate({resolution:s,center:l,duration:this.duration_,easing:de.easeOut})};var mr={LEFT:37,UP:38,RIGHT:39,DOWN:40},dn=function(t){vt.call(this,{handleEvent:dn.handleEvent});var e=t||{};this.defaultCondition_=function(i){return Dt.noModifierKeys(i)&&Dt.targetNotEditable(i)},this.condition_=e.condition!==void 0?e.condition:this.defaultCondition_,this.duration_=e.duration!==void 0?e.duration:100,this.pixelDelta_=e.pixelDelta!==void 0?e.pixelDelta:128};_.inherits(dn,vt),dn.handleEvent=function(t){var e=!1;if(t.type==tt.KEYDOWN){var i=t.originalEvent,r=i.keyCode;if(this.condition_(t)&&(r==mr.DOWN||r==mr.LEFT||r==mr.RIGHT||r==mr.UP)){var n=t.map,a=n.getView(),o=a.getResolution()*this.pixelDelta_,s=0,l=0;r==mr.DOWN?l=-o:r==mr.LEFT?s=-o:r==mr.RIGHT?s=o:l=o;var h=[s,l];Mt.rotate(h,a.getRotation()),vt.pan(a,h,this.duration_),t.preventDefault(),e=!0}}return!e};var _n=function(t){vt.call(this,{handleEvent:_n.handleEvent});var e=t||{};this.condition_=e.condition?e.condition:Dt.targetNotEditable,this.delta_=e.delta?e.delta:1,this.duration_=e.duration!==void 0?e.duration:100};_.inherits(_n,vt),_n.handleEvent=function(t){var e=!1;if(t.type==tt.KEYDOWN||t.type==tt.KEYPRESS){var i=t.originalEvent,r=i.charCode;if(this.condition_(t)&&(r==43||r==45)){var n=t.map,a=r==43?this.delta_:-this.delta_,o=n.getView();vt.zoomByDelta(o,a,void 0,this.duration_),t.preventDefault(),e=!0}}return!e};var Li=function(t){vt.call(this,{handleEvent:Li.handleEvent});var e=t||{};this.delta_=0,this.duration_=e.duration!==void 0?e.duration:250,this.timeout_=e.timeout!==void 0?e.timeout:80,this.useAnchor_=e.useAnchor!==void 0?e.useAnchor:!0,this.constrainResolution_=e.constrainResolution||!1,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_=void 0,this.mode_=void 0,this.trackpadEventGap_=400,this.trackpadTimeoutId_=void 0,this.trackpadDeltaPerZoom_=300,this.trackpadZoomBuffer_=1.5};_.inherits(Li,vt),Li.handleEvent=function(t){var e=t.type;if(e!==tt.WHEEL&&e!==tt.MOUSEWHEEL)return!0;t.preventDefault();var i=t.map,r=t.originalEvent;this.useAnchor_&&(this.lastAnchor_=t.coordinate);var n;if(t.type==tt.WHEEL?(n=r.deltaY,_t.FIREFOX&&r.deltaMode===WheelEvent.DOM_DELTA_PIXEL&&(n/=_t.DEVICE_PIXEL_RATIO),r.deltaMode===WheelEvent.DOM_DELTA_LINE&&(n*=40)):t.type==tt.MOUSEWHEEL&&(n=-r.wheelDeltaY,_t.SAFARI&&(n/=3)),n===0)return!1;var a=Date.now();if(this.startTime_===void 0&&(this.startTime_=a),(!this.mode_||a-this.startTime_>this.trackpadEventGap_)&&(this.mode_=Math.abs(n)<4?Li.Mode_.TRACKPAD:Li.Mode_.WHEEL),this.mode_===Li.Mode_.TRACKPAD){var o=i.getView();this.trackpadTimeoutId_?clearTimeout(this.trackpadTimeoutId_):o.setHint(Pt.INTERACTING,1),this.trackpadTimeoutId_=setTimeout(this.decrementInteractingHint_.bind(this),this.trackpadEventGap_);var s=o.getResolution()*Math.pow(2,n/this.trackpadDeltaPerZoom_),l=o.getMinResolution(),h=o.getMaxResolution(),u=0;if(s<l?(s=Math.max(s,l/this.trackpadZoomBuffer_),u=1):s>h&&(s=Math.min(s,h*this.trackpadZoomBuffer_),u=-1),this.lastAnchor_){var f=o.calculateCenterZoom(s,this.lastAnchor_);o.setCenter(o.constrainCenter(f))}return o.setResolution(s),u===0&&this.constrainResolution_&&o.animate({resolution:o.constrainResolution(s,n>0?-1:1),easing:de.easeOut,anchor:this.lastAnchor_,duration:this.duration_}),u>0?o.animate({resolution:l,easing:de.easeOut,anchor:this.lastAnchor_,duration:500}):u<0&&o.animate({resolution:h,easing:de.easeOut,anchor:this.lastAnchor_,duration:500}),this.startTime_=a,!1}this.delta_+=n;var c=Math.max(this.timeout_-(a-this.startTime_),0);return clearTimeout(this.timeoutId_),this.timeoutId_=setTimeout(this.handleWheelZoom_.bind(this,i),c),!1},Li.prototype.decrementInteractingHint_=function(){this.trackpadTimeoutId_=void 0;var t=this.getMap().getView();t.setHint(Pt.INTERACTING,-1)},Li.prototype.handleWheelZoom_=function(t){var e=t.getView();e.getAnimating()&&e.cancelAnimations();var i=_.MOUSEWHEELZOOM_MAXDELTA,r=j.clamp(this.delta_,-i,i);vt.zoomByDelta(e,-r,this.lastAnchor_,this.duration_),this.mode_=void 0,this.delta_=0,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_=void 0},Li.prototype.setMouseAnchor=function(t){this.useAnchor_=t,t||(this.lastAnchor_=null)},Li.Mode_={TRACKPAD:"trackpad",WHEEL:"wheel"};var Ji=function(t){Gt.call(this,{handleDownEvent:Ji.handleDownEvent_,handleDragEvent:Ji.handleDragEvent_,handleUpEvent:Ji.handleUpEvent_});var e=t||{};this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.threshold_=e.threshold!==void 0?e.threshold:.3,this.duration_=e.duration!==void 0?e.duration:250};_.inherits(Ji,Gt),Ji.handleDragEvent_=function(t){var e=0,i=this.targetPointers[0],r=this.targetPointers[1],n=Math.atan2(r.clientY-i.clientY,r.clientX-i.clientX);if(this.lastAngle_!==void 0){var a=n-this.lastAngle_;this.rotationDelta_+=a,!this.rotating_&&Math.abs(this.rotationDelta_)>this.threshold_&&(this.rotating_=!0),e=a}this.lastAngle_=n;var o=t.map,s=o.getView();if(s.getConstraints().rotation!==Ci.disable){var l=o.getViewport().getBoundingClientRect(),h=Gt.centroid(this.targetPointers);if(h[0]-=l.left,h[1]-=l.top,this.anchor_=o.getCoordinateFromPixel(h),this.rotating_){var u=s.getRotation();o.render(),vt.rotateWithoutConstraints(s,u+e,this.anchor_)}}},Ji.handleUpEvent_=function(t){if(this.targetPointers.length<2){var e=t.map,i=e.getView();if(i.setHint(Pt.INTERACTING,-1),this.rotating_){var r=i.getRotation();vt.rotate(i,r,this.anchor_,this.duration_)}return!1}else return!0},Ji.handleDownEvent_=function(t){if(this.targetPointers.length>=2){var e=t.map;return this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.handlingDownUpSequence||e.getView().setHint(Pt.INTERACTING,1),!0}else return!1},Ji.prototype.shouldStopEvent=ne.FALSE;var qi=function(t){Gt.call(this,{handleDownEvent:qi.handleDownEvent_,handleDragEvent:qi.handleDragEvent_,handleUpEvent:qi.handleUpEvent_});var e=t||{};this.constrainResolution_=e.constrainResolution||!1,this.anchor_=null,this.duration_=e.duration!==void 0?e.duration:400,this.lastDistance_=void 0,this.lastScaleDelta_=1};_.inherits(qi,Gt),qi.handleDragEvent_=function(t){var e=1,i=this.targetPointers[0],r=this.targetPointers[1],n=i.clientX-r.clientX,a=i.clientY-r.clientY,o=Math.sqrt(n*n+a*a);this.lastDistance_!==void 0&&(e=this.lastDistance_/o),this.lastDistance_=o;var s=t.map,l=s.getView(),h=l.getResolution(),u=l.getMaxResolution(),f=l.getMinResolution(),c=h*e;c>u?(e=u/h,c=u):c<f&&(e=f/h,c=f),e!=1&&(this.lastScaleDelta_=e);var d=s.getViewport().getBoundingClientRect(),v=Gt.centroid(this.targetPointers);v[0]-=d.left,v[1]-=d.top,this.anchor_=s.getCoordinateFromPixel(v),s.render(),vt.zoomWithoutConstraints(l,c,this.anchor_)},qi.handleUpEvent_=function(t){if(this.targetPointers.length<2){var e=t.map,i=e.getView();i.setHint(Pt.INTERACTING,-1);var r=i.getResolution();if(this.constrainResolution_||r<i.getMinResolution()||r>i.getMaxResolution()){var n=this.lastScaleDelta_-1;vt.zoom(i,r,this.anchor_,this.duration_,n)}return!1}else return!0},qi.handleDownEvent_=function(t){if(this.targetPointers.length>=2){var e=t.map;return this.anchor_=null,this.lastDistance_=void 0,this.lastScaleDelta_=1,this.handlingDownUpSequence||e.getView().setHint(Pt.INTERACTING,1),!0}else return!1},qi.prototype.shouldStopEvent=ne.FALSE;var fa={};fa.defaults=function(t){var e=t||{},i=new ut,r=new Nr(-.005,.05,100),n=e.altShiftDragRotate!==void 0?e.altShiftDragRotate:!0;n&&i.push(new Zi);var a=e.doubleClickZoom!==void 0?e.doubleClickZoom:!0;a&&i.push(new cn({delta:e.zoomDelta,duration:e.zoomDuration}));var o=e.dragPan!==void 0?e.dragPan:!0;o&&i.push(new ji({kinetic:r}));var s=e.pinchRotate!==void 0?e.pinchRotate:!0;s&&i.push(new Ji);var l=e.pinchZoom!==void 0?e.pinchZoom:!0;l&&i.push(new qi({constrainResolution:e.constrainResolution,duration:e.zoomDuration}));var h=e.keyboard!==void 0?e.keyboard:!0;h&&(i.push(new dn),i.push(new _n({delta:e.zoomDelta,duration:e.zoomDuration})));var u=e.mouseWheelZoom!==void 0?e.mouseWheelZoom:!0;u&&i.push(new Li({constrainResolution:e.constrainResolution,duration:e.zoomDuration}));var f=e.shiftDragZoom!==void 0?e.shiftDragZoom:!0;return f&&i.push(new kn({duration:e.zoomDuration})),i};var Ui=function(t,e,i,r){re.call(this),this.extent=t,this.pixelRatio_=i,this.resolution=e,this.state=r};_.inherits(Ui,re),Ui.prototype.changed=function(){this.dispatchEvent(tt.CHANGE)},Ui.prototype.getExtent=function(){return this.extent},Ui.prototype.getImage=function(){},Ui.prototype.getPixelRatio=function(){return this.pixelRatio_},Ui.prototype.getResolution=function(){return this.resolution},Ui.prototype.getState=function(){return this.state},Ui.prototype.load=function(){};var Ke={IDLE:0,LOADING:1,LOADED:2,ERROR:3},Gr=function(t,e,i,r,n){this.loader_=n!==void 0?n:null;var a=n!==void 0?Ke.IDLE:Ke.LOADED;Ui.call(this,t,e,i,a),this.canvas_=r,this.error_=null};_.inherits(Gr,Ui),Gr.prototype.getError=function(){return this.error_},Gr.prototype.handleLoad_=function(t){t?(this.error_=t,this.state=Ke.ERROR):this.state=Ke.LOADED,this.changed()},Gr.prototype.load=function(){this.state==Ke.IDLE&&(this.state=Ke.LOADING,this.changed(),this.loader_(this.handleLoad_.bind(this)))},Gr.prototype.getImage=function(){return this.canvas_};var fo={IMAGE:"image",VECTOR:"vector"},Jr=function(t,e,i,r,n){ue.call(this,t),this.vectorContext=e,this.frameState=i,this.context=r,this.glContext=n};_.inherits(Jr,ue);var se=function(t){re.call(this),this.highWaterMark=t!==void 0?t:2048,this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null};_.inherits(se,re),se.prototype.canExpireCache=function(){return this.getCount()>this.highWaterMark},se.prototype.clear=function(){this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null,this.dispatchEvent(tt.CLEAR)},se.prototype.containsKey=function(t){return this.entries_.hasOwnProperty(t)},se.prototype.forEach=function(t,e){for(var i=this.oldest_;i;)t.call(e,i.value_,i.key_,this),i=i.newer},se.prototype.get=function(t){var e=this.entries_[t];return Ot.assert(e!==void 0,15),e===this.newest_||(e===this.oldest_?(this.oldest_=this.oldest_.newer,this.oldest_.older=null):(e.newer.older=e.older,e.older.newer=e.newer),e.newer=null,e.older=this.newest_,this.newest_.newer=e,this.newest_=e),e.value_},se.prototype.remove=function(t){var e=this.entries_[t];return Ot.assert(e!==void 0,15),e===this.newest_?(this.newest_=e.older,this.newest_&&(this.newest_.newer=null)):e===this.oldest_?(this.oldest_=e.newer,this.oldest_&&(this.oldest_.older=null)):(e.newer.older=e.older,e.older.newer=e.newer),delete this.entries_[t],--this.count_,e.value_},se.prototype.getCount=function(){return this.count_},se.prototype.getKeys=function(){var t=new Array(this.count_),e=0,i;for(i=this.newest_;i;i=i.older)t[e++]=i.key_;return t},se.prototype.getValues=function(){var t=new Array(this.count_),e=0,i;for(i=this.newest_;i;i=i.older)t[e++]=i.value_;return t},se.prototype.peekLast=function(){return this.oldest_.value_},se.prototype.peekLastKey=function(){return this.oldest_.key_},se.prototype.peekFirstKey=function(){return this.newest_.key_},se.prototype.pop=function(){var t=this.oldest_;return delete this.entries_[t.key_],t.newer&&(t.newer.older=null),this.oldest_=t.newer,this.oldest_||(this.newest_=null),--this.count_,t.value_},se.prototype.replace=function(t,e){this.get(t),this.entries_[t].value_=e},se.prototype.set=function(t,e){Ot.assert(!(t in this.entries_),16);var i={key_:t,newer:null,older:this.newest_,value_:e};this.newest_?this.newest_.newer=i:this.oldest_=i,this.newest_=i,this.entries_[t]=i,++this.count_},se.prototype.prune=function(){for(;this.canExpireCache();)this.pop()};var w={};w.defaultFont="10px sans-serif",w.defaultFillStyle=[0,0,0,1],w.defaultLineCap="round",w.defaultLineDash=[],w.defaultLineDashOffset=0,w.defaultLineJoin="round",w.defaultMiterLimit=10,w.defaultStrokeStyle=[0,0,0,1],w.defaultTextAlign="center",w.defaultTextBaseline="middle",w.defaultPadding=[0,0,0,0],w.defaultLineWidth=1,w.labelCache=new se,w.checkedFonts_={},w.measureContext_=null,w.textHeights_={},w.checkFont=function(){var t=60,e=w.checkedFonts_,i=w.labelCache,r="32px monospace",n="wmytzilWMYTZIL@#/&?$%10",a,o;function s(h){var u=w.getMeasureContext();u.font=r,o=u.measureText(n).width;var f=!0;if(h!="monospace"){u.font="32px "+h+",monospace";var c=u.measureText(n).width;f=c!=o}return f}function l(){var h=!0;for(var u in e)e[u]<t&&(s(u)?(e[u]=t,ht.clear(w.textHeights_),w.measureContext_=null,i.clear()):(++e[u],h=!1));h&&(window.clearInterval(a),a=void 0)}return function(h){var u=pe.getFontFamilies(h);if(u)for(var f=0,c=u.length;f<c;++f){var d=u[f];d in e||(e[d]=t,s(d)||(e[d]=0,a===void 0&&(a=window.setInterval(l,32))))}}}(),w.getMeasureContext=function(){var t=w.measureContext_;return t||(t=w.measureContext_=At.createCanvasContext2D(1,1)),t},w.measureTextHeight=function(){var t,e=w.textHeights_;return function(i){var r=e[i];return r==null&&(t||(t=document.createElement("span"),t.textContent="M",t.style.margin=t.style.padding="0 !important",t.style.position="absolute !important",t.style.left="-99999px !important"),t.style.font=i,document.body.appendChild(t),r=e[i]=t.offsetHeight,document.body.removeChild(t)),r}}(),w.measureTextWidth=function(t,e){var i=w.getMeasureContext();return t!=i.font&&(i.font=t),i.measureText(e).width},w.rotateAtOffset=function(t,e,i,r){e!==0&&(t.translate(i,r),t.rotate(e),t.translate(-i,-r))},w.resetTransform_=A.create(),w.drawImage=function(t,e,i,r,n,a,o,s,l,h,u){var f;i!=1&&(f=t.globalAlpha,t.globalAlpha=f*i),e&&t.setTransform.apply(t,e),t.drawImage(r,n,a,o,s,l,h,o*u,s*u),f&&(t.globalAlpha=f),e&&t.setTransform.apply(t,w.resetTransform_)};var Xt={};Xt.HEX_COLOR_RE_=/^#(?:[0-9a-f]{3,4}){1,2}$/i,Xt.NAMED_COLOR_RE_=/^([a-z]*)$/i,Xt.asArray=function(t){return Array.isArray(t)?t:Xt.fromString(t)},Xt.asString=function(t){return typeof t=="string"?t:Xt.toString(t)},Xt.fromNamed=function(t){var e=document.createElement("div");e.style.color=t,document.body.appendChild(e);var i=getComputedStyle(e).color;return document.body.removeChild(e),i},Xt.fromString=function(){var t=1024,e={},i=0;return function(r){var n;if(e.hasOwnProperty(r))n=e[r];else{if(i>=t){var a=0,o;for(o in e)a++&3||(delete e[o],--i)}n=Xt.fromStringInternal_(r),e[r]=n,++i}return n}}(),Xt.fromStringInternal_=function(t){var e,i,r,n,a,o;if(Xt.NAMED_COLOR_RE_.exec(t)&&(t=Xt.fromNamed(t)),Xt.HEX_COLOR_RE_.exec(t)){var s=t.length-1,l;s<=4?l=1:l=2;var h=s===4||s===8;e=parseInt(t.substr(1+0*l,l),16),i=parseInt(t.substr(1+1*l,l),16),r=parseInt(t.substr(1+2*l,l),16),h?n=parseInt(t.substr(1+3*l,l),16):n=255,l==1&&(e=(e<<4)+e,i=(i<<4)+i,r=(r<<4)+r,h&&(n=(n<<4)+n)),a=[e,i,r,n/255]}else t.indexOf("rgba(")==0?(o=t.slice(5,-1).split(",").map(Number),a=Xt.normalize(o)):t.indexOf("rgb(")==0?(o=t.slice(4,-1).split(",").map(Number),o.push(1),a=Xt.normalize(o)):Ot.assert(!1,14);return a},Xt.normalize=function(t,e){var i=e||[];return i[0]=j.clamp(t[0]+.5|0,0,255),i[1]=j.clamp(t[1]+.5|0,0,255),i[2]=j.clamp(t[2]+.5|0,0,255),i[3]=j.clamp(t[3],0,1),i},Xt.toString=function(t){var e=t[0];e!=(e|0)&&(e=e+.5|0);var i=t[1];i!=(i|0)&&(i=i+.5|0);var r=t[2];r!=(r|0)&&(r=r+.5|0);var n=t[3]===void 0?1:t[3];return"rgba("+e+","+i+","+r+","+n+")"};var li={};li.asColorLike=function(t){return li.isColorLike(t)?t:Xt.asString(t)},li.isColorLike=function(t){return typeof t=="string"||t instanceof CanvasPattern||t instanceof CanvasGradient};var Kt=function(){};Kt.prototype.drawCustom=function(t,e,i){},Kt.prototype.drawGeometry=function(t){},Kt.prototype.setStyle=function(t){},Kt.prototype.drawCircle=function(t,e){},Kt.prototype.drawFeature=function(t,e){},Kt.prototype.drawGeometryCollection=function(t,e){},Kt.prototype.drawLineString=function(t,e){},Kt.prototype.drawMultiLineString=function(t,e){},Kt.prototype.drawMultiPoint=function(t,e){},Kt.prototype.drawMultiPolygon=function(t,e){},Kt.prototype.drawPoint=function(t,e){},Kt.prototype.drawPolygon=function(t,e){},Kt.prototype.drawText=function(t,e){},Kt.prototype.setFillStrokeStyle=function(t,e){},Kt.prototype.setImageStyle=function(t,e){},Kt.prototype.setTextStyle=function(t,e){};var zt=function(t,e,i,r,n){Kt.call(this),this.context_=t,this.pixelRatio_=e,this.extent_=i,this.transform_=r,this.viewRotation_=n,this.contextFillState_=null,this.contextStrokeState_=null,this.contextTextState_=null,this.fillState_=null,this.strokeState_=null,this.image_=null,this.imageAnchorX_=0,this.imageAnchorY_=0,this.imageHeight_=0,this.imageOpacity_=0,this.imageOriginX_=0,this.imageOriginY_=0,this.imageRotateWithView_=!1,this.imageRotation_=0,this.imageScale_=0,this.imageSnapToPixel_=!1,this.imageWidth_=0,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=!1,this.textRotation_=0,this.textScale_=0,this.textFillState_=null,this.textStrokeState_=null,this.textState_=null,this.pixelCoordinates_=[],this.tmpLocalTransform_=A.create()};_.inherits(zt,Kt),zt.prototype.drawImages_=function(t,e,i,r){if(this.image_){var n=ae.transform2D(t,e,i,2,this.transform_,this.pixelCoordinates_),a=this.context_,o=this.tmpLocalTransform_,s=a.globalAlpha;this.imageOpacity_!=1&&(a.globalAlpha=s*this.imageOpacity_);var l=this.imageRotation_;this.imageRotateWithView_&&(l+=this.viewRotation_);var h,u;for(h=0,u=n.length;h<u;h+=2){var f=n[h]-this.imageAnchorX_,c=n[h+1]-this.imageAnchorY_;if(this.imageSnapToPixel_&&(f=Math.round(f),c=Math.round(c)),l!==0||this.imageScale_!=1){var d=f+this.imageAnchorX_,v=c+this.imageAnchorY_;A.compose(o,d,v,this.imageScale_,this.imageScale_,l,-d,-v),a.setTransform.apply(a,o)}a.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,f,c,this.imageWidth_,this.imageHeight_)}(l!==0||this.imageScale_!=1)&&a.setTransform(1,0,0,1,0,0),this.imageOpacity_!=1&&(a.globalAlpha=s)}},zt.prototype.drawText_=function(t,e,i,r){if(!(!this.textState_||this.text_==="")){this.textFillState_&&this.setContextFillState_(this.textFillState_),this.textStrokeState_&&this.setContextStrokeState_(this.textStrokeState_),this.setContextTextState_(this.textState_);var n=ae.transform2D(t,e,i,r,this.transform_,this.pixelCoordinates_),a=this.context_,o=this.textRotation_;for(this.textRotateWithView_&&(o+=this.viewRotation_);e<i;e+=r){var s=n[e]+this.textOffsetX_,l=n[e+1]+this.textOffsetY_;if(o!==0||this.textScale_!=1){var h=A.compose(this.tmpLocalTransform_,s,l,this.textScale_,this.textScale_,o,-s,-l);a.setTransform.apply(a,h)}this.textStrokeState_&&a.strokeText(this.text_,s,l),this.textFillState_&&a.fillText(this.text_,s,l)}(o!==0||this.textScale_!=1)&&a.setTransform(1,0,0,1,0,0)}},zt.prototype.moveToLineTo_=function(t,e,i,r,n){var a=this.context_,o=ae.transform2D(t,e,i,r,this.transform_,this.pixelCoordinates_);a.moveTo(o[0],o[1]);var s=o.length;n&&(s-=2);for(var l=2;l<s;l+=2)a.lineTo(o[l],o[l+1]);return n&&a.closePath(),i},zt.prototype.drawRings_=function(t,e,i,r){var n,a;for(n=0,a=i.length;n<a;++n)e=this.moveToLineTo_(t,e,i[n],r,!0);return e},zt.prototype.drawCircle=function(t){if(g.intersects(this.extent_,t.getExtent())){if(this.fillState_||this.strokeState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);var e=Tt.transform2D(t,this.transform_,this.pixelCoordinates_),i=e[2]-e[0],r=e[3]-e[1],n=Math.sqrt(i*i+r*r),a=this.context_;a.beginPath(),a.arc(e[0],e[1],n,0,2*Math.PI),this.fillState_&&a.fill(),this.strokeState_&&a.stroke()}this.text_!==""&&this.drawText_(t.getCenter(),0,2,2)}},zt.prototype.setStyle=function(t){this.setFillStrokeStyle(t.getFill(),t.getStroke()),this.setImageStyle(t.getImage()),this.setTextStyle(t.getText())},zt.prototype.drawGeometry=function(t){var e=t.getType();switch(e){case K.POINT:this.drawPoint(t);break;case K.LINE_STRING:this.drawLineString(t);break;case K.POLYGON:this.drawPolygon(t);break;case K.MULTI_POINT:this.drawMultiPoint(t);break;case K.MULTI_LINE_STRING:this.drawMultiLineString(t);break;case K.MULTI_POLYGON:this.drawMultiPolygon(t);break;case K.GEOMETRY_COLLECTION:this.drawGeometryCollection(t);break;case K.CIRCLE:this.drawCircle(t);break}},zt.prototype.drawFeature=function(t,e){var i=e.getGeometryFunction()(t);!i||!g.intersects(this.extent_,i.getExtent())||(this.setStyle(e),this.drawGeometry(i))},zt.prototype.drawGeometryCollection=function(t){var e=t.getGeometriesArray(),i,r;for(i=0,r=e.length;i<r;++i)this.drawGeometry(e[i])},zt.prototype.drawPoint=function(t){var e=t.getFlatCoordinates(),i=t.getStride();this.image_&&this.drawImages_(e,0,e.length,i),this.text_!==""&&this.drawText_(e,0,e.length,i)},zt.prototype.drawMultiPoint=function(t){var e=t.getFlatCoordinates(),i=t.getStride();this.image_&&this.drawImages_(e,0,e.length,i),this.text_!==""&&this.drawText_(e,0,e.length,i)},zt.prototype.drawLineString=function(t){if(g.intersects(this.extent_,t.getExtent())){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);var e=this.context_,i=t.getFlatCoordinates();e.beginPath(),this.moveToLineTo_(i,0,i.length,t.getStride(),!1),e.stroke()}if(this.text_!==""){var r=t.getFlatMidpoint();this.drawText_(r,0,2,2)}}},zt.prototype.drawMultiLineString=function(t){var e=t.getExtent();if(g.intersects(this.extent_,e)){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);var i=this.context_,r=t.getFlatCoordinates(),n=0,a=t.getEnds(),o=t.getStride();i.beginPath();var s,l;for(s=0,l=a.length;s<l;++s)n=this.moveToLineTo_(r,n,a[s],o,!1);i.stroke()}if(this.text_!==""){var h=t.getFlatMidpoints();this.drawText_(h,0,h.length,2)}}},zt.prototype.drawPolygon=function(t){if(g.intersects(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);var e=this.context_;e.beginPath(),this.drawRings_(t.getOrientedFlatCoordinates(),0,t.getEnds(),t.getStride()),this.fillState_&&e.fill(),this.strokeState_&&e.stroke()}if(this.text_!==""){var i=t.getFlatInteriorPoint();this.drawText_(i,0,2,2)}}},zt.prototype.drawMultiPolygon=function(t){if(g.intersects(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);var e=this.context_,i=t.getOrientedFlatCoordinates(),r=0,n=t.getEndss(),a=t.getStride(),o,s;for(e.beginPath(),o=0,s=n.length;o<s;++o){var l=n[o];r=this.drawRings_(i,r,l,a)}this.fillState_&&e.fill(),this.strokeState_&&e.stroke()}if(this.text_!==""){var h=t.getFlatInteriorPoints();this.drawText_(h,0,h.length,2)}}},zt.prototype.setContextFillState_=function(t){var e=this.context_,i=this.contextFillState_;i?i.fillStyle!=t.fillStyle&&(i.fillStyle=e.fillStyle=t.fillStyle):(e.fillStyle=t.fillStyle,this.contextFillState_={fillStyle:t.fillStyle})},zt.prototype.setContextStrokeState_=function(t){var e=this.context_,i=this.contextStrokeState_;i?(i.lineCap!=t.lineCap&&(i.lineCap=e.lineCap=t.lineCap),_t.CANVAS_LINE_DASH&&(st.equals(i.lineDash,t.lineDash)||e.setLineDash(i.lineDash=t.lineDash),i.lineDashOffset!=t.lineDashOffset&&(i.lineDashOffset=e.lineDashOffset=t.lineDashOffset)),i.lineJoin!=t.lineJoin&&(i.lineJoin=e.lineJoin=t.lineJoin),i.lineWidth!=t.lineWidth&&(i.lineWidth=e.lineWidth=t.lineWidth),i.miterLimit!=t.miterLimit&&(i.miterLimit=e.miterLimit=t.miterLimit),i.strokeStyle!=t.strokeStyle&&(i.strokeStyle=e.strokeStyle=t.strokeStyle)):(e.lineCap=t.lineCap,_t.CANVAS_LINE_DASH&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.lineJoin=t.lineJoin,e.lineWidth=t.lineWidth,e.miterLimit=t.miterLimit,e.strokeStyle=t.strokeStyle,this.contextStrokeState_={lineCap:t.lineCap,lineDash:t.lineDash,lineDashOffset:t.lineDashOffset,lineJoin:t.lineJoin,lineWidth:t.lineWidth,miterLimit:t.miterLimit,strokeStyle:t.strokeStyle})},zt.prototype.setContextTextState_=function(t){var e=this.context_,i=this.contextTextState_,r=t.textAlign?t.textAlign:w.defaultTextAlign;i?(i.font!=t.font&&(i.font=e.font=t.font),i.textAlign!=r&&(i.textAlign=r),i.textBaseline!=t.textBaseline&&(i.textBaseline=e.textBaseline=t.textBaseline)):(e.font=t.font,e.textAlign=r,e.textBaseline=t.textBaseline,this.contextTextState_={font:t.font,textAlign:r,textBaseline:t.textBaseline})},zt.prototype.setFillStrokeStyle=function(t,e){if(!t)this.fillState_=null;else{var i=t.getColor();this.fillState_={fillStyle:li.asColorLike(i||w.defaultFillStyle)}}if(!e)this.strokeState_=null;else{var r=e.getColor(),n=e.getLineCap(),a=e.getLineDash(),o=e.getLineDashOffset(),s=e.getLineJoin(),l=e.getWidth(),h=e.getMiterLimit();this.strokeState_={lineCap:n!==void 0?n:w.defaultLineCap,lineDash:a||w.defaultLineDash,lineDashOffset:o||w.defaultLineDashOffset,lineJoin:s!==void 0?s:w.defaultLineJoin,lineWidth:this.pixelRatio_*(l!==void 0?l:w.defaultLineWidth),miterLimit:h!==void 0?h:w.defaultMiterLimit,strokeStyle:li.asColorLike(r||w.defaultStrokeStyle)}}},zt.prototype.setImageStyle=function(t){if(!t)this.image_=null;else{var e=t.getAnchor(),i=t.getImage(1),r=t.getOrigin(),n=t.getSize();this.imageAnchorX_=e[0],this.imageAnchorY_=e[1],this.imageHeight_=n[1],this.image_=i,this.imageOpacity_=t.getOpacity(),this.imageOriginX_=r[0],this.imageOriginY_=r[1],this.imageRotateWithView_=t.getRotateWithView(),this.imageRotation_=t.getRotation(),this.imageScale_=t.getScale()*this.pixelRatio_,this.imageSnapToPixel_=t.getSnapToPixel(),this.imageWidth_=n[0]}},zt.prototype.setTextStyle=function(t){if(!t)this.text_="";else{var e=t.getFill();if(!e)this.textFillState_=null;else{var i=e.getColor();this.textFillState_={fillStyle:li.asColorLike(i||w.defaultFillStyle)}}var r=t.getStroke();if(!r)this.textStrokeState_=null;else{var n=r.getColor(),a=r.getLineCap(),o=r.getLineDash(),s=r.getLineDashOffset(),l=r.getLineJoin(),h=r.getWidth(),u=r.getMiterLimit();this.textStrokeState_={lineCap:a!==void 0?a:w.defaultLineCap,lineDash:o||w.defaultLineDash,lineDashOffset:s||w.defaultLineDashOffset,lineJoin:l!==void 0?l:w.defaultLineJoin,lineWidth:h!==void 0?h:w.defaultLineWidth,miterLimit:u!==void 0?u:w.defaultMiterLimit,strokeStyle:li.asColorLike(n||w.defaultStrokeStyle)}}var f=t.getFont(),c=t.getOffsetX(),d=t.getOffsetY(),v=t.getRotateWithView(),E=t.getRotation(),p=t.getScale(),m=t.getText(),y=t.getTextAlign(),R=t.getTextBaseline();this.textState_={font:f!==void 0?f:w.defaultFont,textAlign:y!==void 0?y:w.defaultTextAlign,textBaseline:R!==void 0?R:w.defaultTextBaseline},this.text_=m!==void 0?m:"",this.textOffsetX_=c!==void 0?this.pixelRatio_*c:0,this.textOffsetY_=d!==void 0?this.pixelRatio_*d:0,this.textRotateWithView_=v!==void 0?v:!1,this.textRotation_=E!==void 0?E:0,this.textScale_=this.pixelRatio_*(p!==void 0?p:1)}};var ze=function(t){di.call(this),this.layer_=t};_.inherits(ze,di),ze.prototype.forEachFeatureAtCoordinate=_.nullFunction,ze.prototype.hasFeatureAtCoordinate=ne.FALSE,ze.prototype.createLoadedTileFinder=function(t,e,i){return function(r,n){function a(o){i[r]||(i[r]={}),i[r][o.tileCoord.toString()]=o}return t.forEachLoadedTile(e,r,n,a)}},ze.prototype.getLayer=function(){return this.layer_},ze.prototype.handleImageChange_=function(t){var e=t.target;e.getState()===Ke.LOADED&&this.renderIfReadyAndVisible()},ze.prototype.loadImage=function(t){var e=t.getState();return e!=Ke.LOADED&&e!=Ke.ERROR&&L.listen(t,tt.CHANGE,this.handleImageChange_,this),e==Ke.IDLE&&(t.load(),e=t.getState()),e==Ke.LOADED},ze.prototype.renderIfReadyAndVisible=function(){var t=this.getLayer();t.getVisible()&&t.getSourceState()==Or.READY&&this.changed()},ze.prototype.scheduleExpireCache=function(t,e){if(e.canExpireCache()){var i=(function(r,n,a){var o=_.getUid(r).toString();o in a.usedTiles&&r.expireCache(a.viewState.projection,a.usedTiles[o])}).bind(null,e);t.postRenderFunctions.push(i)}},ze.prototype.updateLogos=function(t,e){var i=e.getLogo();i!==void 0&&(typeof i=="string"?t.logos[i]="":i&&(Ot.assert(typeof i.href=="string",44),Ot.assert(typeof i.src=="string",45),t.logos[i.src]=i.href))},ze.prototype.updateUsedTiles=function(t,e,i,r){var n=_.getUid(e).toString(),a=i.toString();n in t?a in t[n]?t[n][a].extend(r):t[n][a]=r:(t[n]={},t[n][a]=r)},ze.prototype.manageTilePyramid=function(t,e,i,r,n,a,o,s,l,h){var u=_.getUid(e).toString();u in t.wantedTiles||(t.wantedTiles[u]={});var f=t.wantedTiles[u],c=t.tileQueue,d=i.getMinZoom(),v,E,p,m,y,R;for(R=d;R<=o;++R)for(E=i.getTileRangeForExtentAndZ(a,R,E),p=i.getResolution(R),m=E.minX;m<=E.maxX;++m)for(y=E.minY;y<=E.maxY;++y)o-R<=s?(v=e.getTile(R,m,y,r,n),v.getState()==V.IDLE&&(f[v.getKey()]=!0,c.isKeyQueued(v.getKey())||c.enqueue([v,u,i.getTileCoordCenter(v.tileCoord),p])),l!==void 0&&l.call(h,v)):e.useTile(R,m,y,n)};var je=function(t){ze.call(this,t),this.renderedResolution,this.transform_=A.create()};_.inherits(je,ze),je.prototype.clip=function(t,e,i){var r=e.pixelRatio,n=e.size[0]*r,a=e.size[1]*r,o=e.viewState.rotation,s=g.getTopLeft(i),l=g.getTopRight(i),h=g.getBottomRight(i),u=g.getBottomLeft(i);A.apply(e.coordinateToPixelTransform,s),A.apply(e.coordinateToPixelTransform,l),A.apply(e.coordinateToPixelTransform,h),A.apply(e.coordinateToPixelTransform,u),t.save(),w.rotateAtOffset(t,-o,n/2,a/2),t.beginPath(),t.moveTo(s[0]*r,s[1]*r),t.lineTo(l[0]*r,l[1]*r),t.lineTo(h[0]*r,h[1]*r),t.lineTo(u[0]*r,u[1]*r),t.clip(),w.rotateAtOffset(t,o,n/2,a/2)},je.prototype.dispatchComposeEvent_=function(t,e,i,r){var n=this.getLayer();if(n.hasListener(t)){var a=i.size[0]*i.pixelRatio,o=i.size[1]*i.pixelRatio,s=i.viewState.rotation;w.rotateAtOffset(e,-s,a/2,o/2);var l=r!==void 0?r:this.getTransform(i,0),h=new zt(e,i.pixelRatio,i.extent,l,i.viewState.rotation),u=new Jr(t,h,i,e,null);n.dispatchEvent(u),w.rotateAtOffset(e,s,a/2,o/2)}},je.prototype.forEachLayerAtCoordinate=function(t,e,i,r){var n=this.forEachFeatureAtCoordinate(t,e,0,ne.TRUE,this);if(n)return i.call(r,this.getLayer(),null)},je.prototype.postCompose=function(t,e,i,r){this.dispatchComposeEvent_(Ri.POSTCOMPOSE,t,e,r)},je.prototype.preCompose=function(t,e,i){this.dispatchComposeEvent_(Ri.PRECOMPOSE,t,e,i)},je.prototype.dispatchRenderEvent=function(t,e,i){this.dispatchComposeEvent_(Ri.RENDER,t,e,i)},je.prototype.getTransform=function(t,e){var i=t.viewState,r=t.pixelRatio,n=r*t.size[0]/2,a=r*t.size[1]/2,o=r/i.resolution,s=-o,l=-i.rotation,h=-i.center[0]+e,u=-i.center[1];return A.compose(this.transform_,n,a,o,s,l,h,u)},je.prototype.composeFrame=function(t,e,i){},je.prototype.prepareFrame=function(t,e){};var Ai=function(t){je.call(this,t),this.coordinateToCanvasPixelTransform=A.create(),this.hitCanvasContext_=null};_.inherits(Ai,je),Ai.prototype.composeFrame=function(t,e,i){this.preCompose(i,t);var r=this.getImage();if(r){var n=e.extent,a=n!==void 0&&!g.containsExtent(n,t.extent)&&g.intersects(n,t.extent);a&&this.clip(i,t,n);var o=this.getImageTransform(),s=i.globalAlpha;i.globalAlpha=e.opacity;var l=o[4],h=o[5],u=r.width*o[0],f=r.height*o[3];i.drawImage(r,0,0,+r.width,+r.height,Math.round(l),Math.round(h),Math.round(u),Math.round(f)),i.globalAlpha=s,a&&i.restore()}this.postCompose(i,t,e)},Ai.prototype.getImage=function(){},Ai.prototype.getImageTransform=function(){},Ai.prototype.forEachFeatureAtCoordinate=function(t,e,i,r,n){var a=this.getLayer(),o=a.getSource(),s=e.viewState.resolution,l=e.viewState.rotation,h=e.skippedFeatureUids;return o.forEachFeatureAtCoordinate(t,s,l,i,h,function(u){return r.call(n,u,a)})},Ai.prototype.forEachLayerAtCoordinate=function(t,e,i,r){if(this.getImage()){if(this.getLayer().getSource().forEachFeatureAtCoordinate!==_.nullFunction)return je.prototype.forEachLayerAtCoordinate.apply(this,arguments);var n=A.apply(this.coordinateToCanvasPixelTransform,t.slice());Mt.scale(n,e.viewState.resolution/this.renderedResolution),this.hitCanvasContext_||(this.hitCanvasContext_=At.createCanvasContext2D(1,1)),this.hitCanvasContext_.clearRect(0,0,1,1),this.hitCanvasContext_.drawImage(this.getImage(),n[0],n[1],1,1,0,0,1,1);var a=this.hitCanvasContext_.getImageData(0,0,1,1).data;return a[3]>0?i.call(r,this.getLayer(),a):void 0}};var wi=function(t){Ai.call(this,t),this.image_=null,this.imageTransform_=A.create(),this.skippedFeatures_=[],this.vectorRenderer_=null};_.inherits(wi,Ai),wi.handles=function(t,e){return t===ri.CANVAS&&(e.getType()===Pi.IMAGE||e.getType()===Pi.VECTOR&&e.getRenderMode()===fo.IMAGE)},wi.create=function(t,e){var i=new wi(e);if(e.getType()===Pi.VECTOR)for(var r=Le.getLayerRendererPlugins(),n=0,a=r.length;n<a;++n){var o=r[n];o!==wi&&o.handles(ri.CANVAS,e)&&i.setVectorRenderer(o.create(t,e))}return i},wi.prototype.getImage=function(){return this.image_?this.image_.getImage():null},wi.prototype.getImageTransform=function(){return this.imageTransform_},wi.prototype.prepareFrame=function(t,e){var i=t.pixelRatio,r=t.size,n=t.viewState,a=n.center,o=n.resolution,s,l=this.getLayer(),h=l.getSource(),u=t.viewHints,f=t.extent;if(e.extent!==void 0&&(f=g.getIntersection(f,e.extent)),!u[Pt.ANIMATING]&&!u[Pt.INTERACTING]&&!g.isEmpty(f)){var c=n.projection;if(!_.ENABLE_RASTER_REPROJECTION){var d=h.getProjection();d&&(c=d)}var v=this.vectorRenderer_;if(v){var E=v.context,p=ht.assign({},t,{size:[g.getWidth(f)/o,g.getHeight(f)/o],viewState:ht.assign({},t.viewState,{rotation:0})}),m=Object.keys(p.skippedFeatureUids).sort();v.prepareFrame(p,e)&&(v.replayGroupChanged||!st.equals(m,this.skippedFeatures_))&&(E.canvas.width=p.size[0]*i,E.canvas.height=p.size[1]*i,v.composeFrame(p,e,E),this.image_=new Gr(f,o,i,E.canvas),this.skippedFeatures_=m)}else if(s=h.getImage(f,o,i,c),s){var y=this.loadImage(s);y&&(this.image_=s)}}if(this.image_){s=this.image_;var R=s.getExtent(),C=s.getResolution(),x=s.getPixelRatio(),I=i*C/(o*x),D=A.compose(this.imageTransform_,i*r[0]/2,i*r[1]/2,I,I,0,x*(R[0]-a[0])/C,x*(a[1]-R[3])/C);A.compose(this.coordinateToCanvasPixelTransform,i*r[0]/2-D[4],i*r[1]/2-D[5],i/o,-i/o,0,-a[0],-a[1]),this.updateLogos(t,h),this.renderedResolution=C*i/x}return!!this.image_},wi.prototype.forEachFeatureAtCoordinate=function(t,e,i,r,n){return this.vectorRenderer_?this.vectorRenderer_.forEachFeatureAtCoordinate(t,e,i,r,n):Ai.prototype.forEachFeatureAtCoordinate.call(this,t,e,i,r,n)},wi.prototype.setVectorRenderer=function(t){this.vectorRenderer_=t};var $i=function(){this.cache_={},this.cacheSize_=0,this.maxCacheSize_=32};$i.getKey=function(t,e,i){var r=i?Xt.asString(i):"null";return e+":"+t+":"+r},$i.prototype.clear=function(){this.cache_={},this.cacheSize_=0},$i.prototype.expire=function(){if(this.cacheSize_>this.maxCacheSize_){var t=0,e,i;for(e in this.cache_)i=this.cache_[e],!(t++&3)&&!i.hasListener()&&(delete this.cache_[e],--this.cacheSize_)}},$i.prototype.get=function(t,e,i){var r=$i.getKey(t,e,i);return r in this.cache_?this.cache_[r]:null},$i.prototype.set=function(t,e,i,r){var n=$i.getKey(t,e,i);this.cache_[n]=r,++this.cacheSize_},$i.prototype.setSize=function(t){this.maxCacheSize_=t,this.expire()};var ca={};ca.iconImageCache=new $i;var Wt=function(t,e){Vi.call(this),this.map_=e,this.layerRenderers_={},this.layerRendererListeners_={}};_.inherits(Wt,Vi),Wt.prototype.calculateMatrices2D=function(t){var e=t.viewState,i=t.coordinateToPixelTransform,r=t.pixelToCoordinateTransform;A.compose(i,t.size[0]/2,t.size[1]/2,1/e.resolution,-1/e.resolution,-e.rotation,-e.center[0],-e.center[1]),A.invert(A.setFromArray(r,i))},Wt.prototype.removeLayerRenderers=function(){for(var t in this.layerRenderers_)this.removeLayerRendererByKey_(t).dispose()},Wt.expireIconCache_=function(t,e){var i=ca.iconImageCache;i.expire()},Wt.prototype.forEachFeatureAtCoordinate=function(t,e,i,r,n,a,o){var s,l=e.viewState,h=l.resolution;function u(D,O){var B=_.getUid(D).toString(),W=e.layerStates[_.getUid(O)].managed;if(!(B in e.skippedFeatureUids&&!W))return r.call(n,D,W?O:null)}var f=l.projection,c=t;if(f.canWrapX()){var d=f.getExtent(),v=g.getWidth(d),E=t[0];if(E<d[0]||E>d[2]){var p=Math.ceil((d[0]-E)/v);c=[E+v*p,t[1]]}}var m=e.layerStatesArray,y=m.length,R;for(R=y-1;R>=0;--R){var C=m[R],x=C.layer;if(ce.visibleAtResolution(C,h)&&a.call(o,x)){var I=this.getLayerRenderer(x);if(x.getSource()&&(s=I.forEachFeatureAtCoordinate(x.getSource().getWrapX()?c:t,e,i,u,n)),s)return s}}},Wt.prototype.forEachLayerAtPixel=function(t,e,i,r,n,a){},Wt.prototype.hasFeatureAtCoordinate=function(t,e,i,r,n){var a=this.forEachFeatureAtCoordinate(t,e,i,ne.TRUE,this,r,n);return a!==void 0},Wt.prototype.getLayerRenderer=function(t){var e=_.getUid(t).toString();if(e in this.layerRenderers_)return this.layerRenderers_[e];for(var i=Le.getLayerRendererPlugins(),r,n=this.getType(),a=0,o=i.length;a<o;++a){var s=i[a];if(s.handles(n,t)){r=s.create(this,t);break}}if(r)this.layerRenderers_[e]=r,this.layerRendererListeners_[e]=L.listen(r,tt.CHANGE,this.handleLayerRendererChange_,this);else throw new Error("Unable to create renderer for layer: "+t.getType());return r},Wt.prototype.getLayerRendererByKey=function(t){return this.layerRenderers_[t]},Wt.prototype.getLayerRenderers=function(){return this.layerRenderers_},Wt.prototype.getMap=function(){return this.map_},Wt.prototype.getType=function(){},Wt.prototype.handleLayerRendererChange_=function(){this.map_.render()},Wt.prototype.removeLayerRendererByKey_=function(t){var e=this.layerRenderers_[t];return delete this.layerRenderers_[t],L.unlistenByKey(this.layerRendererListeners_[t]),delete this.layerRendererListeners_[t],e},Wt.prototype.renderFrame=_.nullFunction,Wt.prototype.removeUnusedLayerRenderers_=function(t,e){var i;for(i in this.layerRenderers_)(!e||!(i in e.layerStates))&&this.removeLayerRendererByKey_(i).dispose()},Wt.prototype.scheduleExpireIconCache=function(t){t.postRenderFunctions.push(Wt.expireIconCache_)},Wt.prototype.scheduleRemoveUnusedLayerRenderers=function(t){var e;for(e in this.layerRenderers_)if(!(e in t.layerStates)){t.postRenderFunctions.push(this.removeUnusedLayerRenderers_.bind(this));return}},Wt.sortByZIndex=function(t,e){return t.zIndex-e.zIndex};var Bi=function(t,e){Wt.call(this,t,e),this.context_=At.createCanvasContext2D(),this.canvas_=this.context_.canvas,this.canvas_.style.width="100%",this.canvas_.style.height="100%",this.canvas_.style.display="block",this.canvas_.className=pe.CLASS_UNSELECTABLE,t.insertBefore(this.canvas_,t.childNodes[0]||null),this.renderedVisible_=!0,this.transform_=A.create()};_.inherits(Bi,Wt),Bi.handles=function(t){return t===ri.CANVAS},Bi.create=function(t,e){return new Bi(t,e)},Bi.prototype.dispatchComposeEvent_=function(t,e){var i=this.getMap(),r=this.context_;if(i.hasListener(t)){var n=e.extent,a=e.pixelRatio,o=e.viewState,s=o.rotation,l=this.getTransform(e),h=new zt(r,a,n,l,s),u=new Jr(t,h,e,r,null);i.dispatchEvent(u)}},Bi.prototype.getTransform=function(t){var e=t.viewState,i=this.canvas_.width/2,r=this.canvas_.height/2,n=t.pixelRatio/e.resolution,a=-n,o=-e.rotation,s=-e.center[0],l=-e.center[1];return A.compose(this.transform_,i,r,n,a,o,s,l)},Bi.prototype.getType=function(){return ri.CANVAS},Bi.prototype.renderFrame=function(t){if(!t){this.renderedVisible_&&(this.canvas_.style.display="none",this.renderedVisible_=!1);return}var e=this.context_,i=t.pixelRatio,r=Math.round(t.size[0]*i),n=Math.round(t.size[1]*i);this.canvas_.width!=r||this.canvas_.height!=n?(this.canvas_.width=r,this.canvas_.height=n):e.clearRect(0,0,r,n);var a=t.viewState.rotation;this.calculateMatrices2D(t),this.dispatchComposeEvent_(Ri.PRECOMPOSE,t);var o=t.layerStatesArray;st.stableSort(o,Wt.sortByZIndex),a&&(e.save(),w.rotateAtOffset(e,a,r/2,n/2));var s=t.viewState.resolution,l,h,u,f,c;for(l=0,h=o.length;l<h;++l)c=o[l],u=c.layer,f=this.getLayerRenderer(u),!(!ce.visibleAtResolution(c,s)||c.sourceState!=Or.READY)&&f.prepareFrame(t,c)&&f.composeFrame(t,c,e);a&&e.restore(),this.dispatchComposeEvent_(Ri.POSTCOMPOSE,t),this.renderedVisible_||(this.canvas_.style.display="",this.renderedVisible_=!0),this.scheduleRemoveUnusedLayerRenderers(t),this.scheduleExpireIconCache(t)},Bi.prototype.forEachLayerAtPixel=function(t,e,i,r,n,a){var o,s=e.viewState,l=s.resolution,h=e.layerStatesArray,u=h.length,f=A.apply(e.pixelToCoordinateTransform,t.slice()),c;for(c=u-1;c>=0;--c){var d=h[c],v=d.layer;if(ce.visibleAtResolution(d,l)&&n.call(a,v)){var E=this.getLayerRenderer(v);if(o=E.forEachLayerAtCoordinate(f,e,i,r),o)return o}}};var Ae=function(t,e,i,r){this.minX=t,this.maxX=e,this.minY=i,this.maxY=r};Ae.createOrUpdate=function(t,e,i,r,n){return n!==void 0?(n.minX=t,n.maxX=e,n.minY=i,n.maxY=r,n):new Ae(t,e,i,r)},Ae.prototype.contains=function(t){return this.containsXY(t[1],t[2])},Ae.prototype.containsTileRange=function(t){return this.minX<=t.minX&&t.maxX<=this.maxX&&this.minY<=t.minY&&t.maxY<=this.maxY},Ae.prototype.containsXY=function(t,e){return this.minX<=t&&t<=this.maxX&&this.minY<=e&&e<=this.maxY},Ae.prototype.equals=function(t){return this.minX==t.minX&&this.minY==t.minY&&this.maxX==t.maxX&&this.maxY==t.maxY},Ae.prototype.extend=function(t){t.minX<this.minX&&(this.minX=t.minX),t.maxX>this.maxX&&(this.maxX=t.maxX),t.minY<this.minY&&(this.minY=t.minY),t.maxY>this.maxY&&(this.maxY=t.maxY)},Ae.prototype.getHeight=function(){return this.maxY-this.minY+1},Ae.prototype.getSize=function(){return[this.getWidth(),this.getHeight()]},Ae.prototype.getWidth=function(){return this.maxX-this.minX+1},Ae.prototype.intersects=function(t){return this.minX<=t.maxX&&this.maxX>=t.minX&&this.minY<=t.maxY&&this.maxY>=t.minY};var Be=function(t){Ai.call(this,t),this.context=this.context===null?null:At.createCanvasContext2D(),this.oversampling_,this.renderedExtent_=null,this.renderedRevision,this.renderedTiles=[],this.tmpExtent=g.createEmpty(),this.tmpTileRange_=new Ae(0,0,0,0),this.imageTransform_=A.create(),this.zDirection=0};_.inherits(Be,Ai),Be.handles=function(t,e){return t===ri.CANVAS&&e.getType()===Pi.TILE},Be.create=function(t,e){return new Be(e)},Be.prototype.isDrawableTile_=function(t){var e=t.getState(),i=this.getLayer().getUseInterimTilesOnError();return e==V.LOADED||e==V.EMPTY||e==V.ERROR&&!i},Be.prototype.prepareFrame=function(t,e){var i=t.pixelRatio,r=t.size,n=t.viewState,a=n.projection,o=n.resolution,s=n.center,l=this.getLayer(),h=l.getSource(),u=h.getRevision(),f=h.getTileGridForProjection(a),c=f.getZForResolution(o,this.zDirection),d=f.getResolution(c),v=Math.round(o/d)||1,E=t.extent;if(e.extent!==void 0&&(E=g.getIntersection(E,e.extent)),g.isEmpty(E))return!1;var p=f.getTileRangeForExtentAndZ(E,c),m=f.getTileRangeExtent(c,p),y=h.getTilePixelRatio(i),R={};R[c]={};var C=this.createLoadedTileFinder(h,a,R),x=this.tmpExtent,I=this.tmpTileRange_,D=!1,O,B,W;for(B=p.minX;B<=p.maxX;++B)for(W=p.minY;W<=p.maxY;++W){if(O=h.getTile(c,B,W,i,a),O.getState()==V.ERROR&&(l.getUseInterimTilesOnError()?l.getPreload()>0&&(D=!0):O.setState(V.LOADED)),this.isDrawableTile_(O)||(O=O.getInterimTile()),this.isDrawableTile_(O)){var N=_.getUid(this);if(O.getState()==V.LOADED){R[c][O.tileCoord.toString()]=O;var P=O.inTransition(N);!D&&(P||this.renderedTiles.indexOf(O)===-1)&&(D=!0)}if(O.getAlpha(N,t.time)===1)continue}var $=f.getTileCoordChildTileRange(O.tileCoord,I,x),b=!1;$&&(b=C(c+1,$)),b||f.forEachTileCoordParentTileRange(O.tileCoord,C,null,I,x)}var M=d*i/y*v,F=t.viewHints,X=F[Pt.ANIMATING]||F[Pt.INTERACTING];if(!(this.renderedResolution&&Date.now()-t.time>16&&X)&&(D||!(this.renderedExtent_&&g.containsExtent(this.renderedExtent_,E))||this.renderedRevision!=u||v!=this.oversampling_||!X&&M!=this.renderedResolution)){var U=this.context;if(U){var Z=h.getTilePixelSize(c,i,a),z=Math.round(p.getWidth()*Z[0]/v),Q=Math.round(p.getHeight()*Z[1]/v),rt=U.canvas;rt.width!=z||rt.height!=Q?(this.oversampling_=v,rt.width=z,rt.height=Q):(this.renderedExtent_&&!g.equals(m,this.renderedExtent_)&&U.clearRect(0,0,z,Q),v=this.oversampling_)}this.renderedTiles.length=0;var ft=Object.keys(R).map(Number);ft.sort(function(Xi,Ei){return Xi===c?1:Ei===c?-1:Xi>Ei?1:Xi<Ei?-1:0});var Ct,yt,jt,It,ie,xe,Bt,Ce,ke,Fe,fi;for(ie=0,xe=ft.length;ie<xe;++ie){It=ft[ie],jt=h.getTilePixelSize(It,i,a),Ct=f.getResolution(It),yt=Ct/d,Ce=y*h.getGutter(a),ke=R[It];for(var cr in ke)O=ke[cr],Bt=f.getTileCoordExtent(O.getTileCoord(),x),B=(Bt[0]-m[0])/d*y/v,W=(m[3]-Bt[3])/d*y/v,Fe=jt[0]*yt/v,fi=jt[1]*yt/v,this.drawTileImage(O,t,e,B,W,Fe,fi,Ce,c===It),this.renderedTiles.push(O)}this.renderedRevision=u,this.renderedResolution=d*i/y*v,this.renderedExtent_=m}var ki=this.renderedResolution/o,ir=A.compose(this.imageTransform_,i*r[0]/2,i*r[1]/2,ki,ki,0,(this.renderedExtent_[0]-s[0])/this.renderedResolution*i,(s[1]-this.renderedExtent_[3])/this.renderedResolution*i);return A.compose(this.coordinateToCanvasPixelTransform,i*r[0]/2-ir[4],i*r[1]/2-ir[5],i/o,-i/o,0,-s[0],-s[1]),this.updateUsedTiles(t.usedTiles,h,c,p),this.manageTilePyramid(t,h,f,i,a,E,c,l.getPreload()),this.scheduleExpireCache(t,h),this.updateLogos(t,h),this.renderedTiles.length>0},Be.prototype.drawTileImage=function(t,e,i,r,n,a,o,s,l){var h=t.getImage(this.getLayer());if(h){var u=_.getUid(this),f=l?t.getAlpha(u,e.time):1;f===1&&!this.getLayer().getSource().getOpaque(e.viewState.projection)&&this.context.clearRect(r,n,a,o);var c=f!==this.context.globalAlpha;c&&(this.context.save(),this.context.globalAlpha=f),this.context.drawImage(h,s,s,h.width-2*s,h.height-2*s,r,n,a,o),c&&this.context.restore(),f!==1?e.animate=!0:l&&t.endTransition(u)}},Be.prototype.getImage=function(){var t=this.context;return t?t.canvas:null},Be.prototype.getLayer,Be.prototype.getImageTransform=function(){return this.imageTransform_};var da={exports:{}};(function(t,e){(function(i,r){t.exports=r()})(Qn,function(){function i(o,s,l,h,u){r(o,s,l||0,h||o.length-1,u||a)}function r(o,s,l,h,u){for(;h>l;){if(h-l>600){var f=h-l+1,c=s-l+1,d=Math.log(f),v=.5*Math.exp(2*d/3),E=.5*Math.sqrt(d*v*(f-v)/f)*(c-f/2<0?-1:1),p=Math.max(l,Math.floor(s-c*v/f+E)),m=Math.min(h,Math.floor(s+(f-c)*v/f+E));r(o,s,p,m,u)}var y=o[s],R=l,C=h;for(n(o,l,s),u(o[h],y)>0&&n(o,l,h);R<C;){for(n(o,R,C),R++,C--;u(o[R],y)<0;)R++;for(;u(o[C],y)>0;)C--}u(o[l],y)===0?n(o,l,C):(C++,n(o,C,h)),C<=s&&(l=C+1),s<=C&&(h=C-1)}}function n(o,s,l){var h=o[s];o[s]=o[l],o[l]=h}function a(o,s){return o<s?-1:o>s?1:0}return i})})(da);var co=da.exports,_o=vn,vo=co;function vn(t,e){if(!(this instanceof vn))return new vn(t,e);this._maxEntries=Math.max(4,t||9),this._minEntries=Math.max(2,Math.ceil(this._maxEntries*.4)),e&&this._initFormat(e),this.clear()}vn.prototype={all:function(){return this._all(this.data,[])},search:function(t){var e=this.data,i=[],r=this.toBBox;if(!gn(t,e))return i;for(var n=[],a,o,s,l;e;){for(a=0,o=e.children.length;a<o;a++)s=e.children[a],l=e.leaf?r(s):s,gn(t,l)&&(e.leaf?i.push(s):Yn(t,l)?this._all(s,i):n.push(s));e=n.pop()}return i},collides:function(t){var e=this.data,i=this.toBBox;if(!gn(t,e))return!1;for(var r=[],n,a,o,s;e;){for(n=0,a=e.children.length;n<a;n++)if(o=e.children[n],s=e.leaf?i(o):o,gn(t,s)){if(e.leaf||Yn(t,s))return!0;r.push(o)}e=r.pop()}return!1},load:function(t){if(!(t&&t.length))return this;if(t.length<this._minEntries){for(var e=0,i=t.length;e<i;e++)this.insert(t[e]);return this}var r=this._build(t.slice(),0,t.length-1,0);if(!this.data.children.length)this.data=r;else if(this.data.height===r.height)this._splitRoot(this.data,r);else{if(this.data.height<r.height){var n=this.data;this.data=r,r=n}this._insert(r,this.data.height-r.height-1,!0)}return this},insert:function(t){return t&&this._insert(t,this.data.height-1),this},clear:function(){return this.data=Br([]),this},remove:function(t,e){if(!t)return this;for(var i=this.data,r=this.toBBox(t),n=[],a=[],o,s,l,h;i||n.length;){if(i||(i=n.pop(),s=n[n.length-1],o=a.pop(),h=!0),i.leaf&&(l=po(t,i.children,e),l!==-1))return i.children.splice(l,1),n.push(i),this._condense(n),this;!h&&!i.leaf&&Yn(i,r)?(n.push(i),a.push(o),o=0,s=i,i=i.children[0]):s?(o++,i=s.children[o],h=!1):i=null}return this},toBBox:function(t){return t},compareMinX:_a,compareMinY:va,toJSON:function(){return this.data},fromJSON:function(t){return this.data=t,this},_all:function(t,e){for(var i=[];t;)t.leaf?e.push.apply(e,t.children):i.push.apply(i,t.children),t=i.pop();return e},_build:function(t,e,i,r){var n=i-e+1,a=this._maxEntries,o;if(n<=a)return o=Br(t.slice(e,i+1)),Ur(o,this.toBBox),o;r||(r=Math.ceil(Math.log(n)/Math.log(a)),a=Math.ceil(n/Math.pow(a,r-1))),o=Br([]),o.leaf=!1,o.height=r;var s=Math.ceil(n/a),l=s*Math.ceil(Math.sqrt(a)),h,u,f,c;for(pa(t,e,i,l,this.compareMinX),h=e;h<=i;h+=l)for(f=Math.min(h+l-1,i),pa(t,h,f,s,this.compareMinY),u=h;u<=f;u+=s)c=Math.min(u+s-1,f),o.children.push(this._build(t,u,c,r-1));return Ur(o,this.toBBox),o},_chooseSubtree:function(t,e,i,r){for(var n,a,o,s,l,h,u,f;r.push(e),!(e.leaf||r.length-1===i);){for(u=f=1/0,n=0,a=e.children.length;n<a;n++)o=e.children[n],l=Xn(o),h=go(t,o)-l,h<f?(f=h,u=l<u?l:u,s=o):h===f&&l<u&&(u=l,s=o);e=s||e.children[0]}return e},_insert:function(t,e,i){var r=this.toBBox,n=i?t:r(t),a=[],o=this._chooseSubtree(n,this.data,e,a);for(o.children.push(t),$r(o,n);e>=0&&a[e].children.length>this._maxEntries;)this._split(a,e),e--;this._adjustParentBBoxes(n,a,e)},_split:function(t,e){var i=t[e],r=i.children.length,n=this._minEntries;this._chooseSplitAxis(i,n,r);var a=this._chooseSplitIndex(i,n,r),o=Br(i.children.splice(a,i.children.length-a));o.height=i.height,o.leaf=i.leaf,Ur(i,this.toBBox),Ur(o,this.toBBox),e?t[e-1].children.push(o):this._splitRoot(i,o)},_splitRoot:function(t,e){this.data=Br([t,e]),this.data.height=t.height+1,this.data.leaf=!1,Ur(this.data,this.toBBox)},_chooseSplitIndex:function(t,e,i){var r,n,a,o,s,l,h,u;for(l=h=1/0,r=e;r<=i-e;r++)n=qr(t,0,r,this.toBBox),a=qr(t,r,i,this.toBBox),o=yo(n,a),s=Xn(n)+Xn(a),o<l?(l=o,u=r,h=s<h?s:h):o===l&&s<h&&(h=s,u=r);return u},_chooseSplitAxis:function(t,e,i){var r=t.leaf?this.compareMinX:_a,n=t.leaf?this.compareMinY:va,a=this._allDistMargin(t,e,i,r),o=this._allDistMargin(t,e,i,n);a<o&&t.children.sort(r)},_allDistMargin:function(t,e,i,r){t.children.sort(r);var n=this.toBBox,a=qr(t,0,e,n),o=qr(t,i-e,i,n),s=pn(a)+pn(o),l,h;for(l=e;l<i-e;l++)h=t.children[l],$r(a,t.leaf?n(h):h),s+=pn(a);for(l=i-e-1;l>=e;l--)h=t.children[l],$r(o,t.leaf?n(h):h),s+=pn(o);return s},_adjustParentBBoxes:function(t,e,i){for(var r=i;r>=0;r--)$r(e[r],t)},_condense:function(t){for(var e=t.length-1,i;e>=0;e--)t[e].children.length===0?e>0?(i=t[e-1].children,i.splice(i.indexOf(t[e]),1)):this.clear():Ur(t[e],this.toBBox)},_initFormat:function(t){var e=["return a"," - b",";"];this.compareMinX=new Function("a","b",e.join(t[0])),this.compareMinY=new Function("a","b",e.join(t[1])),this.toBBox=new Function("a","return {minX: a"+t[0]+", minY: a"+t[1]+", maxX: a"+t[2]+", maxY: a"+t[3]+"};")}};function po(t,e,i){if(!i)return e.indexOf(t);for(var r=0;r<e.length;r++)if(i(t,e[r]))return r;return-1}function Ur(t,e){qr(t,0,t.children.length,e,t)}function qr(t,e,i,r,n){n||(n=Br(null)),n.minX=1/0,n.minY=1/0,n.maxX=-1/0,n.maxY=-1/0;for(var a=e,o;a<i;a++)o=t.children[a],$r(n,t.leaf?r(o):o);return n}function $r(t,e){return t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY),t}function _a(t,e){return t.minX-e.minX}function va(t,e){return t.minY-e.minY}function Xn(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function pn(t){return t.maxX-t.minX+(t.maxY-t.minY)}function go(t,e){return(Math.max(e.maxX,t.maxX)-Math.min(e.minX,t.minX))*(Math.max(e.maxY,t.maxY)-Math.min(e.minY,t.minY))}function yo(t,e){var i=Math.max(t.minX,e.minX),r=Math.max(t.minY,e.minY),n=Math.min(t.maxX,e.maxX),a=Math.min(t.maxY,e.maxY);return Math.max(0,n-i)*Math.max(0,a-r)}function Yn(t,e){return t.minX<=e.minX&&t.minY<=e.minY&&e.maxX<=t.maxX&&e.maxY<=t.maxY}function gn(t,e){return e.minX<=t.maxX&&e.minY<=t.maxY&&e.maxX>=t.minX&&e.maxY>=t.minY}function Br(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function pa(t,e,i,r,n){for(var a=[e,i],o;a.length;)i=a.pop(),e=a.pop(),!(i-e<=r)&&(o=e+Math.ceil((i-e)/r/2)*r,vo(t,o,e,i,n),a.push(e,o,o,i))}const Vn=ta(_o);var Wr=function(){};Wr.prototype.getReplay=function(t,e){},Wr.prototype.isEmpty=function(){};var nt={CIRCLE:"Circle",DEFAULT:"Default",IMAGE:"Image",LINE_STRING:"LineString",POLYGON:"Polygon",TEXT:"Text"},yn={};yn.lineString=function(t,e,i,r){var n=t[e],a=t[e+1],o=0,s;for(s=e+r;s<i;s+=r){var l=t[s],h=t[s+1];o+=Math.sqrt((l-n)*(l-n)+(h-a)*(h-a)),n=l,a=h}return o},yn.linearRing=function(t,e,i,r){var n=yn.lineString(t,e,i,r),a=t[i-r]-t[e],o=t[i-r+1]-t[e+1];return n+=Math.sqrt(a*a+o*o),n};var ga={};ga.lineString=function(t,e,i,r,n,a,o,s){var l=[],h=t[e]>t[i-r],u=n.length,f=t[e],c=t[e+1];e+=r;for(var d=t[e],v=t[e+1],E=0,p=Math.sqrt(Math.pow(d-f,2)+Math.pow(v-c,2)),m="",y=0,R,C,x,I=0;I<u;++I){C=h?u-I-1:I;var D=n.charAt(C);m=h?D+m:m+D;var O=a(m)-y;y+=O;for(var B=o+O/2;e<i-r&&E+p<B;)f=d,c=v,e+=r,d=t[e],v=t[e+1],E+=p,p=Math.sqrt(Math.pow(d-f,2)+Math.pow(v-c,2));var W=B-E,N=Math.atan2(v-c,d-f);if(h&&(N+=N>0?-Math.PI:Math.PI),x!==void 0){var P=N-x;if(P+=P>Math.PI?-2*Math.PI:P<-Math.PI?2*Math.PI:0,Math.abs(P)>s)return null}var $=W/p,b=j.lerp(f,d,$),M=j.lerp(c,v,$);x==N?(h&&(R[0]=b,R[1]=M,R[2]=O/2),R[4]=m):(m=D,y=O,R=[b,M,O/2,N,m],h?l.unshift(R):l.push(R),x=N),o+=O}return l};var J={BEGIN_GEOMETRY:0,BEGIN_PATH:1,CIRCLE:2,CLOSE_PATH:3,CUSTOM:4,DRAW_CHARS:5,DRAW_IMAGE:6,END_GEOMETRY:7,FILL:8,MOVE_TO_LINE_TO:9,SET_FILL_STYLE:10,SET_STROKE_STYLE:11,STROKE:12},Ut={};Ut.ORDER=[nt.POLYGON,nt.CIRCLE,nt.LINE_STRING,nt.IMAGE,nt.TEXT,nt.DEFAULT],Ut.TEXT_ALIGN={},Ut.TEXT_ALIGN.left=0,Ut.TEXT_ALIGN.end=0,Ut.TEXT_ALIGN.center=.5,Ut.TEXT_ALIGN.right=1,Ut.TEXT_ALIGN.start=1,Ut.TEXT_ALIGN.top=0,Ut.TEXT_ALIGN.middle=.5,Ut.TEXT_ALIGN.hanging=.2,Ut.TEXT_ALIGN.alphabetic=.8,Ut.TEXT_ALIGN.ideographic=.8,Ut.TEXT_ALIGN.bottom=1;var gt=function(t,e,i,r,n,a){Kt.call(this),this.declutterTree=a,this.tmpExtent_=g.createEmpty(),this.tolerance=t,this.maxExtent=e,this.overlaps=n,this.pixelRatio=r,this.maxLineWidth=0,this.resolution=i,this.fillOrigin_,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_=null,this.bufferedMaxExtent_=null,this.instructions=[],this.coordinates=[],this.coordinateCache_={},this.renderedTransform_=A.create(),this.hitDetectionInstructions=[],this.pixelCoordinates_=null,this.state={},this.viewRotation_=0,this.tmpLocalTransform_=A.create(),this.resetTransform_=A.create()};_.inherits(gt,Kt),gt.prototype.replayTextBackground_=function(t,e,i,r,n,a,o){t.beginPath(),t.moveTo.apply(t,e),t.lineTo.apply(t,i),t.lineTo.apply(t,r),t.lineTo.apply(t,n),t.lineTo.apply(t,e),a&&(this.fillOrigin_=a[2],this.fill_(t)),o&&(this.setStrokeStyle_(t,o),t.stroke())},gt.prototype.replayImage_=function(t,e,i,r,n,a,o,s,l,h,u,f,c,d,v,E,p,m){var y=p||m,R=this.tmpLocalTransform_;n*=c,a*=c,e-=n,i-=a,d&&(e=Math.round(e),i=Math.round(i));var C=v+h>r.width?r.width-h:v,x=s+u>r.height?r.height-u:s,I=this.tmpExtent_,D=E[3]+C*c+E[1],O=E[0]+x*c+E[2],B=e-E[3],W=i-E[0],N,P,$,b;(y||f!==0)&&(N=[B,W],P=[B+D,W],$=[B+D,W+O],b=[B,W+O]);var M=null;if(f!==0){var F=e+n,X=i+a;M=A.compose(R,F,X,1,1,f,-F,-X),g.createOrUpdateEmpty(I),g.extendCoordinate(I,A.apply(R,N)),g.extendCoordinate(I,A.apply(R,P)),g.extendCoordinate(I,A.apply(R,$)),g.extendCoordinate(I,A.apply(R,b))}else g.createOrUpdate(B,W,B+D,W+O,I);var U=t.canvas,Z=I[0]<=U.width&&I[2]>=0&&I[1]<=U.height&&I[3]>=0;if(o){if(!Z&&o[4]==1)return;g.extend(o,I);var z=Z?[t,M?M.slice(0):null,l,r,h,u,C,x,e,i,c]:null;z&&y&&z.push(p,m,N,P,$,b),o.push(z)}else Z&&(y&&this.replayTextBackground_(t,N,P,$,b,p,m),w.drawImage(t,M,l,r,h,u,C,x,e,i,c))},gt.prototype.applyPixelRatio=function(t){var e=this.pixelRatio;return e==1?t:t.map(function(i){return i*e})},gt.prototype.appendFlatCoordinates=function(t,e,i,r,n,a){var o=this.coordinates.length,s=this.getBufferedMaxExtent();a&&(e+=r);var l=[t[e],t[e+1]],h=[NaN,NaN],u=!0,f,c,d;for(f=e+r;f<i;f+=r)h[0]=t[f],h[1]=t[f+1],d=g.coordinateRelationship(s,h),d!==c?(u&&(this.coordinates[o++]=l[0],this.coordinates[o++]=l[1]),this.coordinates[o++]=h[0],this.coordinates[o++]=h[1],u=!1):d===Ie.INTERSECTING?(this.coordinates[o++]=h[0],this.coordinates[o++]=h[1],u=!1):u=!0,l[0]=h[0],l[1]=h[1],c=d;return(n&&u||f===e+r)&&(this.coordinates[o++]=l[0],this.coordinates[o++]=l[1]),o},gt.prototype.drawCustomCoordinates_=function(t,e,i,r,n){for(var a=0,o=i.length;a<o;++a){var s=i[a],l=this.appendFlatCoordinates(t,e,s,r,!1,!1);n.push(l),e=s}return e},gt.prototype.drawCustom=function(t,e,i){this.beginGeometry(t,e);var r=t.getType(),n=t.getStride(),a=this.coordinates.length,o,s,l,h,u;if(r==K.MULTI_POLYGON){t=t,o=t.getOrientedFlatCoordinates(),h=[];var f=t.getEndss();u=0;for(var c=0,d=f.length;c<d;++c){var v=[];u=this.drawCustomCoordinates_(o,u,f[c],n,v),h.push(v)}this.instructions.push([J.CUSTOM,a,h,t,i,Ni.coordinatesss])}else r==K.POLYGON||r==K.MULTI_LINE_STRING?(l=[],o=r==K.POLYGON?t.getOrientedFlatCoordinates():t.getFlatCoordinates(),u=this.drawCustomCoordinates_(o,0,t.getEnds(),n,l),this.instructions.push([J.CUSTOM,a,l,t,i,Ni.coordinatess])):r==K.LINE_STRING||r==K.MULTI_POINT?(o=t.getFlatCoordinates(),s=this.appendFlatCoordinates(o,0,o.length,n,!1,!1),this.instructions.push([J.CUSTOM,a,s,t,i,Ni.coordinates])):r==K.POINT&&(o=t.getFlatCoordinates(),this.coordinates.push(o[0],o[1]),s=this.coordinates.length,this.instructions.push([J.CUSTOM,a,s,t,i]));this.endGeometry(t,e)},gt.prototype.beginGeometry=function(t,e){this.beginGeometryInstruction1_=[J.BEGIN_GEOMETRY,e,0],this.instructions.push(this.beginGeometryInstruction1_),this.beginGeometryInstruction2_=[J.BEGIN_GEOMETRY,e,0],this.hitDetectionInstructions.push(this.beginGeometryInstruction2_)},gt.prototype.fill_=function(t){if(this.fillOrigin_){var e=A.apply(this.renderedTransform_,this.fillOrigin_.slice());t.translate(e[0],e[1]),t.rotate(this.viewRotation_)}t.fill(),this.fillOrigin_&&t.setTransform.apply(t,w.resetTransform_)},gt.prototype.setStrokeStyle_=function(t,e){t.strokeStyle=e[1],t.lineWidth=e[2],t.lineCap=e[3],t.lineJoin=e[4],t.miterLimit=e[5],_t.CANVAS_LINE_DASH&&(t.lineDashOffset=e[7],t.setLineDash(e[6]))},gt.prototype.renderDeclutter_=function(t,e){if(t&&t.length>5){var i=t[4];if(i==1||i==t.length-5){var r={minX:t[0],minY:t[1],maxX:t[2],maxY:t[3],value:e};if(!this.declutterTree.collides(r)){this.declutterTree.insert(r);for(var n=w.drawImage,a=5,o=t.length;a<o;++a){var s=t[a];s&&(s.length>11&&this.replayTextBackground_(s[0],s[13],s[14],s[15],s[16],s[11],s[12]),n.apply(void 0,s))}}t.length=5,g.createOrUpdateEmpty(t)}}},gt.prototype.replay_=function(t,e,i,r,n,a){var o;this.pixelCoordinates_&&st.equals(e,this.renderedTransform_)?o=this.pixelCoordinates_:(this.pixelCoordinates_||(this.pixelCoordinates_=[]),o=ae.transform2D(this.coordinates,0,this.coordinates.length,2,e,this.pixelCoordinates_),A.setFromArray(this.renderedTransform_,e));for(var s=!ht.isEmpty(i),l=0,h=r.length,u=0,f,c,d,v,E,p,m,y,R,C=0,x=0,I=null,D=null,O=this.coordinateCache_,B=this.viewRotation_,W={context:t,pixelRatio:this.pixelRatio,resolution:this.resolution,rotation:B},N=this.instructions!=r||this.overlaps?0:200;l<h;){var P=r[l],$=P[0],b,M,F;switch($){case J.BEGIN_GEOMETRY:b=P[1],s&&i[_.getUid(b).toString()]||!b.getGeometry()?l=P[2]:a!==void 0&&!g.intersects(a,b.getGeometry().getExtent())?l=P[2]+1:++l;break;case J.BEGIN_PATH:C>N&&(this.fill_(t),C=0),x>N&&(t.stroke(),x=0),!C&&!x&&(t.beginPath(),v=E=NaN),++l;break;case J.CIRCLE:u=P[1];var X=o[u],U=o[u+1],Z=o[u+2],z=o[u+3],Q=Z-X,rt=z-U,ft=Math.sqrt(Q*Q+rt*rt);t.moveTo(X+ft,U),t.arc(X,U,ft,0,2*Math.PI,!0),++l;break;case J.CLOSE_PATH:t.closePath(),++l;break;case J.CUSTOM:u=P[1],f=P[2];var Ct=P[3],yt=P[4],jt=P.length==6?P[5]:void 0;W.geometry=Ct,W.feature=b,l in O||(O[l]=[]);var It=O[l];jt?jt(o,u,f,2,It):(It[0]=o[u],It[1]=o[u+1],It.length=2),yt(It,W),++l;break;case J.DRAW_IMAGE:u=P[1],f=P[2],R=P[3],c=P[4],d=P[5],y=n?null:P[6];var ie=P[7],xe=P[8],Bt=P[9],Ce=P[10],ke=P[11],Fe=P[12],fi=P[13],cr=P[14],ki=P[15],ir,Xi,Ei;for(P.length>16?(ir=P[16],Xi=P[17],Ei=P[18]):(ir=w.defaultPadding,Xi=Ei=!1),ke&&(Fe+=B);u<f;u+=2)this.replayImage_(t,o[u],o[u+1],R,c,d,y,ie,xe,Bt,Ce,Fe,fi,cr,ki,ir,Xi?I:null,Ei?D:null);this.renderDeclutter_(y,b),++l;break;case J.DRAW_CHARS:var wn=P[1],On=P[2],Ir=P[3];y=n?null:P[4];var zn=P[5],Pn=P[6],Mn=P[7],en=P[8],dr=P[9],Dn=P[10],rn=P[11],nn=P[12],Sr=P[13],bn=P[14],Fn=yn.lineString(o,wn,On,2),Nn=en(nn);if(zn||Nn<=Fn){var jn=this.textStates[Sr].textAlign,Zn=(Fn-Nn)*Ut.TEXT_ALIGN[jn],Lr=ga.lineString(o,wn,On,2,nn,en,Zn,Mn);if(Lr){var Yi,_r,Ar,Xe,$e;if(Dn)for(Yi=0,_r=Lr.length;Yi<_r;++Yi)$e=Lr[Yi],Ar=$e[4],Xe=this.getImage(Ar,Sr,"",Dn),c=$e[2]+rn,d=Ir*Xe.height+(.5-Ir)*2*rn-dr,this.replayImage_(t,$e[0],$e[1],Xe,c,d,y,Xe.height,1,0,0,$e[3],bn,!1,Xe.width,w.defaultPadding,null,null);if(Pn)for(Yi=0,_r=Lr.length;Yi<_r;++Yi)$e=Lr[Yi],Ar=$e[4],Xe=this.getImage(Ar,Sr,Pn,""),c=$e[2],d=Ir*Xe.height-dr,this.replayImage_(t,$e[0],$e[1],Xe,c,d,y,Xe.height,1,0,0,$e[3],bn,!1,Xe.width,w.defaultPadding,null,null)}}this.renderDeclutter_(y,b),++l;break;case J.END_GEOMETRY:if(n!==void 0){b=P[1];var Yr=n(b);if(Yr)return Yr}++l;break;case J.FILL:N?C++:this.fill_(t),++l;break;case J.MOVE_TO_LINE_TO:for(u=P[1],f=P[2],M=o[u],F=o[u+1],p=M+.5|0,m=F+.5|0,(p!==v||m!==E)&&(t.moveTo(M,F),v=p,E=m),u+=2;u<f;u+=2)M=o[u],F=o[u+1],p=M+.5|0,m=F+.5|0,(u==f-2||p!==v||m!==E)&&(t.lineTo(M,F),v=p,E=m);++l;break;case J.SET_FILL_STYLE:I=P,this.fillOrigin_=P[2],C&&(this.fill_(t),C=0,x&&(t.stroke(),x=0)),t.fillStyle=P[1],++l;break;case J.SET_STROKE_STYLE:D=P,x&&(t.stroke(),x=0),this.setStrokeStyle_(t,P),++l;break;case J.STROKE:N?x++:t.stroke(),++l;break;default:++l;break}}C&&this.fill_(t),x&&t.stroke()},gt.prototype.replay=function(t,e,i,r){this.viewRotation_=i,this.replay_(t,e,r,this.instructions,void 0,void 0)},gt.prototype.replayHitDetection=function(t,e,i,r,n,a){return this.viewRotation_=i,this.replay_(t,e,r,this.hitDetectionInstructions,n,a)},gt.prototype.reverseHitDetectionInstructions=function(){var t=this.hitDetectionInstructions;t.reverse();var e,i=t.length,r,n,a=-1;for(e=0;e<i;++e)r=t[e],n=r[0],n==J.END_GEOMETRY?a=e:n==J.BEGIN_GEOMETRY&&(r[2]=e,st.reverseSubArray(this.hitDetectionInstructions,a,e),a=-1)},gt.prototype.setFillStrokeStyle=function(t,e){var i=this.state;if(t){var r=t.getColor();i.fillStyle=li.asColorLike(r||w.defaultFillStyle)}else i.fillStyle=void 0;if(e){var n=e.getColor();i.strokeStyle=li.asColorLike(n||w.defaultStrokeStyle);var a=e.getLineCap();i.lineCap=a!==void 0?a:w.defaultLineCap;var o=e.getLineDash();i.lineDash=o?o.slice():w.defaultLineDash;var s=e.getLineDashOffset();i.lineDashOffset=s||w.defaultLineDashOffset;var l=e.getLineJoin();i.lineJoin=l!==void 0?l:w.defaultLineJoin;var h=e.getWidth();i.lineWidth=h!==void 0?h:w.defaultLineWidth;var u=e.getMiterLimit();i.miterLimit=u!==void 0?u:w.defaultMiterLimit,i.lineWidth>this.maxLineWidth&&(this.maxLineWidth=i.lineWidth,this.bufferedMaxExtent_=null)}else i.strokeStyle=void 0,i.lineCap=void 0,i.lineDash=null,i.lineDashOffset=void 0,i.lineJoin=void 0,i.lineWidth=void 0,i.miterLimit=void 0},gt.prototype.applyFill=function(t,e){var i=t.fillStyle,r=[J.SET_FILL_STYLE,i];if(typeof i!="string"){var n=e.getExtent();r.push([n[0],n[3]])}this.instructions.push(r)},gt.prototype.applyStroke=function(t){this.instructions.push([J.SET_STROKE_STYLE,t.strokeStyle,t.lineWidth*this.pixelRatio,t.lineCap,t.lineJoin,t.miterLimit,this.applyPixelRatio(t.lineDash),t.lineDashOffset*this.pixelRatio])},gt.prototype.updateFillStyle=function(t,e,i){var r=t.fillStyle;(typeof r!="string"||t.currentFillStyle!=r)&&(e.call(this,t,i),t.currentFillStyle=r)},gt.prototype.updateStrokeStyle=function(t,e){var i=t.strokeStyle,r=t.lineCap,n=t.lineDash,a=t.lineDashOffset,o=t.lineJoin,s=t.lineWidth,l=t.miterLimit;(t.currentStrokeStyle!=i||t.currentLineCap!=r||n!=t.currentLineDash&&!st.equals(t.currentLineDash,n)||t.currentLineDashOffset!=a||t.currentLineJoin!=o||t.currentLineWidth!=s||t.currentMiterLimit!=l)&&(e.call(this,t),t.currentStrokeStyle=i,t.currentLineCap=r,t.currentLineDash=n,t.currentLineDashOffset=a,t.currentLineJoin=o,t.currentLineWidth=s,t.currentMiterLimit=l)},gt.prototype.endGeometry=function(t,e){this.beginGeometryInstruction1_[2]=this.instructions.length,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_[2]=this.hitDetectionInstructions.length,this.beginGeometryInstruction2_=null;var i=[J.END_GEOMETRY,e];this.instructions.push(i),this.hitDetectionInstructions.push(i)},gt.prototype.finish=_.nullFunction,gt.prototype.getBufferedMaxExtent=function(){if(!this.bufferedMaxExtent_&&(this.bufferedMaxExtent_=g.clone(this.maxExtent),this.maxLineWidth>0)){var t=this.resolution*(this.maxLineWidth+1)/2;g.buffer(this.bufferedMaxExtent_,t,this.bufferedMaxExtent_)}return this.bufferedMaxExtent_};var Er=function(t,e,i,r,n,a){gt.call(this,t,e,i,r,n,a),this.declutterGroup_=null,this.hitDetectionImage_=null,this.image_=null,this.anchorX_=void 0,this.anchorY_=void 0,this.height_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.scale_=void 0,this.snapToPixel_=void 0,this.width_=void 0};_.inherits(Er,gt),Er.prototype.drawCoordinates_=function(t,e,i,r){return this.appendFlatCoordinates(t,e,i,r,!1,!1)},Er.prototype.drawPoint=function(t,e){if(this.image_){this.beginGeometry(t,e);var i=t.getFlatCoordinates(),r=t.getStride(),n=this.coordinates.length,a=this.drawCoordinates_(i,0,i.length,r);this.instructions.push([J.DRAW_IMAGE,n,a,this.image_,this.anchorX_,this.anchorY_,this.declutterGroup_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_*this.pixelRatio,this.snapToPixel_,this.width_]),this.hitDetectionInstructions.push([J.DRAW_IMAGE,n,a,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.declutterGroup_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.snapToPixel_,this.width_]),this.endGeometry(t,e)}},Er.prototype.drawMultiPoint=function(t,e){if(this.image_){this.beginGeometry(t,e);var i=t.getFlatCoordinates(),r=t.getStride(),n=this.coordinates.length,a=this.drawCoordinates_(i,0,i.length,r);this.instructions.push([J.DRAW_IMAGE,n,a,this.image_,this.anchorX_,this.anchorY_,this.declutterGroup_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_*this.pixelRatio,this.snapToPixel_,this.width_]),this.hitDetectionInstructions.push([J.DRAW_IMAGE,n,a,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.declutterGroup_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.snapToPixel_,this.width_]),this.endGeometry(t,e)}},Er.prototype.finish=function(){this.reverseHitDetectionInstructions(),this.anchorX_=void 0,this.anchorY_=void 0,this.hitDetectionImage_=null,this.image_=null,this.height_=void 0,this.scale_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.snapToPixel_=void 0,this.width_=void 0},Er.prototype.setImageStyle=function(t,e){var i=t.getAnchor(),r=t.getSize(),n=t.getHitDetectionImage(1),a=t.getImage(1),o=t.getOrigin();this.anchorX_=i[0],this.anchorY_=i[1],this.declutterGroup_=e,this.hitDetectionImage_=n,this.image_=a,this.height_=r[1],this.opacity_=t.getOpacity(),this.originX_=o[0],this.originY_=o[1],this.rotateWithView_=t.getRotateWithView(),this.rotation_=t.getRotation(),this.scale_=t.getScale(),this.snapToPixel_=t.getSnapToPixel(),this.width_=r[0]};var Tr=function(t,e,i,r,n,a){gt.call(this,t,e,i,r,n,a)};_.inherits(Tr,gt),Tr.prototype.drawFlatCoordinates_=function(t,e,i,r){var n=this.coordinates.length,a=this.appendFlatCoordinates(t,e,i,r,!1,!1),o=[J.MOVE_TO_LINE_TO,n,a];return this.instructions.push(o),this.hitDetectionInstructions.push(o),i},Tr.prototype.drawLineString=function(t,e){var i=this.state,r=i.strokeStyle,n=i.lineWidth;if(!(r===void 0||n===void 0)){this.updateStrokeStyle(i,this.applyStroke),this.beginGeometry(t,e),this.hitDetectionInstructions.push([J.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,i.lineDash,i.lineDashOffset],[J.BEGIN_PATH]);var a=t.getFlatCoordinates(),o=t.getStride();this.drawFlatCoordinates_(a,0,a.length,o),this.hitDetectionInstructions.push([J.STROKE]),this.endGeometry(t,e)}},Tr.prototype.drawMultiLineString=function(t,e){var i=this.state,r=i.strokeStyle,n=i.lineWidth;if(!(r===void 0||n===void 0)){this.updateStrokeStyle(i,this.applyStroke),this.beginGeometry(t,e),this.hitDetectionInstructions.push([J.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,i.lineDash,i.lineDashOffset],[J.BEGIN_PATH]);var a=t.getEnds(),o=t.getFlatCoordinates(),s=t.getStride(),l=0,h,u;for(h=0,u=a.length;h<u;++h)l=this.drawFlatCoordinates_(o,l,a[h],s);this.hitDetectionInstructions.push([J.STROKE]),this.endGeometry(t,e)}},Tr.prototype.finish=function(){var t=this.state;t.lastStroke!=null&&t.lastStroke!=this.coordinates.length&&this.instructions.push([J.STROKE]),this.reverseHitDetectionInstructions(),this.state=null},Tr.prototype.applyStroke=function(t){t.lastStroke!=null&&t.lastStroke!=this.coordinates.length&&(this.instructions.push([J.STROKE]),t.lastStroke=this.coordinates.length),t.lastStroke=0,gt.prototype.applyStroke.call(this,t),this.instructions.push([J.BEGIN_PATH])};var Qi=function(t,e,i,r,n,a){gt.call(this,t,e,i,r,n,a)};_.inherits(Qi,gt),Qi.prototype.drawFlatCoordinatess_=function(t,e,i,r){var n=this.state,a=n.fillStyle!==void 0,o=n.strokeStyle!=null,s=i.length,l=[J.BEGIN_PATH];this.instructions.push(l),this.hitDetectionInstructions.push(l);for(var h=0;h<s;++h){var u=i[h],f=this.coordinates.length,c=this.appendFlatCoordinates(t,e,u,r,!0,!o),d=[J.MOVE_TO_LINE_TO,f,c];if(this.instructions.push(d),this.hitDetectionInstructions.push(d),o){var v=[J.CLOSE_PATH];this.instructions.push(v),this.hitDetectionInstructions.push(v)}e=u}var E=[J.FILL];if(this.hitDetectionInstructions.push(E),a&&this.instructions.push(E),o){var p=[J.STROKE];this.instructions.push(p),this.hitDetectionInstructions.push(p)}return e},Qi.prototype.drawCircle=function(t,e){var i=this.state,r=i.fillStyle,n=i.strokeStyle;if(!(r===void 0&&n===void 0)){this.setFillStrokeStyles_(t),this.beginGeometry(t,e),this.hitDetectionInstructions.push([J.SET_FILL_STYLE,Xt.asString(w.defaultFillStyle)]),i.strokeStyle!==void 0&&this.hitDetectionInstructions.push([J.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,i.lineDash,i.lineDashOffset]);var a=t.getFlatCoordinates(),o=t.getStride(),s=this.coordinates.length;this.appendFlatCoordinates(a,0,a.length,o,!1,!1);var l=[J.BEGIN_PATH],h=[J.CIRCLE,s];this.instructions.push(l,h),this.hitDetectionInstructions.push(l,h);var u=[J.FILL];if(this.hitDetectionInstructions.push(u),i.fillStyle!==void 0&&this.instructions.push(u),i.strokeStyle!==void 0){var f=[J.STROKE];this.instructions.push(f),this.hitDetectionInstructions.push(f)}this.endGeometry(t,e)}},Qi.prototype.drawPolygon=function(t,e){var i=this.state;this.setFillStrokeStyles_(t),this.beginGeometry(t,e),this.hitDetectionInstructions.push([J.SET_FILL_STYLE,Xt.asString(w.defaultFillStyle)]),i.strokeStyle!==void 0&&this.hitDetectionInstructions.push([J.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,i.lineDash,i.lineDashOffset]);var r=t.getEnds(),n=t.getOrientedFlatCoordinates(),a=t.getStride();this.drawFlatCoordinatess_(n,0,r,a),this.endGeometry(t,e)},Qi.prototype.drawMultiPolygon=function(t,e){var i=this.state,r=i.fillStyle,n=i.strokeStyle;if(!(r===void 0&&n===void 0)){this.setFillStrokeStyles_(t),this.beginGeometry(t,e),this.hitDetectionInstructions.push([J.SET_FILL_STYLE,Xt.asString(w.defaultFillStyle)]),i.strokeStyle!==void 0&&this.hitDetectionInstructions.push([J.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,i.lineDash,i.lineDashOffset]);var a=t.getEndss(),o=t.getOrientedFlatCoordinates(),s=t.getStride(),l=0,h,u;for(h=0,u=a.length;h<u;++h)l=this.drawFlatCoordinatess_(o,l,a[h],s);this.endGeometry(t,e)}},Qi.prototype.finish=function(){this.reverseHitDetectionInstructions(),this.state=null;var t=this.tolerance;if(t!==0){var e=this.coordinates,i,r;for(i=0,r=e.length;i<r;++i)e[i]=Ht.snap(e[i],t)}},Qi.prototype.setFillStrokeStyles_=function(t){var e=this.state,i=e.fillStyle;i!==void 0&&this.updateFillStyle(e,this.applyFill,t),e.strokeStyle!==void 0&&this.updateStrokeStyle(e,this.applyStroke)};var ya={};ya.lineString=function(t,e,i,r,n){var a=i,o=i,s=0,l=0,h=i,u,f,c,d,v,E,p,m,y,R;for(f=i;f<r;f+=n){var C=e[f],x=e[f+1];v!==void 0&&(y=C-v,R=x-E,d=Math.sqrt(y*y+R*R),p!==void 0&&(l+=c,u=Math.acos((p*y+m*R)/(c*d)),u>t&&(l>s&&(s=l,a=h,o=f),l=0,h=f-n)),c=d,p=y,m=R),v=C,E=x}return l+=d,l>s?[h,f]:[a,o]};var mo={POINT:"point",LINE:"line"},tr=function(t,e,i,r,n,a){gt.call(this,t,e,i,r,n,a),this.declutterGroup_,this.labels_=null,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=void 0,this.textRotation_=0,this.textFillState_=null,this.fillStates={},this.textStrokeState_=null,this.strokeStates={},this.textState_={},this.textStates={},this.textKey_="",this.fillKey_="",this.strokeKey_="",this.widths_={};var o=w.labelCache;o.prune()};_.inherits(tr,gt),tr.measureTextWidths=function(t,e,i){var r=e.length,n=0,a,o;for(o=0;o<r;++o)a=w.measureTextWidth(t,e[o]),n=Math.max(n,a),i.push(a);return n},tr.prototype.drawText=function(t,e){var i=this.textFillState_,r=this.textStrokeState_,n=this.textState_;if(!(this.text_===""||!n||!i&&!r)){var a=this.coordinates.length,o=t.getType(),s=null,l=2,h=2,u,f;if(n.placement===mo.LINE){if(!g.intersects(this.getBufferedMaxExtent(),t.getExtent()))return;var c;if(s=t.getFlatCoordinates(),h=t.getStride(),o==K.LINE_STRING)c=[s.length];else if(o==K.MULTI_LINE_STRING)c=t.getEnds();else if(o==K.POLYGON)c=t.getEnds().slice(0,1);else if(o==K.MULTI_POLYGON){var d=t.getEndss();for(c=[],u=0,f=d.length;u<f;++u)c.push(d[u][0])}this.beginGeometry(t,e);for(var v=n.textAlign,E=0,p,m=0,y=c.length;m<y;++m){if(v==null){var R=ya.lineString(n.maxAngle,s,E,c[m],h);E=R[0],p=R[1]}else p=c[m];for(u=E;u<p;u+=h)this.coordinates.push(s[u],s[u+1]);l=this.coordinates.length,E=c[m],this.drawChars_(a,l,this.declutterGroup_),a=l}this.endGeometry(t,e)}else{var C=this.getImage(this.text_,this.textKey_,this.fillKey_,this.strokeKey_),x=C.width/this.pixelRatio;switch(o){case K.POINT:case K.MULTI_POINT:s=t.getFlatCoordinates(),l=s.length;break;case K.LINE_STRING:s=t.getFlatMidpoint();break;case K.CIRCLE:s=t.getCenter();break;case K.MULTI_LINE_STRING:s=t.getFlatMidpoints(),l=s.length;break;case K.POLYGON:if(s=t.getFlatInteriorPoint(),!n.overflow&&s[2]/this.resolution<x)return;h=3;break;case K.MULTI_POLYGON:var I=t.getFlatInteriorPoints();for(s=[],u=0,f=I.length;u<f;u+=3)(n.overflow||I[u+2]/this.resolution>=x)&&s.push(I[u],I[u+1]);if(l=s.length,l==0)return;break}l=this.appendFlatCoordinates(s,0,l,h,!1,!1),this.beginGeometry(t,e),(n.backgroundFill||n.backgroundStroke)&&(this.setFillStrokeStyle(n.backgroundFill,n.backgroundStroke),this.updateFillStyle(this.state,this.applyFill,t),this.updateStrokeStyle(this.state,this.applyStroke)),this.drawTextImage_(C,a,l),this.endGeometry(t,e)}}},tr.prototype.getImage=function(t,e,i,r){var n,a=r+e+t+i+this.pixelRatio,o=w.labelCache;if(!o.containsKey(a)){var s=r?this.strokeStates[r]||this.textStrokeState_:null,l=i?this.fillStates[i]||this.textFillState_:null,h=this.textStates[e]||this.textState_,u=this.pixelRatio,f=h.scale*u,c=Ut.TEXT_ALIGN[h.textAlign||w.defaultTextAlign],d=r&&s.lineWidth?s.lineWidth:0,v=t.split(`
`),E=v.length,p=[],m=tr.measureTextWidths(h.font,v,p),y=w.measureTextHeight(h.font),R=y*E,C=m+d,x=At.createCanvasContext2D(Math.ceil(C*f),Math.ceil((R+d)*f));n=x.canvas,o.set(a,n),f!=1&&x.scale(f,f),x.font=h.font,r&&(x.strokeStyle=s.strokeStyle,x.lineWidth=d*(_t.SAFARI?f:1),x.lineCap=s.lineCap,x.lineJoin=s.lineJoin,x.miterLimit=s.miterLimit,_t.CANVAS_LINE_DASH&&s.lineDash.length&&(x.setLineDash(s.lineDash),x.lineDashOffset=s.lineDashOffset)),i&&(x.fillStyle=l.fillStyle),x.textBaseline="middle",x.textAlign="center";var I=.5-c,D=c*n.width/f+I*d,O;if(r)for(O=0;O<E;++O)x.strokeText(v[O],D+I*p[O],.5*(d+y)+O*y);if(i)for(O=0;O<E;++O)x.fillText(v[O],D+I*p[O],.5*(d+y)+O*y)}return o.get(a)},tr.prototype.drawTextImage_=function(t,e,i){var r=this.textState_,n=this.textStrokeState_,a=this.pixelRatio,o=Ut.TEXT_ALIGN[r.textAlign||w.defaultTextAlign],s=Ut.TEXT_ALIGN[r.textBaseline],l=n&&n.lineWidth?n.lineWidth:0,h=o*t.width/a+2*(.5-o)*l,u=s*t.height/a+2*(.5-s)*l;this.instructions.push([J.DRAW_IMAGE,e,i,t,(h-this.textOffsetX_)*a,(u-this.textOffsetY_)*a,this.declutterGroup_,t.height,1,0,0,this.textRotateWithView_,this.textRotation_,1,!0,t.width,r.padding==w.defaultPadding?w.defaultPadding:r.padding.map(function(f){return f*a}),!!r.backgroundFill,!!r.backgroundStroke]),this.hitDetectionInstructions.push([J.DRAW_IMAGE,e,i,t,(h-this.textOffsetX_)*a,(u-this.textOffsetY_)*a,this.declutterGroup_,t.height,1,0,0,this.textRotateWithView_,this.textRotation_,1/a,!0,t.width,r.padding,!!r.backgroundFill,!!r.backgroundStroke])},tr.prototype.drawChars_=function(t,e,i){var r=this.textStrokeState_,n=this.textState_,a=this.textFillState_,o=this.strokeKey_;r&&(o in this.strokeStates||(this.strokeStates[o]={strokeStyle:r.strokeStyle,lineCap:r.lineCap,lineDashOffset:r.lineDashOffset,lineWidth:r.lineWidth,lineJoin:r.lineJoin,miterLimit:r.miterLimit,lineDash:r.lineDash}));var s=this.textKey_;this.textKey_ in this.textStates||(this.textStates[this.textKey_]={font:n.font,textAlign:n.textAlign||w.defaultTextAlign,scale:n.scale});var l=this.fillKey_;a&&(l in this.fillStates||(this.fillStates[l]={fillStyle:a.fillStyle}));var h=this.pixelRatio,u=Ut.TEXT_ALIGN[n.textBaseline],f=this.textOffsetY_*h,c=this.text_,d=n.font,v=n.scale,E=r?r.lineWidth*v/2:0,p=this.widths_[d];p||(this.widths_[d]=p={}),this.instructions.push([J.DRAW_CHARS,t,e,u,i,n.overflow,l,n.maxAngle,function(m){var y=p[m];return y||(y=p[m]=w.measureTextWidth(d,m)),y*v*h},f,o,E*h,c,s,1]),this.hitDetectionInstructions.push([J.DRAW_CHARS,t,e,u,i,n.overflow,l,n.maxAngle,function(m){var y=p[m];return y||(y=p[m]=w.measureTextWidth(d,m)),y*v},f,o,E,c,s,1/h])},tr.prototype.setTextStyle=function(t,e){var i,r,n;if(!t)this.text_="";else{this.declutterGroup_=e;var a=t.getFill();a?(r=this.textFillState_,r||(r=this.textFillState_={}),r.fillStyle=li.asColorLike(a.getColor()||w.defaultFillStyle)):r=this.textFillState_=null;var o=t.getStroke();if(!o)n=this.textStrokeState_=null;else{n=this.textStrokeState_,n||(n=this.textStrokeState_={});var s=o.getLineDash(),l=o.getLineDashOffset(),h=o.getWidth(),u=o.getMiterLimit();n.lineCap=o.getLineCap()||w.defaultLineCap,n.lineDash=s?s.slice():w.defaultLineDash,n.lineDashOffset=l===void 0?w.defaultLineDashOffset:l,n.lineJoin=o.getLineJoin()||w.defaultLineJoin,n.lineWidth=h===void 0?w.defaultLineWidth:h,n.miterLimit=u===void 0?w.defaultMiterLimit:u,n.strokeStyle=li.asColorLike(o.getColor()||w.defaultStrokeStyle)}i=this.textState_;var f=t.getFont()||w.defaultFont;w.checkFont(f);var c=t.getScale();i.overflow=t.getOverflow(),i.font=f,i.maxAngle=t.getMaxAngle(),i.placement=t.getPlacement(),i.textAlign=t.getTextAlign(),i.textBaseline=t.getTextBaseline()||w.defaultTextBaseline,i.backgroundFill=t.getBackgroundFill(),i.backgroundStroke=t.getBackgroundStroke(),i.padding=t.getPadding()||w.defaultPadding,i.scale=c===void 0?1:c;var d=t.getOffsetX(),v=t.getOffsetY(),E=t.getRotateWithView(),p=t.getRotation();this.text_=t.getText()||"",this.textOffsetX_=d===void 0?0:d,this.textOffsetY_=v===void 0?0:v,this.textRotateWithView_=E===void 0?!1:E,this.textRotation_=p===void 0?0:p,this.strokeKey_=n?(typeof n.strokeStyle=="string"?n.strokeStyle:_.getUid(n.strokeStyle))+n.lineCap+n.lineDashOffset+"|"+n.lineWidth+n.lineJoin+n.miterLimit+"["+n.lineDash.join()+"]":"",this.textKey_=i.font+i.scale+(i.textAlign||"?"),this.fillKey_=r?typeof r.fillStyle=="string"?r.fillStyle:"|"+_.getUid(r.fillStyle):""}};var xt=function(t,e,i,r,n,a,o){Wr.call(this),this.declutterTree_=a,this.declutterGroup_=null,this.tolerance_=t,this.maxExtent_=e,this.overlaps_=n,this.pixelRatio_=r,this.resolution_=i,this.renderBuffer_=o,this.replaysByZIndex_={},this.hitDetectionContext_=At.createCanvasContext2D(1,1),this.hitDetectionTransform_=A.create()};_.inherits(xt,Wr),xt.circleArrayCache_={0:[[!0]]},xt.fillCircleArrayRowToMiddle_=function(t,e,i){var r,n=Math.floor(t.length/2);if(e>=n)for(r=n;r<e;r++)t[r][i]=!0;else if(e<n)for(r=e+1;r<n;r++)t[r][i]=!0},xt.getCircleArray_=function(t){if(xt.circleArrayCache_[t]!==void 0)return xt.circleArrayCache_[t];for(var e=t*2+1,i=new Array(e),r=0;r<e;r++)i[r]=new Array(e);for(var n=t,a=0,o=0;n>=a;)xt.fillCircleArrayRowToMiddle_(i,t+n,t+a),xt.fillCircleArrayRowToMiddle_(i,t+a,t+n),xt.fillCircleArrayRowToMiddle_(i,t-a,t+n),xt.fillCircleArrayRowToMiddle_(i,t-n,t+a),xt.fillCircleArrayRowToMiddle_(i,t-n,t-a),xt.fillCircleArrayRowToMiddle_(i,t-a,t-n),xt.fillCircleArrayRowToMiddle_(i,t+a,t-n),xt.fillCircleArrayRowToMiddle_(i,t+n,t-a),a++,o+=1+2*a,2*(o-n)+1>0&&(n-=1,o+=1-2*n);return xt.circleArrayCache_[t]=i,i},xt.replayDeclutter=function(t,e,i){for(var r=Object.keys(t).map(Number).sort(st.numberSafeCompareFunction),n={},a=0,o=r.length;a<o;++a)for(var s=t[r[a].toString()],l=0,h=s.length;l<h;){var u=s[l++],f=s[l++];u.replay(e,f,i,n)}},xt.prototype.addDeclutter=function(t){var e=null;return this.declutterTree_&&(t?(e=this.declutterGroup_,e[4]++):(e=this.declutterGroup_=g.createEmpty(),e.push(1))),e},xt.prototype.clip=function(t,e){var i=this.getClipCoords(e);t.beginPath(),t.moveTo(i[0],i[1]),t.lineTo(i[2],i[3]),t.lineTo(i[4],i[5]),t.lineTo(i[6],i[7]),t.clip()},xt.prototype.hasReplays=function(t){for(var e in this.replaysByZIndex_)for(var i=this.replaysByZIndex_[e],r=0,n=t.length;r<n;++r)if(t[r]in i)return!0;return!1},xt.prototype.finish=function(){var t;for(t in this.replaysByZIndex_){var e=this.replaysByZIndex_[t],i;for(i in e)e[i].finish()}},xt.prototype.forEachFeatureAtCoordinate=function(t,e,i,r,n,a,o){r=Math.round(r);var s=r*2+1,l=A.compose(this.hitDetectionTransform_,r+.5,r+.5,1/e,-1/e,-i,-t[0],-t[1]),h=this.hitDetectionContext_;h.canvas.width!==s||h.canvas.height!==s?(h.canvas.width=s,h.canvas.height=s):h.clearRect(0,0,s,s);var u;this.renderBuffer_!==void 0&&(u=g.createEmpty(),g.extendCoordinate(u,t),g.buffer(u,e*(this.renderBuffer_+r),u));var f=xt.getCircleArray_(r),c;this.declutterTree_&&(c=this.declutterTree_.all().map(function(D){return D.value}));var d;function v(D){for(var O=h.getImageData(0,0,s,s).data,B=0;B<s;B++)for(var W=0;W<s;W++)if(f[B][W]&&O[(W*s+B)*4+3]>0){var N;if((!(c&&(d==nt.IMAGE||d==nt.TEXT))||c.indexOf(D)!==-1)&&(N=a(D)),N)return N;h.clearRect(0,0,s,s);return}}var E=Object.keys(this.replaysByZIndex_).map(Number);E.sort(st.numberSafeCompareFunction);var p,m,y,R,C;for(p=E.length-1;p>=0;--p){var x=E[p].toString();for(y=this.replaysByZIndex_[x],m=Ut.ORDER.length-1;m>=0;--m)if(d=Ut.ORDER[m],R=y[d],R!==void 0){if(o&&(d==nt.IMAGE||d==nt.TEXT)){var I=o[x];I?I.push(R,l.slice(0)):o[x]=[R,l.slice(0)]}else if(C=R.replayHitDetection(h,l,i,n,v,u),C)return C}}},xt.prototype.getClipCoords=function(t){var e=this.maxExtent_,i=e[0],r=e[1],n=e[2],a=e[3],o=[i,r,i,a,n,a,n,r];return ae.transform2D(o,0,8,2,t,o),o},xt.prototype.getReplay=function(t,e){var i=t!==void 0?t.toString():"0",r=this.replaysByZIndex_[i];r===void 0&&(r={},this.replaysByZIndex_[i]=r);var n=r[e];if(n===void 0){var a=xt.BATCH_CONSTRUCTORS_[e];n=new a(this.tolerance_,this.maxExtent_,this.resolution_,this.pixelRatio_,this.overlaps_,this.declutterTree_),r[e]=n}return n},xt.prototype.getReplays=function(){return this.replaysByZIndex_},xt.prototype.isEmpty=function(){return ht.isEmpty(this.replaysByZIndex_)},xt.prototype.replay=function(t,e,i,r,n,a){var o=Object.keys(this.replaysByZIndex_).map(Number);o.sort(st.numberSafeCompareFunction),t.save(),this.clip(t,e);var s=n||Ut.ORDER,l,h,u,f,c,d;for(l=0,h=o.length;l<h;++l){var v=o[l].toString();for(c=this.replaysByZIndex_[v],u=0,f=s.length;u<f;++u){var E=s[u];if(d=c[E],d!==void 0)if(a&&(E==nt.IMAGE||E==nt.TEXT)){var p=a[v];p?p.push(d,e.slice(0)):a[v]=[d,e.slice(0)]}else d.replay(t,e,i,r)}}t.restore()},xt.BATCH_CONSTRUCTORS_={Circle:Qi,Default:gt,Image:Er,LineString:Tr,Polygon:Qi,Text:tr};var ot={};ot.defaultOrder=function(t,e){return _.getUid(t)-_.getUid(e)},ot.getSquaredTolerance=function(t,e){var i=ot.getTolerance(t,e);return i*i},ot.getTolerance=function(t,e){return _.SIMPLIFY_TOLERANCE*t/e},ot.renderCircleGeometry_=function(t,e,i,r){var n=i.getFill(),a=i.getStroke();if(n||a){var o=t.getReplay(i.getZIndex(),nt.CIRCLE);o.setFillStrokeStyle(n,a),o.drawCircle(e,r)}var s=i.getText();if(s){var l=t.getReplay(i.getZIndex(),nt.TEXT);l.setTextStyle(s,t.addDeclutter(!1)),l.drawText(e,r)}},ot.renderFeature=function(t,e,i,r,n,a){var o=!1,s,l;return s=i.getImage(),s&&(l=s.getImageState(),l==Ke.LOADED||l==Ke.ERROR?s.unlistenImageChange(n,a):(l==Ke.IDLE&&s.load(),l=s.getImageState(),s.listenImageChange(n,a),o=!0)),ot.renderFeature_(t,e,i,r),o},ot.renderFeature_=function(t,e,i,r){var n=i.getGeometryFunction()(e);if(n){var a=n.getSimplifiedGeometry(r),o=i.getRenderer();if(o)ot.renderGeometry_(t,a,i,e);else{var s=ot.GEOMETRY_RENDERERS_[a.getType()];s(t,a,i,e)}}},ot.renderGeometry_=function(t,e,i,r){if(e.getType()==K.GEOMETRY_COLLECTION){for(var n=e.getGeometries(),a=0,o=n.length;a<o;++a)ot.renderGeometry_(t,n[a],i,r);return}var s=t.getReplay(i.getZIndex(),nt.DEFAULT);s.drawCustom(e,r,i.getRenderer())},ot.renderGeometryCollectionGeometry_=function(t,e,i,r){var n=e.getGeometriesArray(),a,o;for(a=0,o=n.length;a<o;++a){var s=ot.GEOMETRY_RENDERERS_[n[a].getType()];s(t,n[a],i,r)}},ot.renderLineStringGeometry_=function(t,e,i,r){var n=i.getStroke();if(n){var a=t.getReplay(i.getZIndex(),nt.LINE_STRING);a.setFillStrokeStyle(null,n),a.drawLineString(e,r)}var o=i.getText();if(o){var s=t.getReplay(i.getZIndex(),nt.TEXT);s.setTextStyle(o,t.addDeclutter(!1)),s.drawText(e,r)}},ot.renderMultiLineStringGeometry_=function(t,e,i,r){var n=i.getStroke();if(n){var a=t.getReplay(i.getZIndex(),nt.LINE_STRING);a.setFillStrokeStyle(null,n),a.drawMultiLineString(e,r)}var o=i.getText();if(o){var s=t.getReplay(i.getZIndex(),nt.TEXT);s.setTextStyle(o,t.addDeclutter(!1)),s.drawText(e,r)}},ot.renderMultiPolygonGeometry_=function(t,e,i,r){var n=i.getFill(),a=i.getStroke();if(a||n){var o=t.getReplay(i.getZIndex(),nt.POLYGON);o.setFillStrokeStyle(n,a),o.drawMultiPolygon(e,r)}var s=i.getText();if(s){var l=t.getReplay(i.getZIndex(),nt.TEXT);l.setTextStyle(s,t.addDeclutter(!1)),l.drawText(e,r)}},ot.renderPointGeometry_=function(t,e,i,r){var n=i.getImage();if(n){if(n.getImageState()!=Ke.LOADED)return;var a=t.getReplay(i.getZIndex(),nt.IMAGE);a.setImageStyle(n,t.addDeclutter(!1)),a.drawPoint(e,r)}var o=i.getText();if(o){var s=t.getReplay(i.getZIndex(),nt.TEXT);s.setTextStyle(o,t.addDeclutter(!!n)),s.drawText(e,r)}},ot.renderMultiPointGeometry_=function(t,e,i,r){var n=i.getImage();if(n){if(n.getImageState()!=Ke.LOADED)return;var a=t.getReplay(i.getZIndex(),nt.IMAGE);a.setImageStyle(n,t.addDeclutter(!1)),a.drawMultiPoint(e,r)}var o=i.getText();if(o){var s=t.getReplay(i.getZIndex(),nt.TEXT);s.setTextStyle(o,t.addDeclutter(!!n)),s.drawText(e,r)}},ot.renderPolygonGeometry_=function(t,e,i,r){var n=i.getFill(),a=i.getStroke();if(n||a){var o=t.getReplay(i.getZIndex(),nt.POLYGON);o.setFillStrokeStyle(n,a),o.drawPolygon(e,r)}var s=i.getText();if(s){var l=t.getReplay(i.getZIndex(),nt.TEXT);l.setTextStyle(s,t.addDeclutter(!1)),l.drawText(e,r)}},ot.GEOMETRY_RENDERERS_={Point:ot.renderPointGeometry_,LineString:ot.renderLineStringGeometry_,Polygon:ot.renderPolygonGeometry_,MultiPoint:ot.renderMultiPointGeometry_,MultiLineString:ot.renderMultiLineStringGeometry_,MultiPolygon:ot.renderMultiPolygonGeometry_,GeometryCollection:ot.renderGeometryCollectionGeometry_,Circle:ot.renderCircleGeometry_};var pi=function(t){je.call(this,t),this.declutterTree_=t.getDeclutter()?Vn(9):null,this.dirty_=!1,this.renderedRevision_=-1,this.renderedResolution_=NaN,this.renderedExtent_=g.createEmpty(),this.renderedRenderOrder_=null,this.replayGroup_=null,this.replayGroupChanged=!0,this.context=At.createCanvasContext2D(),L.listen(w.labelCache,tt.CLEAR,this.handleFontsChanged_,this)};_.inherits(pi,je),pi.handles=function(t,e){return t===ri.CANVAS&&e.getType()===Pi.VECTOR},pi.create=function(t,e){return new pi(e)},pi.prototype.disposeInternal=function(){L.unlisten(w.labelCache,tt.CLEAR,this.handleFontsChanged_,this),je.prototype.disposeInternal.call(this)},pi.prototype.composeFrame=function(t,e,i){var r=t.extent,n=t.pixelRatio,a=e.managed?t.skippedFeatureUids:{},o=t.viewState,s=o.projection,l=o.rotation,h=s.getExtent(),u=this.getLayer().getSource(),f=this.getTransform(t,0);this.preCompose(i,t,f);var c=e.extent,d=c!==void 0;d&&this.clip(i,t,c);var v=this.replayGroup_;if(v&&!v.isEmpty()){this.declutterTree_&&this.declutterTree_.clear();var E=this.getLayer(),p=0,m=0,y,R=e.opacity!==1,C=E.hasListener(Ri.RENDER);if(R||C){var x=i.canvas.width,I=i.canvas.height;if(l){var D=Math.round(Math.sqrt(x*x+I*I));p=(D-x)/2,m=(D-I)/2,x=I=D}this.context.canvas.width=x,this.context.canvas.height=I,y=this.context}else y=i;var O=y.globalAlpha;R||(y.globalAlpha=e.opacity),y!=i&&y.translate(p,m);var B=t.size[0]*n,W=t.size[1]*n;if(w.rotateAtOffset(y,-l,B/2,W/2),v.replay(y,f,l,a),u.getWrapX()&&s.canWrapX()&&!g.containsExtent(h,r)){for(var N=r[0],P=g.getWidth(h),$=0,b;N<h[0];)--$,b=P*$,f=this.getTransform(t,b),v.replay(y,f,l,a),N+=P;for($=0,N=r[2];N>h[2];)++$,b=P*$,f=this.getTransform(t,b),v.replay(y,f,l,a),N-=P;f=this.getTransform(t,0)}if(w.rotateAtOffset(y,l,B/2,W/2),y!=i){if(C&&this.dispatchRenderEvent(y,t,f),R){var M=i.globalAlpha;i.globalAlpha=e.opacity,i.drawImage(y.canvas,-p,-m),i.globalAlpha=M}else i.drawImage(y.canvas,-p,-m);y.translate(-p,-m)}R||(y.globalAlpha=O)}d&&i.restore(),this.postCompose(i,t,e,f)},pi.prototype.forEachFeatureAtCoordinate=function(t,e,i,r,n){if(this.replayGroup_){var a=e.viewState.resolution,o=e.viewState.rotation,s=this.getLayer(),l={},h=this.replayGroup_.forEachFeatureAtCoordinate(t,a,o,i,{},function(u){var f=_.getUid(u).toString();if(!(f in l))return l[f]=!0,r.call(n,u,s)},null);return h}else return},pi.prototype.handleFontsChanged_=function(t){var e=this.getLayer();e.getVisible()&&this.replayGroup_&&e.changed()},pi.prototype.handleStyleImageChange_=function(t){this.renderIfReadyAndVisible()},pi.prototype.prepareFrame=function(t,e){var i=this.getLayer(),r=i.getSource();this.updateLogos(t,r);var n=t.viewHints[Pt.ANIMATING],a=t.viewHints[Pt.INTERACTING],o=i.getUpdateWhileAnimating(),s=i.getUpdateWhileInteracting();if(!this.dirty_&&!o&&n||!s&&a)return!0;var l=t.extent,h=t.viewState,u=h.projection,f=h.resolution,c=t.pixelRatio,d=i.getRevision(),v=i.getRenderBuffer(),E=i.getRenderOrder();E===void 0&&(E=ot.defaultOrder);var p=g.buffer(l,v*f),m=h.projection.getExtent();if(r.getWrapX()&&h.projection.canWrapX()&&!g.containsExtent(m,t.extent)){var y=g.getWidth(m),R=Math.max(g.getWidth(p)/2,y);p[0]=m[0]-R,p[2]=m[2]+R}if(!this.dirty_&&this.renderedResolution_==f&&this.renderedRevision_==d&&this.renderedRenderOrder_==E&&g.containsExtent(this.renderedExtent_,p))return this.replayGroupChanged=!1,!0;this.replayGroup_=null,this.dirty_=!1;var C=new xt(ot.getTolerance(f,c),p,f,c,r.getOverlaps(),this.declutterTree_,i.getRenderBuffer());r.loadFeatures(p,f,u);var x=(function(B){var W,N=B.getStyleFunction();if(N?W=N.call(B,f):(N=i.getStyleFunction(),N&&(W=N(B,f))),W){var P=this.renderFeature(B,f,c,W,C);this.dirty_=this.dirty_||P}}).bind(this);if(E){var I=[];r.forEachFeatureInExtent(p,function(B){I.push(B)},this),I.sort(E);for(var D=0,O=I.length;D<O;++D)x(I[D])}else r.forEachFeatureInExtent(p,x,this);return C.finish(),this.renderedResolution_=f,this.renderedRevision_=d,this.renderedRenderOrder_=E,this.renderedExtent_=p,this.replayGroup_=C,this.replayGroupChanged=!0,!0},pi.prototype.renderFeature=function(t,e,i,r,n){if(!r)return!1;var a=!1;if(Array.isArray(r))for(var o=0,s=r.length;o<s;++o)a=ot.renderFeature(n,t,r[o],ot.getSquaredTolerance(e,i),this.handleStyleImageChange_,this)||a;else a=ot.renderFeature(n,t,r,ot.getSquaredTolerance(e,i),this.handleStyleImageChange_,this);return a};var mn={IMAGE:"image",HYBRID:"hybrid",VECTOR:"vector"},ge=function(t){this.context=null,Be.call(this,t),this.declutterTree_=t.getDeclutter()?Vn(9):null,this.dirty_=!1,this.renderedLayerRevision_,this.tmpTransform_=A.create(),this.zDirection=t.getRenderMode()==mn.VECTOR?1:0,L.listen(w.labelCache,tt.CLEAR,this.handleFontsChanged_,this)};_.inherits(ge,Be),ge.handles=function(t,e){return t===ri.CANVAS&&e.getType()===Pi.VECTOR_TILE},ge.create=function(t,e){return new ge(e)},ge.IMAGE_REPLAYS={image:[nt.POLYGON,nt.CIRCLE,nt.LINE_STRING,nt.IMAGE,nt.TEXT],hybrid:[nt.POLYGON,nt.LINE_STRING]},ge.VECTOR_REPLAYS={image:[nt.DEFAULT],hybrid:[nt.IMAGE,nt.TEXT,nt.DEFAULT],vector:Ut.ORDER},ge.prototype.disposeInternal=function(){L.unlisten(w.labelCache,tt.CLEAR,this.handleFontsChanged_,this),Be.prototype.disposeInternal.call(this)},ge.prototype.prepareFrame=function(t,e){var i=this.getLayer(),r=i.getRevision();if(this.renderedLayerRevision_!=r){this.renderedTiles.length=0;var n=i.getRenderMode();!this.context&&n!=mn.VECTOR&&(this.context=At.createCanvasContext2D()),this.context&&n==mn.VECTOR&&(this.context=null)}return this.renderedLayerRevision_=r,Be.prototype.prepareFrame.apply(this,arguments)},ge.prototype.createReplayGroup_=function(t,e){var i=this.getLayer(),r=e.pixelRatio,n=e.viewState.projection,a=i.getRevision(),o=i.getRenderOrder()||null,s=t.getReplayState(i);if(!(!s.dirty&&s.renderedRevision==a&&s.renderedRenderOrder==o)){for(var l=i.getSource(),h=l.getTileGrid(),u=l.getTileGridForProjection(n),f=u.getResolution(t.tileCoord[0]),c=u.getTileCoordExtent(t.wrappedTileCoord),d=0,v=t.tileKeys.length;d<v;++d){var E=t.getTile(t.tileKeys[d]);if(E.getState()!=V.ERROR){var p=E.tileCoord,m=h.getTileCoordExtent(p),y=g.getIntersection(c,m),R=g.equals(m,y)?null:g.buffer(y,i.getRenderBuffer()*f),C=E.getProjection(),x=!1;k.equivalent(n,C)||(x=!0,E.setProjection(n)),s.dirty=!1;var I=new xt(0,y,f,r,l.getOverlaps(),this.declutterTree_,i.getRenderBuffer()),D=ot.getSquaredTolerance(f,r),O=function(b){var M,F=b.getStyleFunction();if(F?M=F.call(b,f):(F=i.getStyleFunction(),F&&(M=F(b,f))),M){var X=this.renderFeature(b,D,M,I);this.dirty_=this.dirty_||X,s.dirty=s.dirty||X}},B=E.getFeatures();o&&o!==s.renderedRenderOrder&&B.sort(o);for(var W,N=0,P=B.length;N<P;++N)W=B[N],x&&(C.getUnits()==_e.TILE_PIXELS&&(C.setWorldExtent(m),C.setExtent(E.getExtent())),W.getGeometry().transform(C,n)),(!R||g.intersects(R,W.getGeometry().getExtent()))&&O.call(this,W);I.finish();for(var $ in I.getReplays());E.setReplayGroup(i,t.tileCoord.toString(),I)}}s.renderedRevision=a,s.renderedRenderOrder=o}},ge.prototype.drawTileImage=function(t,e,i,r,n,a,o,s,l){var h=t;this.createReplayGroup_(h,e),this.context&&(this.renderTileImage_(h,e,i),Be.prototype.drawTileImage.apply(this,arguments))},ge.prototype.forEachFeatureAtCoordinate=function(t,e,i,r,n){var a=e.viewState.resolution,o=e.viewState.rotation;i=i??0;var s=this.getLayer(),l={},h=this.renderedTiles,u=s.getSource(),f=u.getTileGridForProjection(e.viewState.projection),c,d,v,E,p,m,y,R;for(v=0,E=h.length;v<E;++v)if(m=h[v],y=m.wrappedTileCoord,R=f.getTileCoordExtent(y,this.tmpExtent),c=g.buffer(R,i*a,c),!!g.containsCoordinate(c,t))for(var C=0,x=m.tileKeys.length;C<x;++C){var I=m.getTile(m.tileKeys[C]);I.getState()!=V.ERROR&&(p=I.getReplayGroup(s,m.tileCoord.toString()),d=d||p.forEachFeatureAtCoordinate(t,a,o,i,{},function(D){var O=_.getUid(D).toString();if(!(O in l))return l[O]=!0,r.call(n,D,s)},null))}return d},ge.prototype.getReplayTransform_=function(t,e){var i=this.getLayer(),r=i.getSource(),n=r.getTileGrid(),a=t.tileCoord,o=n.getResolution(a[0]),s=e.viewState,l=e.pixelRatio,h=s.resolution/l,u=n.getTileCoordExtent(a,this.tmpExtent),f=s.center,c=g.getTopLeft(u),d=e.size,v=Math.round(l*d[0]/2),E=Math.round(l*d[1]/2);return A.compose(this.tmpTransform_,v,E,o/h,o/h,s.rotation,(c[0]-f[0])/o,(f[1]-c[1])/o)},ge.prototype.handleFontsChanged_=function(t){var e=this.getLayer();e.getVisible()&&this.renderedLayerRevision_!==void 0&&e.changed()},ge.prototype.handleStyleImageChange_=function(t){this.renderIfReadyAndVisible()},ge.prototype.postCompose=function(t,e,i){var r=this.getLayer(),n=r.getDeclutter()?{}:null,a=r.getSource(),o=r.getRenderMode(),s=ge.VECTOR_REPLAYS[o],l=e.pixelRatio,h=e.viewState.rotation,u=e.size,f,c;h&&(f=Math.round(l*u[0]/2),c=Math.round(l*u[1]/2),w.rotateAtOffset(t,-h,f,c)),n&&this.declutterTree_.clear();for(var d=this.renderedTiles,v=a.getTileGridForProjection(e.viewState.projection),E=[],p=[],m=d.length-1;m>=0;--m){var y=d[m];if(y.getState()!=V.ABORT)for(var R=y.tileCoord,C=v.getTileCoordExtent(R)[0]-v.getTileCoordExtent(y.wrappedTileCoord)[0],x=void 0,I=0,D=y.tileKeys.length;I<D;++I){var O=y.getTile(y.tileKeys[I]);if(O.getState()!=V.ERROR){var B=O.getReplayGroup(r,R.toString());if(!(o!=mn.VECTOR&&!B.hasReplays(s))){x||(x=this.getTransform(e,C));var W=O.tileCoord[0],N=B.getClipCoords(x);t.save(),t.globalAlpha=i.opacity;for(var P=0,$=E.length;P<$;++P){var b=E[P];W<p[P]&&(t.beginPath(),t.moveTo(N[0],N[1]),t.lineTo(N[2],N[3]),t.lineTo(N[4],N[5]),t.lineTo(N[6],N[7]),t.moveTo(b[6],b[7]),t.lineTo(b[4],b[5]),t.lineTo(b[2],b[3]),t.lineTo(b[0],b[1]),t.clip())}B.replay(t,x,h,{},s,n),t.restore(),E.push(N),p.push(W)}}}}n&&xt.replayDeclutter(n,t,h),h&&w.rotateAtOffset(t,h,f,c),Be.prototype.postCompose.apply(this,arguments)},ge.prototype.renderFeature=function(t,e,i,r){if(!i)return!1;var n=!1;if(Array.isArray(i))for(var a=0,o=i.length;a<o;++a)n=ot.renderFeature(r,t,i[a],e,this.handleStyleImageChange_,this)||n;else n=ot.renderFeature(r,t,i,e,this.handleStyleImageChange_,this);return n},ge.prototype.renderTileImage_=function(t,e,i){var r=this.getLayer(),n=t.getReplayState(r),a=r.getRevision(),o=ge.IMAGE_REPLAYS[r.getRenderMode()];if(o&&n.renderedTileRevision!==a){n.renderedTileRevision=a;var s=t.wrappedTileCoord,l=s[0],h=e.pixelRatio,u=r.getSource(),f=u.getTileGridForProjection(e.viewState.projection),c=f.getResolution(l),d=t.getContext(r),v=u.getTilePixelSize(l,h,e.viewState.projection);d.canvas.width=v[0],d.canvas.height=v[1];for(var E=f.getTileCoordExtent(s),p=0,m=t.tileKeys.length;p<m;++p){var y=t.getTile(t.tileKeys[p]);if(y.getState()!=V.ERROR){var R=h/c,C=A.reset(this.tmpTransform_);A.scale(C,R,-R),A.translate(C,-E[0],-E[3]);var x=y.getReplayGroup(r,t.tileCoord.toString());x.replay(d,C,0,{},o)}}}};var Rr=function(t){this.source_=t};Rr.prototype.getType=function(){},Rr.prototype.getSource=function(){return this.source_},Rr.prototype.isAnimated=ne.FALSE;var lr=function(t){Rr.call(this,t)};_.inherits(lr,Rr),lr.prototype.getType=function(){return S.FRAGMENT_SHADER};var hr=function(t){Rr.call(this,t)};_.inherits(hr,Rr),hr.prototype.getType=function(){return S.VERTEX_SHADER};var En={};En.fragment=new lr(_.DEBUG_WEBGL?`precision mediump float;
varying vec2 v_center;
varying vec2 v_offset;
varying float v_halfWidth;
varying float v_pixelRatio;



uniform float u_opacity;
uniform vec4 u_fillColor;
uniform vec4 u_strokeColor;
uniform vec2 u_size;

void main(void) {
  vec2 windowCenter = vec2((v_center.x + 1.0) / 2.0 * u_size.x * v_pixelRatio,
      (v_center.y + 1.0) / 2.0 * u_size.y * v_pixelRatio);
  vec2 windowOffset = vec2((v_offset.x + 1.0) / 2.0 * u_size.x * v_pixelRatio,
      (v_offset.y + 1.0) / 2.0 * u_size.y * v_pixelRatio);
  float radius = length(windowCenter - windowOffset);
  float dist = length(windowCenter - gl_FragCoord.xy);
  if (dist > radius + v_halfWidth) {
    if (u_strokeColor.a == 0.0) {
      gl_FragColor = u_fillColor;
    } else {
      gl_FragColor = u_strokeColor;
    }
    gl_FragColor.a = gl_FragColor.a - (dist - (radius + v_halfWidth));
  } else if (u_fillColor.a == 0.0) {
    // Hooray, no fill, just stroke. We can use real antialiasing.
    gl_FragColor = u_strokeColor;
    if (dist < radius - v_halfWidth) {
      gl_FragColor.a = gl_FragColor.a - (radius - v_halfWidth - dist);
    }
  } else {
    gl_FragColor = u_fillColor;
    float strokeDist = radius - v_halfWidth;
    float antialias = 2.0 * v_pixelRatio;
    if (dist > strokeDist) {
      gl_FragColor = u_strokeColor;
    } else if (dist >= strokeDist - antialias) {
      float step = smoothstep(strokeDist - antialias, strokeDist, dist);
      gl_FragColor = mix(u_fillColor, u_strokeColor, step);
    }
  }
  gl_FragColor.a = gl_FragColor.a * u_opacity;
  if (gl_FragColor.a <= 0.0) {
    discard;
  }
}
`:"precision mediump float;varying vec2 a;varying vec2 b;varying float c;varying float d;uniform float m;uniform vec4 n;uniform vec4 o;uniform vec2 p;void main(void){vec2 windowCenter=vec2((a.x+1.0)/2.0*p.x*d,(a.y+1.0)/2.0*p.y*d);vec2 windowOffset=vec2((b.x+1.0)/2.0*p.x*d,(b.y+1.0)/2.0*p.y*d);float radius=length(windowCenter-windowOffset);float dist=length(windowCenter-gl_FragCoord.xy);if(dist>radius+c){if(o.a==0.0){gl_FragColor=n;}else{gl_FragColor=o;}gl_FragColor.a=gl_FragColor.a-(dist-(radius+c));}else if(n.a==0.0){gl_FragColor=o;if(dist<radius-c){gl_FragColor.a=gl_FragColor.a-(radius-c-dist);}} else{gl_FragColor=n;float strokeDist=radius-c;float antialias=2.0*d;if(dist>strokeDist){gl_FragColor=o;}else if(dist>=strokeDist-antialias){float step=smoothstep(strokeDist-antialias,strokeDist,dist);gl_FragColor=mix(n,o,step);}} gl_FragColor.a=gl_FragColor.a*m;if(gl_FragColor.a<=0.0){discard;}}"),En.vertex=new hr(_.DEBUG_WEBGL?`varying vec2 v_center;
varying vec2 v_offset;
varying float v_halfWidth;
varying float v_pixelRatio;


attribute vec2 a_position;
attribute float a_instruction;
attribute float a_radius;

uniform mat4 u_projectionMatrix;
uniform mat4 u_offsetScaleMatrix;
uniform mat4 u_offsetRotateMatrix;
uniform float u_lineWidth;
uniform float u_pixelRatio;

void main(void) {
  mat4 offsetMatrix = u_offsetScaleMatrix * u_offsetRotateMatrix;
  v_center = vec4(u_projectionMatrix * vec4(a_position, 0.0, 1.0)).xy;
  v_pixelRatio = u_pixelRatio;
  float lineWidth = u_lineWidth * u_pixelRatio;
  v_halfWidth = lineWidth / 2.0;
  if (lineWidth == 0.0) {
    lineWidth = 2.0 * u_pixelRatio;
  }
  vec2 offset;
  // Radius with anitaliasing (roughly).
  float radius = a_radius + 3.0 * u_pixelRatio;
  // Until we get gl_VertexID in WebGL, we store an instruction.
  if (a_instruction == 0.0) {
    // Offsetting the edges of the triangle by lineWidth / 2 is necessary, however
    // we should also leave some space for the antialiasing, thus we offset by lineWidth.
    offset = vec2(-1.0, 1.0);
  } else if (a_instruction == 1.0) {
    offset = vec2(-1.0, -1.0);
  } else if (a_instruction == 2.0) {
    offset = vec2(1.0, -1.0);
  } else {
    offset = vec2(1.0, 1.0);
  }

  gl_Position = u_projectionMatrix * vec4(a_position + offset * radius, 0.0, 1.0) +
      offsetMatrix * vec4(offset * lineWidth, 0.0, 0.0);
  v_offset = vec4(u_projectionMatrix * vec4(a_position.x + a_radius, a_position.y,
      0.0, 1.0)).xy;

  if (distance(v_center, v_offset) > 20000.0) {
    gl_Position = vec4(v_center, 0.0, 1.0);
  }
}


`:"varying vec2 a;varying vec2 b;varying float c;varying float d;attribute vec2 e;attribute float f;attribute float g;uniform mat4 h;uniform mat4 i;uniform mat4 j;uniform float k;uniform float l;void main(void){mat4 offsetMatrix=i*j;a=vec4(h*vec4(e,0.0,1.0)).xy;d=l;float lineWidth=k*l;c=lineWidth/2.0;if(lineWidth==0.0){lineWidth=2.0*l;}vec2 offset;float radius=g+3.0*l;//Until we get gl_VertexID in WebGL,we store an instruction.if(f==0.0){//Offsetting the edges of the triangle by lineWidth/2 is necessary,however//we should also leave some space for the antialiasing,thus we offset by lineWidth.offset=vec2(-1.0,1.0);}else if(f==1.0){offset=vec2(-1.0,-1.0);}else if(f==2.0){offset=vec2(1.0,-1.0);}else{offset=vec2(1.0,1.0);}gl_Position=h*vec4(e+offset*radius,0.0,1.0)+offsetMatrix*vec4(offset*lineWidth,0.0,0.0);b=vec4(h*vec4(e.x+g,e.y,0.0,1.0)).xy;if(distance(a,b)>20000.0){gl_Position=vec4(a,0.0,1.0);}}");var Eo=function(t,e){this.u_projectionMatrix=t.getUniformLocation(e,_.DEBUG_WEBGL?"u_projectionMatrix":"h"),this.u_offsetScaleMatrix=t.getUniformLocation(e,_.DEBUG_WEBGL?"u_offsetScaleMatrix":"i"),this.u_offsetRotateMatrix=t.getUniformLocation(e,_.DEBUG_WEBGL?"u_offsetRotateMatrix":"j"),this.u_lineWidth=t.getUniformLocation(e,_.DEBUG_WEBGL?"u_lineWidth":"k"),this.u_pixelRatio=t.getUniformLocation(e,_.DEBUG_WEBGL?"u_pixelRatio":"l"),this.u_opacity=t.getUniformLocation(e,_.DEBUG_WEBGL?"u_opacity":"m"),this.u_fillColor=t.getUniformLocation(e,_.DEBUG_WEBGL?"u_fillColor":"n"),this.u_strokeColor=t.getUniformLocation(e,_.DEBUG_WEBGL?"u_strokeColor":"o"),this.u_size=t.getUniformLocation(e,_.DEBUG_WEBGL?"u_size":"p"),this.a_position=t.getAttribLocation(e,_.DEBUG_WEBGL?"a_position":"e"),this.a_instruction=t.getAttribLocation(e,_.DEBUG_WEBGL?"a_instruction":"f"),this.a_radius=t.getAttribLocation(e,_.DEBUG_WEBGL?"a_radius":"g")},er={};er.create=function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]},er.fromTransform=function(t,e){return t[0]=e[0],t[1]=e[1],t[4]=e[2],t[5]=e[3],t[12]=e[4],t[13]=e[5],t};var Ee=function(t,e){Kt.call(this),this.tolerance=t,this.maxExtent=e,this.origin=g.getCenter(e),this.projectionMatrix_=A.create(),this.offsetRotateMatrix_=A.create(),this.offsetScaleMatrix_=A.create(),this.tmpMat4_=er.create(),this.indices=[],this.indicesBuffer=null,this.startIndices=[],this.startIndicesFeature=[],this.vertices=[],this.verticesBuffer=null,this.lineStringReplay=void 0};_.inherits(Ee,Kt),Ee.prototype.getDeleteResourcesFunction=function(t){},Ee.prototype.finish=function(t){},Ee.prototype.setUpProgram=function(t,e,i,r){},Ee.prototype.shutDownProgram=function(t,e){},Ee.prototype.drawReplay=function(t,e,i,r){},Ee.prototype.drawHitDetectionReplayOneByOne=function(t,e,i,r,n){},Ee.prototype.drawHitDetectionReplay=function(t,e,i,r,n,a){return n?this.drawHitDetectionReplayOneByOne(t,e,i,r,a):this.drawHitDetectionReplayAll(t,e,i,r)},Ee.prototype.drawHitDetectionReplayAll=function(t,e,i,r){t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),this.drawReplay(t,e,i,!0);var n=r(null);if(n)return n},Ee.prototype.replay=function(t,e,i,r,n,a,o,s,l,h,u){var f=t.getGL(),c,d,v,E,p,m,y,R;this.lineStringReplay&&(c=f.isEnabled(f.STENCIL_TEST),d=f.getParameter(f.STENCIL_FUNC),v=f.getParameter(f.STENCIL_VALUE_MASK),E=f.getParameter(f.STENCIL_REF),p=f.getParameter(f.STENCIL_WRITEMASK),m=f.getParameter(f.STENCIL_FAIL),y=f.getParameter(f.STENCIL_PASS_DEPTH_PASS),R=f.getParameter(f.STENCIL_PASS_DEPTH_FAIL),f.enable(f.STENCIL_TEST),f.clear(f.STENCIL_BUFFER_BIT),f.stencilMask(255),f.stencilFunc(f.ALWAYS,1,255),f.stencilOp(f.KEEP,f.KEEP,f.REPLACE),this.lineStringReplay.replay(t,e,i,r,n,a,o,s,l,h,u),f.stencilMask(0),f.stencilFunc(f.NOTEQUAL,1,255)),t.bindBuffer(S.ARRAY_BUFFER,this.verticesBuffer),t.bindBuffer(S.ELEMENT_ARRAY_BUFFER,this.indicesBuffer);var C=this.setUpProgram(f,t,n,a),x=A.reset(this.projectionMatrix_);A.scale(x,2/(i*n[0]),2/(i*n[1])),A.rotate(x,-r),A.translate(x,-(e[0]-this.origin[0]),-(e[1]-this.origin[1]));var I=A.reset(this.offsetScaleMatrix_);A.scale(I,2/n[0],2/n[1]);var D=A.reset(this.offsetRotateMatrix_);r!==0&&A.rotate(D,-r),f.uniformMatrix4fv(C.u_projectionMatrix,!1,er.fromTransform(this.tmpMat4_,x)),f.uniformMatrix4fv(C.u_offsetScaleMatrix,!1,er.fromTransform(this.tmpMat4_,I)),f.uniformMatrix4fv(C.u_offsetRotateMatrix,!1,er.fromTransform(this.tmpMat4_,D)),f.uniform1f(C.u_opacity,o);var O;return l===void 0?this.drawReplay(f,t,s,!1):O=this.drawHitDetectionReplay(f,t,s,l,h,u),this.shutDownProgram(f,C),this.lineStringReplay&&(c||f.disable(f.STENCIL_TEST),f.clear(f.STENCIL_BUFFER_BIT),f.stencilFunc(d,E,v),f.stencilMask(p),f.stencilOp(m,R,y)),O},Ee.prototype.drawElements=function(t,e,i,r){var n=e.hasOESElementIndexUint?S.UNSIGNED_INT:S.UNSIGNED_SHORT,a=e.hasOESElementIndexUint?4:2,o=r-i,s=i*a;t.drawElements(S.TRIANGLES,o,n,s)};var et={};et.defaultFont="10px sans-serif",et.defaultFillStyle=[0,0,0,1],et.defaultLineCap="round",et.defaultLineDash=[],et.defaultLineDashOffset=0,et.defaultLineJoin="round",et.defaultMiterLimit=10,et.defaultStrokeStyle=[0,0,0,1],et.defaultTextAlign=.5,et.defaultTextBaseline=.5,et.defaultLineWidth=1,et.triangleIsCounterClockwise=function(t,e,i,r,n,a){var o=(i-t)*(a-e)-(n-t)*(r-e);return o<=et.EPSILON&&o>=-et.EPSILON?void 0:o>0},et.EPSILON=Number.EPSILON||2220446049250313e-31;var Ze=function(t,e){this.arr_=t!==void 0?t:[],this.usage_=e!==void 0?e:Ze.Usage_.STATIC_DRAW};Ze.prototype.getArray=function(){return this.arr_},Ze.prototype.getUsage=function(){return this.usage_},Ze.Usage_={STATIC_DRAW:S.STATIC_DRAW,STREAM_DRAW:S.STREAM_DRAW,DYNAMIC_DRAW:S.DYNAMIC_DRAW};var ai=function(t,e){Ee.call(this,t,e),this.defaultLocations_=null,this.styles_=[],this.styleIndices_=[],this.radius_=0,this.state_={fillColor:null,strokeColor:null,lineDash:null,lineDashOffset:void 0,lineWidth:void 0,changed:!1}};_.inherits(ai,Ee),ai.prototype.drawCoordinates_=function(t,e,i,r){var n=this.vertices.length,a=this.indices.length,o=n/4,s,l;for(s=e,l=i;s<l;s+=r)this.vertices[n++]=t[s],this.vertices[n++]=t[s+1],this.vertices[n++]=0,this.vertices[n++]=this.radius_,this.vertices[n++]=t[s],this.vertices[n++]=t[s+1],this.vertices[n++]=1,this.vertices[n++]=this.radius_,this.vertices[n++]=t[s],this.vertices[n++]=t[s+1],this.vertices[n++]=2,this.vertices[n++]=this.radius_,this.vertices[n++]=t[s],this.vertices[n++]=t[s+1],this.vertices[n++]=3,this.vertices[n++]=this.radius_,this.indices[a++]=o,this.indices[a++]=o+1,this.indices[a++]=o+2,this.indices[a++]=o+2,this.indices[a++]=o+3,this.indices[a++]=o,o+=4},ai.prototype.drawCircle=function(t,e){var i=t.getRadius(),r=t.getStride();if(i){this.startIndices.push(this.indices.length),this.startIndicesFeature.push(e),this.state_.changed&&(this.styleIndices_.push(this.indices.length),this.state_.changed=!1),this.radius_=i;var n=t.getFlatCoordinates();n=ae.translate(n,0,2,r,-this.origin[0],-this.origin[1]),this.drawCoordinates_(n,0,2,r)}else if(this.state_.changed&&(this.styles_.pop(),this.styles_.length)){var a=this.styles_[this.styles_.length-1];this.state_.fillColor=a[0],this.state_.strokeColor=a[1],this.state_.lineWidth=a[2],this.state_.changed=!1}},ai.prototype.finish=function(t){this.verticesBuffer=new Ze(this.vertices),this.indicesBuffer=new Ze(this.indices),this.startIndices.push(this.indices.length),this.styleIndices_.length===0&&this.styles_.length>0&&(this.styles_=[]),this.vertices=null,this.indices=null},ai.prototype.getDeleteResourcesFunction=function(t){var e=this.verticesBuffer,i=this.indicesBuffer;return function(){t.deleteBuffer(e),t.deleteBuffer(i)}},ai.prototype.setUpProgram=function(t,e,i,r){var n,a;n=En.fragment,a=En.vertex;var o=e.getProgram(n,a),s;return this.defaultLocations_?s=this.defaultLocations_:(s=new Eo(t,o),this.defaultLocations_=s),e.useProgram(o),t.enableVertexAttribArray(s.a_position),t.vertexAttribPointer(s.a_position,2,S.FLOAT,!1,16,0),t.enableVertexAttribArray(s.a_instruction),t.vertexAttribPointer(s.a_instruction,1,S.FLOAT,!1,16,8),t.enableVertexAttribArray(s.a_radius),t.vertexAttribPointer(s.a_radius,1,S.FLOAT,!1,16,12),t.uniform2fv(s.u_size,i),t.uniform1f(s.u_pixelRatio,r),s},ai.prototype.shutDownProgram=function(t,e){t.disableVertexAttribArray(e.a_position),t.disableVertexAttribArray(e.a_instruction),t.disableVertexAttribArray(e.a_radius)},ai.prototype.drawReplay=function(t,e,i,r){if(!ht.isEmpty(i))this.drawReplaySkipping_(t,e,i);else{var n,a,o,s;for(o=this.startIndices[this.startIndices.length-1],n=this.styleIndices_.length-1;n>=0;--n)a=this.styleIndices_[n],s=this.styles_[n],this.setFillStyle_(t,s[0]),this.setStrokeStyle_(t,s[1],s[2]),this.drawElements(t,e,a,o),o=a}},ai.prototype.drawHitDetectionReplayOneByOne=function(t,e,i,r,n){var a,o,s,l,h,u,f,c;for(c=this.startIndices.length-2,s=this.startIndices[c+1],a=this.styleIndices_.length-1;a>=0;--a)for(l=this.styles_[a],this.setFillStyle_(t,l[0]),this.setStrokeStyle_(t,l[1],l[2]),h=this.styleIndices_[a];c>=0&&this.startIndices[c]>=h;){if(o=this.startIndices[c],u=this.startIndicesFeature[c],f=_.getUid(u).toString(),i[f]===void 0&&u.getGeometry()&&(n===void 0||g.intersects(n,u.getGeometry().getExtent()))){t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),this.drawElements(t,e,o,s);var d=r(u);if(d)return d}c--,s=o}},ai.prototype.drawReplaySkipping_=function(t,e,i){var r,n,a,o,s,l,h,u,f;for(u=this.startIndices.length-2,a=n=this.startIndices[u+1],r=this.styleIndices_.length-1;r>=0;--r){for(o=this.styles_[r],this.setFillStyle_(t,o[0]),this.setStrokeStyle_(t,o[1],o[2]),s=this.styleIndices_[r];u>=0&&this.startIndices[u]>=s;)f=this.startIndices[u],l=this.startIndicesFeature[u],h=_.getUid(l).toString(),i[h]&&(n!==a&&this.drawElements(t,e,n,a),a=f),u--,n=f;n!==a&&this.drawElements(t,e,n,a),n=a=s}},ai.prototype.setFillStyle_=function(t,e){t.uniform4fv(this.defaultLocations_.u_fillColor,e)},ai.prototype.setStrokeStyle_=function(t,e,i){t.uniform4fv(this.defaultLocations_.u_strokeColor,e),t.uniform1f(this.defaultLocations_.u_lineWidth,i)},ai.prototype.setFillStrokeStyle=function(t,e){var i,r;if(e){var n=e.getLineDash();this.state_.lineDash=n||et.defaultLineDash;var a=e.getLineDashOffset();this.state_.lineDashOffset=a||et.defaultLineDashOffset,i=e.getColor(),!(i instanceof CanvasGradient)&&!(i instanceof CanvasPattern)?i=Xt.asArray(i).map(function(s,l){return l!=3?s/255:s})||et.defaultStrokeStyle:i=et.defaultStrokeStyle,r=e.getWidth(),r=r!==void 0?r:et.defaultLineWidth}else i=[0,0,0,0],r=0;var o=t?t.getColor():[0,0,0,0];!(o instanceof CanvasGradient)&&!(o instanceof CanvasPattern)?o=Xt.asArray(o).map(function(s,l){return l!=3?s/255:s})||et.defaultFillStyle:o=et.defaultFillStyle,(!this.state_.strokeColor||!st.equals(this.state_.strokeColor,i)||!this.state_.fillColor||!st.equals(this.state_.fillColor,o)||this.state_.lineWidth!==r)&&(this.state_.changed=!0,this.state_.fillColor=o,this.state_.strokeColor=i,this.state_.lineWidth=r,this.styles_.push([o,i,r]))};var Tn={};Tn.fragment=new lr(_.DEBUG_WEBGL?`precision mediump float;
varying vec2 v_texCoord;
varying float v_opacity;

uniform float u_opacity;
uniform sampler2D u_image;

void main(void) {
  vec4 texColor = texture2D(u_image, v_texCoord);
  gl_FragColor.rgb = texColor.rgb;
  float alpha = texColor.a * v_opacity * u_opacity;
  if (alpha == 0.0) {
    discard;
  }
  gl_FragColor.a = alpha;
}
`:"precision mediump float;varying vec2 a;varying float b;uniform float k;uniform sampler2D l;void main(void){vec4 texColor=texture2D(l,a);gl_FragColor.rgb=texColor.rgb;float alpha=texColor.a*b*k;if(alpha==0.0){discard;}gl_FragColor.a=alpha;}"),Tn.vertex=new hr(_.DEBUG_WEBGL?`varying vec2 v_texCoord;
varying float v_opacity;

attribute vec2 a_position;
attribute vec2 a_texCoord;
attribute vec2 a_offsets;
attribute float a_opacity;
attribute float a_rotateWithView;

uniform mat4 u_projectionMatrix;
uniform mat4 u_offsetScaleMatrix;
uniform mat4 u_offsetRotateMatrix;

void main(void) {
  mat4 offsetMatrix = u_offsetScaleMatrix;
  if (a_rotateWithView == 1.0) {
    offsetMatrix = u_offsetScaleMatrix * u_offsetRotateMatrix;
  }
  vec4 offsets = offsetMatrix * vec4(a_offsets, 0.0, 0.0);
  gl_Position = u_projectionMatrix * vec4(a_position, 0.0, 1.0) + offsets;
  v_texCoord = a_texCoord;
  v_opacity = a_opacity;
}


`:"varying vec2 a;varying float b;attribute vec2 c;attribute vec2 d;attribute vec2 e;attribute float f;attribute float g;uniform mat4 h;uniform mat4 i;uniform mat4 j;void main(void){mat4 offsetMatrix=i;if(g==1.0){offsetMatrix=i*j;}vec4 offsets=offsetMatrix*vec4(e,0.0,0.0);gl_Position=h*vec4(c,0.0,1.0)+offsets;a=d;b=f;}");var To=function(t,e){this.u_projectionMatrix=t.getUniformLocation(e,_.DEBUG_WEBGL?"u_projectionMatrix":"h"),this.u_offsetScaleMatrix=t.getUniformLocation(e,_.DEBUG_WEBGL?"u_offsetScaleMatrix":"i"),this.u_offsetRotateMatrix=t.getUniformLocation(e,_.DEBUG_WEBGL?"u_offsetRotateMatrix":"j"),this.u_opacity=t.getUniformLocation(e,_.DEBUG_WEBGL?"u_opacity":"k"),this.u_image=t.getUniformLocation(e,_.DEBUG_WEBGL?"u_image":"l"),this.a_position=t.getAttribLocation(e,_.DEBUG_WEBGL?"a_position":"c"),this.a_texCoord=t.getAttribLocation(e,_.DEBUG_WEBGL?"a_texCoord":"d"),this.a_offsets=t.getAttribLocation(e,_.DEBUG_WEBGL?"a_offsets":"e"),this.a_opacity=t.getAttribLocation(e,_.DEBUG_WEBGL?"a_opacity":"f"),this.a_rotateWithView=t.getAttribLocation(e,_.DEBUG_WEBGL?"a_rotateWithView":"g")},Rn={LOST:"webglcontextlost",RESTORED:"webglcontextrestored"},qt=function(t,e){this.canvas_=t,this.gl_=e,this.bufferCache_={},this.shaderCache_={},this.programCache_={},this.currentProgram_=null,this.hitDetectionFramebuffer_=null,this.hitDetectionTexture_=null,this.hitDetectionRenderbuffer_=null,this.hasOESElementIndexUint=st.includes(_.WEBGL_EXTENSIONS,"OES_element_index_uint"),this.hasOESElementIndexUint&&e.getExtension("OES_element_index_uint"),L.listen(this.canvas_,Rn.LOST,this.handleWebGLContextLost,this),L.listen(this.canvas_,Rn.RESTORED,this.handleWebGLContextRestored,this)};_.inherits(qt,Vi),qt.prototype.bindBuffer=function(t,e){var i=this.getGL(),r=e.getArray(),n=String(_.getUid(e));if(n in this.bufferCache_){var a=this.bufferCache_[n];i.bindBuffer(t,a.buffer)}else{var o=i.createBuffer();i.bindBuffer(t,o);var s;t==S.ARRAY_BUFFER?s=new Float32Array(r):t==S.ELEMENT_ARRAY_BUFFER&&(s=this.hasOESElementIndexUint?new Uint32Array(r):new Uint16Array(r)),i.bufferData(t,s,e.getUsage()),this.bufferCache_[n]={buf:e,buffer:o}}},qt.prototype.deleteBuffer=function(t){var e=this.getGL(),i=String(_.getUid(t)),r=this.bufferCache_[i];e.isContextLost()||e.deleteBuffer(r.buffer),delete this.bufferCache_[i]},qt.prototype.disposeInternal=function(){L.unlistenAll(this.canvas_);var t=this.getGL();if(!t.isContextLost()){var e;for(e in this.bufferCache_)t.deleteBuffer(this.bufferCache_[e].buffer);for(e in this.programCache_)t.deleteProgram(this.programCache_[e]);for(e in this.shaderCache_)t.deleteShader(this.shaderCache_[e]);t.deleteFramebuffer(this.hitDetectionFramebuffer_),t.deleteRenderbuffer(this.hitDetectionRenderbuffer_),t.deleteTexture(this.hitDetectionTexture_)}},qt.prototype.getCanvas=function(){return this.canvas_},qt.prototype.getGL=function(){return this.gl_},qt.prototype.getHitDetectionFramebuffer=function(){return this.hitDetectionFramebuffer_||this.initHitDetectionFramebuffer_(),this.hitDetectionFramebuffer_},qt.prototype.getShader=function(t){var e=String(_.getUid(t));if(e in this.shaderCache_)return this.shaderCache_[e];var i=this.getGL(),r=i.createShader(t.getType());return i.shaderSource(r,t.getSource()),i.compileShader(r),this.shaderCache_[e]=r,r},qt.prototype.getProgram=function(t,e){var i=_.getUid(t)+"/"+_.getUid(e);if(i in this.programCache_)return this.programCache_[i];var r=this.getGL(),n=r.createProgram();return r.attachShader(n,this.getShader(t)),r.attachShader(n,this.getShader(e)),r.linkProgram(n),this.programCache_[i]=n,n},qt.prototype.handleWebGLContextLost=function(){ht.clear(this.bufferCache_),ht.clear(this.shaderCache_),ht.clear(this.programCache_),this.currentProgram_=null,this.hitDetectionFramebuffer_=null,this.hitDetectionTexture_=null,this.hitDetectionRenderbuffer_=null},qt.prototype.handleWebGLContextRestored=function(){},qt.prototype.initHitDetectionFramebuffer_=function(){var t=this.gl_,e=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,e);var i=qt.createEmptyTexture(t,1,1),r=t.createRenderbuffer();t.bindRenderbuffer(t.RENDERBUFFER,r),t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT16,1,1),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,i,0),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,r),t.bindTexture(t.TEXTURE_2D,null),t.bindRenderbuffer(t.RENDERBUFFER,null),t.bindFramebuffer(t.FRAMEBUFFER,null),this.hitDetectionFramebuffer_=e,this.hitDetectionTexture_=i,this.hitDetectionRenderbuffer_=r},qt.prototype.useProgram=function(t){if(t==this.currentProgram_)return!1;var e=this.getGL();return e.useProgram(t),this.currentProgram_=t,!0},qt.createTexture_=function(t,e,i){var r=t.createTexture();return t.bindTexture(t.TEXTURE_2D,r),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),e!==void 0&&t.texParameteri(S.TEXTURE_2D,S.TEXTURE_WRAP_S,e),i!==void 0&&t.texParameteri(S.TEXTURE_2D,S.TEXTURE_WRAP_T,i),r},qt.createEmptyTexture=function(t,e,i,r,n){var a=qt.createTexture_(t,r,n);return t.texImage2D(t.TEXTURE_2D,0,t.RGBA,e,i,0,t.RGBA,t.UNSIGNED_BYTE,null),a},qt.createTexture=function(t,e,i,r){var n=qt.createTexture_(t,i,r);return t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e),n};var we=function(t,e){Ee.call(this,t,e),this.anchorX=void 0,this.anchorY=void 0,this.groupIndices=[],this.hitDetectionGroupIndices=[],this.height=void 0,this.imageHeight=void 0,this.imageWidth=void 0,this.defaultLocations=null,this.opacity=void 0,this.originX=void 0,this.originY=void 0,this.rotateWithView=void 0,this.rotation=void 0,this.scale=void 0,this.width=void 0};_.inherits(we,Ee),we.prototype.getDeleteResourcesFunction=function(t){var e=this.verticesBuffer,i=this.indicesBuffer,r=this.getTextures(!0),n=t.getGL();return function(){if(!n.isContextLost()){var a,o;for(a=0,o=r.length;a<o;++a)n.deleteTexture(r[a])}t.deleteBuffer(e),t.deleteBuffer(i)}},we.prototype.drawCoordinates=function(t,e,i,r){var n=this.anchorX,a=this.anchorY,o=this.height,s=this.imageHeight,l=this.imageWidth,h=this.opacity,u=this.originX,f=this.originY,c=this.rotateWithView?1:0,d=-this.rotation,v=this.scale,E=this.width,p=Math.cos(d),m=Math.sin(d),y=this.indices.length,R=this.vertices.length,C,x,I,D,O,B;for(C=e;C<i;C+=r)O=t[C]-this.origin[0],B=t[C+1]-this.origin[1],x=R/8,I=-v*n,D=-v*(o-a),this.vertices[R++]=O,this.vertices[R++]=B,this.vertices[R++]=I*p-D*m,this.vertices[R++]=I*m+D*p,this.vertices[R++]=u/l,this.vertices[R++]=(f+o)/s,this.vertices[R++]=h,this.vertices[R++]=c,I=v*(E-n),D=-v*(o-a),this.vertices[R++]=O,this.vertices[R++]=B,this.vertices[R++]=I*p-D*m,this.vertices[R++]=I*m+D*p,this.vertices[R++]=(u+E)/l,this.vertices[R++]=(f+o)/s,this.vertices[R++]=h,this.vertices[R++]=c,I=v*(E-n),D=v*a,this.vertices[R++]=O,this.vertices[R++]=B,this.vertices[R++]=I*p-D*m,this.vertices[R++]=I*m+D*p,this.vertices[R++]=(u+E)/l,this.vertices[R++]=f/s,this.vertices[R++]=h,this.vertices[R++]=c,I=-v*n,D=v*a,this.vertices[R++]=O,this.vertices[R++]=B,this.vertices[R++]=I*p-D*m,this.vertices[R++]=I*m+D*p,this.vertices[R++]=u/l,this.vertices[R++]=f/s,this.vertices[R++]=h,this.vertices[R++]=c,this.indices[y++]=x,this.indices[y++]=x+1,this.indices[y++]=x+2,this.indices[y++]=x,this.indices[y++]=x+2,this.indices[y++]=x+3;return R},we.prototype.createTextures=function(t,e,i,r){var n,a,o,s,l=e.length;for(s=0;s<l;++s)a=e[s],o=_.getUid(a).toString(),o in i?n=i[o]:(n=qt.createTexture(r,a,S.CLAMP_TO_EDGE,S.CLAMP_TO_EDGE),i[o]=n),t[s]=n},we.prototype.setUpProgram=function(t,e,i,r){var n=Tn.fragment,a=Tn.vertex,o=e.getProgram(n,a),s;return this.defaultLocations?s=this.defaultLocations:(s=new To(t,o),this.defaultLocations=s),e.useProgram(o),t.enableVertexAttribArray(s.a_position),t.vertexAttribPointer(s.a_position,2,S.FLOAT,!1,32,0),t.enableVertexAttribArray(s.a_offsets),t.vertexAttribPointer(s.a_offsets,2,S.FLOAT,!1,32,8),t.enableVertexAttribArray(s.a_texCoord),t.vertexAttribPointer(s.a_texCoord,2,S.FLOAT,!1,32,16),t.enableVertexAttribArray(s.a_opacity),t.vertexAttribPointer(s.a_opacity,1,S.FLOAT,!1,32,24),t.enableVertexAttribArray(s.a_rotateWithView),t.vertexAttribPointer(s.a_rotateWithView,1,S.FLOAT,!1,32,28),s},we.prototype.shutDownProgram=function(t,e){t.disableVertexAttribArray(e.a_position),t.disableVertexAttribArray(e.a_offsets),t.disableVertexAttribArray(e.a_texCoord),t.disableVertexAttribArray(e.a_opacity),t.disableVertexAttribArray(e.a_rotateWithView)},we.prototype.drawReplay=function(t,e,i,r){var n=r?this.getHitDetectionTextures():this.getTextures(),a=r?this.hitDetectionGroupIndices:this.groupIndices;if(!ht.isEmpty(i))this.drawReplaySkipping(t,e,i,n,a);else{var o,s,l;for(o=0,s=n.length,l=0;o<s;++o){t.bindTexture(S.TEXTURE_2D,n[o]);var h=a[o];this.drawElements(t,e,l,h),l=h}}},we.prototype.drawReplaySkipping=function(t,e,i,r,n){var a=0,o,s;for(o=0,s=r.length;o<s;++o){t.bindTexture(S.TEXTURE_2D,r[o]);for(var l=o>0?n[o-1]:0,h=n[o],u=l,f=l;a<this.startIndices.length&&this.startIndices[a]<=h;){var c=this.startIndicesFeature[a],d=_.getUid(c).toString();i[d]!==void 0?(u!==f&&this.drawElements(t,e,u,f),u=a===this.startIndices.length-1?h:this.startIndices[a+1],f=u):f=a===this.startIndices.length-1?h:this.startIndices[a+1],a++}u!==f&&this.drawElements(t,e,u,f)}},we.prototype.drawHitDetectionReplayOneByOne=function(t,e,i,r,n){var a,o,s,l,h,u,f=this.startIndices.length-1,c=this.getHitDetectionTextures();for(a=c.length-1;a>=0;--a)for(t.bindTexture(S.TEXTURE_2D,c[a]),o=a>0?this.hitDetectionGroupIndices[a-1]:0,l=this.hitDetectionGroupIndices[a];f>=0&&this.startIndices[f]>=o;){if(s=this.startIndices[f],h=this.startIndicesFeature[f],u=_.getUid(h).toString(),i[u]===void 0&&h.getGeometry()&&(n===void 0||g.intersects(n,h.getGeometry().getExtent()))){t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),this.drawElements(t,e,s,l);var d=r(h);if(d)return d}l=s,f--}},we.prototype.finish=function(t){this.anchorX=void 0,this.anchorY=void 0,this.height=void 0,this.imageHeight=void 0,this.imageWidth=void 0,this.indices=null,this.opacity=void 0,this.originX=void 0,this.originY=void 0,this.rotateWithView=void 0,this.rotation=void 0,this.scale=void 0,this.vertices=null,this.width=void 0},we.prototype.getTextures=function(t){},we.prototype.getHitDetectionTextures=function(){};var ur=function(t,e){we.call(this,t,e),this.images_=[],this.hitDetectionImages_=[],this.textures_=[],this.hitDetectionTextures_=[]};_.inherits(ur,we),ur.prototype.drawMultiPoint=function(t,e){this.startIndices.push(this.indices.length),this.startIndicesFeature.push(e);var i=t.getFlatCoordinates(),r=t.getStride();this.drawCoordinates(i,0,i.length,r)},ur.prototype.drawPoint=function(t,e){this.startIndices.push(this.indices.length),this.startIndicesFeature.push(e);var i=t.getFlatCoordinates(),r=t.getStride();this.drawCoordinates(i,0,i.length,r)},ur.prototype.finish=function(t){var e=t.getGL();this.groupIndices.push(this.indices.length),this.hitDetectionGroupIndices.push(this.indices.length),this.verticesBuffer=new Ze(this.vertices);var i=this.indices;this.indicesBuffer=new Ze(i);var r={};this.createTextures(this.textures_,this.images_,r,e),this.createTextures(this.hitDetectionTextures_,this.hitDetectionImages_,r,e),this.images_=null,this.hitDetectionImages_=null,we.prototype.finish.call(this,t)},ur.prototype.setImageStyle=function(t){var e=t.getAnchor(),i=t.getImage(1),r=t.getImageSize(),n=t.getHitDetectionImage(1),a=t.getOpacity(),o=t.getOrigin(),s=t.getRotateWithView(),l=t.getRotation(),h=t.getSize(),u=t.getScale(),f;this.images_.length===0?this.images_.push(i):(f=this.images_[this.images_.length-1],_.getUid(f)!=_.getUid(i)&&(this.groupIndices.push(this.indices.length),this.images_.push(i))),this.hitDetectionImages_.length===0?this.hitDetectionImages_.push(n):(f=this.hitDetectionImages_[this.hitDetectionImages_.length-1],_.getUid(f)!=_.getUid(n)&&(this.hitDetectionGroupIndices.push(this.indices.length),this.hitDetectionImages_.push(n))),this.anchorX=e[0],this.anchorY=e[1],this.height=h[1],this.imageHeight=r[1],this.imageWidth=r[0],this.opacity=a,this.originX=o[0],this.originY=o[1],this.rotation=l,this.rotateWithView=s,this.scale=u,this.width=h[0]},ur.prototype.getTextures=function(t){return t?this.textures_.concat(this.hitDetectionTextures_):this.textures_},ur.prototype.getHitDetectionTextures=function(){return this.hitDetectionTextures_};var xn={};xn.lineStringIsClosed=function(t,e,i,r){var n=i-r;return t[e]===t[n]&&t[e+1]===t[n+1]&&(i-e)/r>3?!!or.linearRing(t,e,i,r):!1};var Cn={};Cn.fragment=new lr(_.DEBUG_WEBGL?`precision mediump float;
varying float v_round;
varying vec2 v_roundVertex;
varying float v_halfWidth;



uniform float u_opacity;
uniform vec4 u_color;
uniform vec2 u_size;
uniform float u_pixelRatio;

void main(void) {
  if (v_round > 0.0) {
    vec2 windowCoords = vec2((v_roundVertex.x + 1.0) / 2.0 * u_size.x * u_pixelRatio,
        (v_roundVertex.y + 1.0) / 2.0 * u_size.y * u_pixelRatio);
    if (length(windowCoords - gl_FragCoord.xy) > v_halfWidth * u_pixelRatio) {
      discard;
    }
  }
  gl_FragColor = u_color;
  float alpha = u_color.a * u_opacity;
  if (alpha == 0.0) {
    discard;
  }
  gl_FragColor.a = alpha;
}
`:"precision mediump float;varying float a;varying vec2 aVertex;varying float c;uniform float m;uniform vec4 n;uniform vec2 o;uniform float p;void main(void){if(a>0.0){vec2 windowCoords=vec2((aVertex.x+1.0)/2.0*o.x*p,(aVertex.y+1.0)/2.0*o.y*p);if(length(windowCoords-gl_FragCoord.xy)>c*p){discard;}} gl_FragColor=n;float alpha=n.a*m;if(alpha==0.0){discard;}gl_FragColor.a=alpha;}"),Cn.vertex=new hr(_.DEBUG_WEBGL?`varying float v_round;
varying vec2 v_roundVertex;
varying float v_halfWidth;


attribute vec2 a_lastPos;
attribute vec2 a_position;
attribute vec2 a_nextPos;
attribute float a_direction;

uniform mat4 u_projectionMatrix;
uniform mat4 u_offsetScaleMatrix;
uniform mat4 u_offsetRotateMatrix;
uniform float u_lineWidth;
uniform float u_miterLimit;

bool nearlyEquals(in float value, in float ref) {
  float epsilon = 0.000000000001;
  return value >= ref - epsilon && value <= ref + epsilon;
}

void alongNormal(out vec2 offset, in vec2 nextP, in float turnDir, in float direction) {
  vec2 dirVect = nextP - a_position;
  vec2 normal = normalize(vec2(-turnDir * dirVect.y, turnDir * dirVect.x));
  offset = u_lineWidth / 2.0 * normal * direction;
}

void miterUp(out vec2 offset, out float round, in bool isRound, in float direction) {
  float halfWidth = u_lineWidth / 2.0;
  vec2 tangent = normalize(normalize(a_nextPos - a_position) + normalize(a_position - a_lastPos));
  vec2 normal = vec2(-tangent.y, tangent.x);
  vec2 dirVect = a_nextPos - a_position;
  vec2 tmpNormal = normalize(vec2(-dirVect.y, dirVect.x));
  float miterLength = abs(halfWidth / dot(normal, tmpNormal));
  offset = normal * direction * miterLength;
  round = 0.0;
  if (isRound) {
    round = 1.0;
  } else if (miterLength > u_miterLimit + u_lineWidth) {
    offset = halfWidth * tmpNormal * direction;
  }
}

bool miterDown(out vec2 offset, in vec4 projPos, in mat4 offsetMatrix, in float direction) {
  bool degenerate = false;
  vec2 tangent = normalize(normalize(a_nextPos - a_position) + normalize(a_position - a_lastPos));
  vec2 normal = vec2(-tangent.y, tangent.x);
  vec2 dirVect = a_lastPos - a_position;
  vec2 tmpNormal = normalize(vec2(-dirVect.y, dirVect.x));
  vec2 longOffset, shortOffset, longVertex;
  vec4 shortProjVertex;
  float halfWidth = u_lineWidth / 2.0;
  if (length(a_nextPos - a_position) > length(a_lastPos - a_position)) {
    longOffset = tmpNormal * direction * halfWidth;
    shortOffset = normalize(vec2(dirVect.y, -dirVect.x)) * direction * halfWidth;
    longVertex = a_nextPos;
    shortProjVertex = u_projectionMatrix * vec4(a_lastPos, 0.0, 1.0);
  } else {
    shortOffset = tmpNormal * direction * halfWidth;
    longOffset = normalize(vec2(dirVect.y, -dirVect.x)) * direction * halfWidth;
    longVertex = a_lastPos;
    shortProjVertex = u_projectionMatrix * vec4(a_nextPos, 0.0, 1.0);
  }
  //Intersection algorithm based on theory by Paul Bourke (http://paulbourke.net/geometry/pointlineplane/).
  vec4 p1 = u_projectionMatrix * vec4(longVertex, 0.0, 1.0) + offsetMatrix * vec4(longOffset, 0.0, 0.0);
  vec4 p2 = projPos + offsetMatrix * vec4(longOffset, 0.0, 0.0);
  vec4 p3 = shortProjVertex + offsetMatrix * vec4(-shortOffset, 0.0, 0.0);
  vec4 p4 = shortProjVertex + offsetMatrix * vec4(shortOffset, 0.0, 0.0);
  float denom = (p4.y - p3.y) * (p2.x - p1.x) - (p4.x - p3.x) * (p2.y - p1.y);
  float firstU = ((p4.x - p3.x) * (p1.y - p3.y) - (p4.y - p3.y) * (p1.x - p3.x)) / denom;
  float secondU = ((p2.x - p1.x) * (p1.y - p3.y) - (p2.y - p1.y) * (p1.x - p3.x)) / denom;
  float epsilon = 0.000000000001;
  if (firstU > epsilon && firstU < 1.0 - epsilon && secondU > epsilon && secondU < 1.0 - epsilon) {
    shortProjVertex.x = p1.x + firstU * (p2.x - p1.x);
    shortProjVertex.y = p1.y + firstU * (p2.y - p1.y);
    offset = shortProjVertex.xy;
    degenerate = true;
  } else {
    float miterLength = abs(halfWidth / dot(normal, tmpNormal));
    offset = normal * direction * miterLength;
  }
  return degenerate;
}

void squareCap(out vec2 offset, out float round, in bool isRound, in vec2 nextP,
    in float turnDir, in float direction) {
  round = 0.0;
  vec2 dirVect = a_position - nextP;
  vec2 firstNormal = normalize(dirVect);
  vec2 secondNormal = vec2(turnDir * firstNormal.y * direction, -turnDir * firstNormal.x * direction);
  vec2 hypotenuse = normalize(firstNormal - secondNormal);
  vec2 normal = vec2(turnDir * hypotenuse.y * direction, -turnDir * hypotenuse.x * direction);
  float length = sqrt(v_halfWidth * v_halfWidth * 2.0);
  offset = normal * length;
  if (isRound) {
    round = 1.0;
  }
}

void main(void) {
  bool degenerate = false;
  float direction = float(sign(a_direction));
  mat4 offsetMatrix = u_offsetScaleMatrix * u_offsetRotateMatrix;
  vec2 offset;
  vec4 projPos = u_projectionMatrix * vec4(a_position, 0.0, 1.0);
  bool round = nearlyEquals(mod(a_direction, 2.0), 0.0);

  v_round = 0.0;
  v_halfWidth = u_lineWidth / 2.0;
  v_roundVertex = projPos.xy;

  if (nearlyEquals(mod(a_direction, 3.0), 0.0) || nearlyEquals(mod(a_direction, 17.0), 0.0)) {
    alongNormal(offset, a_nextPos, 1.0, direction);
  } else if (nearlyEquals(mod(a_direction, 5.0), 0.0) || nearlyEquals(mod(a_direction, 13.0), 0.0)) {
    alongNormal(offset, a_lastPos, -1.0, direction);
  } else if (nearlyEquals(mod(a_direction, 23.0), 0.0)) {
    miterUp(offset, v_round, round, direction);
  } else if (nearlyEquals(mod(a_direction, 19.0), 0.0)) {
    degenerate = miterDown(offset, projPos, offsetMatrix, direction);
  } else if (nearlyEquals(mod(a_direction, 7.0), 0.0)) {
    squareCap(offset, v_round, round, a_nextPos, 1.0, direction);
  } else if (nearlyEquals(mod(a_direction, 11.0), 0.0)) {
    squareCap(offset, v_round, round, a_lastPos, -1.0, direction);
  }
  if (!degenerate) {
    vec4 offsets = offsetMatrix * vec4(offset, 0.0, 0.0);
    gl_Position = projPos + offsets;
  } else {
    gl_Position = vec4(offset, 0.0, 1.0);
  }
}


`:"varying float a;varying vec2 aVertex;varying float c;attribute vec2 d;attribute vec2 e;attribute vec2 f;attribute float g;uniform mat4 h;uniform mat4 i;uniform mat4 j;uniform float k;uniform float l;bool nearlyEquals(in float value,in float ref){float epsilon=0.000000000001;return value>=ref-epsilon&&value<=ref+epsilon;}void alongNormal(out vec2 offset,in vec2 nextP,in float turnDir,in float direction){vec2 dirVect=nextP-e;vec2 normal=normalize(vec2(-turnDir*dirVect.y,turnDir*dirVect.x));offset=k/2.0*normal*direction;}void miterUp(out vec2 offset,out float round,in bool isRound,in float direction){float halfWidth=k/2.0;vec2 tangent=normalize(normalize(f-e)+normalize(e-d));vec2 normal=vec2(-tangent.y,tangent.x);vec2 dirVect=f-e;vec2 tmpNormal=normalize(vec2(-dirVect.y,dirVect.x));float miterLength=abs(halfWidth/dot(normal,tmpNormal));offset=normal*direction*miterLength;round=0.0;if(isRound){round=1.0;}else if(miterLength>l+k){offset=halfWidth*tmpNormal*direction;}} bool miterDown(out vec2 offset,in vec4 projPos,in mat4 offsetMatrix,in float direction){bool degenerate=false;vec2 tangent=normalize(normalize(f-e)+normalize(e-d));vec2 normal=vec2(-tangent.y,tangent.x);vec2 dirVect=d-e;vec2 tmpNormal=normalize(vec2(-dirVect.y,dirVect.x));vec2 longOffset,shortOffset,longVertex;vec4 shortProjVertex;float halfWidth=k/2.0;if(length(f-e)>length(d-e)){longOffset=tmpNormal*direction*halfWidth;shortOffset=normalize(vec2(dirVect.y,-dirVect.x))*direction*halfWidth;longVertex=f;shortProjVertex=h*vec4(d,0.0,1.0);}else{shortOffset=tmpNormal*direction*halfWidth;longOffset=normalize(vec2(dirVect.y,-dirVect.x))*direction*halfWidth;longVertex=d;shortProjVertex=h*vec4(f,0.0,1.0);}vec4 p1=h*vec4(longVertex,0.0,1.0)+offsetMatrix*vec4(longOffset,0.0,0.0);vec4 p2=projPos+offsetMatrix*vec4(longOffset,0.0,0.0);vec4 p3=shortProjVertex+offsetMatrix*vec4(-shortOffset,0.0,0.0);vec4 p4=shortProjVertex+offsetMatrix*vec4(shortOffset,0.0,0.0);float denom=(p4.y-p3.y)*(p2.x-p1.x)-(p4.x-p3.x)*(p2.y-p1.y);float firstU=((p4.x-p3.x)*(p1.y-p3.y)-(p4.y-p3.y)*(p1.x-p3.x))/denom;float secondU=((p2.x-p1.x)*(p1.y-p3.y)-(p2.y-p1.y)*(p1.x-p3.x))/denom;float epsilon=0.000000000001;if(firstU>epsilon&&firstU<1.0-epsilon&&secondU>epsilon&&secondU<1.0-epsilon){shortProjVertex.x=p1.x+firstU*(p2.x-p1.x);shortProjVertex.y=p1.y+firstU*(p2.y-p1.y);offset=shortProjVertex.xy;degenerate=true;}else{float miterLength=abs(halfWidth/dot(normal,tmpNormal));offset=normal*direction*miterLength;}return degenerate;}void squareCap(out vec2 offset,out float round,in bool isRound,in vec2 nextP,in float turnDir,in float direction){round=0.0;vec2 dirVect=e-nextP;vec2 firstNormal=normalize(dirVect);vec2 secondNormal=vec2(turnDir*firstNormal.y*direction,-turnDir*firstNormal.x*direction);vec2 hypotenuse=normalize(firstNormal-secondNormal);vec2 normal=vec2(turnDir*hypotenuse.y*direction,-turnDir*hypotenuse.x*direction);float length=sqrt(c*c*2.0);offset=normal*length;if(isRound){round=1.0;}} void main(void){bool degenerate=false;float direction=float(sign(g));mat4 offsetMatrix=i*j;vec2 offset;vec4 projPos=h*vec4(e,0.0,1.0);bool round=nearlyEquals(mod(g,2.0),0.0);a=0.0;c=k/2.0;aVertex=projPos.xy;if(nearlyEquals(mod(g,3.0),0.0)||nearlyEquals(mod(g,17.0),0.0)){alongNormal(offset,f,1.0,direction);}else if(nearlyEquals(mod(g,5.0),0.0)||nearlyEquals(mod(g,13.0),0.0)){alongNormal(offset,d,-1.0,direction);}else if(nearlyEquals(mod(g,23.0),0.0)){miterUp(offset,a,round,direction);}else if(nearlyEquals(mod(g,19.0),0.0)){degenerate=miterDown(offset,projPos,offsetMatrix,direction);}else if(nearlyEquals(mod(g,7.0),0.0)){squareCap(offset,a,round,f,1.0,direction);}else if(nearlyEquals(mod(g,11.0),0.0)){squareCap(offset,a,round,d,-1.0,direction);}if(!degenerate){vec4 offsets=offsetMatrix*vec4(offset,0.0,0.0);gl_Position=projPos+offsets;}else{gl_Position=vec4(offset,0.0,1.0);}}");var Ro=function(t,e){this.u_projectionMatrix=t.getUniformLocation(e,_.DEBUG_WEBGL?"u_projectionMatrix":"h"),this.u_offsetScaleMatrix=t.getUniformLocation(e,_.DEBUG_WEBGL?"u_offsetScaleMatrix":"i"),this.u_offsetRotateMatrix=t.getUniformLocation(e,_.DEBUG_WEBGL?"u_offsetRotateMatrix":"j"),this.u_lineWidth=t.getUniformLocation(e,_.DEBUG_WEBGL?"u_lineWidth":"k"),this.u_miterLimit=t.getUniformLocation(e,_.DEBUG_WEBGL?"u_miterLimit":"l"),this.u_opacity=t.getUniformLocation(e,_.DEBUG_WEBGL?"u_opacity":"m"),this.u_color=t.getUniformLocation(e,_.DEBUG_WEBGL?"u_color":"n"),this.u_size=t.getUniformLocation(e,_.DEBUG_WEBGL?"u_size":"o"),this.u_pixelRatio=t.getUniformLocation(e,_.DEBUG_WEBGL?"u_pixelRatio":"p"),this.a_lastPos=t.getAttribLocation(e,_.DEBUG_WEBGL?"a_lastPos":"d"),this.a_position=t.getAttribLocation(e,_.DEBUG_WEBGL?"a_position":"e"),this.a_nextPos=t.getAttribLocation(e,_.DEBUG_WEBGL?"a_nextPos":"f"),this.a_direction=t.getAttribLocation(e,_.DEBUG_WEBGL?"a_direction":"g")},dt=function(t,e){Ee.call(this,t,e),this.defaultLocations_=null,this.styles_=[],this.styleIndices_=[],this.state_={strokeColor:null,lineCap:void 0,lineDash:null,lineDashOffset:void 0,lineJoin:void 0,lineWidth:void 0,miterLimit:void 0,changed:!1}};_.inherits(dt,Ee),dt.prototype.drawCoordinates_=function(t,e,i,r){var n,a,o=this.vertices.length,s=this.indices.length,l=this.state_.lineJoin==="bevel"?0:this.state_.lineJoin==="miter"?1:2,h=this.state_.lineCap==="butt"?0:this.state_.lineCap==="square"?1:2,u=xn.lineStringIsClosed(t,e,i,r),f,c,d,v=s,E=1,p,m,y;for(n=e,a=i;n<a;n+=r){if(d=o/7,p=m,m=y||[t[n],t[n+1]],n===e){if(y=[t[n+r],t[n+r+1]],i-e===r*2&&st.equals(m,y))break;if(u)p=[t[i-r*2],t[i-r*2+1]],f=y;else{h&&(o=this.addVertices_([0,0],m,y,E*dt.Instruction_.BEGIN_LINE_CAP*h,o),o=this.addVertices_([0,0],m,y,-E*dt.Instruction_.BEGIN_LINE_CAP*h,o),this.indices[s++]=d+2,this.indices[s++]=d,this.indices[s++]=d+1,this.indices[s++]=d+1,this.indices[s++]=d+3,this.indices[s++]=d+2),o=this.addVertices_([0,0],m,y,E*dt.Instruction_.BEGIN_LINE*(h||1),o),o=this.addVertices_([0,0],m,y,-E*dt.Instruction_.BEGIN_LINE*(h||1),o),v=o/7-1;continue}}else if(n===i-r)if(u){y=f;break}else{p=p||[0,0],o=this.addVertices_(p,m,[0,0],E*dt.Instruction_.END_LINE*(h||1),o),o=this.addVertices_(p,m,[0,0],-E*dt.Instruction_.END_LINE*(h||1),o),this.indices[s++]=d,this.indices[s++]=v-1,this.indices[s++]=v,this.indices[s++]=v,this.indices[s++]=d+1,this.indices[s++]=d,h&&(o=this.addVertices_(p,m,[0,0],E*dt.Instruction_.END_LINE_CAP*h,o),o=this.addVertices_(p,m,[0,0],-E*dt.Instruction_.END_LINE_CAP*h,o),this.indices[s++]=d+2,this.indices[s++]=d,this.indices[s++]=d+1,this.indices[s++]=d+1,this.indices[s++]=d+3,this.indices[s++]=d+2);break}else y=[t[n+r],t[n+r+1]];c=et.triangleIsCounterClockwise(p[0],p[1],m[0],m[1],y[0],y[1])?-1:1,o=this.addVertices_(p,m,y,c*dt.Instruction_.BEVEL_FIRST*(l||1),o),o=this.addVertices_(p,m,y,c*dt.Instruction_.BEVEL_SECOND*(l||1),o),o=this.addVertices_(p,m,y,-c*dt.Instruction_.MITER_BOTTOM*(l||1),o),n>e&&(this.indices[s++]=d,this.indices[s++]=v-1,this.indices[s++]=v,this.indices[s++]=d+2,this.indices[s++]=d,this.indices[s++]=E*c>0?v:v-1),this.indices[s++]=d,this.indices[s++]=d+2,this.indices[s++]=d+1,v=d+2,E=c,l&&(o=this.addVertices_(p,m,y,c*dt.Instruction_.MITER_TOP*l,o),this.indices[s++]=d+1,this.indices[s++]=d+3,this.indices[s++]=d)}u&&(d=d||o/7,c=Ve.linearRingIsClockwise([p[0],p[1],m[0],m[1],y[0],y[1]],0,6,2)?1:-1,o=this.addVertices_(p,m,y,c*dt.Instruction_.BEVEL_FIRST*(l||1),o),o=this.addVertices_(p,m,y,-c*dt.Instruction_.MITER_BOTTOM*(l||1),o),this.indices[s++]=d,this.indices[s++]=v-1,this.indices[s++]=v,this.indices[s++]=d+1,this.indices[s++]=d,this.indices[s++]=E*c>0?v:v-1)},dt.prototype.addVertices_=function(t,e,i,r,n){return this.vertices[n++]=t[0],this.vertices[n++]=t[1],this.vertices[n++]=e[0],this.vertices[n++]=e[1],this.vertices[n++]=i[0],this.vertices[n++]=i[1],this.vertices[n++]=r,n},dt.prototype.isValid_=function(t,e,i,r){var n=i-e;if(n<r*2)return!1;if(n===r*2){var a=[t[e],t[e+1]],o=[t[e+r],t[e+r+1]];return!st.equals(a,o)}return!0},dt.prototype.drawLineString=function(t,e){var i=t.getFlatCoordinates(),r=t.getStride();this.isValid_(i,0,i.length,r)&&(i=ae.translate(i,0,i.length,r,-this.origin[0],-this.origin[1]),this.state_.changed&&(this.styleIndices_.push(this.indices.length),this.state_.changed=!1),this.startIndices.push(this.indices.length),this.startIndicesFeature.push(e),this.drawCoordinates_(i,0,i.length,r))},dt.prototype.drawMultiLineString=function(t,e){var i=this.indices.length,r=t.getEnds();r.unshift(0);var n=t.getFlatCoordinates(),a=t.getStride(),o,s;if(r.length>1){for(o=1,s=r.length;o<s;++o)if(this.isValid_(n,r[o-1],r[o],a)){var l=ae.translate(n,r[o-1],r[o],a,-this.origin[0],-this.origin[1]);this.drawCoordinates_(l,0,l.length,a)}}this.indices.length>i&&(this.startIndices.push(i),this.startIndicesFeature.push(e),this.state_.changed&&(this.styleIndices_.push(i),this.state_.changed=!1))},dt.prototype.drawPolygonCoordinates=function(t,e,i){if(xn.lineStringIsClosed(t,0,t.length,i)||(t.push(t[0]),t.push(t[1])),this.drawCoordinates_(t,0,t.length,i),e.length){var r,n;for(r=0,n=e.length;r<n;++r)xn.lineStringIsClosed(e[r],0,e[r].length,i)||(e[r].push(e[r][0]),e[r].push(e[r][1])),this.drawCoordinates_(e[r],0,e[r].length,i)}},dt.prototype.setPolygonStyle=function(t,e){var i=e===void 0?this.indices.length:e;this.startIndices.push(i),this.startIndicesFeature.push(t),this.state_.changed&&(this.styleIndices_.push(i),this.state_.changed=!1)},dt.prototype.getCurrentIndex=function(){return this.indices.length},dt.prototype.finish=function(t){this.verticesBuffer=new Ze(this.vertices),this.indicesBuffer=new Ze(this.indices),this.startIndices.push(this.indices.length),this.styleIndices_.length===0&&this.styles_.length>0&&(this.styles_=[]),this.vertices=null,this.indices=null},dt.prototype.getDeleteResourcesFunction=function(t){var e=this.verticesBuffer,i=this.indicesBuffer;return function(){t.deleteBuffer(e),t.deleteBuffer(i)}},dt.prototype.setUpProgram=function(t,e,i,r){var n,a;n=Cn.fragment,a=Cn.vertex;var o=e.getProgram(n,a),s;return this.defaultLocations_?s=this.defaultLocations_:(s=new Ro(t,o),this.defaultLocations_=s),e.useProgram(o),t.enableVertexAttribArray(s.a_lastPos),t.vertexAttribPointer(s.a_lastPos,2,S.FLOAT,!1,28,0),t.enableVertexAttribArray(s.a_position),t.vertexAttribPointer(s.a_position,2,S.FLOAT,!1,28,8),t.enableVertexAttribArray(s.a_nextPos),t.vertexAttribPointer(s.a_nextPos,2,S.FLOAT,!1,28,16),t.enableVertexAttribArray(s.a_direction),t.vertexAttribPointer(s.a_direction,1,S.FLOAT,!1,28,24),t.uniform2fv(s.u_size,i),t.uniform1f(s.u_pixelRatio,r),s},dt.prototype.shutDownProgram=function(t,e){t.disableVertexAttribArray(e.a_lastPos),t.disableVertexAttribArray(e.a_position),t.disableVertexAttribArray(e.a_nextPos),t.disableVertexAttribArray(e.a_direction)},dt.prototype.drawReplay=function(t,e,i,r){var n=t.getParameter(t.DEPTH_FUNC),a=t.getParameter(t.DEPTH_WRITEMASK);if(r||(t.enable(t.DEPTH_TEST),t.depthMask(!0),t.depthFunc(t.NOTEQUAL)),!ht.isEmpty(i))this.drawReplaySkipping_(t,e,i);else{var o,s,l,h;for(l=this.startIndices[this.startIndices.length-1],o=this.styleIndices_.length-1;o>=0;--o)s=this.styleIndices_[o],h=this.styles_[o],this.setStrokeStyle_(t,h[0],h[1],h[2]),this.drawElements(t,e,s,l),t.clear(t.DEPTH_BUFFER_BIT),l=s}r||(t.disable(t.DEPTH_TEST),t.clear(t.DEPTH_BUFFER_BIT),t.depthMask(a),t.depthFunc(n))},dt.prototype.drawReplaySkipping_=function(t,e,i){var r,n,a,o,s,l,h,u,f;for(u=this.startIndices.length-2,a=n=this.startIndices[u+1],r=this.styleIndices_.length-1;r>=0;--r){for(o=this.styles_[r],this.setStrokeStyle_(t,o[0],o[1],o[2]),s=this.styleIndices_[r];u>=0&&this.startIndices[u]>=s;)f=this.startIndices[u],l=this.startIndicesFeature[u],h=_.getUid(l).toString(),i[h]&&(n!==a&&(this.drawElements(t,e,n,a),t.clear(t.DEPTH_BUFFER_BIT)),a=f),u--,n=f;n!==a&&(this.drawElements(t,e,n,a),t.clear(t.DEPTH_BUFFER_BIT)),n=a=s}},dt.prototype.drawHitDetectionReplayOneByOne=function(t,e,i,r,n){var a,o,s,l,h,u,f,c;for(c=this.startIndices.length-2,s=this.startIndices[c+1],a=this.styleIndices_.length-1;a>=0;--a)for(l=this.styles_[a],this.setStrokeStyle_(t,l[0],l[1],l[2]),h=this.styleIndices_[a];c>=0&&this.startIndices[c]>=h;){if(o=this.startIndices[c],u=this.startIndicesFeature[c],f=_.getUid(u).toString(),i[f]===void 0&&u.getGeometry()&&(n===void 0||g.intersects(n,u.getGeometry().getExtent()))){t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),this.drawElements(t,e,o,s);var d=r(u);if(d)return d}c--,s=o}},dt.prototype.setStrokeStyle_=function(t,e,i,r){t.uniform4fv(this.defaultLocations_.u_color,e),t.uniform1f(this.defaultLocations_.u_lineWidth,i),t.uniform1f(this.defaultLocations_.u_miterLimit,r)},dt.prototype.setFillStrokeStyle=function(t,e){var i=e.getLineCap();this.state_.lineCap=i!==void 0?i:et.defaultLineCap;var r=e.getLineDash();this.state_.lineDash=r||et.defaultLineDash;var n=e.getLineDashOffset();this.state_.lineDashOffset=n||et.defaultLineDashOffset;var a=e.getLineJoin();this.state_.lineJoin=a!==void 0?a:et.defaultLineJoin;var o=e.getColor();!(o instanceof CanvasGradient)&&!(o instanceof CanvasPattern)?o=Xt.asArray(o).map(function(h,u){return u!=3?h/255:h})||et.defaultStrokeStyle:o=et.defaultStrokeStyle;var s=e.getWidth();s=s!==void 0?s:et.defaultLineWidth;var l=e.getMiterLimit();l=l!==void 0?l:et.defaultMiterLimit,(!this.state_.strokeColor||!st.equals(this.state_.strokeColor,o)||this.state_.lineWidth!==s||this.state_.miterLimit!==l)&&(this.state_.changed=!0,this.state_.strokeColor=o,this.state_.lineWidth=s,this.state_.miterLimit=l,this.styles_.push([o,s,l]))},dt.Instruction_={ROUND:2,BEGIN_LINE:3,END_LINE:5,BEGIN_LINE_CAP:7,END_LINE_CAP:11,BEVEL_FIRST:13,BEVEL_SECOND:17,MITER_BOTTOM:19,MITER_TOP:23};var In={};In.fragment=new lr(_.DEBUG_WEBGL?`precision mediump float;



uniform vec4 u_color;
uniform float u_opacity;

void main(void) {
  gl_FragColor = u_color;
  float alpha = u_color.a * u_opacity;
  if (alpha == 0.0) {
    discard;
  }
  gl_FragColor.a = alpha;
}
`:"precision mediump float;uniform vec4 e;uniform float f;void main(void){gl_FragColor=e;float alpha=e.a*f;if(alpha==0.0){discard;}gl_FragColor.a=alpha;}"),In.vertex=new hr(_.DEBUG_WEBGL?`

attribute vec2 a_position;

uniform mat4 u_projectionMatrix;
uniform mat4 u_offsetScaleMatrix;
uniform mat4 u_offsetRotateMatrix;

void main(void) {
  gl_Position = u_projectionMatrix * vec4(a_position, 0.0, 1.0);
}


`:"attribute vec2 a;uniform mat4 b;uniform mat4 c;uniform mat4 d;void main(void){gl_Position=b*vec4(a,0.0,1.0);}");var xo=function(t,e){this.u_projectionMatrix=t.getUniformLocation(e,_.DEBUG_WEBGL?"u_projectionMatrix":"b"),this.u_offsetScaleMatrix=t.getUniformLocation(e,_.DEBUG_WEBGL?"u_offsetScaleMatrix":"c"),this.u_offsetRotateMatrix=t.getUniformLocation(e,_.DEBUG_WEBGL?"u_offsetRotateMatrix":"d"),this.u_color=t.getUniformLocation(e,_.DEBUG_WEBGL?"u_color":"e"),this.u_opacity=t.getUniformLocation(e,_.DEBUG_WEBGL?"u_opacity":"f"),this.a_position=t.getAttribLocation(e,_.DEBUG_WEBGL?"a_position":"a")},Oe=function(t){var e=t||{};this.color_=e.color!==void 0?e.color:null,this.lineCap_=e.lineCap,this.lineDash_=e.lineDash!==void 0?e.lineDash:null,this.lineDashOffset_=e.lineDashOffset,this.lineJoin_=e.lineJoin,this.miterLimit_=e.miterLimit,this.width_=e.width,this.checksum_=void 0};Oe.prototype.clone=function(){var t=this.getColor();return new Oe({color:t&&t.slice?t.slice():t||void 0,lineCap:this.getLineCap(),lineDash:this.getLineDash()?this.getLineDash().slice():void 0,lineDashOffset:this.getLineDashOffset(),lineJoin:this.getLineJoin(),miterLimit:this.getMiterLimit(),width:this.getWidth()})},Oe.prototype.getColor=function(){return this.color_},Oe.prototype.getLineCap=function(){return this.lineCap_},Oe.prototype.getLineDash=function(){return this.lineDash_},Oe.prototype.getLineDashOffset=function(){return this.lineDashOffset_},Oe.prototype.getLineJoin=function(){return this.lineJoin_},Oe.prototype.getMiterLimit=function(){return this.miterLimit_},Oe.prototype.getWidth=function(){return this.width_},Oe.prototype.setColor=function(t){this.color_=t,this.checksum_=void 0},Oe.prototype.setLineCap=function(t){this.lineCap_=t,this.checksum_=void 0},Oe.prototype.setLineDash=function(t){this.lineDash_=t,this.checksum_=void 0},Oe.prototype.setLineDashOffset=function(t){this.lineDashOffset_=t,this.checksum_=void 0},Oe.prototype.setLineJoin=function(t){this.lineJoin_=t,this.checksum_=void 0},Oe.prototype.setMiterLimit=function(t){this.miterLimit_=t,this.checksum_=void 0},Oe.prototype.setWidth=function(t){this.width_=t,this.checksum_=void 0},Oe.prototype.getChecksum=function(){return this.checksum_===void 0&&(this.checksum_="s",this.color_?typeof this.color_=="string"?this.checksum_+=this.color_:this.checksum_+=_.getUid(this.color_).toString():this.checksum_+="-",this.checksum_+=","+(this.lineCap_!==void 0?this.lineCap_.toString():"-")+","+(this.lineDash_?this.lineDash_.toString():"-")+","+(this.lineDashOffset_!==void 0?this.lineDashOffset_:"-")+","+(this.lineJoin_!==void 0?this.lineJoin_:"-")+","+(this.miterLimit_!==void 0?this.miterLimit_.toString():"-")+","+(this.width_!==void 0?this.width_.toString():"-")),this.checksum_};var ti=function(t){this.first_=void 0,this.last_=void 0,this.head_=void 0,this.circular_=t===void 0?!0:t,this.length_=0};ti.prototype.insertItem=function(t){var e={prev:void 0,next:void 0,data:t},i=this.head_;if(!i)this.first_=e,this.last_=e,this.circular_&&(e.next=e,e.prev=e);else{var r=i.next;e.prev=i,e.next=r,i.next=e,r&&(r.prev=e),i===this.last_&&(this.last_=e)}this.head_=e,this.length_++},ti.prototype.removeItem=function(){var t=this.head_;if(t){var e=t.next,i=t.prev;e&&(e.prev=i),i&&(i.next=e),this.head_=e||i,this.first_===this.last_?(this.head_=void 0,this.first_=void 0,this.last_=void 0):this.first_===t?this.first_=this.head_:this.last_===t&&(this.last_=i?this.head_.prev:this.head_),this.length_--}},ti.prototype.firstItem=function(){if(this.head_=this.first_,this.head_)return this.head_.data},ti.prototype.lastItem=function(){if(this.head_=this.last_,this.head_)return this.head_.data},ti.prototype.nextItem=function(){if(this.head_&&this.head_.next)return this.head_=this.head_.next,this.head_.data},ti.prototype.getNextItem=function(){if(this.head_&&this.head_.next)return this.head_.next.data},ti.prototype.prevItem=function(){if(this.head_&&this.head_.prev)return this.head_=this.head_.prev,this.head_.data},ti.prototype.getPrevItem=function(){if(this.head_&&this.head_.prev)return this.head_.prev.data},ti.prototype.getCurrItem=function(){if(this.head_)return this.head_.data},ti.prototype.setFirstItem=function(){this.circular_&&this.head_&&(this.first_=this.head_,this.last_=this.head_.prev)},ti.prototype.concat=function(t){if(t.head_){if(this.head_){var e=this.head_.next;this.head_.next=t.first_,t.first_.prev=this.head_,e.prev=t.last_,t.last_.next=e,this.length_+=t.length_}else this.head_=t.head_,this.first_=t.first_,this.last_=t.last_,this.length_=t.length_;t.head_=void 0,t.first_=void 0,t.last_=void 0,t.length_=0}},ti.prototype.getLength=function(){return this.length_};var Je=function(t){this.rbush_=Vn(t),this.items_={}};Je.prototype.insert=function(t,e){var i={minX:t[0],minY:t[1],maxX:t[2],maxY:t[3],value:e};this.rbush_.insert(i),this.items_[_.getUid(e)]=i},Je.prototype.load=function(t,e){for(var i=new Array(e.length),r=0,n=e.length;r<n;r++){var a=t[r],o=e[r],s={minX:a[0],minY:a[1],maxX:a[2],maxY:a[3],value:o};i[r]=s,this.items_[_.getUid(o)]=s}this.rbush_.load(i)},Je.prototype.remove=function(t){var e=_.getUid(t),i=this.items_[e];return delete this.items_[e],this.rbush_.remove(i)!==null},Je.prototype.update=function(t,e){var i=this.items_[_.getUid(e)],r=[i.minX,i.minY,i.maxX,i.maxY];g.equals(r,t)||(this.remove(e),this.insert(t,e))},Je.prototype.getAll=function(){var t=this.rbush_.all();return t.map(function(e){return e.value})},Je.prototype.getInExtent=function(t){var e={minX:t[0],minY:t[1],maxX:t[2],maxY:t[3]},i=this.rbush_.search(e);return i.map(function(r){return r.value})},Je.prototype.forEach=function(t,e){return this.forEach_(this.getAll(),t,e)},Je.prototype.forEachInExtent=function(t,e,i){return this.forEach_(this.getInExtent(t),e,i)},Je.prototype.forEach_=function(t,e,i){for(var r,n=0,a=t.length;n<a;n++)if(r=e.call(i,t[n]),r)return r;return r},Je.prototype.isEmpty=function(){return ht.isEmpty(this.items_)},Je.prototype.clear=function(){this.rbush_.clear(),this.items_={}},Je.prototype.getExtent=function(t){var e=this.rbush_.data;return g.createOrUpdate(e.minX,e.minY,e.maxX,e.maxY,t)},Je.prototype.concat=function(t){this.rbush_.load(t.rbush_.all());for(var e in t.items_)this.items_[e|0]=t.items_[e|0]};var wt=function(t,e){Ee.call(this,t,e),this.lineStringReplay=new dt(t,e),this.defaultLocations_=null,this.styles_=[],this.styleIndices_=[],this.state_={fillColor:null,changed:!1}};_.inherits(wt,Ee),wt.prototype.drawCoordinates_=function(t,e,i){var r=new ti,n=new Je;this.processFlatCoordinates_(t,i,r,n,!0);var a=this.getMaxCoords_(r);if(e.length){var o,s,l=[];for(o=0,s=e.length;o<s;++o){var h={list:new ti,maxCoords:void 0,rtree:new Je};l.push(h),this.processFlatCoordinates_(e[o],i,h.list,h.rtree,!1),this.classifyPoints_(h.list,h.rtree,!0),h.maxCoords=this.getMaxCoords_(h.list)}for(l.sort(function(v,E){return E.maxCoords[0]===v.maxCoords[0]?v.maxCoords[1]-E.maxCoords[1]:E.maxCoords[0]-v.maxCoords[0]}),o=0;o<l.length;++o){var u=l[o].list,f=u.firstItem(),c=f,d;do{if(this.getIntersections_(c,n).length){d=!0;break}c=u.nextItem()}while(f!==c);d||this.bridgeHole_(u,l[o].maxCoords[0],r,a[0],n)&&(n.concat(l[o].rtree),this.classifyPoints_(r,n,!1))}}else this.classifyPoints_(r,n,!1);this.triangulate_(r,n)},wt.prototype.processFlatCoordinates_=function(t,e,i,r,n){var a=Ve.linearRingIsClockwise(t,0,t.length,e),o,s,l=this.vertices.length/2,h,u,f,c=[],d=[];if(n===a){for(h=this.createPoint_(t[0],t[1],l++),u=h,o=e,s=t.length;o<s;o+=e)f=this.createPoint_(t[o],t[o+1],l++),d.push(this.insertItem_(u,f,i)),c.push([Math.min(u.x,f.x),Math.min(u.y,f.y),Math.max(u.x,f.x),Math.max(u.y,f.y)]),u=f;d.push(this.insertItem_(f,h,i)),c.push([Math.min(u.x,f.x),Math.min(u.y,f.y),Math.max(u.x,f.x),Math.max(u.y,f.y)])}else{var v=t.length-e;for(h=this.createPoint_(t[v],t[v+1],l++),u=h,o=v-e,s=0;o>=s;o-=e)f=this.createPoint_(t[o],t[o+1],l++),d.push(this.insertItem_(u,f,i)),c.push([Math.min(u.x,f.x),Math.min(u.y,f.y),Math.max(u.x,f.x),Math.max(u.y,f.y)]),u=f;d.push(this.insertItem_(f,h,i)),c.push([Math.min(u.x,f.x),Math.min(u.y,f.y),Math.max(u.x,f.x),Math.max(u.y,f.y)])}r.load(c,d)},wt.prototype.getMaxCoords_=function(t){var e=t.firstItem(),i=e,r=[i.p0.x,i.p0.y];do i=t.nextItem(),i.p0.x>r[0]&&(r=[i.p0.x,i.p0.y]);while(i!==e);return r},wt.prototype.classifyPoints_=function(t,e,i){var r=t.firstItem(),n=r,a=t.nextItem(),o=!1;do{var s=i?et.triangleIsCounterClockwise(a.p1.x,a.p1.y,n.p1.x,n.p1.y,n.p0.x,n.p0.y):et.triangleIsCounterClockwise(n.p0.x,n.p0.y,n.p1.x,n.p1.y,a.p1.x,a.p1.y);s===void 0?(this.removeItem_(n,a,t,e),o=!0,a===r&&(r=t.getNextItem()),a=n,t.prevItem()):n.p1.reflex!==s&&(n.p1.reflex=s,o=!0),n=a,a=t.nextItem()}while(n!==r);return o},wt.prototype.bridgeHole_=function(t,e,i,r,n){for(var a=t.firstItem();a.p1.x!==e;)a=t.nextItem();var o=a.p1,s={x:r,y:o.y,i:-1},l=1/0,h,u,f,c,d=this.getIntersections_({p0:o,p1:s},n,!0);for(h=0,u=d.length;h<u;++h){var v=d[h],E=this.calculateIntersection_(o,s,v.p0,v.p1,!0),p=Math.abs(o.x-E[0]);p<l&&et.triangleIsCounterClockwise(o.x,o.y,v.p0.x,v.p0.y,v.p1.x,v.p1.y)!==void 0&&(l=p,c={x:E[0],y:E[1],i:-1},a=v)}if(l===1/0)return!1;if(f=a.p1,l>0){var m=this.getPointsInTriangle_(o,c,a.p1,n);if(m.length){var y=1/0;for(h=0,u=m.length;h<u;++h){var R=m[h],C=Math.atan2(o.y-R.y,s.x-R.x);(C<y||C===y&&R.x<f.x)&&(y=C,f=R)}}}for(a=i.firstItem();a.p1.x!==f.x||a.p1.y!==f.y;)a=i.nextItem();var x={x:o.x,y:o.y,i:o.i,reflex:void 0},I={x:a.p1.x,y:a.p1.y,i:a.p1.i,reflex:void 0};return t.getNextItem().p0=x,this.insertItem_(o,a.p1,t,n),this.insertItem_(I,x,t,n),a.p1=I,t.setFirstItem(),i.concat(t),!0},wt.prototype.triangulate_=function(t,e){for(var i=!1,r=this.isSimple_(t,e);t.getLength()>3;)if(r){if(!this.clipEars_(t,e,r,i)&&!this.classifyPoints_(t,e,i)&&!this.resolveSelfIntersections_(t,e,!0))break}else if(!this.clipEars_(t,e,r,i)&&!this.classifyPoints_(t,e,i)&&!this.resolveSelfIntersections_(t,e))if(r=this.isSimple_(t,e),r)i=!this.isClockwise_(t),this.classifyPoints_(t,e,i);else{this.splitPolygon_(t,e);break}if(t.getLength()===3){var n=this.indices.length;this.indices[n++]=t.getPrevItem().p0.i,this.indices[n++]=t.getCurrItem().p0.i,this.indices[n++]=t.getNextItem().p0.i}},wt.prototype.clipEars_=function(t,e,i,r){var n=this.indices.length,a=t.firstItem(),o=t.getPrevItem(),s=a,l=t.nextItem(),h=t.getNextItem(),u,f,c,d=!1;do{if(u=s.p0,f=s.p1,c=l.p1,f.reflex===!1){var v;i?v=this.getPointsInTriangle_(u,f,c,e,!0).length===0:v=r?this.diagonalIsInside_(h.p1,c,f,u,o.p0):this.diagonalIsInside_(o.p0,u,f,c,h.p1),(i||this.getIntersections_({p0:u,p1:c},e).length===0)&&v&&(i||u.reflex===!1||c.reflex===!1||Ve.linearRingIsClockwise([o.p0.x,o.p0.y,u.x,u.y,f.x,f.y,c.x,c.y,h.p1.x,h.p1.y],0,10,2)===!r)&&(this.indices[n++]=u.i,this.indices[n++]=f.i,this.indices[n++]=c.i,this.removeItem_(s,l,t,e),l===a&&(a=h),d=!0)}o=t.getPrevItem(),s=t.getCurrItem(),l=t.nextItem(),h=t.getNextItem()}while(s!==a&&t.getLength()>3);return d},wt.prototype.resolveSelfIntersections_=function(t,e,i){var r=t.firstItem();t.nextItem();var n=r,a=t.nextItem(),o=!1;do{var s=this.calculateIntersection_(n.p0,n.p1,a.p0,a.p1,i);if(s){var l=!1,h=this.vertices.length,u=this.indices.length,f=h/2,c=t.prevItem();t.removeItem(),e.remove(c),l=c===r;var d;if(i?(s[0]===n.p0.x&&s[1]===n.p0.y?(t.prevItem(),d=n.p0,a.p0=d,e.remove(n),l=l||n===r):(d=a.p1,n.p1=d,e.remove(a),l=l||a===r),t.removeItem()):(d=this.createPoint_(s[0],s[1],f),n.p1=d,a.p0=d,e.update([Math.min(n.p0.x,n.p1.x),Math.min(n.p0.y,n.p1.y),Math.max(n.p0.x,n.p1.x),Math.max(n.p0.y,n.p1.y)],n),e.update([Math.min(a.p0.x,a.p1.x),Math.min(a.p0.y,a.p1.y),Math.max(a.p0.x,a.p1.x),Math.max(a.p0.y,a.p1.y)],a)),this.indices[u++]=c.p0.i,this.indices[u++]=c.p1.i,this.indices[u++]=d.i,o=!0,l)break}n=t.getPrevItem(),a=t.nextItem()}while(n!==r);return o},wt.prototype.isSimple_=function(t,e){var i=t.firstItem(),r=i;do{if(this.getIntersections_(r,e).length)return!1;r=t.nextItem()}while(r!==i);return!0},wt.prototype.isClockwise_=function(t){var e=t.getLength()*2,i=new Array(e),r=t.firstItem(),n=r,a=0;do i[a++]=n.p0.x,i[a++]=n.p0.y,n=t.nextItem();while(n!==r);return Ve.linearRingIsClockwise(i,0,e,2)},wt.prototype.splitPolygon_=function(t,e){var i=t.firstItem(),r=i;do{var n=this.getIntersections_(r,e);if(n.length){var a=n[0],o=this.vertices.length/2,s=this.calculateIntersection_(r.p0,r.p1,a.p0,a.p1),l=this.createPoint_(s[0],s[1],o),h=new ti,u=new Je;this.insertItem_(l,r.p1,h,u),r.p1=l,e.update([Math.min(r.p0.x,l.x),Math.min(r.p0.y,l.y),Math.max(r.p0.x,l.x),Math.max(r.p0.y,l.y)],r);for(var f=t.nextItem();f!==a;)this.insertItem_(f.p0,f.p1,h,u),e.remove(f),t.removeItem(),f=t.getCurrItem();this.insertItem_(a.p0,l,h,u),a.p0=l,e.update([Math.min(a.p1.x,l.x),Math.min(a.p1.y,l.y),Math.max(a.p1.x,l.x),Math.max(a.p1.y,l.y)],a),this.classifyPoints_(t,e,!1),this.triangulate_(t,e),this.classifyPoints_(h,u,!1),this.triangulate_(h,u);break}r=t.nextItem()}while(r!==i)},wt.prototype.createPoint_=function(t,e,i){var r=this.vertices.length;this.vertices[r++]=t,this.vertices[r++]=e;var n={x:t,y:e,i,reflex:void 0};return n},wt.prototype.insertItem_=function(t,e,i,r){var n={p0:t,p1:e};return i.insertItem(n),r&&r.insert([Math.min(t.x,e.x),Math.min(t.y,e.y),Math.max(t.x,e.x),Math.max(t.y,e.y)],n),n},wt.prototype.removeItem_=function(t,e,i,r){i.getCurrItem()===e&&(i.removeItem(),t.p1=e.p1,r.remove(e),r.update([Math.min(t.p0.x,t.p1.x),Math.min(t.p0.y,t.p1.y),Math.max(t.p0.x,t.p1.x),Math.max(t.p0.y,t.p1.y)],t))},wt.prototype.getPointsInTriangle_=function(t,e,i,r,n){var a,o,s,l,h=[],u=r.getInExtent([Math.min(t.x,e.x,i.x),Math.min(t.y,e.y,i.y),Math.max(t.x,e.x,i.x),Math.max(t.y,e.y,i.y)]);for(a=0,o=u.length;a<o;++a)for(s in u[a])l=u[a][s],typeof l=="object"&&(!n||l.reflex)&&(l.x!==t.x||l.y!==t.y)&&(l.x!==e.x||l.y!==e.y)&&(l.x!==i.x||l.y!==i.y)&&h.indexOf(l)===-1&&Ye.linearRingContainsXY([t.x,t.y,e.x,e.y,i.x,i.y],0,6,2,l.x,l.y)&&h.push(l);return h},wt.prototype.getIntersections_=function(t,e,i){var r=t.p0,n=t.p1,a=e.getInExtent([Math.min(r.x,n.x),Math.min(r.y,n.y),Math.max(r.x,n.x),Math.max(r.y,n.y)]),o=[],s,l;for(s=0,l=a.length;s<l;++s){var h=a[s];t!==h&&(i||h.p0!==n||h.p1!==r)&&this.calculateIntersection_(r,n,h.p0,h.p1,i)&&o.push(h)}return o},wt.prototype.calculateIntersection_=function(t,e,i,r,n){var a=(r.y-i.y)*(e.x-t.x)-(r.x-i.x)*(e.y-t.y);if(a!==0){var o=((r.x-i.x)*(t.y-i.y)-(r.y-i.y)*(t.x-i.x))/a,s=((e.x-t.x)*(t.y-i.y)-(e.y-t.y)*(t.x-i.x))/a;if(!n&&o>et.EPSILON&&o<1-et.EPSILON&&s>et.EPSILON&&s<1-et.EPSILON||n&&o>=0&&o<=1&&s>=0&&s<=1)return[t.x+o*(e.x-t.x),t.y+o*(e.y-t.y)]}},wt.prototype.diagonalIsInside_=function(t,e,i,r,n){if(e.reflex===void 0||r.reflex===void 0)return!1;var a=(i.x-r.x)*(e.y-r.y)>(i.y-r.y)*(e.x-r.x),o=(n.x-r.x)*(e.y-r.y)<(n.y-r.y)*(e.x-r.x),s=(t.x-e.x)*(r.y-e.y)>(t.y-e.y)*(r.x-e.x),l=(i.x-e.x)*(r.y-e.y)<(i.y-e.y)*(r.x-e.x),h=r.reflex?o||a:o&&a,u=e.reflex?l||s:l&&s;return h&&u},wt.prototype.drawMultiPolygon=function(t,e){var i=t.getEndss(),r=t.getStride(),n=this.indices.length,a=this.lineStringReplay.getCurrentIndex(),o=t.getFlatCoordinates(),s,l,h,u,f=0;for(s=0,l=i.length;s<l;++s){var c=i[s];if(c.length>0){var d=ae.translate(o,f,c[0],r,-this.origin[0],-this.origin[1]);if(d.length){var v=[],E;for(h=1,u=c.length;h<u;++h)c[h]!==c[h-1]&&(E=ae.translate(o,c[h-1],c[h],r,-this.origin[0],-this.origin[1]),v.push(E));this.lineStringReplay.drawPolygonCoordinates(d,v,r),this.drawCoordinates_(d,v,r)}}f=c[c.length-1]}this.indices.length>n&&(this.startIndices.push(n),this.startIndicesFeature.push(e),this.state_.changed&&(this.styleIndices_.push(n),this.state_.changed=!1)),this.lineStringReplay.getCurrentIndex()>a&&this.lineStringReplay.setPolygonStyle(e,a)},wt.prototype.drawPolygon=function(t,e){var i=t.getEnds(),r=t.getStride();if(i.length>0){var n=t.getFlatCoordinates().map(Number),a=ae.translate(n,0,i[0],r,-this.origin[0],-this.origin[1]);if(a.length){var o=[],s,l,h;for(s=1,l=i.length;s<l;++s)i[s]!==i[s-1]&&(h=ae.translate(n,i[s-1],i[s],r,-this.origin[0],-this.origin[1]),o.push(h));this.startIndices.push(this.indices.length),this.startIndicesFeature.push(e),this.state_.changed&&(this.styleIndices_.push(this.indices.length),this.state_.changed=!1),this.lineStringReplay.setPolygonStyle(e),this.lineStringReplay.drawPolygonCoordinates(a,o,r),this.drawCoordinates_(a,o,r)}}},wt.prototype.finish=function(t){this.verticesBuffer=new Ze(this.vertices),this.indicesBuffer=new Ze(this.indices),this.startIndices.push(this.indices.length),this.lineStringReplay.finish(t),this.styleIndices_.length===0&&this.styles_.length>0&&(this.styles_=[]),this.vertices=null,this.indices=null},wt.prototype.getDeleteResourcesFunction=function(t){var e=this.verticesBuffer,i=this.indicesBuffer,r=this.lineStringReplay.getDeleteResourcesFunction(t);return function(){t.deleteBuffer(e),t.deleteBuffer(i),r()}},wt.prototype.setUpProgram=function(t,e,i,r){var n,a;n=In.fragment,a=In.vertex;var o=e.getProgram(n,a),s;return this.defaultLocations_?s=this.defaultLocations_:(s=new xo(t,o),this.defaultLocations_=s),e.useProgram(o),t.enableVertexAttribArray(s.a_position),t.vertexAttribPointer(s.a_position,2,S.FLOAT,!1,8,0),s},wt.prototype.shutDownProgram=function(t,e){t.disableVertexAttribArray(e.a_position)},wt.prototype.drawReplay=function(t,e,i,r){var n=t.getParameter(t.DEPTH_FUNC),a=t.getParameter(t.DEPTH_WRITEMASK);if(r||(t.enable(t.DEPTH_TEST),t.depthMask(!0),t.depthFunc(t.NOTEQUAL)),!ht.isEmpty(i))this.drawReplaySkipping_(t,e,i);else{var o,s,l,h;for(l=this.startIndices[this.startIndices.length-1],o=this.styleIndices_.length-1;o>=0;--o)s=this.styleIndices_[o],h=this.styles_[o],this.setFillStyle_(t,h),this.drawElements(t,e,s,l),l=s}r||(t.disable(t.DEPTH_TEST),t.clear(t.DEPTH_BUFFER_BIT),t.depthMask(a),t.depthFunc(n))},wt.prototype.drawHitDetectionReplayOneByOne=function(t,e,i,r,n){var a,o,s,l,h,u,f,c;for(c=this.startIndices.length-2,s=this.startIndices[c+1],a=this.styleIndices_.length-1;a>=0;--a)for(l=this.styles_[a],this.setFillStyle_(t,l),h=this.styleIndices_[a];c>=0&&this.startIndices[c]>=h;){if(o=this.startIndices[c],u=this.startIndicesFeature[c],f=_.getUid(u).toString(),i[f]===void 0&&u.getGeometry()&&(n===void 0||g.intersects(n,u.getGeometry().getExtent()))){t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),this.drawElements(t,e,o,s);var d=r(u);if(d)return d}c--,s=o}},wt.prototype.drawReplaySkipping_=function(t,e,i){var r,n,a,o,s,l,h,u,f;for(u=this.startIndices.length-2,a=n=this.startIndices[u+1],r=this.styleIndices_.length-1;r>=0;--r){for(o=this.styles_[r],this.setFillStyle_(t,o),s=this.styleIndices_[r];u>=0&&this.startIndices[u]>=s;)f=this.startIndices[u],l=this.startIndicesFeature[u],h=_.getUid(l).toString(),i[h]&&(n!==a&&(this.drawElements(t,e,n,a),t.clear(t.DEPTH_BUFFER_BIT)),a=f),u--,n=f;n!==a&&(this.drawElements(t,e,n,a),t.clear(t.DEPTH_BUFFER_BIT)),n=a=s}},wt.prototype.setFillStyle_=function(t,e){t.uniform4fv(this.defaultLocations_.u_color,e)},wt.prototype.setFillStrokeStyle=function(t,e){var i=t?t.getColor():[0,0,0,0];if(!(i instanceof CanvasGradient)&&!(i instanceof CanvasPattern)?i=Xt.asArray(i).map(function(n,a){return a!=3?n/255:n})||et.defaultFillStyle:i=et.defaultFillStyle,(!this.state_.fillColor||!st.equals(i,this.state_.fillColor))&&(this.state_.fillColor=i,this.state_.changed=!0,this.styles_.push(i)),e)this.lineStringReplay.setFillStrokeStyle(null,e);else{var r=new Oe({color:[0,0,0,0],lineWidth:0});this.lineStringReplay.setFillStrokeStyle(null,r)}};var xr=function(t,e){this.space_=e,this.emptyBlocks_=[{x:0,y:0,width:t,height:t}],this.entries_={},this.context_=At.createCanvasContext2D(t,t),this.canvas_=this.context_.canvas};xr.prototype.get=function(t){return this.entries_[t]||null},xr.prototype.add=function(t,e,i,r,n){var a,o,s;for(o=0,s=this.emptyBlocks_.length;o<s;++o)if(a=this.emptyBlocks_[o],a.width>=e+this.space_&&a.height>=i+this.space_){var l={offsetX:a.x+this.space_,offsetY:a.y+this.space_,image:this.canvas_};return this.entries_[t]=l,r.call(n,this.context_,a.x+this.space_,a.y+this.space_),this.split_(o,a,e+this.space_,i+this.space_),l}return null},xr.prototype.split_=function(t,e,i,r){var n=e.width-i,a=e.height-r,o,s;n>a?(o={x:e.x+i,y:e.y,width:e.width-i,height:e.height},s={x:e.x,y:e.y+r,width:i,height:e.height-r},this.updateBlocks_(t,o,s)):(o={x:e.x+i,y:e.y,width:e.width-i,height:r},s={x:e.x,y:e.y+r,width:e.width,height:e.height-r},this.updateBlocks_(t,o,s))},xr.prototype.updateBlocks_=function(t,e,i){var r=[t,1];e.width>0&&e.height>0&&r.push(e),i.width>0&&i.height>0&&r.push(i),this.emptyBlocks_.splice.apply(this.emptyBlocks_,r)};var kr=function(t){var e=t||{};this.currentSize_=e.initialSize!==void 0?e.initialSize:_.INITIAL_ATLAS_SIZE,this.maxSize_=e.maxSize!==void 0?e.maxSize:_.MAX_ATLAS_SIZE!=-1?_.MAX_ATLAS_SIZE:_.WEBGL_MAX_TEXTURE_SIZE!==void 0?_.WEBGL_MAX_TEXTURE_SIZE:2048,this.space_=e.space!==void 0?e.space:1,this.atlases_=[new xr(this.currentSize_,this.space_)],this.currentHitSize_=this.currentSize_,this.hitAtlases_=[new xr(this.currentHitSize_,this.space_)]};kr.prototype.getInfo=function(t){var e=this.getInfo_(this.atlases_,t);if(!e)return null;var i=this.getInfo_(this.hitAtlases_,t);return this.mergeInfos_(e,i)},kr.prototype.getInfo_=function(t,e){var i,r,n,a;for(n=0,a=t.length;n<a;++n)if(i=t[n],r=i.get(e),r)return r;return null},kr.prototype.mergeInfos_=function(t,e){return{offsetX:t.offsetX,offsetY:t.offsetY,image:t.image,hitImage:e.image}},kr.prototype.add=function(t,e,i,r,n,a){if(e+this.space_>this.maxSize_||i+this.space_>this.maxSize_)return null;var o=this.add_(!1,t,e,i,r,a);if(!o)return null;var s=n!==void 0?n:_.nullFunction,l=this.add_(!0,t,e,i,s,a);return this.mergeInfos_(o,l)},kr.prototype.add_=function(t,e,i,r,n,a){var o=t?this.hitAtlases_:this.atlases_,s,l,h,u;for(h=0,u=o.length;h<u;++h){if(s=o[h],l=s.add(e,i,r,n,a),l)return l;if(!l&&h===u-1){var f;t?(f=Math.min(this.currentHitSize_*2,this.maxSize_),this.currentHitSize_=f):(f=Math.min(this.currentSize_*2,this.maxSize_),this.currentSize_=f),s=new xr(f,this.space_),o.push(s),++u}}return null};var gi=function(t,e){we.call(this,t,e),this.images_=[],this.textures_=[],this.measureCanvas_=At.createCanvasContext2D(0,0).canvas,this.state_={strokeColor:null,lineCap:void 0,lineDash:null,lineDashOffset:void 0,lineJoin:void 0,lineWidth:0,miterLimit:void 0,fillColor:null,font:void 0,scale:void 0},this.text_="",this.textAlign_=void 0,this.textBaseline_=void 0,this.offsetX_=void 0,this.offsetY_=void 0,this.atlases_={},this.currAtlas_=void 0,this.scale=1,this.opacity=1};_.inherits(gi,we),gi.prototype.drawText=function(t,e){if(this.text_){var i=null,r=0,n=2,a=2;switch(t.getType()){case K.POINT:case K.MULTI_POINT:i=t.getFlatCoordinates(),n=i.length,a=t.getStride();break;case K.CIRCLE:i=t.getCenter();break;case K.LINE_STRING:i=t.getFlatMidpoint();break;case K.MULTI_LINE_STRING:i=t.getFlatMidpoints(),n=i.length;break;case K.POLYGON:i=t.getFlatInteriorPoint();break;case K.MULTI_POLYGON:i=t.getFlatInteriorPoints(),n=i.length;break}this.startIndices.push(this.indices.length),this.startIndicesFeature.push(e);var o=this.currAtlas_,s=this.text_.split(`
`),l=this.getTextSize_(s),h,u,f,c,d,v,E,p,m=Math.round(l[0]*this.textAlign_-this.offsetX_),y=Math.round(l[1]*this.textBaseline_-this.offsetY_),R=this.state_.lineWidth/2*this.state_.scale;for(h=0,u=s.length;h<u;++h)for(d=0,v=o.height*h,E=s[h].split(""),f=0,c=E.length;f<c;++f){if(p=o.atlas.getInfo(E[f]),p){var C=p.image;this.anchorX=m-d,this.anchorY=y-v,this.originX=f===0?p.offsetX-R:p.offsetX,this.originY=p.offsetY,this.height=o.height,this.width=f===0||f===E.length-1?o.width[E[f]]+R:o.width[E[f]],this.imageHeight=C.height,this.imageWidth=C.width;var x;this.images_.length===0?this.images_.push(C):(x=this.images_[this.images_.length-1],_.getUid(x)!=_.getUid(C)&&(this.groupIndices.push(this.indices.length),this.images_.push(C))),this.drawText_(i,r,n,a)}d+=this.width}}},gi.prototype.getTextSize_=function(t){var e=this,i=this.currAtlas_,r=t.length*i.height,n=t.map(function(a){var o=0,s,l;for(s=0,l=a.length;s<l;++s){var h=a[s];i.width[h]||e.addCharToAtlas_(h),o+=i.width[h]?i.width[h]:0}return o}).reduce(function(a,o){return Math.max(a,o)});return[n,r]},gi.prototype.drawText_=function(t,e,i,r){var n,a;for(n=e,a=i;n<a;n+=r)this.drawCoordinates(t,e,i,r)},gi.prototype.addCharToAtlas_=function(t){if(t.length===1){var e=this.currAtlas_,i=this.state_,r=this.measureCanvas_.getContext("2d");r.font=i.font;var n=Math.ceil(r.measureText(t).width*i.scale),a=e.atlas.add(t,n,e.height,function(o,s,l){o.font=i.font,o.fillStyle=i.fillColor,o.strokeStyle=i.strokeColor,o.lineWidth=i.lineWidth,o.lineCap=i.lineCap,o.lineJoin=i.lineJoin,o.miterLimit=i.miterLimit,o.textAlign="left",o.textBaseline="top",_t.CANVAS_LINE_DASH&&i.lineDash&&(o.setLineDash(i.lineDash),o.lineDashOffset=i.lineDashOffset),i.scale!==1&&o.setTransform(i.scale,0,0,i.scale,0,0),i.strokeColor&&o.strokeText(t,s,l),i.fillColor&&o.fillText(t,s,l)});a&&(e.width[t]=n)}},gi.prototype.finish=function(t){var e=t.getGL();this.groupIndices.push(this.indices.length),this.hitDetectionGroupIndices=this.groupIndices,this.verticesBuffer=new Ze(this.vertices),this.indicesBuffer=new Ze(this.indices);var i={};this.createTextures(this.textures_,this.images_,i,e),this.state_={strokeColor:null,lineCap:void 0,lineDash:null,lineDashOffset:void 0,lineJoin:void 0,lineWidth:0,miterLimit:void 0,fillColor:null,font:void 0,scale:void 0},this.text_="",this.textAlign_=void 0,this.textBaseline_=void 0,this.offsetX_=void 0,this.offsetY_=void 0,this.images_=null,this.atlases_={},this.currAtlas_=void 0,we.prototype.finish.call(this,t)},gi.prototype.setTextStyle=function(t){var e=this.state_,i=t.getFill(),r=t.getStroke();if(!t||!t.getText()||!i&&!r)this.text_="";else{if(!i)e.fillColor=null;else{var n=i.getColor();e.fillColor=li.asColorLike(n||et.defaultFillStyle)}if(!r)e.strokeColor=null,e.lineWidth=0;else{var a=r.getColor();e.strokeColor=li.asColorLike(a||et.defaultStrokeStyle),e.lineWidth=r.getWidth()||et.defaultLineWidth,e.lineCap=r.getLineCap()||et.defaultLineCap,e.lineDashOffset=r.getLineDashOffset()||et.defaultLineDashOffset,e.lineJoin=r.getLineJoin()||et.defaultLineJoin,e.miterLimit=r.getMiterLimit()||et.defaultMiterLimit;var o=r.getLineDash();e.lineDash=o?o.slice():et.defaultLineDash}e.font=t.getFont()||et.defaultFont,e.scale=t.getScale()||1,this.text_=t.getText();var s=Ut.TEXT_ALIGN[t.getTextAlign()],l=Ut.TEXT_ALIGN[t.getTextBaseline()];this.textAlign_=s===void 0?et.defaultTextAlign:s,this.textBaseline_=l===void 0?et.defaultTextBaseline:l,this.offsetX_=t.getOffsetX()||0,this.offsetY_=t.getOffsetY()||0,this.rotateWithView=!!t.getRotateWithView(),this.rotation=t.getRotation()||0,this.currAtlas_=this.getAtlas_(e)}},gi.prototype.getAtlas_=function(t){var e=[],i;for(i in t)(t[i]||t[i]===0)&&(Array.isArray(t[i])?e=e.concat(t[i]):e.push(t[i]));var r=this.calculateHash_(e);if(!this.atlases_[r]){var n=this.measureCanvas_.getContext("2d");n.font=t.font;var a=Math.ceil((n.measureText("M").width*1.5+t.lineWidth/2)*t.scale);this.atlases_[r]={atlas:new kr({space:t.lineWidth+1}),width:{},height:a}}return this.atlases_[r]},gi.prototype.calculateHash_=function(t){var e,i,r="";for(e=0,i=t.length;e<i;++e)r+=t[e];return r},gi.prototype.getTextures=function(t){return this.textures_},gi.prototype.getHitDetectionTextures=function(){return this.textures_};var $t=function(t,e,i){Wr.call(this),this.maxExtent_=e,this.tolerance_=t,this.renderBuffer_=i,this.replaysByZIndex_={}};_.inherits($t,Wr),$t.prototype.addDeclutter=function(t,e){},$t.prototype.getDeleteResourcesFunction=function(t){var e=[],i;for(i in this.replaysByZIndex_){var r=this.replaysByZIndex_[i],n;for(n in r)e.push(r[n].getDeleteResourcesFunction(t))}return function(){for(var a=e.length,o,s=0;s<a;s++)o=e[s].apply(this,arguments);return o}},$t.prototype.finish=function(t){var e;for(e in this.replaysByZIndex_){var i=this.replaysByZIndex_[e],r;for(r in i)i[r].finish(t)}},$t.prototype.getReplay=function(t,e){var i=t!==void 0?t.toString():"0",r=this.replaysByZIndex_[i];r===void 0&&(r={},this.replaysByZIndex_[i]=r);var n=r[e];if(n===void 0){var a=$t.BATCH_CONSTRUCTORS_[e];n=new a(this.tolerance_,this.maxExtent_),r[e]=n}return n},$t.prototype.isEmpty=function(){return ht.isEmpty(this.replaysByZIndex_)},$t.prototype.replay=function(t,e,i,r,n,a,o,s){var l=Object.keys(this.replaysByZIndex_).map(Number);l.sort(st.numberSafeCompareFunction);var h,u,f,c,d,v;for(h=0,u=l.length;h<u;++h)for(d=this.replaysByZIndex_[l[h].toString()],f=0,c=Ut.ORDER.length;f<c;++f)v=d[Ut.ORDER[f]],v!==void 0&&v.replay(t,e,i,r,n,a,o,s,void 0,!1)},$t.prototype.replayHitDetection_=function(t,e,i,r,n,a,o,s,l,h,u){var f=Object.keys(this.replaysByZIndex_).map(Number);f.sort(function(y,R){return R-y});var c,d,v,E,p,m;for(c=0,d=f.length;c<d;++c)for(E=this.replaysByZIndex_[f[c].toString()],v=Ut.ORDER.length-1;v>=0;--v)if(p=E[Ut.ORDER[v]],p!==void 0&&(m=p.replay(t,e,i,r,n,a,o,s,l,h,u),m))return m},$t.prototype.forEachFeatureAtCoordinate=function(t,e,i,r,n,a,o,s,l,h){var u=e.getGL();u.bindFramebuffer(u.FRAMEBUFFER,e.getHitDetectionFramebuffer());var f;return this.renderBuffer_!==void 0&&(f=g.buffer(g.createOrUpdateFromCoordinate(t),r*this.renderBuffer_)),this.replayHitDetection_(e,t,r,n,$t.HIT_DETECTION_SIZE_,o,s,l,function(c){var d=new Uint8Array(4);if(u.readPixels(0,0,1,1,u.RGBA,u.UNSIGNED_BYTE,d),d[3]>0){var v=h(c);if(v)return v}},!0,f)},$t.prototype.hasFeatureAtCoordinate=function(t,e,i,r,n,a,o,s,l){var h=e.getGL();h.bindFramebuffer(h.FRAMEBUFFER,e.getHitDetectionFramebuffer());var u=this.replayHitDetection_(e,t,r,n,$t.HIT_DETECTION_SIZE_,o,s,l,function(f){var c=new Uint8Array(4);return h.readPixels(0,0,1,1,h.RGBA,h.UNSIGNED_BYTE,c),c[3]>0},!1);return u!==void 0},$t.HIT_DETECTION_SIZE_=[1,1],$t.BATCH_CONSTRUCTORS_={Circle:ai,Image:ur,LineString:dt,Polygon:wt,Text:gi};var Pe=function(t,e,i,r,n,a,o){Kt.call(this),this.context_=t,this.center_=e,this.extent_=a,this.pixelRatio_=o,this.size_=n,this.rotation_=r,this.resolution_=i,this.imageStyle_=null,this.fillStyle_=null,this.strokeStyle_=null,this.textStyle_=null};_.inherits(Pe,Kt),Pe.prototype.drawText_=function(t,e){var i=this.context_,r=t.getReplay(0,nt.TEXT);r.setTextStyle(this.textStyle_),r.drawText(e,null),r.finish(i);var n=1,a={},o,s=!1;r.replay(this.context_,this.center_,this.resolution_,this.rotation_,this.size_,this.pixelRatio_,n,a,o,s),r.getDeleteResourcesFunction(i)()},Pe.prototype.setStyle=function(t){this.setFillStrokeStyle(t.getFill(),t.getStroke()),this.setImageStyle(t.getImage()),this.setTextStyle(t.getText())},Pe.prototype.drawGeometry=function(t){var e=t.getType();switch(e){case K.POINT:this.drawPoint(t,null);break;case K.LINE_STRING:this.drawLineString(t,null);break;case K.POLYGON:this.drawPolygon(t,null);break;case K.MULTI_POINT:this.drawMultiPoint(t,null);break;case K.MULTI_LINE_STRING:this.drawMultiLineString(t,null);break;case K.MULTI_POLYGON:this.drawMultiPolygon(t,null);break;case K.GEOMETRY_COLLECTION:this.drawGeometryCollection(t,null);break;case K.CIRCLE:this.drawCircle(t,null);break}},Pe.prototype.drawFeature=function(t,e){var i=e.getGeometryFunction()(t);!i||!g.intersects(this.extent_,i.getExtent())||(this.setStyle(e),this.drawGeometry(i))},Pe.prototype.drawGeometryCollection=function(t,e){var i=t.getGeometriesArray(),r,n;for(r=0,n=i.length;r<n;++r)this.drawGeometry(i[r])},Pe.prototype.drawPoint=function(t,e){var i=this.context_,r=new $t(1,this.extent_),n=r.getReplay(0,nt.IMAGE);n.setImageStyle(this.imageStyle_),n.drawPoint(t,e),n.finish(i);var a=1,o={},s,l=!1;n.replay(this.context_,this.center_,this.resolution_,this.rotation_,this.size_,this.pixelRatio_,a,o,s,l),n.getDeleteResourcesFunction(i)(),this.textStyle_&&this.drawText_(r,t)},Pe.prototype.drawMultiPoint=function(t,e){var i=this.context_,r=new $t(1,this.extent_),n=r.getReplay(0,nt.IMAGE);n.setImageStyle(this.imageStyle_),n.drawMultiPoint(t,e),n.finish(i);var a=1,o={},s,l=!1;n.replay(this.context_,this.center_,this.resolution_,this.rotation_,this.size_,this.pixelRatio_,a,o,s,l),n.getDeleteResourcesFunction(i)(),this.textStyle_&&this.drawText_(r,t)},Pe.prototype.drawLineString=function(t,e){var i=this.context_,r=new $t(1,this.extent_),n=r.getReplay(0,nt.LINE_STRING);n.setFillStrokeStyle(null,this.strokeStyle_),n.drawLineString(t,e),n.finish(i);var a=1,o={},s,l=!1;n.replay(this.context_,this.center_,this.resolution_,this.rotation_,this.size_,this.pixelRatio_,a,o,s,l),n.getDeleteResourcesFunction(i)(),this.textStyle_&&this.drawText_(r,t)},Pe.prototype.drawMultiLineString=function(t,e){var i=this.context_,r=new $t(1,this.extent_),n=r.getReplay(0,nt.LINE_STRING);n.setFillStrokeStyle(null,this.strokeStyle_),n.drawMultiLineString(t,e),n.finish(i);var a=1,o={},s,l=!1;n.replay(this.context_,this.center_,this.resolution_,this.rotation_,this.size_,this.pixelRatio_,a,o,s,l),n.getDeleteResourcesFunction(i)(),this.textStyle_&&this.drawText_(r,t)},Pe.prototype.drawPolygon=function(t,e){var i=this.context_,r=new $t(1,this.extent_),n=r.getReplay(0,nt.POLYGON);n.setFillStrokeStyle(this.fillStyle_,this.strokeStyle_),n.drawPolygon(t,e),n.finish(i);var a=1,o={},s,l=!1;n.replay(this.context_,this.center_,this.resolution_,this.rotation_,this.size_,this.pixelRatio_,a,o,s,l),n.getDeleteResourcesFunction(i)(),this.textStyle_&&this.drawText_(r,t)},Pe.prototype.drawMultiPolygon=function(t,e){var i=this.context_,r=new $t(1,this.extent_),n=r.getReplay(0,nt.POLYGON);n.setFillStrokeStyle(this.fillStyle_,this.strokeStyle_),n.drawMultiPolygon(t,e),n.finish(i);var a=1,o={},s,l=!1;n.replay(this.context_,this.center_,this.resolution_,this.rotation_,this.size_,this.pixelRatio_,a,o,s,l),n.getDeleteResourcesFunction(i)(),this.textStyle_&&this.drawText_(r,t)},Pe.prototype.drawCircle=function(t,e){var i=this.context_,r=new $t(1,this.extent_),n=r.getReplay(0,nt.CIRCLE);n.setFillStrokeStyle(this.fillStyle_,this.strokeStyle_),n.drawCircle(t,e),n.finish(i);var a=1,o={},s,l=!1;n.replay(this.context_,this.center_,this.resolution_,this.rotation_,this.size_,this.pixelRatio_,a,o,s,l),n.getDeleteResourcesFunction(i)(),this.textStyle_&&this.drawText_(r,t)},Pe.prototype.setImageStyle=function(t){this.imageStyle_=t},Pe.prototype.setFillStrokeStyle=function(t,e){this.fillStyle_=t,this.strokeStyle_=e},Pe.prototype.setTextStyle=function(t){this.textStyle_=t};var Sn={};Sn.fragment=new lr(_.DEBUG_WEBGL?`precision mediump float;
varying vec2 v_texCoord;


uniform float u_opacity;
uniform sampler2D u_texture;

void main(void) {
  vec4 texColor = texture2D(u_texture, v_texCoord);
  gl_FragColor.rgb = texColor.rgb;
  gl_FragColor.a = texColor.a * u_opacity;
}
`:"precision mediump float;varying vec2 a;uniform float f;uniform sampler2D g;void main(void){vec4 texColor=texture2D(g,a);gl_FragColor.rgb=texColor.rgb;gl_FragColor.a=texColor.a*f;}"),Sn.vertex=new hr(_.DEBUG_WEBGL?`varying vec2 v_texCoord;


attribute vec2 a_position;
attribute vec2 a_texCoord;

uniform mat4 u_texCoordMatrix;
uniform mat4 u_projectionMatrix;

void main(void) {
  gl_Position = u_projectionMatrix * vec4(a_position, 0., 1.);
  v_texCoord = (u_texCoordMatrix * vec4(a_texCoord, 0., 1.)).st;
}


`:"varying vec2 a;attribute vec2 b;attribute vec2 c;uniform mat4 d;uniform mat4 e;void main(void){gl_Position=e*vec4(b,0.,1.);a=(d*vec4(c,0.,1.)).st;}");var Co=function(t,e){this.u_texCoordMatrix=t.getUniformLocation(e,_.DEBUG_WEBGL?"u_texCoordMatrix":"d"),this.u_projectionMatrix=t.getUniformLocation(e,_.DEBUG_WEBGL?"u_projectionMatrix":"e"),this.u_opacity=t.getUniformLocation(e,_.DEBUG_WEBGL?"u_opacity":"f"),this.u_texture=t.getUniformLocation(e,_.DEBUG_WEBGL?"u_texture":"g"),this.a_position=t.getAttribLocation(e,_.DEBUG_WEBGL?"a_position":"b"),this.a_texCoord=t.getAttribLocation(e,_.DEBUG_WEBGL?"a_texCoord":"c")},Te=function(t,e){ze.call(this,e),this.mapRenderer=t,this.arrayBuffer_=new Ze([-1,-1,0,0,1,-1,1,0,-1,1,0,1,1,1,1,1]),this.texture=null,this.framebuffer=null,this.framebufferDimension=void 0,this.texCoordMatrix=A.create(),this.projectionMatrix=A.create(),this.tmpMat4_=er.create(),this.defaultLocations_=null};_.inherits(Te,ze),Te.prototype.bindFramebuffer=function(t,e){var i=this.mapRenderer.getGL();if(this.framebufferDimension===void 0||this.framebufferDimension!=e){var r=(function(o,s,l){o.isContextLost()||(o.deleteFramebuffer(s),o.deleteTexture(l))}).bind(null,i,this.framebuffer,this.texture);t.postRenderFunctions.push(r);var n=qt.createEmptyTexture(i,e,e),a=i.createFramebuffer();i.bindFramebuffer(S.FRAMEBUFFER,a),i.framebufferTexture2D(S.FRAMEBUFFER,S.COLOR_ATTACHMENT0,S.TEXTURE_2D,n,0),this.texture=n,this.framebuffer=a,this.framebufferDimension=e}else i.bindFramebuffer(S.FRAMEBUFFER,this.framebuffer)},Te.prototype.composeFrame=function(t,e,i){this.dispatchComposeEvent_(Ri.PRECOMPOSE,i,t),i.bindBuffer(S.ARRAY_BUFFER,this.arrayBuffer_);var r=i.getGL(),n=Sn.fragment,a=Sn.vertex,o=i.getProgram(n,a),s;this.defaultLocations_?s=this.defaultLocations_:(s=new Co(r,o),this.defaultLocations_=s),i.useProgram(o)&&(r.enableVertexAttribArray(s.a_position),r.vertexAttribPointer(s.a_position,2,S.FLOAT,!1,16,0),r.enableVertexAttribArray(s.a_texCoord),r.vertexAttribPointer(s.a_texCoord,2,S.FLOAT,!1,16,8),r.uniform1i(s.u_texture,0)),r.uniformMatrix4fv(s.u_texCoordMatrix,!1,er.fromTransform(this.tmpMat4_,this.getTexCoordMatrix())),r.uniformMatrix4fv(s.u_projectionMatrix,!1,er.fromTransform(this.tmpMat4_,this.getProjectionMatrix())),r.uniform1f(s.u_opacity,e.opacity),r.bindTexture(S.TEXTURE_2D,this.getTexture()),r.drawArrays(S.TRIANGLE_STRIP,0,4),this.dispatchComposeEvent_(Ri.POSTCOMPOSE,i,t)},Te.prototype.dispatchComposeEvent_=function(t,e,i){var r=this.getLayer();if(r.hasListener(t)){var n=i.viewState,a=n.resolution,o=i.pixelRatio,s=i.extent,l=n.center,h=n.rotation,u=i.size,f=new Pe(e,l,a,h,u,s,o),c=new Jr(t,f,i,null,e);r.dispatchEvent(c)}},Te.prototype.getTexCoordMatrix=function(){return this.texCoordMatrix},Te.prototype.getTexture=function(){return this.texture},Te.prototype.getProjectionMatrix=function(){return this.projectionMatrix},Te.prototype.handleWebGLContextLost=function(){this.texture=null,this.framebuffer=null,this.framebufferDimension=void 0},Te.prototype.prepareFrame=function(t,e,i){},Te.prototype.forEachLayerAtPixel=function(t,e,i,r){};var yi=function(t,e){Te.call(this,t,e),this.image_=null,this.hitCanvasContext_=null,this.hitTransformationMatrix_=null};_.inherits(yi,Te),yi.handles=function(t,e){return t===ri.WEBGL&&e.getType()===Pi.IMAGE},yi.create=function(t,e){return new yi(t,e)},yi.prototype.createTexture_=function(t){var e=t.getImage(),i=this.mapRenderer.getGL();return qt.createTexture(i,e,S.CLAMP_TO_EDGE,S.CLAMP_TO_EDGE)},yi.prototype.forEachFeatureAtCoordinate=function(t,e,i,r,n){var a=this.getLayer(),o=a.getSource(),s=e.viewState.resolution,l=e.viewState.rotation,h=e.skippedFeatureUids;return o.forEachFeatureAtCoordinate(t,s,l,i,h,function(u){return r.call(n,u,a)})},yi.prototype.prepareFrame=function(t,e,i){var r=this.mapRenderer.getGL(),n=t.pixelRatio,a=t.viewState,o=a.center,s=a.resolution,l=a.rotation,h=this.image_,u=this.texture,f=this.getLayer(),c=f.getSource(),d=t.viewHints,v=t.extent;if(e.extent!==void 0&&(v=g.getIntersection(v,e.extent)),!d[Pt.ANIMATING]&&!d[Pt.INTERACTING]&&!g.isEmpty(v)){var E=a.projection;if(!_.ENABLE_RASTER_REPROJECTION){var p=c.getProjection();p&&(E=p)}var m=c.getImage(v,s,n,E);if(m){var y=this.loadImage(m);if(y&&(h=m,u=this.createTexture_(m),this.texture)){var R=(function(I,D){I.isContextLost()||I.deleteTexture(D)}).bind(null,r,this.texture);t.postRenderFunctions.push(R)}}}if(h){var C=this.mapRenderer.getContext().getCanvas();this.updateProjectionMatrix_(C.width,C.height,n,o,s,l,h.getExtent()),this.hitTransformationMatrix_=null;var x=this.texCoordMatrix;A.reset(x),A.scale(x,1,-1),A.translate(x,0,-1),this.image_=h,this.texture=u,this.updateLogos(t,c)}return!!h},yi.prototype.updateProjectionMatrix_=function(t,e,i,r,n,a,o){var s=t*n,l=e*n,h=this.projectionMatrix;A.reset(h),A.scale(h,i*2/s,i*2/l),A.rotate(h,-a),A.translate(h,o[0]-r[0],o[1]-r[1]),A.scale(h,(o[2]-o[0])/2,(o[3]-o[1])/2),A.translate(h,1,1)},yi.prototype.hasFeatureAtCoordinate=function(t,e){var i=this.forEachFeatureAtCoordinate(t,e,0,ne.TRUE,this);return i!==void 0},yi.prototype.forEachLayerAtPixel=function(t,e,i,r){if(!(!this.image_||!this.image_.getImage()))if(this.getLayer().getSource().forEachFeatureAtCoordinate!==_.nullFunction){var n=A.apply(e.pixelToCoordinateTransform,t.slice()),a=this.forEachFeatureAtCoordinate(n,e,0,ne.TRUE,this);return a?i.call(r,this.getLayer(),null):void 0}else{var o=[this.image_.getImage().width,this.image_.getImage().height];this.hitTransformationMatrix_||(this.hitTransformationMatrix_=this.getHitTransformationMatrix_(e.size,o));var s=A.apply(this.hitTransformationMatrix_,t.slice());if(s[0]<0||s[0]>o[0]||s[1]<0||s[1]>o[1])return;this.hitCanvasContext_||(this.hitCanvasContext_=At.createCanvasContext2D(1,1)),this.hitCanvasContext_.clearRect(0,0,1,1),this.hitCanvasContext_.drawImage(this.image_.getImage(),s[0],s[1],1,1,0,0,1,1);var l=this.hitCanvasContext_.getImageData(0,0,1,1).data;return l[3]>0?i.call(r,this.getLayer(),l):void 0}},yi.prototype.getHitTransformationMatrix_=function(t,e){var i=A.create();A.translate(i,-1,-1),A.scale(i,2/t[0],2/t[1]),A.translate(i,0,t[1]),A.scale(i,1,-1);var r=A.invert(this.projectionMatrix.slice()),n=A.create();return A.translate(n,0,e[1]),A.scale(n,1,-1),A.scale(n,e[0]/2,e[1]/2),A.translate(n,1,1),A.multiply(n,r),A.multiply(n,i),n};var le=function(t,e){Wt.call(this,t,e),this.canvas_=document.createElement("CANVAS"),this.canvas_.style.width="100%",this.canvas_.style.height="100%",this.canvas_.style.display="block",this.canvas_.className=pe.CLASS_UNSELECTABLE,t.insertBefore(this.canvas_,t.childNodes[0]||null),this.clipTileCanvasWidth_=0,this.clipTileCanvasHeight_=0,this.clipTileContext_=At.createCanvasContext2D(),this.renderedVisible_=!0,this.gl_=S.getContext(this.canvas_,{antialias:!0,depth:!0,failIfMajorPerformanceCaveat:!0,preserveDrawingBuffer:!1,stencil:!0}),this.context_=new qt(this.canvas_,this.gl_),L.listen(this.canvas_,Rn.LOST,this.handleWebGLContextLost,this),L.listen(this.canvas_,Rn.RESTORED,this.handleWebGLContextRestored,this),this.textureCache_=new se,this.focus_=null,this.tileTextureQueue_=new Jt((function(i){var r=i[1],n=i[2],a=r[0]-this.focus_[0],o=r[1]-this.focus_[1];return 65536*Math.log(n)+Math.sqrt(a*a+o*o)/n}).bind(this),function(i){return i[0].getKey()}),this.loadNextTileTexture_=(function(i,r){if(!this.tileTextureQueue_.isEmpty()){this.tileTextureQueue_.reprioritize();var n=this.tileTextureQueue_.dequeue(),a=n[0],o=n[3],s=n[4];this.bindTileTexture(a,o,s,S.LINEAR,S.LINEAR)}return!1}).bind(this),this.textureCacheFrameMarkerCount_=0,this.initializeGL_()};_.inherits(le,Wt),le.handles=function(t){return _t.WEBGL&&t===ri.WEBGL},le.create=function(t,e){return new le(t,e)},le.prototype.bindTileTexture=function(t,e,i,r,n){var a=this.getGL(),o=t.getKey();if(this.textureCache_.containsKey(o)){var s=this.textureCache_.get(o);a.bindTexture(S.TEXTURE_2D,s.texture),s.magFilter!=r&&(a.texParameteri(S.TEXTURE_2D,S.TEXTURE_MAG_FILTER,r),s.magFilter=r),s.minFilter!=n&&(a.texParameteri(S.TEXTURE_2D,S.TEXTURE_MIN_FILTER,n),s.minFilter=n)}else{var l=a.createTexture();if(a.bindTexture(S.TEXTURE_2D,l),i>0){var h=this.clipTileContext_.canvas,u=this.clipTileContext_;this.clipTileCanvasWidth_!==e[0]||this.clipTileCanvasHeight_!==e[1]?(h.width=e[0],h.height=e[1],this.clipTileCanvasWidth_=e[0],this.clipTileCanvasHeight_=e[1]):u.clearRect(0,0,e[0],e[1]),u.drawImage(t.getImage(),i,i,e[0],e[1],0,0,e[0],e[1]),a.texImage2D(S.TEXTURE_2D,0,S.RGBA,S.RGBA,S.UNSIGNED_BYTE,h)}else a.texImage2D(S.TEXTURE_2D,0,S.RGBA,S.RGBA,S.UNSIGNED_BYTE,t.getImage());a.texParameteri(S.TEXTURE_2D,S.TEXTURE_MAG_FILTER,r),a.texParameteri(S.TEXTURE_2D,S.TEXTURE_MIN_FILTER,n),a.texParameteri(S.TEXTURE_2D,S.TEXTURE_WRAP_S,S.CLAMP_TO_EDGE),a.texParameteri(S.TEXTURE_2D,S.TEXTURE_WRAP_T,S.CLAMP_TO_EDGE),this.textureCache_.set(o,{texture:l,magFilter:r,minFilter:n})}},le.prototype.dispatchComposeEvent_=function(t,e){var i=this.getMap();if(i.hasListener(t)){var r=this.context_,n=e.extent,a=e.size,o=e.viewState,s=e.pixelRatio,l=o.resolution,h=o.center,u=o.rotation,f=new Pe(r,h,l,u,a,n,s),c=new Jr(t,f,e,null,r);i.dispatchEvent(c)}},le.prototype.disposeInternal=function(){var t=this.getGL();t.isContextLost()||this.textureCache_.forEach(function(e){e&&t.deleteTexture(e.texture)}),this.context_.dispose(),Wt.prototype.disposeInternal.call(this)},le.prototype.expireCache_=function(t,e){for(var i=this.getGL(),r;this.textureCache_.getCount()-this.textureCacheFrameMarkerCount_>_.WEBGL_TEXTURE_CACHE_HIGH_WATER_MARK;){if(r=this.textureCache_.peekLast(),r)i.deleteTexture(r.texture);else{if(+this.textureCache_.peekLastKey()==e.index)break;--this.textureCacheFrameMarkerCount_}this.textureCache_.pop()}},le.prototype.getContext=function(){return this.context_},le.prototype.getGL=function(){return this.gl_},le.prototype.getTileTextureQueue=function(){return this.tileTextureQueue_},le.prototype.getType=function(){return ri.WEBGL},le.prototype.handleWebGLContextLost=function(t){t.preventDefault(),this.textureCache_.clear(),this.textureCacheFrameMarkerCount_=0;var e=this.getLayerRenderers();for(var i in e){var r=e[i];r.handleWebGLContextLost()}},le.prototype.handleWebGLContextRestored=function(){this.initializeGL_(),this.getMap().render()},le.prototype.initializeGL_=function(){var t=this.gl_;t.activeTexture(S.TEXTURE0),t.blendFuncSeparate(S.SRC_ALPHA,S.ONE_MINUS_SRC_ALPHA,S.ONE,S.ONE_MINUS_SRC_ALPHA),t.disable(S.CULL_FACE),t.disable(S.DEPTH_TEST),t.disable(S.SCISSOR_TEST),t.disable(S.STENCIL_TEST)},le.prototype.isTileTextureLoaded=function(t){return this.textureCache_.containsKey(t.getKey())},le.prototype.renderFrame=function(t){var e=this.getContext(),i=this.getGL();if(i.isContextLost())return!1;if(!t)return this.renderedVisible_&&(this.canvas_.style.display="none",this.renderedVisible_=!1),!1;this.focus_=t.focus,this.textureCache_.set((-t.index).toString(),null),++this.textureCacheFrameMarkerCount_,this.dispatchComposeEvent_(Ri.PRECOMPOSE,t);var r=[],n=t.layerStatesArray;st.stableSort(n,Wt.sortByZIndex);var a=t.viewState.resolution,o,s,l,h;for(o=0,s=n.length;o<s;++o)h=n[o],ce.visibleAtResolution(h,a)&&h.sourceState==Or.READY&&(l=this.getLayerRenderer(h.layer),l.prepareFrame(t,h,e)&&r.push(h));var u=t.size[0]*t.pixelRatio,f=t.size[1]*t.pixelRatio;for((this.canvas_.width!=u||this.canvas_.height!=f)&&(this.canvas_.width=u,this.canvas_.height=f),i.bindFramebuffer(S.FRAMEBUFFER,null),i.clearColor(0,0,0,0),i.clear(S.COLOR_BUFFER_BIT),i.enable(S.BLEND),i.viewport(0,0,this.canvas_.width,this.canvas_.height),o=0,s=r.length;o<s;++o)h=r[o],l=this.getLayerRenderer(h.layer),l.composeFrame(t,h,e);this.renderedVisible_||(this.canvas_.style.display="",this.renderedVisible_=!0),this.calculateMatrices2D(t),this.textureCache_.getCount()-this.textureCacheFrameMarkerCount_>_.WEBGL_TEXTURE_CACHE_HIGH_WATER_MARK&&t.postRenderFunctions.push(this.expireCache_.bind(this)),this.tileTextureQueue_.isEmpty()||(t.postRenderFunctions.push(this.loadNextTileTexture_),t.animate=!0),this.dispatchComposeEvent_(Ri.POSTCOMPOSE,t),this.scheduleRemoveUnusedLayerRenderers(t),this.scheduleExpireIconCache(t)},le.prototype.forEachFeatureAtCoordinate=function(t,e,i,r,n,a,o){var s;if(this.getGL().isContextLost())return!1;var l=e.viewState,h=e.layerStatesArray,u=h.length,f;for(f=u-1;f>=0;--f){var c=h[f],d=c.layer;if(ce.visibleAtResolution(c,l.resolution)&&a.call(o,d)){var v=this.getLayerRenderer(d);if(s=v.forEachFeatureAtCoordinate(t,e,i,r,n),s)return s}}},le.prototype.hasFeatureAtCoordinate=function(t,e,i,r,n){var a=!1;if(this.getGL().isContextLost())return!1;var o=e.viewState,s=e.layerStatesArray,l=s.length,h;for(h=l-1;h>=0;--h){var u=s[h],f=u.layer;if(ce.visibleAtResolution(u,o.resolution)&&r.call(n,f)){var c=this.getLayerRenderer(f);if(a=c.hasFeatureAtCoordinate(t,e),a)return!0}}return a},le.prototype.forEachLayerAtPixel=function(t,e,i,r,n,a){if(this.getGL().isContextLost())return!1;var o=e.viewState,s,l=e.layerStatesArray,h=l.length,u;for(u=h-1;u>=0;--u){var f=l[u],c=f.layer;if(ce.visibleAtResolution(f,o.resolution)&&n.call(r,c)){var d=this.getLayerRenderer(c);if(s=d.forEachLayerAtPixel(t,e,i,r),s)return s}}};var Ln={};Ln.fragment=new lr(_.DEBUG_WEBGL?`precision mediump float;
varying vec2 v_texCoord;


uniform sampler2D u_texture;

void main(void) {
  gl_FragColor = texture2D(u_texture, v_texCoord);
}
`:"precision mediump float;varying vec2 a;uniform sampler2D e;void main(void){gl_FragColor=texture2D(e,a);}"),Ln.vertex=new hr(_.DEBUG_WEBGL?`varying vec2 v_texCoord;


attribute vec2 a_position;
attribute vec2 a_texCoord;
uniform vec4 u_tileOffset;

void main(void) {
  gl_Position = vec4(a_position * u_tileOffset.xy + u_tileOffset.zw, 0., 1.);
  v_texCoord = a_texCoord;
}


`:"varying vec2 a;attribute vec2 b;attribute vec2 c;uniform vec4 d;void main(void){gl_Position=vec4(b*d.xy+d.zw,0.,1.);a=c;}");var Io=function(t,e){this.u_tileOffset=t.getUniformLocation(e,_.DEBUG_WEBGL?"u_tileOffset":"d"),this.u_texture=t.getUniformLocation(e,_.DEBUG_WEBGL?"u_texture":"e"),this.a_position=t.getAttribLocation(e,_.DEBUG_WEBGL?"a_position":"b"),this.a_texCoord=t.getAttribLocation(e,_.DEBUG_WEBGL?"a_texCoord":"c")},Wi=function(t,e){Te.call(this,t,e),this.fragmentShader_=Ln.fragment,this.vertexShader_=Ln.vertex,this.locations_=null,this.renderArrayBuffer_=new Ze([0,0,0,1,1,0,1,1,0,1,0,0,1,1,1,0]),this.renderedTileRange_=null,this.renderedFramebufferExtent_=null,this.renderedRevision_=-1,this.tmpSize_=[0,0]};_.inherits(Wi,Te),Wi.handles=function(t,e){return t===ri.WEBGL&&e.getType()===Pi.TILE},Wi.create=function(t,e){return new Wi(t,e)},Wi.prototype.disposeInternal=function(){var t=this.mapRenderer.getContext();t.deleteBuffer(this.renderArrayBuffer_),Te.prototype.disposeInternal.call(this)},Wi.prototype.createLoadedTileFinder=function(t,e,i){var r=this.mapRenderer;return function(n,a){function o(s){var l=r.isTileTextureLoaded(s);return l&&(i[n]||(i[n]={}),i[n][s.tileCoord.toString()]=s),l}return t.forEachLoadedTile(e,n,a,o)}},Wi.prototype.handleWebGLContextLost=function(){Te.prototype.handleWebGLContextLost.call(this),this.locations_=null},Wi.prototype.prepareFrame=function(t,e,i){var r=this.mapRenderer,n=i.getGL(),a=t.viewState,o=a.projection,s=this.getLayer(),l=s.getSource(),h=l.getTileGridForProjection(o),u=h.getZForResolution(a.resolution),f=h.getResolution(u),c=l.getTilePixelSize(u,t.pixelRatio,o),d=c[0]/ni.toSize(h.getTileSize(u),this.tmpSize_)[0],v=f/d,E=l.getTilePixelRatio(d)*l.getGutter(o),p=a.center,m=t.extent,y=h.getTileRangeForExtentAndZ(m,u),R;if(this.renderedTileRange_&&this.renderedTileRange_.equals(y)&&this.renderedRevision_==l.getRevision())R=this.renderedFramebufferExtent_;else{var C=y.getSize(),x=Math.max(C[0]*c[0],C[1]*c[1]),I=j.roundUpToPowerOfTwo(x),D=v*I,O=h.getOrigin(u),B=O[0]+y.minX*c[0]*v,W=O[1]+y.minY*c[1]*v;R=[B,W,B+D,W+D],this.bindFramebuffer(t,I),n.viewport(0,0,I,I),n.clearColor(0,0,0,0),n.clear(S.COLOR_BUFFER_BIT),n.disable(S.BLEND);var N=i.getProgram(this.fragmentShader_,this.vertexShader_);i.useProgram(N),this.locations_||(this.locations_=new Io(n,N)),i.bindBuffer(S.ARRAY_BUFFER,this.renderArrayBuffer_),n.enableVertexAttribArray(this.locations_.a_position),n.vertexAttribPointer(this.locations_.a_position,2,S.FLOAT,!1,16,0),n.enableVertexAttribArray(this.locations_.a_texCoord),n.vertexAttribPointer(this.locations_.a_texCoord,2,S.FLOAT,!1,16,8),n.uniform1i(this.locations_.u_texture,0);var P={};P[u]={};var $=this.createLoadedTileFinder(l,o,P),b=s.getUseInterimTilesOnError(),M=!0,F=g.createEmpty(),X=new Ae(0,0,0,0),U,Z,z,Q,rt,ft,Ct,yt;for(ft=y.minX;ft<=y.maxX;++ft)for(Ct=y.minY;Ct<=y.maxY;++Ct)if(Q=l.getTile(u,ft,Ct,d,o),!(e.extent!==void 0&&(yt=h.getTileCoordExtent(Q.tileCoord,F),!g.intersects(yt,e.extent)))){if(rt=Q.getState(),Z=rt==V.LOADED||rt==V.EMPTY||rt==V.ERROR&&!b,Z||(Q=Q.getInterimTile()),rt=Q.getState(),rt==V.LOADED){if(r.isTileTextureLoaded(Q)){P[u][Q.tileCoord.toString()]=Q;continue}}else if(rt==V.EMPTY||rt==V.ERROR&&!b)continue;M=!1,z=h.forEachTileCoordParentTileRange(Q.tileCoord,$,null,X,F),z||(U=h.getTileCoordChildTileRange(Q.tileCoord,X,F),U&&$(u+1,U))}var jt=Object.keys(P).map(Number);jt.sort(st.numberSafeCompareFunction);var It=new Float32Array(4),ie,xe,Bt,Ce;for(ie=0,xe=jt.length;ie<xe;++ie){Ce=P[jt[ie]];for(Bt in Ce)Q=Ce[Bt],yt=h.getTileCoordExtent(Q.tileCoord,F),It[0]=2*(yt[2]-yt[0])/D,It[1]=2*(yt[3]-yt[1])/D,It[2]=2*(yt[0]-R[0])/D-1,It[3]=2*(yt[1]-R[1])/D-1,n.uniform4fv(this.locations_.u_tileOffset,It),r.bindTileTexture(Q,c,E*d,S.LINEAR,S.LINEAR),n.drawArrays(S.TRIANGLE_STRIP,0,4)}M?(this.renderedTileRange_=y,this.renderedFramebufferExtent_=R,this.renderedRevision_=l.getRevision()):(this.renderedTileRange_=null,this.renderedFramebufferExtent_=null,this.renderedRevision_=-1,t.animate=!0)}this.updateUsedTiles(t.usedTiles,l,u,y);var ke=r.getTileTextureQueue();this.manageTilePyramid(t,l,h,d,o,m,u,s.getPreload(),function(fi){fi.getState()==V.LOADED&&!r.isTileTextureLoaded(fi)&&!ke.isKeyQueued(fi.getKey())&&ke.enqueue([fi,h.getTileCoordCenter(fi.tileCoord),h.getResolution(fi.tileCoord[0]),c,E*d])},this),this.scheduleExpireCache(t,l),this.updateLogos(t,l);var Fe=this.texCoordMatrix;return A.reset(Fe),A.translate(Fe,(Math.round(p[0]/f)*f-R[0])/(R[2]-R[0]),(Math.round(p[1]/f)*f-R[1])/(R[3]-R[1])),a.rotation!==0&&A.rotate(Fe,a.rotation),A.scale(Fe,t.size[0]*a.resolution/(R[2]-R[0]),t.size[1]*a.resolution/(R[3]-R[1])),A.translate(Fe,-.5,-.5),!0},Wi.prototype.forEachLayerAtPixel=function(t,e,i,r){if(this.framebuffer){var n=[t[0]/e.size[0],(e.size[1]-t[1])/e.size[1]],a=A.apply(this.texCoordMatrix,n.slice()),o=[a[0]*this.framebufferDimension,a[1]*this.framebufferDimension],s=this.mapRenderer.getContext().getGL();s.bindFramebuffer(s.FRAMEBUFFER,this.framebuffer);var l=new Uint8Array(4);if(s.readPixels(o[0],o[1],1,1,s.RGBA,s.UNSIGNED_BYTE,l),l[3]>0)return i.call(r,this.getLayer(),l)}};var hi=function(t,e){Te.call(this,t,e),this.dirty_=!1,this.renderedRevision_=-1,this.renderedResolution_=NaN,this.renderedExtent_=g.createEmpty(),this.renderedRenderOrder_=null,this.replayGroup_=null,this.layerState_=null};_.inherits(hi,Te),hi.handles=function(t,e){return t===ri.WEBGL&&e.getType()===Pi.VECTOR},hi.create=function(t,e){return new hi(t,e)},hi.prototype.composeFrame=function(t,e,i){this.layerState_=e;var r=t.viewState,n=this.replayGroup_,a=t.size,o=t.pixelRatio,s=this.mapRenderer.getGL();n&&!n.isEmpty()&&(s.enable(s.SCISSOR_TEST),s.scissor(0,0,a[0]*o,a[1]*o),n.replay(i,r.center,r.resolution,r.rotation,a,o,e.opacity,e.managed?t.skippedFeatureUids:{}),s.disable(s.SCISSOR_TEST))},hi.prototype.disposeInternal=function(){var t=this.replayGroup_;if(t){var e=this.mapRenderer.getContext();t.getDeleteResourcesFunction(e)(),this.replayGroup_=null}Te.prototype.disposeInternal.call(this)},hi.prototype.forEachFeatureAtCoordinate=function(t,e,i,r,n){if(!(!this.replayGroup_||!this.layerState_)){var a=this.mapRenderer.getContext(),o=e.viewState,s=this.getLayer(),l=this.layerState_,h={};return this.replayGroup_.forEachFeatureAtCoordinate(t,a,o.center,o.resolution,o.rotation,e.size,e.pixelRatio,l.opacity,{},function(u){var f=_.getUid(u).toString();if(!(f in h))return h[f]=!0,r.call(n,u,s)})}},hi.prototype.hasFeatureAtCoordinate=function(t,e){if(!this.replayGroup_||!this.layerState_)return!1;var i=this.mapRenderer.getContext(),r=e.viewState,n=this.layerState_;return this.replayGroup_.hasFeatureAtCoordinate(t,i,r.center,r.resolution,r.rotation,e.size,e.pixelRatio,n.opacity,e.skippedFeatureUids)},hi.prototype.forEachLayerAtPixel=function(t,e,i,r){var n=A.apply(e.pixelToCoordinateTransform,t.slice()),a=this.hasFeatureAtCoordinate(n,e);if(a)return i.call(r,this.getLayer(),null)},hi.prototype.handleStyleImageChange_=function(t){this.renderIfReadyAndVisible()},hi.prototype.prepareFrame=function(t,e,i){var r=this.getLayer(),n=r.getSource();this.updateLogos(t,n);var a=t.viewHints[Pt.ANIMATING],o=t.viewHints[Pt.INTERACTING],s=r.getUpdateWhileAnimating(),l=r.getUpdateWhileInteracting();if(!this.dirty_&&!s&&a||!l&&o)return!0;var h=t.extent,u=t.viewState,f=u.projection,c=u.resolution,d=t.pixelRatio,v=r.getRevision(),E=r.getRenderBuffer(),p=r.getRenderOrder();p===void 0&&(p=ot.defaultOrder);var m=g.buffer(h,E*c);if(!this.dirty_&&this.renderedResolution_==c&&this.renderedRevision_==v&&this.renderedRenderOrder_==p&&g.containsExtent(this.renderedExtent_,m))return!0;this.replayGroup_&&t.postRenderFunctions.push(this.replayGroup_.getDeleteResourcesFunction(i)),this.dirty_=!1;var y=new $t(ot.getTolerance(c,d),m,r.getRenderBuffer());n.loadFeatures(m,c,f);var R=function(x){var I,D=x.getStyleFunction();if(D?I=D.call(x,c):(D=r.getStyleFunction(),D&&(I=D(x,c))),I){var O=this.renderFeature(x,c,d,I,y);this.dirty_=this.dirty_||O}};if(p){var C=[];n.forEachFeatureInExtent(m,function(x){C.push(x)},this),C.sort(p),C.forEach(R,this)}else n.forEachFeatureInExtent(m,R,this);return y.finish(i),this.renderedResolution_=c,this.renderedRevision_=v,this.renderedRenderOrder_=p,this.renderedExtent_=m,this.replayGroup_=y,!0},hi.prototype.renderFeature=function(t,e,i,r,n){if(!r)return!1;var a=!1;if(Array.isArray(r))for(var o=r.length-1,s=0;o>=s;--o)a=ot.renderFeature(n,t,r[o],ot.getSquaredTolerance(e,i),this.handleStyleImageChange_,this)||a;else a=ot.renderFeature(n,t,r,ot.getSquaredTolerance(e,i),this.handleStyleImageChange_,this)||a;return a},_.ENABLE_CANVAS&&(Le.register(br.MAP_RENDERER,Bi),Le.registerMultiple(br.LAYER_RENDERER,[wi,Be,pi,ge])),_.ENABLE_WEBGL&&(Le.register(br.MAP_RENDERER,le),Le.registerMultiple(br.LAYER_RENDERER,[yi,Wi,hi]));var ma=function(t){t=ht.assign({},t),t.controls||(t.controls=ha.defaults()),t.interactions||(t.interactions=fa.defaults()),H.call(this,t)};_.inherits(ma,H);var ui={BOTTOM_LEFT:"bottom-left",BOTTOM_CENTER:"bottom-center",BOTTOM_RIGHT:"bottom-right",CENTER_LEFT:"center-left",CENTER_CENTER:"center-center",CENTER_RIGHT:"center-right",TOP_LEFT:"top-left",TOP_CENTER:"top-center",TOP_RIGHT:"top-right"},lt=function(t){it.call(this),this.options=t,this.id=t.id,this.insertFirst=t.insertFirst!==void 0?t.insertFirst:!0,this.stopEvent=t.stopEvent!==void 0?t.stopEvent:!0,this.element=document.createElement("DIV"),this.element.className=t.className!==void 0?t.className:"ol-overlay-container "+pe.CLASS_SELECTABLE,this.element.style.position="absolute",this.autoPan=t.autoPan!==void 0?t.autoPan:!1,this.autoPanAnimation=t.autoPanAnimation||{},this.autoPanMargin=t.autoPanMargin!==void 0?t.autoPanMargin:20,this.rendered={bottom_:"",left_:"",right_:"",top_:"",visible:!0},this.mapPostrenderListenerKey=null,L.listen(this,it.getChangeEventType(lt.Property.ELEMENT),this.handleElementChanged,this),L.listen(this,it.getChangeEventType(lt.Property.MAP),this.handleMapChanged,this),L.listen(this,it.getChangeEventType(lt.Property.OFFSET),this.handleOffsetChanged,this),L.listen(this,it.getChangeEventType(lt.Property.POSITION),this.handlePositionChanged,this),L.listen(this,it.getChangeEventType(lt.Property.POSITIONING),this.handlePositioningChanged,this),t.element!==void 0&&this.setElement(t.element),this.setOffset(t.offset!==void 0?t.offset:[0,0]),this.setPositioning(t.positioning!==void 0?t.positioning:ui.TOP_LEFT),t.position!==void 0&&this.setPosition(t.position)};_.inherits(lt,it),lt.prototype.getElement=function(){return this.get(lt.Property.ELEMENT)},lt.prototype.getId=function(){return this.id},lt.prototype.getMap=function(){return this.get(lt.Property.MAP)},lt.prototype.getOffset=function(){return this.get(lt.Property.OFFSET)},lt.prototype.getPosition=function(){return this.get(lt.Property.POSITION)},lt.prototype.getPositioning=function(){return this.get(lt.Property.POSITIONING)},lt.prototype.handleElementChanged=function(){At.removeChildren(this.element);var t=this.getElement();t&&this.element.appendChild(t)},lt.prototype.handleMapChanged=function(){this.mapPostrenderListenerKey&&(At.removeNode(this.element),L.unlistenByKey(this.mapPostrenderListenerKey),this.mapPostrenderListenerKey=null);var t=this.getMap();if(t){this.mapPostrenderListenerKey=L.listen(t,jr.POSTRENDER,this.render,this),this.updatePixelPosition();var e=this.stopEvent?t.getOverlayContainerStopEvent():t.getOverlayContainer();this.insertFirst?e.insertBefore(this.element,e.childNodes[0]||null):e.appendChild(this.element)}},lt.prototype.render=function(){this.updatePixelPosition()},lt.prototype.handleOffsetChanged=function(){this.updatePixelPosition()},lt.prototype.handlePositionChanged=function(){this.updatePixelPosition(),this.get(lt.Property.POSITION)&&this.autoPan&&this.panIntoView()},lt.prototype.handlePositioningChanged=function(){this.updatePixelPosition()},lt.prototype.setElement=function(t){this.set(lt.Property.ELEMENT,t)},lt.prototype.setMap=function(t){this.set(lt.Property.MAP,t)},lt.prototype.setOffset=function(t){this.set(lt.Property.OFFSET,t)},lt.prototype.setPosition=function(t){this.set(lt.Property.POSITION,t)},lt.prototype.panIntoView=function(){var t=this.getMap();if(!(!t||!t.getTargetElement())){var e=this.getRect(t.getTargetElement(),t.getSize()),i=this.getElement(),r=this.getRect(i,[At.outerWidth(i),At.outerHeight(i)]),n=this.autoPanMargin;if(!g.containsExtent(e,r)){var a=r[0]-e[0],o=e[2]-r[2],s=r[1]-e[1],l=e[3]-r[3],h=[0,0];if(a<0?h[0]=a-n:o<0&&(h[0]=Math.abs(o)+n),s<0?h[1]=s-n:l<0&&(h[1]=Math.abs(l)+n),h[0]!==0||h[1]!==0){var u=t.getView().getCenter(),f=t.getPixelFromCoordinate(u),c=[f[0]+h[0],f[1]+h[1]];t.getView().animate({center:t.getCoordinateFromPixel(c),duration:this.autoPanAnimation.duration,easing:this.autoPanAnimation.easing})}}}},lt.prototype.getRect=function(t,e){var i=t.getBoundingClientRect(),r=i.left+window.pageXOffset,n=i.top+window.pageYOffset;return[r,n,r+e[0],n+e[1]]},lt.prototype.setPositioning=function(t){this.set(lt.Property.POSITIONING,t)},lt.prototype.setVisible=function(t){this.rendered.visible!==t&&(this.element.style.display=t?"":"none",this.rendered.visible=t)},lt.prototype.updatePixelPosition=function(){var t=this.getMap(),e=this.getPosition();if(!t||!t.isRendered()||!e){this.setVisible(!1);return}var i=t.getPixelFromCoordinate(e),r=t.getSize();this.updateRenderedPosition(i,r)},lt.prototype.updateRenderedPosition=function(t,e){var i=this.element.style,r=this.getOffset(),n=this.getPositioning();this.setVisible(!0);var a=r[0],o=r[1];if(n==ui.BOTTOM_RIGHT||n==ui.CENTER_RIGHT||n==ui.TOP_RIGHT){this.rendered.left_!==""&&(this.rendered.left_=i.left="");var s=Math.round(e[0]-t[0]-a)+"px";this.rendered.right_!=s&&(this.rendered.right_=i.right=s)}else{this.rendered.right_!==""&&(this.rendered.right_=i.right=""),(n==ui.BOTTOM_CENTER||n==ui.CENTER_CENTER||n==ui.TOP_CENTER)&&(a-=this.element.offsetWidth/2);var l=Math.round(t[0]+a)+"px";this.rendered.left_!=l&&(this.rendered.left_=i.left=l)}if(n==ui.BOTTOM_LEFT||n==ui.BOTTOM_CENTER||n==ui.BOTTOM_RIGHT){this.rendered.top_!==""&&(this.rendered.top_=i.top="");var h=Math.round(e[1]-t[1]-o)+"px";this.rendered.bottom_!=h&&(this.rendered.bottom_=i.bottom=h)}else{this.rendered.bottom_!==""&&(this.rendered.bottom_=i.bottom=""),(n==ui.CENTER_LEFT||n==ui.CENTER_CENTER||n==ui.CENTER_RIGHT)&&(o-=this.element.offsetHeight/2);var u=Math.round(t[1]+o)+"px";this.rendered.top_!=u&&(this.rendered.top_=i.top=u)}},lt.prototype.getOptions=function(){return this.options},lt.Property={ELEMENT:"element",MAP:"map",OFFSET:"offset",POSITION:"position",POSITIONING:"positioning"};var Me=function(t,e,i){re.call(this);var r=i||{};this.tileCoord=t,this.state=e,this.interimTile=null,this.key="",this.transition_=r.transition===void 0?250:r.transition,this.transitionStarts_={}};_.inherits(Me,re),Me.prototype.changed=function(){this.dispatchEvent(tt.CHANGE)},Me.prototype.getKey=function(){return this.key+"/"+this.tileCoord},Me.prototype.getInterimTile=function(){if(!this.interimTile)return this;var t=this.interimTile;do{if(t.getState()==V.LOADED)return t;t=t.interimTile}while(t);return this},Me.prototype.refreshInterimChain=function(){if(this.interimTile){var t=this.interimTile,e=this;do{if(t.getState()==V.LOADED){t.interimTile=null;break}else t.getState()==V.LOADING?e=t:t.getState()==V.IDLE?e.interimTile=t.interimTile:e=t;t=e.interimTile}while(t)}},Me.prototype.getTileCoord=function(){return this.tileCoord},Me.prototype.getState=function(){return this.state},Me.prototype.setState=function(t){this.state=t,this.changed()},Me.prototype.load=function(){},Me.prototype.getAlpha=function(t,e){if(!this.transition_)return 1;var i=this.transitionStarts_[t];if(!i)i=e,this.transitionStarts_[t]=i;else if(i===-1)return 1;var r=e-i+1e3/60;return r>=this.transition_?1:de.easeIn(r/this.transition_)},Me.prototype.inTransition=function(t){return this.transition_?this.transitionStarts_[t]!==-1:!1},Me.prototype.endTransition=function(t){this.transition_&&(this.transitionStarts_[t]=-1)};var mi=function(t,e,i,r,n,a){Me.call(this,t,e,a),this.crossOrigin_=r,this.src_=i,this.image_=new Image,r!==null&&(this.image_.crossOrigin=r),this.imageListenerKeys_=null,this.tileLoadFunction_=n};_.inherits(mi,Me),mi.prototype.disposeInternal=function(){this.state==V.LOADING&&(this.unlistenImage_(),this.image_=mi.getBlankImage()),this.interimTile&&this.interimTile.dispose(),this.state=V.ABORT,this.changed(),Me.prototype.disposeInternal.call(this)},mi.prototype.getImage=function(){return this.image_},mi.prototype.getKey=function(){return this.src_},mi.prototype.handleImageError_=function(){this.state=V.ERROR,this.unlistenImage_(),this.image_=mi.getBlankImage(),this.changed()},mi.prototype.handleImageLoad_=function(){this.image_.naturalWidth&&this.image_.naturalHeight?this.state=V.LOADED:this.state=V.EMPTY,this.unlistenImage_(),this.changed()},mi.prototype.load=function(){this.state==V.ERROR&&(this.state=V.IDLE,this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)),this.state==V.IDLE&&(this.state=V.LOADING,this.changed(),this.imageListenerKeys_=[L.listenOnce(this.image_,tt.ERROR,this.handleImageError_,this),L.listenOnce(this.image_,tt.LOAD,this.handleImageLoad_,this)],this.tileLoadFunction_(this,this.src_))},mi.prototype.unlistenImage_=function(){this.imageListenerKeys_.forEach(L.unlistenByKey),this.imageListenerKeys_=null},mi.getBlankImage=function(){var t=At.createCanvasContext2D(1,1);return t.fillStyle="rgba(0,0,0,0)",t.fillRect(0,0,1,1),t.canvas};var De={};De.createOrUpdate=function(t,e,i,r){return r!==void 0?(r[0]=t,r[1]=e,r[2]=i,r):[t,e,i]},De.getKeyZXY=function(t,e,i){return t+"/"+e+"/"+i},De.getKey=function(t){return De.getKeyZXY(t[0],t[1],t[2])},De.fromKey=function(t){return t.split("/").map(Number)},De.hash=function(t){return(t[1]<<t[0])+t[2]},De.quadKey=function(t){var e=t[0],i=new Array(e),r=1<<e-1,n,a;for(n=0;n<e;++n)a=48,t[1]&r&&(a+=1),t[2]&r&&(a+=2),i[n]=String.fromCharCode(a),r>>=1;return i.join("")},De.withinExtentAndZ=function(t,e){var i=t[0],r=t[1],n=t[2];if(e.getMinZoom()>i||i>e.getMaxZoom())return!1;var a=e.getExtent(),o;return a?o=e.getTileRangeForExtentAndZ(a,i):o=e.getFullTileRange(i),o?o.containsXY(r,n):!0};var Qr=function(t){se.call(this,t)};_.inherits(Qr,se),Qr.prototype.expireCache=function(t){for(var e,i;this.canExpireCache()&&(e=this.peekLast(),i=e.tileCoord[0].toString(),!(i in t&&t[i].contains(e.tileCoord)));)this.pop().dispose()},Qr.prototype.pruneExceptNewestZ=function(){if(this.getCount()!==0){var t=this.peekFirstKey(),e=De.fromKey(t),i=e[0];this.forEach(function(r){r.tileCoord[0]!==i&&(this.remove(De.getKey(r.tileCoord)),r.dispose())},this)}};var fr={};fr.calculateSourceResolution=function(t,e,i,r){var n=k.transform(i,e,t),a=k.getPointResolution(e,r,i),o=e.getMetersPerUnit();o!==void 0&&(a*=o);var s=t.getMetersPerUnit();s!==void 0&&(a/=s);var l=t.getExtent();if(!l||g.containsCoordinate(l,n)){var h=k.getPointResolution(t,a,n)/a;isFinite(h)&&h>0&&(a/=h)}return a},fr.enlargeClipPoint_=function(t,e,i,r){var n=i-t,a=r-e,o=Math.sqrt(n*n+a*a);return[Math.round(i+n/o),Math.round(r+a/o)]},fr.render=function(t,e,i,r,n,a,o,s,l,h,u){var f=At.createCanvasContext2D(Math.round(i*t),Math.round(i*e));if(l.length===0)return f.canvas;f.scale(i,i);var c=g.createEmpty();l.forEach(function(y,R,C){g.extend(c,y.extent)});var d=g.getWidth(c),v=g.getHeight(c),E=At.createCanvasContext2D(Math.round(i*d/r),Math.round(i*v/r)),p=i/r;l.forEach(function(y,R,C){var x=y.extent[0]-c[0],I=-(y.extent[3]-c[3]),D=g.getWidth(y.extent),O=g.getHeight(y.extent);E.drawImage(y.image,h,h,y.image.width-2*h,y.image.height-2*h,x*p,I*p,D*p,O*p)});var m=g.getTopLeft(o);return s.getTriangles().forEach(function(y,R,C){var x=y.source,I=y.target,D=x[0][0],O=x[0][1],B=x[1][0],W=x[1][1],N=x[2][0],P=x[2][1],$=(I[0][0]-m[0])/a,b=-(I[0][1]-m[1])/a,M=(I[1][0]-m[0])/a,F=-(I[1][1]-m[1])/a,X=(I[2][0]-m[0])/a,U=-(I[2][1]-m[1])/a,Z=D,z=O;D=0,O=0,B-=Z,W-=z,N-=Z,P-=z;var Q=[[B,W,0,0,M-$],[N,P,0,0,X-$],[0,0,B,W,F-b],[0,0,N,P,U-b]],rt=j.solveLinearSystem(Q);if(rt){f.save(),f.beginPath();var ft=($+M+X)/3,Ct=(b+F+U)/3,yt=fr.enlargeClipPoint_(ft,Ct,$,b),jt=fr.enlargeClipPoint_(ft,Ct,M,F),It=fr.enlargeClipPoint_(ft,Ct,X,U);f.moveTo(jt[0],jt[1]),f.lineTo(yt[0],yt[1]),f.lineTo(It[0],It[1]),f.clip(),f.transform(rt[0],rt[2],rt[1],rt[3],$,b),f.translate(c[0]-Z,c[3]-z),f.scale(r/i,-r/i),f.drawImage(E.canvas,0,0),f.restore()}}),u&&(f.save(),f.strokeStyle="black",f.lineWidth=1,s.getTriangles().forEach(function(y,R,C){var x=y.target,I=(x[0][0]-m[0])/a,D=-(x[0][1]-m[1])/a,O=(x[1][0]-m[0])/a,B=-(x[1][1]-m[1])/a,W=(x[2][0]-m[0])/a,N=-(x[2][1]-m[1])/a;f.beginPath(),f.moveTo(O,B),f.lineTo(I,D),f.lineTo(W,N),f.closePath(),f.stroke()}),f.restore()),f.canvas};var tn=function(t,e,i,r,n){this.sourceProj_=t,this.targetProj_=e;var a={},o=k.getTransform(this.targetProj_,this.sourceProj_);this.transformInv_=function(p){var m=p[0]+"/"+p[1];return a[m]||(a[m]=o(p)),a[m]},this.maxSourceExtent_=r,this.errorThresholdSquared_=n*n,this.triangles_=[],this.wrapsXInSource_=!1,this.canWrapXInSource_=this.sourceProj_.canWrapX()&&!!r&&!!this.sourceProj_.getExtent()&&g.getWidth(r)==g.getWidth(this.sourceProj_.getExtent()),this.sourceWorldWidth_=this.sourceProj_.getExtent()?g.getWidth(this.sourceProj_.getExtent()):null,this.targetWorldWidth_=this.targetProj_.getExtent()?g.getWidth(this.targetProj_.getExtent()):null;var s=g.getTopLeft(i),l=g.getTopRight(i),h=g.getBottomRight(i),u=g.getBottomLeft(i),f=this.transformInv_(s),c=this.transformInv_(l),d=this.transformInv_(h),v=this.transformInv_(u);if(this.addQuad_(s,l,h,u,f,c,d,v,_.RASTER_REPROJECTION_MAX_SUBDIVISION),this.wrapsXInSource_){var E=1/0;this.triangles_.forEach(function(p,m,y){E=Math.min(E,p.source[0][0],p.source[1][0],p.source[2][0])}),this.triangles_.forEach(function(p){if(Math.max(p.source[0][0],p.source[1][0],p.source[2][0])-E>this.sourceWorldWidth_/2){var m=[[p.source[0][0],p.source[0][1]],[p.source[1][0],p.source[1][1]],[p.source[2][0],p.source[2][1]]];m[0][0]-E>this.sourceWorldWidth_/2&&(m[0][0]-=this.sourceWorldWidth_),m[1][0]-E>this.sourceWorldWidth_/2&&(m[1][0]-=this.sourceWorldWidth_),m[2][0]-E>this.sourceWorldWidth_/2&&(m[2][0]-=this.sourceWorldWidth_);var y=Math.min(m[0][0],m[1][0],m[2][0]),R=Math.max(m[0][0],m[1][0],m[2][0]);R-y<this.sourceWorldWidth_/2&&(p.source=m)}},this)}a={}};tn.prototype.addTriangle_=function(t,e,i,r,n,a){this.triangles_.push({source:[r,n,a],target:[t,e,i]})},tn.prototype.addQuad_=function(t,e,i,r,n,a,o,s,l){var h=g.boundingExtent([n,a,o,s]),u=this.sourceWorldWidth_?g.getWidth(h)/this.sourceWorldWidth_:null,f=this.sourceWorldWidth_,c=this.sourceProj_.canWrapX()&&u>.5&&u<1,d=!1;if(l>0){if(this.targetProj_.isGlobal()&&this.targetWorldWidth_){var v=g.boundingExtent([t,e,i,r]),E=g.getWidth(v)/this.targetWorldWidth_;d|=E>_.RASTER_REPROJECTION_MAX_TRIANGLE_WIDTH}!c&&this.sourceProj_.isGlobal()&&u&&(d|=u>_.RASTER_REPROJECTION_MAX_TRIANGLE_WIDTH)}if(!(!d&&this.maxSourceExtent_&&!g.intersects(h,this.maxSourceExtent_))){if(!d&&(!isFinite(n[0])||!isFinite(n[1])||!isFinite(a[0])||!isFinite(a[1])||!isFinite(o[0])||!isFinite(o[1])||!isFinite(s[0])||!isFinite(s[1])))if(l>0)d=!0;else return;if(l>0){if(!d){var p=[(t[0]+i[0])/2,(t[1]+i[1])/2],m=this.transformInv_(p),y;if(c){var R=(j.modulo(n[0],f)+j.modulo(o[0],f))/2;y=R-j.modulo(m[0],f)}else y=(n[0]+o[0])/2-m[0];var C=(n[1]+o[1])/2-m[1],x=y*y+C*C;d=x>this.errorThresholdSquared_}if(d){if(Math.abs(t[0]-i[0])<=Math.abs(t[1]-i[1])){var I=[(e[0]+i[0])/2,(e[1]+i[1])/2],D=this.transformInv_(I),O=[(r[0]+t[0])/2,(r[1]+t[1])/2],B=this.transformInv_(O);this.addQuad_(t,e,I,O,n,a,D,B,l-1),this.addQuad_(O,I,i,r,B,D,o,s,l-1)}else{var W=[(t[0]+e[0])/2,(t[1]+e[1])/2],N=this.transformInv_(W),P=[(i[0]+r[0])/2,(i[1]+r[1])/2],$=this.transformInv_(P);this.addQuad_(t,W,P,r,n,N,$,s,l-1),this.addQuad_(W,e,i,P,N,a,o,$,l-1)}return}}if(c){if(!this.canWrapXInSource_)return;this.wrapsXInSource_=!0}this.addTriangle_(t,i,r,n,o,s),this.addTriangle_(t,e,i,n,a,o)}},tn.prototype.calculateSourceExtent=function(){var t=g.createEmpty();return this.triangles_.forEach(function(e,i,r){var n=e.source;g.extendCoordinate(t,n[0]),g.extendCoordinate(t,n[1]),g.extendCoordinate(t,n[2])}),t},tn.prototype.getTriangles=function(){return this.triangles_};var Cr=function(t,e,i,r,n,a,o,s,l,h,u){Me.call(this,n,V.IDLE),this.renderEdges_=u!==void 0?u:!1,this.pixelRatio_=o,this.gutter_=s,this.canvas_=null,this.sourceTileGrid_=e,this.targetTileGrid_=r,this.wrappedTileCoord_=a||n,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0;var f=r.getTileCoordExtent(this.wrappedTileCoord_),c=this.targetTileGrid_.getExtent(),d=this.sourceTileGrid_.getExtent(),v=c?g.getIntersection(f,c):f;if(g.getArea(v)===0){this.state=V.EMPTY;return}var E=t.getExtent();E&&(d?d=g.getIntersection(d,E):d=E);var p=r.getResolution(this.wrappedTileCoord_[0]),m=g.getCenter(v),y=fr.calculateSourceResolution(t,i,m,p);if(!isFinite(y)||y<=0){this.state=V.EMPTY;return}var R=h!==void 0?h:_.DEFAULT_RASTER_REPROJECTION_ERROR_THRESHOLD;if(this.triangulation_=new tn(t,i,v,d,y*R),this.triangulation_.getTriangles().length===0){this.state=V.EMPTY;return}this.sourceZ_=e.getZForResolution(y);var C=this.triangulation_.calculateSourceExtent();if(d&&(t.canWrapX()?(C[1]=j.clamp(C[1],d[1],d[3]),C[3]=j.clamp(C[3],d[1],d[3])):C=g.getIntersection(C,d)),!g.getArea(C))this.state=V.EMPTY;else{for(var x=e.getTileRangeForExtentAndZ(C,this.sourceZ_),I=x.minX;I<=x.maxX;I++)for(var D=x.minY;D<=x.maxY;D++){var O=l(this.sourceZ_,I,D,o);O&&this.sourceTiles_.push(O)}this.sourceTiles_.length===0&&(this.state=V.EMPTY)}};_.inherits(Cr,Me),Cr.prototype.disposeInternal=function(){this.state==V.LOADING&&this.unlistenSources_(),Me.prototype.disposeInternal.call(this)},Cr.prototype.getImage=function(){return this.canvas_},Cr.prototype.reproject_=function(){var t=[];if(this.sourceTiles_.forEach(function(l,h,u){l&&l.getState()==V.LOADED&&t.push({extent:this.sourceTileGrid_.getTileCoordExtent(l.tileCoord),image:l.getImage()})},this),this.sourceTiles_.length=0,t.length===0)this.state=V.ERROR;else{var e=this.wrappedTileCoord_[0],i=this.targetTileGrid_.getTileSize(e),r=typeof i=="number"?i:i[0],n=typeof i=="number"?i:i[1],a=this.targetTileGrid_.getResolution(e),o=this.sourceTileGrid_.getResolution(this.sourceZ_),s=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);this.canvas_=fr.render(r,n,this.pixelRatio_,o,this.sourceTileGrid_.getExtent(),a,s,this.triangulation_,t,this.gutter_,this.renderEdges_),this.state=V.LOADED}this.changed()},Cr.prototype.load=function(){if(this.state==V.IDLE){this.state=V.LOADING,this.changed();var t=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(function(e,i,r){var n=e.getState();if(n==V.IDLE||n==V.LOADING){t++;var a;a=L.listen(e,tt.CHANGE,function(o){var s=e.getState();(s==V.LOADED||s==V.ERROR||s==V.EMPTY)&&(L.unlistenByKey(a),t--,t===0&&(this.unlistenSources_(),this.reproject_()))},this),this.sourcesListenerKeys_.push(a)}},this),this.sourceTiles_.forEach(function(e,i,r){var n=e.getState();n==V.IDLE&&e.load()}),t===0&&setTimeout(this.reproject_.bind(this),0)}},Cr.prototype.unlistenSources_=function(){this.sourcesListenerKeys_.forEach(L.unlistenByKey),this.sourcesListenerKeys_=null};var Oi={};Oi.createFromTemplate=function(t,e){var i=/\{z\}/g,r=/\{x\}/g,n=/\{y\}/g,a=/\{-y\}/g;return function(o,s,l){if(o)return t.replace(i,o[0].toString()).replace(r,o[1].toString()).replace(n,function(){var h=-o[2]-1;return h.toString()}).replace(a,function(){var h=o[0],u=e.getFullTileRange(h);Ot.assert(u,55);var f=u.getHeight()+o[2];return f.toString()})}},Oi.createFromTemplates=function(t,e){for(var i=t.length,r=new Array(i),n=0;n<i;++n)r[n]=Oi.createFromTemplate(t[n],e);return Oi.createFromTileUrlFunctions(r)},Oi.createFromTileUrlFunctions=function(t){return t.length===1?t[0]:function(e,i,r){if(e){var n=De.hash(e),a=j.modulo(n,t.length);return t[a](e,i,r)}else return}},Oi.nullTileUrlFunction=function(t,e,i){},Oi.expandUrl=function(t){var e=[],i=/\{([a-z])-([a-z])\}/.exec(t);if(i){var r=i[1].charCodeAt(0),n=i[2].charCodeAt(0),a;for(a=r;a<=n;++a)e.push(t.replace(i[0],String.fromCharCode(a)));return e}if(i=i=/\{(\d+)-(\d+)\}/.exec(t),i){for(var o=parseInt(i[2],10),s=parseInt(i[1],10);s<=o;s++)e.push(t.replace(i[0],s.toString()));return e}return e.push(t),e};var Yt=function(t){this.minZoom=t.minZoom!==void 0?t.minZoom:0,this.resolutions_=t.resolutions,Ot.assert(st.isSorted(this.resolutions_,function(a,o){return o-a},!0),17);var e;if(!t.origins){for(var i=0,r=this.resolutions_.length-1;i<r;++i)if(!e)e=this.resolutions_[i]/this.resolutions_[i+1];else if(this.resolutions_[i]/this.resolutions_[i+1]!==e){e=void 0;break}}this.zoomFactor_=e,this.maxZoom=this.resolutions_.length-1,this.origin_=t.origin!==void 0?t.origin:null,this.origins_=null,t.origins!==void 0&&(this.origins_=t.origins,Ot.assert(this.origins_.length==this.resolutions_.length,20));var n=t.extent;n!==void 0&&!this.origin_&&!this.origins_&&(this.origin_=g.getTopLeft(n)),Ot.assert(!this.origin_&&this.origins_||this.origin_&&!this.origins_,18),this.tileSizes_=null,t.tileSizes!==void 0&&(this.tileSizes_=t.tileSizes,Ot.assert(this.tileSizes_.length==this.resolutions_.length,19)),this.tileSize_=t.tileSize!==void 0?t.tileSize:this.tileSizes_?null:_.DEFAULT_TILE_SIZE,Ot.assert(!this.tileSize_&&this.tileSizes_||this.tileSize_&&!this.tileSizes_,22),this.extent_=n!==void 0?n:null,this.fullTileRanges_=null,this.tmpSize_=[0,0],t.sizes!==void 0?this.fullTileRanges_=t.sizes.map(function(a,o){var s=new Ae(Math.min(0,a[0]),Math.max(a[0]-1,-1),Math.min(0,a[1]),Math.max(a[1]-1,-1));return s},this):n&&this.calculateTileRanges_(n)};Yt.tmpTileCoord_=[0,0,0],Yt.prototype.forEachTileCoord=function(t,e,i){for(var r=this.getTileRangeForExtentAndZ(t,e),n=r.minX,a=r.maxX;n<=a;++n)for(var o=r.minY,s=r.maxY;o<=s;++o)i([e,n,o])},Yt.prototype.forEachTileCoordParentTileRange=function(t,e,i,r,n){var a,o,s,l=null,h=t[0]-1;for(this.zoomFactor_===2?(o=t[1],s=t[2]):l=this.getTileCoordExtent(t,n);h>=this.minZoom;){if(this.zoomFactor_===2?(o=Math.floor(o/2),s=Math.floor(s/2),a=Ae.createOrUpdate(o,o,s,s,r)):a=this.getTileRangeForExtentAndZ(l,h,r),e.call(i,h,a))return!0;--h}return!1},Yt.prototype.getExtent=function(){return this.extent_},Yt.prototype.getMaxZoom=function(){return this.maxZoom},Yt.prototype.getMinZoom=function(){return this.minZoom},Yt.prototype.getOrigin=function(t){return this.origin_?this.origin_:this.origins_[t]},Yt.prototype.getResolution=function(t){return this.resolutions_[t]},Yt.prototype.getResolutions=function(){return this.resolutions_},Yt.prototype.getTileCoordChildTileRange=function(t,e,i){if(t[0]<this.maxZoom){if(this.zoomFactor_===2){var r=t[1]*2,n=t[2]*2;return Ae.createOrUpdate(r,r+1,n,n+1,e)}var a=this.getTileCoordExtent(t,i);return this.getTileRangeForExtentAndZ(a,t[0]+1,e)}return null},Yt.prototype.getTileRangeExtent=function(t,e,i){var r=this.getOrigin(t),n=this.getResolution(t),a=ni.toSize(this.getTileSize(t),this.tmpSize_),o=r[0]+e.minX*a[0]*n,s=r[0]+(e.maxX+1)*a[0]*n,l=r[1]+e.minY*a[1]*n,h=r[1]+(e.maxY+1)*a[1]*n;return g.createOrUpdate(o,l,s,h,i)},Yt.prototype.getTileRangeForExtentAndZ=function(t,e,i){var r=Yt.tmpTileCoord_;this.getTileCoordForXYAndZ_(t[0],t[1],e,!1,r);var n=r[1],a=r[2];return this.getTileCoordForXYAndZ_(t[2],t[3],e,!0,r),Ae.createOrUpdate(n,r[1],a,r[2],i)},Yt.prototype.getTileCoordCenter=function(t){var e=this.getOrigin(t[0]),i=this.getResolution(t[0]),r=ni.toSize(this.getTileSize(t[0]),this.tmpSize_);return[e[0]+(t[1]+.5)*r[0]*i,e[1]+(t[2]+.5)*r[1]*i]},Yt.prototype.getTileCoordExtent=function(t,e){var i=this.getOrigin(t[0]),r=this.getResolution(t[0]),n=ni.toSize(this.getTileSize(t[0]),this.tmpSize_),a=i[0]+t[1]*n[0]*r,o=i[1]+t[2]*n[1]*r,s=a+n[0]*r,l=o+n[1]*r;return g.createOrUpdate(a,o,s,l,e)},Yt.prototype.getTileCoordForCoordAndResolution=function(t,e,i){return this.getTileCoordForXYAndResolution_(t[0],t[1],e,!1,i)},Yt.prototype.getTileCoordForXYAndResolution_=function(t,e,i,r,n){var a=this.getZForResolution(i),o=i/this.getResolution(a),s=this.getOrigin(a),l=ni.toSize(this.getTileSize(a),this.tmpSize_),h=r?.5:0,u=r?0:.5,f=Math.floor((t-s[0])/i+h),c=Math.floor((e-s[1])/i+u),d=o*f/l[0],v=o*c/l[1];return r?(d=Math.ceil(d)-1,v=Math.ceil(v)-1):(d=Math.floor(d),v=Math.floor(v)),De.createOrUpdate(a,d,v,n)},Yt.prototype.getTileCoordForXYAndZ_=function(t,e,i,r,n){var a=this.getOrigin(i),o=this.getResolution(i),s=ni.toSize(this.getTileSize(i),this.tmpSize_),l=r?.5:0,h=r?0:.5,u=Math.floor((t-a[0])/o+l),f=Math.floor((e-a[1])/o+h),c=u/s[0],d=f/s[1];return r?(c=Math.ceil(c)-1,d=Math.ceil(d)-1):(c=Math.floor(c),d=Math.floor(d)),De.createOrUpdate(i,c,d,n)},Yt.prototype.getTileCoordForCoordAndZ=function(t,e,i){return this.getTileCoordForXYAndZ_(t[0],t[1],e,!1,i)},Yt.prototype.getTileCoordResolution=function(t){return this.resolutions_[t[0]]},Yt.prototype.getTileSize=function(t){return this.tileSize_?this.tileSize_:this.tileSizes_[t]},Yt.prototype.getFullTileRange=function(t){return this.fullTileRanges_?this.fullTileRanges_[t]:null},Yt.prototype.getZForResolution=function(t,e){var i=st.linearFindNearest(this.resolutions_,t,e||0);return j.clamp(i,this.minZoom,this.maxZoom)},Yt.prototype.calculateTileRanges_=function(t){for(var e=this.resolutions_.length,i=new Array(e),r=this.minZoom;r<e;++r)i[r]=this.getTileRangeForExtentAndZ(t,r);this.fullTileRanges_=i};var Re={};Re.getForProjection=function(t){var e=t.getDefaultTileGrid();return e||(e=Re.createForProjection(t),t.setDefaultTileGrid(e)),e},Re.wrapX=function(t,e,i){var r=e[0],n=t.getTileCoordCenter(e),a=Re.extentFromProjection(i);if(g.containsCoordinate(a,n))return e;var o=g.getWidth(a),s=Math.ceil((a[0]-n[0])/o);return n[0]+=o*s,t.getTileCoordForCoordAndZ(n,r)},Re.createForExtent=function(t,e,i,r){var n=r!==void 0?r:Zr.TOP_LEFT,a=Re.resolutionsFromExtent(t,e,i);return new Yt({extent:t,origin:g.getCorner(t,n),resolutions:a,tileSize:i})},Re.createXYZ=function(t){var e={};return ht.assign(e,t!==void 0?t:{}),e.extent===void 0&&(e.extent=k.get("EPSG:3857").getExtent()),e.resolutions=Re.resolutionsFromExtent(e.extent,e.maxZoom,e.tileSize),delete e.maxZoom,new Yt(e)},Re.resolutionsFromExtent=function(t,e,i){for(var r=e!==void 0?e:_.DEFAULT_MAX_ZOOM,n=g.getHeight(t),a=g.getWidth(t),o=ni.toSize(i!==void 0?i:_.DEFAULT_TILE_SIZE),s=Math.max(a/o[0],n/o[1]),l=r+1,h=new Array(l),u=0;u<l;++u)h[u]=s/Math.pow(2,u);return h},Re.createForProjection=function(t,e,i,r){var n=Re.extentFromProjection(t);return Re.createForExtent(n,e,i,r)},Re.extentFromProjection=function(t){t=k.get(t);var e=t.getExtent();if(!e){var i=180*k.METERS_PER_UNIT[_e.DEGREES]/t.getMetersPerUnit();e=g.createOrUpdate(-i,-i,i,i)}return e};var Xr=function(t){this.html_=t.html,this.tileRanges_=t.tileRanges?t.tileRanges:null};Xr.prototype.getHTML=function(){return this.html_},Xr.prototype.intersectsAnyTileRange=function(t,e,i){if(!this.tileRanges_)return!0;var r,n,a,o;for(o in t)if(o in this.tileRanges_){a=t[o];var s;for(r=0,n=this.tileRanges_[o].length;r<n;++r){if(s=this.tileRanges_[o][r],s.intersects(a))return!0;var l=e.getTileRangeForExtentAndZ(Re.extentFromProjection(i),parseInt(o,10)),h=l.getWidth();if((a.minX<l.minX||a.maxX>l.maxX)&&(s.intersects(new Ae(j.modulo(a.minX,h),j.modulo(a.maxX,h),a.minY,a.maxY))||a.getWidth()>h&&s.intersects(l)))return!0}}return!1};var qe=function(t){it.call(this),this.projection_=k.get(t.projection),this.attributions_=null,this.attributions2_=this.adaptAttributions_(t.attributions),this.logo_=t.logo,this.state_=t.state!==void 0?t.state:Or.READY,this.wrapX_=t.wrapX!==void 0?t.wrapX:!1};_.inherits(qe,it),qe.prototype.adaptAttributions_=function(t){if(!t)return null;if(t instanceof Xr)return this.attributions_=[t],function(i){return[t.getHTML()]};if(Array.isArray(t)){if(t[0]instanceof Xr){this.attributions_=t;var e=t.map(function(i){return i.getHTML()});return function(i){return e}}return this.attributions_=t.map(function(i){return new Xr({html:i})}),function(i){return t}}return typeof t=="function"?t:(this.attributions_=[new Xr({html:t})],function(i){return[t]})},qe.prototype.forEachFeatureAtCoordinate=_.nullFunction,qe.prototype.getAttributions=function(){return this.attributions_},qe.prototype.getAttributions2=function(){return this.attributions2_},qe.prototype.getLogo=function(){return this.logo_},qe.prototype.getProjection=function(){return this.projection_},qe.prototype.getResolutions=function(){},qe.prototype.getState=function(){return this.state_},qe.prototype.getWrapX=function(){return this.wrapX_},qe.prototype.refresh=function(){this.changed()},qe.prototype.setAttributions=function(t){this.attributions2_=this.adaptAttributions_(t),this.changed()},qe.prototype.setLogo=function(t){this.logo_=t},qe.prototype.setState=function(t){this.state_=t,this.changed()};var Qt=function(t){qe.call(this,{attributions:t.attributions,extent:t.extent,logo:t.logo,projection:t.projection,state:t.state,wrapX:t.wrapX}),this.opaque_=t.opaque!==void 0?t.opaque:!1,this.tilePixelRatio_=t.tilePixelRatio!==void 0?t.tilePixelRatio:1,this.tileGrid=t.tileGrid!==void 0?t.tileGrid:null,this.tileCache=new Qr(t.cacheSize),this.tmpSize=[0,0],this.key_="",this.tileOptions={transition:t.transition}};_.inherits(Qt,qe),Qt.prototype.canExpireCache=function(){return this.tileCache.canExpireCache()},Qt.prototype.expireCache=function(t,e){var i=this.getTileCacheForProjection(t);i&&i.expireCache(e)},Qt.prototype.forEachLoadedTile=function(t,e,i,r){var n=this.getTileCacheForProjection(t);if(!n)return!1;for(var a=!0,o,s,l,h=i.minX;h<=i.maxX;++h)for(var u=i.minY;u<=i.maxY;++u)s=De.getKeyZXY(e,h,u),l=!1,n.containsKey(s)&&(o=n.get(s),l=o.getState()===V.LOADED,l&&(l=r(o)!==!1)),l||(a=!1);return a},Qt.prototype.getGutter=function(t){return 0},Qt.prototype.getKey=function(){return this.key_},Qt.prototype.setKey=function(t){this.key_!==t&&(this.key_=t,this.changed())},Qt.prototype.getOpaque=function(t){return this.opaque_},Qt.prototype.getResolutions=function(){return this.tileGrid.getResolutions()},Qt.prototype.getTile=function(t,e,i,r,n){},Qt.prototype.getTileGrid=function(){return this.tileGrid},Qt.prototype.getTileGridForProjection=function(t){return this.tileGrid?this.tileGrid:Re.getForProjection(t)},Qt.prototype.getTileCacheForProjection=function(t){var e=this.getProjection();return e&&!k.equivalent(e,t)?null:this.tileCache},Qt.prototype.getTilePixelRatio=function(t){return this.tilePixelRatio_},Qt.prototype.getTilePixelSize=function(t,e,i){var r=this.getTileGridForProjection(i),n=this.getTilePixelRatio(e),a=ni.toSize(r.getTileSize(t),this.tmpSize);return n==1?a:ni.scale(a,n,this.tmpSize)},Qt.prototype.getTileCoordForTileUrlFunction=function(t,e){var i=e!==void 0?e:this.getProjection(),r=this.getTileGridForProjection(i);return this.getWrapX()&&i.isGlobal()&&(t=Re.wrapX(r,t,i)),De.withinExtentAndZ(t,r)?t:null},Qt.prototype.refresh=function(){this.tileCache.clear(),this.changed()},Qt.prototype.useTile=_.nullFunction,Qt.Event=function(t,e){ue.call(this,t),this.tile=e},_.inherits(Qt.Event,ue);var Hn={TILELOADSTART:"tileloadstart",TILELOADEND:"tileloadend",TILELOADERROR:"tileloaderror"},be=function(t){Qt.call(this,{attributions:t.attributions,cacheSize:t.cacheSize,extent:t.extent,logo:t.logo,opaque:t.opaque,projection:t.projection,state:t.state,tileGrid:t.tileGrid,tilePixelRatio:t.tilePixelRatio,wrapX:t.wrapX,transition:t.transition}),this.tileLoadFunction=t.tileLoadFunction,this.tileUrlFunction=this.fixedTileUrlFunction?this.fixedTileUrlFunction.bind(this):Oi.nullTileUrlFunction,this.urls=null,t.urls?this.setUrls(t.urls):t.url&&this.setUrl(t.url),t.tileUrlFunction&&this.setTileUrlFunction(t.tileUrlFunction),this.tileLoadingKeys_={}};_.inherits(be,Qt),be.prototype.fixedTileUrlFunction,be.prototype.getTileLoadFunction=function(){return this.tileLoadFunction},be.prototype.getTileUrlFunction=function(){return this.tileUrlFunction},be.prototype.getUrls=function(){return this.urls},be.prototype.handleTileChange=function(t){var e=t.target,i=_.getUid(e),r=e.getState(),n;r==V.LOADING?(this.tileLoadingKeys_[i]=!0,n=Hn.TILELOADSTART):i in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[i],n=r==V.ERROR?Hn.TILELOADERROR:r==V.LOADED||r==V.ABORT?Hn.TILELOADEND:void 0),n!=null&&this.dispatchEvent(new Qt.Event(n,e))},be.prototype.setTileLoadFunction=function(t){this.tileCache.clear(),this.tileLoadFunction=t,this.changed()},be.prototype.setTileUrlFunction=function(t,e){this.tileUrlFunction=t,this.tileCache.pruneExceptNewestZ(),typeof e<"u"?this.setKey(e):this.changed()},be.prototype.setUrl=function(t){var e=this.urls=Oi.expandUrl(t);this.setTileUrlFunction(this.fixedTileUrlFunction?this.fixedTileUrlFunction.bind(this):Oi.createFromTemplates(e,this.tileGrid),t)},be.prototype.setUrls=function(t){this.urls=t;var e=t.join(`
`);this.setTileUrlFunction(this.fixedTileUrlFunction?this.fixedTileUrlFunction.bind(this):Oi.createFromTemplates(t,this.tileGrid),e)},be.prototype.useTile=function(t,e,i){var r=De.getKeyZXY(t,e,i);this.tileCache.containsKey(r)&&this.tileCache.get(r)};var We=function(t){be.call(this,{attributions:t.attributions,cacheSize:t.cacheSize,extent:t.extent,logo:t.logo,opaque:t.opaque,projection:t.projection,state:t.state,tileGrid:t.tileGrid,tileLoadFunction:t.tileLoadFunction?t.tileLoadFunction:We.defaultTileLoadFunction,tilePixelRatio:t.tilePixelRatio,tileUrlFunction:t.tileUrlFunction,url:t.url,urls:t.urls,wrapX:t.wrapX,transition:t.transition}),this.crossOrigin=t.crossOrigin!==void 0?t.crossOrigin:null,this.tileClass=t.tileClass!==void 0?t.tileClass:mi,this.tileCacheForProjection={},this.tileGridForProjection={},this.reprojectionErrorThreshold_=t.reprojectionErrorThreshold,this.renderReprojectionEdges_=!1};_.inherits(We,be),We.prototype.canExpireCache=function(){if(!_.ENABLE_RASTER_REPROJECTION)return be.prototype.canExpireCache.call(this);if(this.tileCache.canExpireCache())return!0;for(var t in this.tileCacheForProjection)if(this.tileCacheForProjection[t].canExpireCache())return!0;return!1},We.prototype.expireCache=function(t,e){if(!_.ENABLE_RASTER_REPROJECTION){be.prototype.expireCache.call(this,t,e);return}var i=this.getTileCacheForProjection(t);this.tileCache.expireCache(this.tileCache==i?e:{});for(var r in this.tileCacheForProjection){var n=this.tileCacheForProjection[r];n.expireCache(n==i?e:{})}},We.prototype.getGutter=function(t){return _.ENABLE_RASTER_REPROJECTION&&this.getProjection()&&t&&!k.equivalent(this.getProjection(),t)?0:this.getGutterInternal()},We.prototype.getGutterInternal=function(){return 0},We.prototype.getOpaque=function(t){return _.ENABLE_RASTER_REPROJECTION&&this.getProjection()&&t&&!k.equivalent(this.getProjection(),t)?!1:be.prototype.getOpaque.call(this,t)},We.prototype.getTileGridForProjection=function(t){if(!_.ENABLE_RASTER_REPROJECTION)return be.prototype.getTileGridForProjection.call(this,t);var e=this.getProjection();if(this.tileGrid&&(!e||k.equivalent(e,t)))return this.tileGrid;var i=_.getUid(t).toString();return i in this.tileGridForProjection||(this.tileGridForProjection[i]=Re.getForProjection(t)),this.tileGridForProjection[i]},We.prototype.getTileCacheForProjection=function(t){if(!_.ENABLE_RASTER_REPROJECTION)return be.prototype.getTileCacheForProjection.call(this,t);var e=this.getProjection();if(!e||k.equivalent(e,t))return this.tileCache;var i=_.getUid(t).toString();return i in this.tileCacheForProjection||(this.tileCacheForProjection[i]=new Qr(this.tileCache.highWaterMark)),this.tileCacheForProjection[i]},We.prototype.createTile_=function(t,e,i,r,n,a){var o=[t,e,i],s=this.getTileCoordForTileUrlFunction(o,n),l=s?this.tileUrlFunction(s,r,n):void 0,h=new this.tileClass(o,l!==void 0?V.IDLE:V.EMPTY,l!==void 0?l:"",this.crossOrigin,this.tileLoadFunction,this.tileOptions);return h.key=a,L.listen(h,tt.CHANGE,this.handleTileChange,this),h},We.prototype.getTile=function(t,e,i,r,n){var a=this.getProjection();if(!_.ENABLE_RASTER_REPROJECTION||!a||!n||k.equivalent(a,n))return this.getTileInternal(t,e,i,r,a||n);var o=this.getTileCacheForProjection(n),s=[t,e,i],l,h=De.getKey(s);o.containsKey(h)&&(l=o.get(h));var u=this.getKey();if(l&&l.key==u)return l;var f=this.getTileGridForProjection(a),c=this.getTileGridForProjection(n),d=this.getTileCoordForTileUrlFunction(s,n),v=new Cr(a,f,n,c,s,d,this.getTilePixelRatio(r),this.getGutterInternal(),(function(E,p,m,y){return this.getTileInternal(E,p,m,y,a)}).bind(this),this.reprojectionErrorThreshold_,this.renderReprojectionEdges_);return v.key=u,l?(v.interimTile=l,v.refreshInterimChain(),o.replace(h,v)):o.set(h,v),v},We.prototype.getTileInternal=function(t,e,i,r,n){var a=null,o=De.getKeyZXY(t,e,i),s=this.getKey();if(!this.tileCache.containsKey(o))a=this.createTile_(t,e,i,r,n,s),this.tileCache.set(o,a);else if(a=this.tileCache.get(o),a.key!=s){var l=a;a=this.createTile_(t,e,i,r,n,s),l.getState()==V.IDLE?a.interimTile=l.interimTile:a.interimTile=l,a.refreshInterimChain(),this.tileCache.replace(o,a)}return a},We.prototype.setRenderReprojectionEdges=function(t){if(!(!_.ENABLE_RASTER_REPROJECTION||this.renderReprojectionEdges_==t)){this.renderReprojectionEdges_=t;for(var e in this.tileCacheForProjection)this.tileCacheForProjection[e].clear();this.changed()}},We.prototype.setTileGridForProjection=function(t,e){if(_.ENABLE_RASTER_REPROJECTION){var i=k.get(t);if(i){var r=_.getUid(i).toString();r in this.tileGridForProjection||(this.tileGridForProjection[r]=e)}}},We.defaultTileLoadFunction=function(t,e){t.getImage().src=e};var Kn=function(t){var e=t||{},i=e.projection!==void 0?e.projection:"EPSG:3857",r=e.tileGrid!==void 0?e.tileGrid:Re.createXYZ({extent:Re.extentFromProjection(i),maxZoom:e.maxZoom,minZoom:e.minZoom,tileSize:e.tileSize});We.call(this,{attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,logo:e.logo,opaque:e.opaque,projection:i,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileGrid:r,tileLoadFunction:e.tileLoadFunction,tilePixelRatio:e.tilePixelRatio,tileUrlFunction:e.tileUrlFunction,url:e.url,urls:e.urls,wrapX:e.wrapX!==void 0?e.wrapX:!0,transition:e.transition})};_.inherits(Kn,We);var An=function(t){var e=t||{},i;e.attributions!==void 0?i=e.attributions:i=[An.ATTRIBUTION];var r=e.crossOrigin!==void 0?e.crossOrigin:"anonymous",n=e.url!==void 0?e.url:"https://{a-c}.tile.openstreetmap.org/{z}/{x}/{y}.png";Kn.call(this,{attributions:i,cacheSize:e.cacheSize,crossOrigin:r,opaque:e.opaque!==void 0?e.opaque:!0,maxZoom:e.maxZoom!==void 0?e.maxZoom:19,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileLoadFunction:e.tileLoadFunction,url:n,wrapX:e.wrapX})};_.inherits(An,Kn),An.ATTRIBUTION='&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors.';function So({className:t}){const e=Zt.useRef();return Zt.useEffect(()=>{const i=new pr({preload:1/0,source:new An}),r=new ma({target:e.current,layers:[i],view:new q({center:[0,0],zoom:0})});return()=>r.setTarget(null)},[]),mt.jsx("div",{id:"map",className:`map-container w-full ${t}`,ref:e})}const Lo=new an({headers:{accept:"application/json;version=2"}}),Ao=new Bn(Lo);function wo({tsids:t,office:e,begin:i,end:r,title:n,fontSize:a,unit:o="EN",className:s=""}){const l=Zt.useRef(null);Zt.useState(null);const[h,u]=Zt.useState(null),[f,c]=Zt.useState(null),[d,v]=Zt.useState(a);Zt.useEffect(()=>{if(n||u((Array.isArray(t)?t[0]:t).split(".")[0]),!t.length)throw Error("You must specify one or more Timeseries IDs to plot.");if(!e)throw Error("You must specify a 3 letter ID for the office");typeof t=="string"&&(t=[t]),c(t)},[n,t,e]);const E=async()=>{let m=f.map(C=>Ao.getCwmsDataTimeseries({name:C,end:r,unit:o,begin:i,office:e})),y=await Promise.all(m),R={ts:{},dates:[]};return y.forEach(C=>{C!=null&&C.units?(R.ts[C.units]||(R.ts[C.units]=[]),R.ts[C.units].push(C)):console.warn(`No unit found for ${C==null?void 0:C.name}`)}),R},{data:p}=$n.useQuery({queryKey:["timeseries",f,i,r,o,e],queryFn:E,enabled:!!l.current});return Zt.useEffect(()=>{if(!l.current||!p)return;let m=Object.keys(p.ts),y=m.length,R={autosize:!0,shapes:[],annotations:[],title:{text:`${h}<br>Units: ${m.join(", ")}`,font:{family:"DejaVuSansMono, monospace"}},grid:{rows:y,columns:1,pattern:"independent"}},C=[],x=1,I=0,D=1/m.length,O=D;d?R.font={size:d}:m.length>4&&(R.font={size:8});let B;for(let W=0;W<m.length;W++){const N=m[W];for(let $=0;$<p.ts[N].length;$++){B=p.ts[N][$];const b={x:B.values.map(M=>new Date(M[0])),y:B.values.map(M=>M[1]),yaxis:"y"+x,type:"scatter",mode:"lines",showlegend:!0,legend:{x:1,xanchor:"right",y:1},name:`${B.name.split(".")[1]}<br>${B.name.split(".")[5]}`};C.push(b)}let P=`${B.name.split(".")[1]}<br>(${N})`;m.length>3&&(P=N),R["yaxis"+x]={domain:[Math.round(I*100)/100,Math.round(O*100)/100],title:{text:P}},m.length>4&&(R["yaxis"+x].nticks=1,R["yaxis"+x].tickvals=[B.values[B.values.length/2]],R["yaxis"+x].dtick=1,R["yaxis"+x].tick0=.5),I+=D,O+=D,x++}qn.newPlot(l.current,C,R,{responsive:!0})},[p,n]),mt.jsx("div",{className:`h-full w-full ${s}`,style:{height:"500px"},children:mt.jsx("div",{ref:l,id:"plot",className:"h-full w-full",style:{height:"500px"},children:p?mt.jsx("div",{children:"Loading..."}):mt.jsx("div",{children:"No Data"})})})}ci.CWMSPlot=wo,ci.GageMap=So,ci.TSPlot=io,ci.TSTable=uo,Object.defineProperty(ci,Symbol.toStringTag,{value:"Module"})});
